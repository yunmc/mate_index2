var Al=Object.defineProperty;var Cl=(y,A,T)=>A in y?Al(y,A,{enumerable:!0,configurable:!0,writable:!0,value:T}):y[A]=T;var Ro=(y,A,T)=>(Cl(y,typeof A!="symbol"?A+"":A,T),T);import{i as Tl,R as Dl,P as Sl,S as Ll,k as Jr,b as El,T as pc,V as ya,n as zr,H as kl,o as No,j as Oo,q as Gn,l as Rl,N as Nl,g as fn,U as Ol,W as Gl,Y as Pl,Z as Ul}from"./index.054f1d57.js";import{X as Da,c as pe,r as Fe,Q as Sa,U as Ms,p as La,i as Ea,d as Tt,a5 as bl,h as Pe,o as Un,t as Aa,O as wl,a6 as Fl,w as Wt,S as Uo,W as ql,P as xl,E as ka,a7 as Xr,v as bo,V as $r,e as ee,f as ne,j as Ue,k as it,l as J,z as gn,m as $e,n as B,x as wo,y as Fo,u as Cs,b as bn,s as ct,q as Ca,F as yt,H as on,a8 as _c,g as Mt,a9 as Go,I as hn,aa as gs,ab as Qr,ac as hs,ad as Vl,C as Zr}from"./index.7ece7038.js";import{b as ys,k as Ra,_ as ec,l as Bl}from"./close_icon.ad697c3f.js";import{b as Hl,A as Kl,f as gc,i as qo,g as Wl,k as De,c as qt,h as Se,u as Na,j as Yl,F as tc,a7 as jl,a8 as Ta,a9 as nc,x as Jl,aa as Pn,_ as mn,o as As}from"./_plugin-vue_export-helper.b3c3debc.js";import{c as zl,b as Xl,N as sn}from"./Image.c819e62f.js";function $l(y){if(typeof y=="number")return{"":y.toString()};const A={};return y.split(/ +/).forEach(T=>{if(T==="")return;const[l,O]=T.split(":");O===void 0?A[""]=l:A[l]=O}),A}function On(y,A){var T;if(y==null)return;const l=$l(y);if(A===void 0)return l[""];if(typeof A=="string")return(T=l[A])!==null&&T!==void 0?T:l[""];if(Array.isArray(A)){for(let O=A.length-1;O>=0;--O){const D=A[O];if(D in l)return l[D]}return l[""]}else{let O,D=-1;return Object.keys(l).forEach(w=>{const R=Number(w);!Number.isNaN(R)&&A>=R&&R>=D&&(D=R,O=l[w])}),O}}function Ql(y,A="default",T=[]){const O=y.$slots[A];return O===void 0?T:O()}function Zl(y){var A;const T=(A=y.dirs)===null||A===void 0?void 0:A.find(({dir:l})=>l===Da);return!!(T&&T.value===!1)}const ed={xs:0,s:640,m:1024,l:1280,xl:1536,"2xl":1920};function td(y){return`(min-width: ${y}px)`}const Po={};function nd(y=ed){if(!Tl)return pe(()=>[]);if(typeof window.matchMedia!="function")return pe(()=>[]);const A=Fe({}),T=Object.keys(y),l=(O,D)=>{O.matches?A.value[D]=!0:A.value[D]=!1};return T.forEach(O=>{const D=y[O];let w,R;Po[D]===void 0?(w=window.matchMedia(td(D)),w.addEventListener?w.addEventListener("change",H=>{R.forEach(z=>{z(H,O)})}):w.addListener&&w.addListener(H=>{R.forEach(z=>{z(H,O)})}),R=new Set,Po[D]={mql:w,cbs:R}):(w=Po[D].mql,R=Po[D].cbs),R.add(l),w.matches&&R.forEach(H=>{H(w,O)})}),Sa(()=>{T.forEach(O=>{const{cbs:D}=Po[y[O]];D.has(l)&&D.delete(l)})}),pe(()=>{const{value:O}=A;return T.filter(D=>O[D])})}function od(y){return Dl(Sl(y).toLowerCase())}var sd=zl(function(y,A,T){return A=A.toLowerCase(),y+(T?od(A):A)});const oc=sd,id=y=>({dotSize:"8px",dotColor:"rgba(255, 255, 255, .3)",dotColorActive:"rgba(255, 255, 255, 1)",dotColorFocus:"rgba(255, 255, 255, .5)",dotLineWidth:"16px",dotLineWidthActive:"24px",arrowColor:"#eee"}),ad={name:"Carousel",common:Hl,self:id},rd=ad;function cd(y){const{length:A}=y;return A>1&&(y.push(sc(y[0],0,"append")),y.unshift(sc(y[A-1],A-1,"prepend"))),y}function sc(y,A,T){return Ms(y,{key:`carousel-item-duplicate-${A}-${T}`})}function ic(y,A,T){return A===1?0:T?y===0?A-3:y===A-1?0:y-1:y}function va(y,A){return A?y+1:y}function ud(y,A,T){return y<0?null:y===0?T?A-1:null:y-1}function ld(y,A,T){return y>A-1?null:y===A-1?T?0:null:y+1}function dd(y,A){return A&&y>3?y-2:y}function ac(y){return window.TouchEvent&&y instanceof window.TouchEvent}function rc(y,A){let{offsetWidth:T,offsetHeight:l}=y;if(A){const O=getComputedStyle(y);T=T-parseFloat(O.getPropertyValue("padding-left"))-parseFloat(O.getPropertyValue("padding-right")),l=l-parseFloat(O.getPropertyValue("padding-top"))-parseFloat(O.getPropertyValue("padding-bottom"))}return{width:T,height:l}}function fs(y,A,T){return y<A?A:y>T?T:y}function pd(y){if(y===void 0)return 0;if(typeof y=="number")return y;const A=/^((\d+)?\.?\d+?)(ms|s)?$/,T=y.match(A);if(T){const[,l,,O="ms"]=T;return Number(l)*(O==="ms"?1:1e3)}return 0}const hc=gc("n-carousel-methods"),_d=y=>{La(hc,y)},Oa=(y="unknown",A="component")=>{const T=Ea(hc);return T||Kl(y,`\`${A}\` must be placed inside \`n-carousel\`.`),T},gd={total:{type:Number,default:0},currentIndex:{type:Number,default:0},dotType:{type:String,default:"dot"},trigger:{type:String,default:"click"},keyboard:Boolean},hd=Tt({name:"CarouselDots",props:gd,setup(y){const{mergedClsPrefixRef:A}=qo(y),T=Fe([]),l=Oa();function O(z,oe){switch(z.key){case"Enter":case" ":z.preventDefault(),l.to(oe);return}y.keyboard&&R(z)}function D(z){y.trigger==="hover"&&l.to(z)}function w(z){y.trigger==="click"&&l.to(z)}function R(z){var oe;if(z.shiftKey||z.altKey||z.ctrlKey||z.metaKey)return;const _e=(oe=document.activeElement)===null||oe===void 0?void 0:oe.nodeName.toLowerCase();if(_e==="input"||_e==="textarea")return;const{code:ve}=z,Ie=ve==="PageUp"||ve==="ArrowUp",j=ve==="PageDown"||ve==="ArrowDown",Z=ve==="PageUp"||ve==="ArrowRight",K=ve==="PageDown"||ve==="ArrowLeft",X=l.isVertical(),$=X?Ie:Z,b=X?j:K;!$&&!b||(z.preventDefault(),$&&!l.isNextDisabled()?(l.next(),H(l.currentIndexRef.value)):b&&!l.isPrevDisabled()&&(l.prev(),H(l.currentIndexRef.value)))}function H(z){var oe;(oe=T.value[z])===null||oe===void 0||oe.focus()}return bl(()=>T.value.length=0),{mergedClsPrefix:A,dotEls:T,handleKeydown:O,handleMouseenter:D,handleClick:w}},render(){const{mergedClsPrefix:y,dotEls:A}=this;return Pe("div",{class:[`${y}-carousel__dots`,`${y}-carousel__dots--${this.dotType}`],role:"tablist"},Ll(this.total,T=>{const l=T===this.currentIndex;return Pe("div",{"aria-selected":l,ref:O=>A.push(O),role:"button",tabindex:"0",class:[`${y}-carousel__dot`,l&&`${y}-carousel__dot--active`],key:T,onClick:()=>{this.handleClick(T)},onMouseenter:()=>{this.handleMouseenter(T)},onKeydown:O=>{this.handleKeydown(O,T)}})}))}}),fd=Pe("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},Pe("g",{fill:"none"},Pe("path",{d:"M10.26 3.2a.75.75 0 0 1 .04 1.06L6.773 8l3.527 3.74a.75.75 0 1 1-1.1 1.02l-4-4.25a.75.75 0 0 1 0-1.02l4-4.25a.75.75 0 0 1 1.06-.04z",fill:"currentColor"}))),md=Pe("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},Pe("g",{fill:"none"},Pe("path",{d:"M5.74 3.2a.75.75 0 0 0-.04 1.06L9.227 8L5.7 11.74a.75.75 0 1 0 1.1 1.02l4-4.25a.75.75 0 0 0 0-1.02l-4-4.25a.75.75 0 0 0-1.06-.04z",fill:"currentColor"}))),vd=Tt({name:"CarouselArrow",setup(y){const{mergedClsPrefixRef:A}=qo(y),{isVertical:T,isPrevDisabled:l,isNextDisabled:O,prev:D,next:w}=Oa();return{mergedClsPrefix:A,isVertical:T,isPrevDisabled:l,isNextDisabled:O,prev:D,next:w}},render(){const{mergedClsPrefix:y}=this;return Pe("div",{class:`${y}-carousel__arrow-group`},Pe("div",{class:[`${y}-carousel__arrow`,this.isPrevDisabled()&&`${y}-carousel__arrow--disabled`],role:"button",onClick:this.prev},fd),Pe("div",{class:[`${y}-carousel__arrow`,this.isNextDisabled()&&`${y}-carousel__arrow--disabled`],role:"button",onClick:this.next},md))}}),Is="CarouselItem",Id=y=>{var A;return((A=y.type)===null||A===void 0?void 0:A.name)===Is},Md=Tt({name:Is,setup(y){const{mergedClsPrefixRef:A}=qo(y),T=Oa(oc(Is),`n-${oc(Is)}`),l=Fe(),O=pe(()=>{const{value:oe}=l;return oe?T.getSlideIndex(oe):-1}),D=pe(()=>T.isPrev(O.value)),w=pe(()=>T.isNext(O.value)),R=pe(()=>T.isActive(O.value)),H=pe(()=>T.getSlideStyle(O.value));Un(()=>{T.addSlide(l.value)}),Sa(()=>{T.removeSlide(l.value)});function z(oe){const{value:_e}=O;_e!==void 0&&(T==null||T.onCarouselItemClick(_e,oe))}return{mergedClsPrefix:A,selfElRef:l,isPrev:D,isNext:w,isActive:R,index:O,style:H,handleClick:z}},render(){var y;const{$slots:A,mergedClsPrefix:T,isPrev:l,isNext:O,isActive:D,index:w,style:R}=this,H=[`${T}-carousel__slide`,{[`${T}-carousel__slide--current`]:D,[`${T}-carousel__slide--prev`]:l,[`${T}-carousel__slide--next`]:O}];return Pe("div",{ref:"selfElRef",class:H,role:"option",tabindex:"-1","data-index":w,"aria-hidden":!D,style:R,onClickCapture:this.handleClick},(y=A.default)===null||y===void 0?void 0:y.call(A,{isPrev:l,isNext:O,isActive:D,index:w}))}}),yd=Wl("carousel",`
 position: relative;
 width: 100%;
 height: 100%;
 touch-action: pan-y;
 overflow: hidden;
`,[De("slides",`
 display: flex;
 width: 100%;
 height: 100%;
 transition-timing-function: var(--n-bezier);
 transition-property: transform;
 `,[De("slide",`
 flex-shrink: 0;
 position: relative;
 width: 100%;
 height: 100%;
 outline: none;
 overflow: hidden;
 `,[qt("> img",`
 display: block;
 `)])]),De("dots",`
 position: absolute;
 display: flex;
 flex-wrap: nowrap;
 `,[Se("dot",[De("dot",`
 height: var(--n-dot-size);
 width: var(--n-dot-size);
 background-color: var(--n-dot-color);
 border-radius: 50%;
 cursor: pointer;
 transition:
 box-shadow .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 outline: none;
 `,[qt("&:focus",`
 background-color: var(--n-dot-color-focus);
 `),Se("active",`
 background-color: var(--n-dot-color-active);
 `)])]),Se("line",[De("dot",`
 border-radius: 9999px;
 width: var(--n-dot-line-width);
 height: 4px;
 background-color: var(--n-dot-color);
 cursor: pointer;
 transition:
 width .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 outline: none;
 `,[qt("&:focus",`
 background-color: var(--n-dot-color-focus);
 `),Se("active",`
 width: var(--n-dot-line-width-active);
 background-color: var(--n-dot-color-active);
 `)])])]),De("arrow",`
 transition: background-color .3s var(--n-bezier);
 cursor: pointer;
 height: 28px;
 width: 28px;
 display: flex;
 align-items: center;
 justify-content: center;
 background-color: rgba(255, 255, 255, .2);
 color: var(--n-arrow-color);
 border-radius: 8px;
 user-select: none;
 -webkit-user-select: none;
 font-size: 18px;
 `,[qt("svg",`
 height: 1em;
 width: 1em;
 `),qt("&:hover",`
 background-color: rgba(255, 255, 255, .3);
 `)]),Se("vertical",`
 touch-action: pan-x;
 `,[De("slides",`
 flex-direction: column;
 `),Se("fade",[De("slide",`
 top: 50%;
 left: unset;
 transform: translateY(-50%);
 `)]),Se("card",[De("slide",`
 top: 50%;
 left: unset;
 transform: translateY(-50%) translateZ(-400px);
 `,[Se("current",`
 transform: translateY(-50%) translateZ(0);
 `),Se("prev",`
 transform: translateY(-100%) translateZ(-200px);
 `),Se("next",`
 transform: translateY(0%) translateZ(-200px);
 `)])])]),Se("usercontrol",[De("slides",[qt(">",[qt("div",`
 position: absolute;
 top: 50%;
 left: 50%;
 width: 100%;
 height: 100%;
 transform: translate(-50%, -50%);
 `)])])]),Se("left",[De("dots",`
 transform: translateY(-50%);
 top: 50%;
 left: 12px;
 flex-direction: column;
 `,[Se("line",[De("dot",`
 width: 4px;
 height: var(--n-dot-line-width);
 margin: 4px 0;
 transition:
 height .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 outline: none;
 `,[Se("active",`
 height: var(--n-dot-line-width-active);
 `)])])]),De("dot",`
 margin: 4px 0;
 `)]),De("arrow-group",`
 position: absolute;
 display: flex;
 flex-wrap: nowrap;
 `),Se("vertical",[De("arrow",`
 transform: rotate(90deg);
 `)]),Se("show-arrow",[Se("bottom",[De("dots",`
 transform: translateX(0);
 bottom: 18px;
 left: 18px;
 `)]),Se("top",[De("dots",`
 transform: translateX(0);
 top: 18px;
 left: 18px;
 `)]),Se("left",[De("dots",`
 transform: translateX(0);
 top: 18px;
 left: 18px;
 `)]),Se("right",[De("dots",`
 transform: translateX(0);
 top: 18px;
 right: 18px;
 `)])]),Se("left",[De("arrow-group",`
 bottom: 12px;
 left: 12px;
 flex-direction: column;
 `,[qt("> *:first-child",`
 margin-bottom: 12px;
 `)])]),Se("right",[De("dots",`
 transform: translateY(-50%);
 top: 50%;
 right: 12px;
 flex-direction: column;
 `,[Se("line",[De("dot",`
 width: 4px;
 height: var(--n-dot-line-width);
 margin: 4px 0;
 transition:
 height .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 outline: none;
 `,[Se("active",`
 height: var(--n-dot-line-width-active);
 `)])])]),De("dot",`
 margin: 4px 0;
 `),De("arrow-group",`
 bottom: 12px;
 right: 12px;
 flex-direction: column;
 `,[qt("> *:first-child",`
 margin-bottom: 12px;
 `)])]),Se("top",[De("dots",`
 transform: translateX(-50%);
 top: 12px;
 left: 50%;
 `,[Se("line",[De("dot",`
 margin: 0 4px;
 `)])]),De("dot",`
 margin: 0 4px;
 `),De("arrow-group",`
 top: 12px;
 right: 12px;
 `,[qt("> *:first-child",`
 margin-right: 12px;
 `)])]),Se("bottom",[De("dots",`
 transform: translateX(-50%);
 bottom: 12px;
 left: 50%;
 `,[Se("line",[De("dot",`
 margin: 0 4px;
 `)])]),De("dot",`
 margin: 0 4px;
 `),De("arrow-group",`
 bottom: 12px;
 right: 12px;
 `,[qt("> *:first-child",`
 margin-right: 12px;
 `)])]),Se("fade",[De("slide",`
 position: absolute;
 opacity: 0;
 transition-property: opacity;
 pointer-events: none;
 `,[Se("current",`
 opacity: 1;
 pointer-events: auto;
 `)])]),Se("card",[De("slides",`
 perspective: 1000px;
 `),De("slide",`
 position: absolute;
 left: 50%;
 opacity: 0;
 transform: translateX(-50%) translateZ(-400px);
 transition-property: opacity, transform;
 `,[Se("current",`
 opacity: 1;
 transform: translateX(-50%) translateZ(0);
 z-index: 1;
 `),Se("prev",`
 opacity: 0.4;
 transform: translateX(-100%) translateZ(-200px);
 `),Se("next",`
 opacity: 0.4;
 transform: translateX(0%) translateZ(-200px);
 `)])])]),Ad=["transitionDuration","transitionTimingFunction"],Cd=Object.assign(Object.assign({},Na.props),{defaultIndex:{type:Number,default:0},currentIndex:Number,showArrow:Boolean,dotType:{type:String,default:"dot"},dotPlacement:{type:String,default:"bottom"},slidesPerView:{type:[Number,String],default:1},spaceBetween:{type:Number,default:0},centeredSlides:Boolean,direction:{type:String,default:"horizontal"},autoplay:Boolean,interval:{type:Number,default:5e3},loop:{type:Boolean,default:!0},effect:{type:String,default:"slide"},showDots:{type:Boolean,default:!0},trigger:{type:String,default:"click"},transitionStyle:{type:Object,default:()=>({transitionDuration:"300ms"})},transitionProps:Object,draggable:Boolean,prevSlideStyle:[Object,String],nextSlideStyle:[Object,String],touchable:{type:Boolean,default:!0},mousewheel:Boolean,keyboard:Boolean,"onUpdate:currentIndex":Function,onUpdateCurrentIndex:Function});let Ia=!1;const Td=Tt({name:"Carousel",props:Cd,setup(y){const{mergedClsPrefixRef:A,inlineThemeDisabled:T}=qo(y),l=Fe(null),O=Fe(null),D=Fe([]),w={value:[]},R=pe(()=>y.direction==="vertical"),H=pe(()=>R.value?"height":"width"),z=pe(()=>R.value?"bottom":"right"),oe=pe(()=>y.effect==="slide"),_e=pe(()=>y.loop&&y.slidesPerView===1&&oe.value),ve=pe(()=>y.effect==="custom"),Ie=pe(()=>!oe.value||y.centeredSlides?1:y.slidesPerView),j=pe(()=>ve.value?1:y.slidesPerView),Z=pe(()=>Ie.value==="auto"||y.slidesPerView==="auto"&&y.centeredSlides),K=Fe({width:0,height:0}),X=pe(()=>{const{value:E}=D;if(!E.length)return[];const{value:W}=Z;if(W)return E.map(be=>rc(be));const{value:se}=j,{value:me}=K,{value:Ae}=H;let ue=me[Ae];if(se!=="auto"){const{spaceBetween:be}=y,At=ue-(se-1)*be,G=1/Math.max(1,se);ue=At*G}const Ge=Object.assign(Object.assign({},me),{[Ae]:ue});return E.map(()=>Ge)}),$=pe(()=>{const{value:E}=X;if(!E.length)return[];const{centeredSlides:W,spaceBetween:se}=y,{value:me}=H,{[me]:Ae}=K.value;let ue=0;return E.map(({[me]:Ge})=>{let be=ue;return W&&(be+=(Ge-Ae)/2),ue+=Ge+se,be})}),b=Fe(!1),Qe=pe(()=>{const{transitionStyle:E}=y;return E?Jr(E,Ad):{}}),He=pe(()=>ve.value?0:pd(Qe.value.transitionDuration)),ut=pe(()=>{const{value:E}=D;if(!E.length)return[];const W=!(Z.value||j.value===1),se=Ge=>{if(W){const{value:be}=H;return{[be]:`${X.value[Ge][be]}px`}}};if(ve.value)return E.map((Ge,be)=>se(be));const{effect:me,spaceBetween:Ae}=y,{value:ue}=z;return E.reduce((Ge,be,At)=>{const G=Object.assign(Object.assign({},se(At)),{[`margin-${ue}`]:`${Ae}px`});return Ge.push(G),b.value&&(me==="fade"||me==="card")&&Object.assign(G,Qe.value),Ge},[])}),Je=pe(()=>{const{value:E}=Ie,{length:W}=D.value;if(E!=="auto")return Math.max(W-E,0)+1;{const{value:se}=X,{length:me}=se;if(!me)return W;const{value:Ae}=$,{value:ue}=H,Ge=K.value[ue];let be=se[se.length-1][ue],At=me;for(;At>1&&be<Ge;)At--,be+=Ae[At]-Ae[At-1];return fs(At+1,1,me)}}),ft=pe(()=>dd(Je.value,_e.value)),Ee=va(y.defaultIndex,_e.value),V=Fe(ic(Ee,Je.value,_e.value)),_=El(Aa(y,"currentIndex"),V),Me=pe(()=>va(_.value,_e.value));function Yt(E){var W,se;E=fs(E,0,Je.value-1);const me=ic(E,Je.value,_e.value),{value:Ae}=_;me!==_.value&&(V.value=me,(W=y["onUpdate:currentIndex"])===null||W===void 0||W.call(y,me,Ae),(se=y.onUpdateCurrentIndex)===null||se===void 0||se.call(y,me,Ae))}function ke(E=Me.value){return ud(E,Je.value,y.loop)}function Ne(E=Me.value){return ld(E,Je.value,y.loop)}function re(E){const W=Vt(E);return W!==null&&ke()===W}function ae(E){const W=Vt(E);return W!==null&&Ne()===W}function we(E){return Me.value===Vt(E)}function nt(E){return _.value===E}function L(){return ke()===null}function de(){return Ne()===null}function Rt(E){const W=fs(va(E,_e.value),0,Je.value);(E!==_.value||W!==Me.value)&&Yt(W)}function xt(){const E=ke();E!==null&&Yt(E)}function Nt(){const E=Ne();E!==null&&Yt(E)}function _t(){(!ot||!_e.value)&&xt()}function xo(){(!ot||!_e.value)&&Nt()}let ot=!1,Dt=0;const Zt=Fe({});function gt(E,W=0){Zt.value=Object.assign({},Qe.value,{transform:R.value?`translateY(${-E}px)`:`translateX(${-E}px)`,transitionDuration:`${W}ms`})}function ze(E=0){oe.value?vn(Me.value,E):Dt!==0&&(!ot&&E>0&&(ot=!0),gt(Dt=0,E))}function vn(E,W){const se=ge(E);se!==Dt&&W>0&&(ot=!0),Dt=ge(Me.value),gt(se,W)}function ge(E){let W;return E>=Je.value-1?W=qe():W=$.value[E]||0,W}function qe(){if(Ie.value==="auto"){const{value:E}=H,{[E]:W}=K.value,{value:se}=$,me=se[se.length-1];let Ae;if(me===void 0)Ae=W;else{const{value:ue}=X;Ae=me+ue[ue.length-1][E]}return Ae-W}else{const{value:E}=$;return E[Je.value-1]||0}}const ce={currentIndexRef:_,to:Rt,prev:_t,next:xo,isVertical:()=>R.value,isHorizontal:()=>!R.value,isPrev:re,isNext:ae,isActive:we,isPrevDisabled:L,isNextDisabled:de,getSlideIndex:Vt,getSlideStyle:Ls,addSlide:xe,removeSlide:Ss,onCarouselItemClick:wn};_d(ce);function xe(E){!E||D.value.push(E)}function Ss(E){if(!E)return;const W=Vt(E);W!==-1&&D.value.splice(W,1)}function Vt(E){return typeof E=="number"?E:E?D.value.indexOf(E):-1}function Ls(E){const W=Vt(E);if(W!==-1){const se=[ut.value[W]],me=ce.isPrev(W),Ae=ce.isNext(W);return me&&se.push(y.prevSlideStyle||""),Ae&&se.push(y.nextSlideStyle||""),ka(se)}}function wn(E,W){let se=!ot&&!Gt&&!rn;y.effect==="card"&&se&&!we(E)&&(Rt(E),se=!1),se||(W.preventDefault(),W.stopPropagation())}let In=null;function en(){In&&(clearInterval(In),In=null)}function tn(){en(),!y.autoplay||ft.value<2||(In=window.setInterval(Nt,y.interval))}let Fn=0,an=0,Ot=0,qn=0,Gt=!1,rn=!1;function xn(E){var W;if(Ia||!(!((W=O.value)===null||W===void 0)&&W.contains(kl(E))))return;Ia=!0,Gt=!0,rn=!1,qn=Date.now(),en(),E.type!=="touchstart"&&!E.target.isContentEditable&&E.preventDefault();const se=ac(E)?E.touches[0]:E;R.value?an=se.clientY:Fn=se.clientX,y.touchable&&(No("touchmove",document,cn),No("touchend",document,jt),No("touchcancel",document,jt)),y.draggable&&(No("mousemove",document,cn),No("mouseup",document,jt))}function cn(E){const{value:W}=R,{value:se}=H,me=ac(E)?E.touches[0]:E,Ae=W?me.clientY-an:me.clientX-Fn,ue=K.value[se];Ot=fs(Ae,-ue,ue),E.cancelable&&E.preventDefault(),oe.value&&gt(Dt-Ot,0)}function jt(){const{value:E}=Me;let W=E;if(!ot&&Ot!==0&&oe.value){const se=Dt-Ot,me=[...$.value.slice(0,Je.value-1),qe()];let Ae=null;for(let ue=0;ue<me.length;ue++){const Ge=Math.abs(me[ue]-se);if(Ae!==null&&Ae<Ge)break;Ae=Ge,W=ue}}if(W===E){const se=Date.now()-qn,{value:me}=H,Ae=K.value[me];Ot>Ae/2||Ot/se>.4?W=ke(E):(Ot<-Ae/2||Ot/se<-.4)&&(W=Ne(E))}W!==null&&W!==E?(rn=!0,Yt(W),Uo(()=>{(!_e.value||V.value!==_.value)&&ze(He.value)})):ze(He.value),Vo(),tn()}function Vo(){Gt&&(Ia=!1),Gt=!1,Fn=0,an=0,Ot=0,qn=0,Oo("touchmove",document,cn),Oo("touchend",document,jt),Oo("touchcancel",document,jt),Oo("mousemove",document,cn),Oo("mouseup",document,jt)}function Bo(){if(oe.value&&ot){const{value:E}=Me;vn(E,0)}else tn();oe.value&&(Zt.value.transitionDuration="0ms"),ot=!1}function Ho(E){if(E.preventDefault(),ot)return;let{deltaX:W,deltaY:se}=E;E.shiftKey&&!W&&(W=se);const me=-1,Ae=1,ue=(W||se)>0?Ae:me;let Ge=0,be=0;R.value?be=ue:Ge=ue;const At=10;(be*se>=At||Ge*W>=At)&&(ue===Ae&&!de()?Nt():ue===me&&!L()&&xt())}function Ko(){K.value=rc(l.value,!0),tn()}function Wo(){var E,W;Z.value&&((W=(E=X.effect).scheduler)===null||W===void 0||W.call(E),X.effect.run())}function Mn(){y.autoplay&&en()}function Yo(){y.autoplay&&tn()}Un(()=>{wl(tn),requestAnimationFrame(()=>b.value=!0)}),Sa(()=>{Vo(),en()}),Fl(()=>{const{value:E}=D,{value:W}=w,se=new Map,me=ue=>se.has(ue)?se.get(ue):-1;let Ae=!1;for(let ue=0;ue<E.length;ue++){const Ge=W.findIndex(be=>be.el===E[ue]);Ge!==ue&&(Ae=!0),se.set(E[ue],Ge)}Ae&&E.sort((ue,Ge)=>me(ue)-me(Ge))}),Wt(Me,(E,W)=>{if(E!==W)if(tn(),oe.value){if(_e.value){const{value:se}=Je;ft.value>2&&E===se-2&&W===1?E=0:E===1&&W===se-2&&(E=se-1)}vn(E,He.value)}else ze()},{immediate:!0}),Wt([_e,Ie],()=>void Uo(()=>{Yt(Me.value)})),Wt($,()=>{oe.value&&ze()},{deep:!0}),Wt(oe,E=>{E?ze():(ot=!1,gt(Dt=0))});const un=pe(()=>({onTouchstartPassive:y.touchable?xn:void 0,onMousedown:y.draggable?xn:void 0,onWheel:y.mousewheel?Ho:void 0})),kt=pe(()=>Object.assign(Object.assign({},Jr(ce,["to","prev","next","isPrevDisabled","isNextDisabled"])),{total:ft.value,currentIndex:_.value})),Pt=pe(()=>({total:ft.value,currentIndex:_.value,to:ce.to})),jo={getCurrentIndex:()=>_.value,to:Rt,prev:xt,next:Nt},Jo=Na("Carousel","-carousel",yd,rd,y,A),u=pe(()=>{const{common:{cubicBezierEaseInOut:E},self:{dotSize:W,dotColor:se,dotColorActive:me,dotColorFocus:Ae,dotLineWidth:ue,dotLineWidthActive:Ge,arrowColor:be}}=Jo.value;return{"--n-bezier":E,"--n-dot-color":se,"--n-dot-color-focus":Ae,"--n-dot-color-active":me,"--n-dot-size":W,"--n-dot-line-width":ue,"--n-dot-line-width-active":Ge,"--n-arrow-color":be}}),Ut=T?Yl("carousel",void 0,u,y):void 0;return Object.assign(Object.assign({mergedClsPrefix:A,selfElRef:l,slidesElRef:O,slideVNodes:w,duplicatedable:_e,userWantsControl:ve,autoSlideSize:Z,realIndex:Me,slideStyles:ut,translateStyle:Zt,slidesControlListeners:un,handleTransitionEnd:Bo,handleResize:Ko,handleSlideResize:Wo,handleMouseenter:Mn,handleMouseleave:Yo,isActive:nt,arrowSlotProps:kt,dotSlotProps:Pt},jo),{cssVars:T?void 0:u,themeClass:Ut==null?void 0:Ut.themeClass,onRender:Ut==null?void 0:Ut.onRender})},render(){var y;const{mergedClsPrefix:A,showArrow:T,userWantsControl:l,slideStyles:O,dotType:D,dotPlacement:w,slidesControlListeners:R,transitionProps:H={},arrowSlotProps:z,dotSlotProps:oe,$slots:{default:_e,dots:ve,arrow:Ie}}=this,j=_e&&pc(_e())||[];let Z=Dd(j);return Z.length||(Z=j.map(K=>Pe(Md,null,{default:()=>Ms(K)}))),this.duplicatedable&&(Z=cd(Z)),this.slideVNodes.value=Z,this.autoSlideSize&&(Z=Z.map(K=>Pe(ya,{onResize:this.handleSlideResize},{default:()=>K}))),(y=this.onRender)===null||y===void 0||y.call(this),Pe("div",Object.assign({ref:"selfElRef",class:[this.themeClass,`${A}-carousel`,this.direction==="vertical"&&`${A}-carousel--vertical`,this.showArrow&&`${A}-carousel--show-arrow`,`${A}-carousel--${w}`,`${A}-carousel--${this.direction}`,`${A}-carousel--${this.effect}`,l&&`${A}-carousel--usercontrol`],style:this.cssVars},R,{onMouseenter:this.handleMouseenter,onMouseleave:this.handleMouseleave}),Pe(ya,{onResize:this.handleResize},{default:()=>Pe("div",{ref:"slidesElRef",class:`${A}-carousel__slides`,role:"listbox",style:this.translateStyle,onTransitionend:this.handleTransitionEnd},l?Z.map((K,X)=>Pe("div",{style:O[X],key:X},ql(Pe(xl,Object.assign({},H),{default:()=>K}),[[Da,this.isActive(X)]]))):Z)}),this.showDots&&oe.total>1&&zr(ve,oe,()=>[Pe(hd,{key:D+w,total:oe.total,currentIndex:oe.currentIndex,dotType:D,trigger:this.trigger,keyboard:this.keyboard})]),T&&zr(Ie,z,()=>[Pe(vd,null)]))}});function Dd(y){return y.reduce((A,T)=>(Id(T)&&A.push(T),A),[])}const Sd={abstract:Boolean,bordered:{type:Boolean,default:void 0},clsPrefix:{type:String,default:Ta},locale:Object,dateLocale:Object,namespace:String,rtl:Array,tag:{type:String,default:"div"},hljs:Object,katex:Object,theme:Object,themeOverrides:Object,componentOptions:Object,icons:Object,breakpoints:Object,preflightStyleDisabled:Boolean,inlineThemeDisabled:{type:Boolean,default:void 0},as:{type:String,validator:()=>(Jl("config-provider","`as` is deprecated, please use `tag` instead."),!0),default:void 0}},Ld=Tt({name:"ConfigProvider",alias:["App"],props:Sd,setup(y){const A=Ea(tc,null),T=pe(()=>{const{theme:j}=y;if(j===null)return;const Z=A==null?void 0:A.mergedThemeRef.value;return j===void 0?Z:Z===void 0?j:Object.assign({},Z,j)}),l=pe(()=>{const{themeOverrides:j}=y;if(j!==null){if(j===void 0)return A==null?void 0:A.mergedThemeOverridesRef.value;{const Z=A==null?void 0:A.mergedThemeOverridesRef.value;return Z===void 0?j:jl({},Z,j)}}}),O=Gn(()=>{const{namespace:j}=y;return j===void 0?A==null?void 0:A.mergedNamespaceRef.value:j}),D=Gn(()=>{const{bordered:j}=y;return j===void 0?A==null?void 0:A.mergedBorderedRef.value:j}),w=pe(()=>{const{icons:j}=y;return j===void 0?A==null?void 0:A.mergedIconsRef.value:j}),R=pe(()=>{const{componentOptions:j}=y;return j!==void 0?j:A==null?void 0:A.mergedComponentPropsRef.value}),H=pe(()=>{const{clsPrefix:j}=y;return j!==void 0?j:A?A.mergedClsPrefixRef.value:Ta}),z=pe(()=>{var j;const{rtl:Z}=y;if(Z===void 0)return A==null?void 0:A.mergedRtlRef.value;const K={};for(const X of Z)K[X.name]=Xr(X),(j=X.peers)===null||j===void 0||j.forEach($=>{$.name in K||(K[$.name]=Xr($))});return K}),oe=pe(()=>y.breakpoints||(A==null?void 0:A.mergedBreakpointsRef.value)),_e=y.inlineThemeDisabled||(A==null?void 0:A.inlineThemeDisabled),ve=y.preflightStyleDisabled||(A==null?void 0:A.preflightStyleDisabled),Ie=pe(()=>{const{value:j}=T,{value:Z}=l,K=Z&&Object.keys(Z).length!==0,X=j==null?void 0:j.name;return X?K?`${X}-${nc(JSON.stringify(l.value))}`:X:K?nc(JSON.stringify(l.value)):""});return La(tc,{mergedThemeHashRef:Ie,mergedBreakpointsRef:oe,mergedRtlRef:z,mergedIconsRef:w,mergedComponentPropsRef:R,mergedBorderedRef:D,mergedNamespaceRef:O,mergedClsPrefixRef:H,mergedLocaleRef:pe(()=>{const{locale:j}=y;if(j!==null)return j===void 0?A==null?void 0:A.mergedLocaleRef.value:j}),mergedDateLocaleRef:pe(()=>{const{dateLocale:j}=y;if(j!==null)return j===void 0?A==null?void 0:A.mergedDateLocaleRef.value:j}),mergedHljsRef:pe(()=>{const{hljs:j}=y;return j===void 0?A==null?void 0:A.mergedHljsRef.value:j}),mergedKatexRef:pe(()=>{const{katex:j}=y;return j===void 0?A==null?void 0:A.mergedKatexRef.value:j}),mergedThemeRef:T,mergedThemeOverridesRef:l,inlineThemeDisabled:_e||!1,preflightStyleDisabled:ve||!1}),{mergedClsPrefix:H,mergedBordered:D,mergedNamespace:O,mergedTheme:T,mergedThemeOverrides:l}},render(){var y,A,T,l;return this.abstract?(l=(T=this.$slots).default)===null||l===void 0?void 0:l.call(T):Pe(this.as||this.tag,{class:`${this.mergedClsPrefix||Ta}-config-provider`},(A=(y=this.$slots).default)===null||A===void 0?void 0:A.call(y))}}),cc=1,fc=gc("n-grid"),mc=1,Ed={span:{type:[Number,String],default:mc},offset:{type:[Number,String],default:0},suffix:Boolean,privateOffset:Number,privateSpan:Number,privateColStart:Number,privateShow:{type:Boolean,default:!0}},ms=Tt({__GRID_ITEM__:!0,name:"GridItem",alias:["Gi"],props:Ed,setup(){const{isSsrRef:y,xGapRef:A,itemStyleRef:T,overflowRef:l,layoutShiftDisabledRef:O}=Ea(fc),D=bo();return{overflow:l,itemStyle:T,layoutShiftDisabled:O,mergedXGap:pe(()=>Pn(A.value||0)),deriveStyle:()=>{y.value;const{privateSpan:w=mc,privateShow:R=!0,privateColStart:H=void 0,privateOffset:z=0}=D.vnode.props,{value:oe}=A,_e=Pn(oe||0);return{display:R?"":"none",gridColumn:`${H!=null?H:`span ${w}`} / span ${w}`,marginLeft:z?`calc((100% - (${w} - 1) * ${_e}) / ${w} * ${z} + ${_e} * ${z})`:""}}}},render(){var y,A;if(this.layoutShiftDisabled){const{span:T,offset:l,mergedXGap:O}=this;return Pe("div",{style:{gridColumn:`span ${T} / span ${T}`,marginLeft:l?`calc((100% - (${T} - 1) * ${O}) / ${T} * ${l} + ${O} * ${l})`:""}},this.$slots)}return Pe("div",{style:[this.itemStyle,this.deriveStyle()]},(A=(y=this.$slots).default)===null||A===void 0?void 0:A.call(y,{overflow:this.overflow}))}}),kd={xs:0,s:640,m:1024,l:1280,xl:1536,xxl:1920},vc=24,Ma="__ssr__",Rd={layoutShiftDisabled:Boolean,responsive:{type:[String,Boolean],default:"self"},cols:{type:[Number,String],default:vc},itemResponsive:Boolean,collapsed:Boolean,collapsedRows:{type:Number,default:1},itemStyle:[Object,String],xGap:{type:[Number,String],default:0},yGap:{type:[Number,String],default:0}},Nd=Tt({name:"Grid",inheritAttrs:!1,props:Rd,setup(y){const{mergedClsPrefixRef:A,mergedBreakpointsRef:T}=qo(y),l=/^\d+$/,O=Fe(void 0),D=nd((T==null?void 0:T.value)||kd),w=Gn(()=>!!(y.itemResponsive||!l.test(y.cols.toString())||!l.test(y.xGap.toString())||!l.test(y.yGap.toString()))),R=pe(()=>{if(!!w.value)return y.responsive==="self"?O.value:D.value}),H=Gn(()=>{var X;return(X=Number(On(y.cols.toString(),R.value)))!==null&&X!==void 0?X:vc}),z=Gn(()=>On(y.xGap.toString(),R.value)),oe=Gn(()=>On(y.yGap.toString(),R.value)),_e=X=>{O.value=X.contentRect.width},ve=X=>{Xl(_e,X)},Ie=Fe(!1),j=pe(()=>{if(y.responsive==="self")return ve}),Z=Fe(!1),K=Fe();return Un(()=>{const{value:X}=K;X&&X.hasAttribute(Ma)&&(X.removeAttribute(Ma),Z.value=!0)}),La(fc,{layoutShiftDisabledRef:Aa(y,"layoutShiftDisabled"),isSsrRef:Z,itemStyleRef:Aa(y,"itemStyle"),xGapRef:z,overflowRef:Ie}),{isSsr:!Rl,contentEl:K,mergedClsPrefix:A,style:pe(()=>y.layoutShiftDisabled?{width:"100%",display:"grid",gridTemplateColumns:`repeat(${y.cols}, minmax(0, 1fr))`,columnGap:Pn(y.xGap),rowGap:Pn(y.yGap)}:{width:"100%",display:"grid",gridTemplateColumns:`repeat(${H.value}, minmax(0, 1fr))`,columnGap:Pn(z.value),rowGap:Pn(oe.value)}),isResponsive:w,responsiveQuery:R,responsiveCols:H,handleResize:j,overflow:Ie}},render(){if(this.layoutShiftDisabled)return Pe("div",$r({ref:"contentEl",class:`${this.mergedClsPrefix}-grid`,style:this.style},this.$attrs),this.$slots);const y=()=>{var A,T,l,O,D,w,R;this.overflow=!1;const H=pc(Ql(this)),z=[],{collapsed:oe,collapsedRows:_e,responsiveCols:ve,responsiveQuery:Ie}=this;H.forEach($=>{var b,Qe,He,ut,Je;if(((b=$==null?void 0:$.type)===null||b===void 0?void 0:b.__GRID_ITEM__)!==!0)return;if(Zl($)){const V=Ms($);V.props?V.props.privateShow=!1:V.props={privateShow:!1},z.push({child:V,rawChildSpan:0});return}$.dirs=((Qe=$.dirs)===null||Qe===void 0?void 0:Qe.filter(({dir:V})=>V!==Da))||null,((He=$.dirs)===null||He===void 0?void 0:He.length)===0&&($.dirs=null);const ft=Ms($),Ee=Number((Je=On((ut=ft.props)===null||ut===void 0?void 0:ut.span,Ie))!==null&&Je!==void 0?Je:cc);Ee!==0&&z.push({child:ft,rawChildSpan:Ee})});let j=0;const Z=(A=z[z.length-1])===null||A===void 0?void 0:A.child;if(Z!=null&&Z.props){const $=(T=Z.props)===null||T===void 0?void 0:T.suffix;$!==void 0&&$!==!1&&(j=Number((O=On((l=Z.props)===null||l===void 0?void 0:l.span,Ie))!==null&&O!==void 0?O:cc),Z.props.privateSpan=j,Z.props.privateColStart=ve+1-j,Z.props.privateShow=(D=Z.props.privateShow)!==null&&D!==void 0?D:!0)}let K=0,X=!1;for(const{child:$,rawChildSpan:b}of z){if(X&&(this.overflow=!0),!X){const Qe=Number((R=On((w=$.props)===null||w===void 0?void 0:w.offset,Ie))!==null&&R!==void 0?R:0),He=Math.min(b+Qe,ve);if($.props?($.props.privateSpan=He,$.props.privateOffset=Qe):$.props={privateSpan:He,privateOffset:Qe},oe){const ut=K%ve;He+ut>ve&&(K+=ve-ut),He+K+j>_e*ve?X=!0:K+=He}}X&&($.props?$.props.privateShow!==!0&&($.props.privateShow=!1):$.props={privateShow:!1})}return Pe("div",$r({ref:"contentEl",class:`${this.mergedClsPrefix}-grid`,style:this.style,[Ma]:this.isSsr||void 0},this.$attrs),z.map(({child:$})=>$))};return this.isResponsive&&this.responsive==="self"?Pe(ya,{onResize:this.handleResize},{default:y}):y()}}),Od=Object.assign(Object.assign({},Na.props),{trigger:String,xScrollable:Boolean,onScroll:Function,contentClass:String,contentStyle:[Object,String],size:Number}),Gd=Tt({name:"Scrollbar",props:Od,setup(){const y=Fe(null);return Object.assign(Object.assign({},{scrollTo:(...T)=>{var l;(l=y.value)===null||l===void 0||l.scrollTo(T[0],T[1])},scrollBy:(...T)=>{var l;(l=y.value)===null||l===void 0||l.scrollBy(T[0],T[1])}}),{scrollbarInstRef:y})},render(){return Pe(Nl,Object.assign({ref:"scrollbarInstRef"},this.$props),this.$slots)}}),Pd=Gd,Ts=""+new URL("prev_icon.600edf17.svg",import.meta.url).href,Ud="data:image/webp;base64,UklGRmYDAABXRUJQVlA4WAoAAAAwAAAAIwAAIwAASUNDUBgCAAAAAAIYAAAAAAQwAABtbnRyUkdCIFhZWiAAAAAAAAAAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAAHRyWFlaAAABZAAAABRnWFlaAAABeAAAABRiWFlaAAABjAAAABRyVFJDAAABoAAAAChnVFJDAAABoAAAAChiVFJDAAABoAAAACh3dHB0AAAByAAAABRjcHJ0AAAB3AAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAFgAAAAcAHMAUgBHAEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFhZWiAAAAAAAABvogAAOPUAAAOQWFlaIAAAAAAAAGKZAAC3hQAAGNpYWVogAAAAAAAAJKAAAA+EAAC2z3BhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABYWVogAAAAAAAA9tYAAQAAAADTLW1sdWMAAAAAAAAAAQAAAAxlblVTAAAAIAAAABwARwBvAG8AZwBsAGUAIABJAG4AYwAuACAAMgAwADEANlZQOEwoAQAALyPACBCfoKBtG8b8Sbc7IOZ//g2yjZz6A+gEvge4HACGABBg8MIDAixJsts2wwgJYFru/Q/LCFBy+I3oPwO3jRR1+XCofQQAAAAAAAAAAAAAAAAAAAAAAAAAAABQv1IK9cPdbNv2WD8Zsq31eK68V7JTBXWyVZXiZccbC96lkJerCbOV/V6IMcYY7SXGswmTnU4GhGuIbNu2bdu2bds+h7a99PGIoSRJkiRJkmSvGm8v2SVxsfdrvxxNqk8BnponWJyOLyVPzzAcXxq2RP/HeG/WnKzY0lOKE3EuVVqfaJVFb/f5Mul2WzJUXD3nMW0+XUh5pcDOxdyI9ljC6amvbszo56wAnMpRGZYdGtGUCMiY2a1jVaghXQghhBBCCH2xhgAAwE8VTAA=",Ga=y=>(wo("data-v-3cff4790"),y=y(),Fo(),y),bd={"w-388":"","p-b-40":"","bg-313255":"","border-radius-20":"","overflow-hidden":""},wd={"color-ffffff":"","fs-22":"","len-35":"","w-300":"","text-center":"","m-a":"","p-t-40":""},Fd=Ga(()=>J("br",null,null,-1)),qd=Ga(()=>J("br",null,null,-1)),xd=Ga(()=>J("br",null,null,-1)),Vd=Tt({__name:"delAi",setup(y){const A=fn(),T=()=>{A.isPopupAi=!1},l=()=>{A.chatIm.deleteConversation(A.delAiInfo.conversationID,A.delAiInfo.index),setTimeout(()=>{T()},300)};return(O,D)=>(ee(),ne("div",null,[Ue(B(ys),{show:B(A).isPopupAi,"onUpdate:show":D[0]||(D[0]=w=>B(A).isPopupAi=w),"on-after-leave":T},{default:it(()=>[J("div",bd,[J("p",wd,[gn(" Are you sure you want to "),Fd,gn(" delete the conversation with "),qd,gn(" "+$e(B(A).delAiInfo.userProfile.nick)+" ? All messages ",1),xd,gn(" will be lost ")]),J("div",{class:"btn",center:""},[J("p",{onClick:T},"Cancel"),J("p",{onClick:l},"Continue")])])]),_:1},8,["show"])]))}});const Bd=mn(Vd,[["__scopeId","data-v-3cff4790"]]),Ds=y=>(wo("data-v-e792d0b1"),y=y(),Fo(),y),Hd={key:0,class:"goHome"},Kd=Ds(()=>J("span",null,"Chat",-1)),Wd={"p-x-12":"","min-w-250":"","p-t-33":"","h-100p":"","overflow-auto":"","flex-column":"",class:"MBox"},Yd={key:0,"color-fff":"","fs-20":"","font-weight-bold":""},Jd={key:1,"h-54":"","m-b-10":"","flex-flex-start-center":"","c-p":"",class:"border current"},zd={"w-100p":"","m-r-8":""},Xd={"line-height-18":"","flex-between-center":""},$d={"color-FFF":"","fs-14":""},Qd={"fs-10":""},Zd=Ds(()=>J("p",{"line-height-18":"","flex-between-center":""},null,-1)),ep={key:2,"color-B5B1FF":"",op30:"","fs-15":""},tp={key:3,"m-t-13":"",class:"peopleBox"},np={"w-100p":"","m-r-8":""},op={"line-height-18":"","flex-between-center":""},sp={"color-FFF":"","fs-14":""},ip={"fs-10":""},ap=Ds(()=>J("p",{"line-height-18":"","flex-between-center":""},null,-1)),rp=["onClick"],cp={"w-100p":"","m-r-8":""},up={"line-height-18":"","flex-between-center":""},lp={"color-FFF":"","fs-14":""},dp={"fs-10":""},pp={"line-height-18":"","flex-between-center":""},_p={class:"overflow","fs-12":""},gp=["onClick"],hp=Ds(()=>J("img",{"square-12":"","border-radius-50p":"",src:Ud},null,-1)),fp=[hp],mp=Tt({__name:"people",emits:["changePosition"],setup(y,{emit:A}){const T=bo(),l=T==null?void 0:T.appContext.config.globalProperties.$sensors,O=T==null?void 0:T.appContext.config.globalProperties.$isMobile,D=Cs(),w=bn(),R=A,H=fn(),z=Ra(),oe=async Ie=>{l.track("h5_AI_function_click",{entrance_source:"\u5207\u6362AI\u89D2\u8272",ai_name:H.aiInfo.name,ai_id:H.aiInfo.ai_uid,entrance_source:"\u6D88\u606F\u5217\u8868",is_login:w.Token?"\u662F":"\u5426",from_our_platform:"ponrh.ai",ref_name:"pornh.ai:"+Mt("ref")}),R("changePosition",100),H.chatList=[],H.isSend=0,H.isScroll=!0,H.isLoadAi=!0;const j=await H.getCoreInfo(Ie.userProfile.userID);H.isLoadAi=!1,j.code==200?H.chatIm.getMessageRead():z.error(j.msg)},_e=(Ie,j)=>{H.delAiInfo=Ie,H.delAiInfo.index=j,H.isPopupAi=!0};Un(async()=>{}),Wt(()=>H.bannerAssign,Ie=>{H.aiInfo.ai_uid,H.aiList,Uo(()=>{!H.aiInfo.ai_uid&&H.aiList!=""&&oe(H.aiList[0])})});const ve=()=>{D.push({path:"/"})};return(Ie,j)=>(ee(),ne(yt,null,[B(O)?(ee(),ne("div",Hd,[J("img",{src:Ts,class:"prev",onClick:ve}),Kd])):ct("",!0),J("div",Wd,[B(O)?ct("",!0):(ee(),ne("div",Yd," Chat")),Object.keys(B(H).aiInfo).length!==0&&!B(w).Token?(ee(),ne("div",Jd,[Ue(B(sn),{width:"37",height:"37","m-x-8":"","border-radius-50p":"","preview-disabled":"","object-fit":"cover",src:B(H).aiInfo.avatar},null,8,["src"]),J("div",zd,[J("p",Xd,[J("span",$d,$e(B(H).aiInfo.name),1),J("span",Qd,$e(),1)]),Zd])])):B(H).aiList==""&&B(H).isAI?(ee(),ne("p",ep," It's empty ")):(ee(),ne("div",tp,[B(H).isAI?ct("",!0):(ee(),ne("div",{key:0,"h-54":"","m-b-10":"","flex-flex-start-center":"","c-p":"",class:Ca(B(H).isAI?"border":"border current")},[Ue(B(sn),{width:"37",height:"37","m-x-8":"","border-radius-50p":"","preview-disabled":"","object-fit":"cover",src:B(H).aiInfo.avatar},null,8,["src"]),J("div",np,[J("p",op,[J("span",sp,$e(B(H).aiInfo.name),1),J("span",ip,$e(),1)]),ap])],2)),(ee(!0),ne(yt,null,on(B(H).aiList,(Z,K)=>(ee(),ne("div",{key:K,class:Ca(Z.userProfile.userID===B(H).aiInfo.ai_uid?"border current":"border"),"h-54":"","m-b-10":"","flex-flex-start-center":"","c-p":"",onClick:X=>oe(Z)},[Ue(B(sn),{width:"37",height:"37","m-x-8":"","border-radius-50p":"","preview-disabled":"","object-fit":"cover",src:Z.userProfile.avatar},null,8,["src"]),J("div",cp,[J("p",up,[J("span",lp,$e(Z.userProfile.nick),1),J("span",dp,$e(Z.lastMessage.lastTime),1)]),J("p",pp,[J("span",_p,$e(typeof Z.lastMessage.content=="string"?Z.lastMessage.content:Z.lastMessage.content.content),1),Z.userProfile.userID!=B(H).aiInfo.ai_uid?(ee(),ne("span",{key:0,onClick:_c(X=>_e(Z,K),["stop"])},fp,8,gp)):ct("",!0)])])],10,rp))),128))]))]),Ue(Bd)],64))}});const vp=mn(mp,[["__scopeId","data-v-e792d0b1"]]),Ip=""+new URL("interdictDialogBg3.9d9425e7.png",import.meta.url).href,Mp=""+new URL("interdictDialogBg.c4bbb09a.png",import.meta.url).href,yp=""+new URL("interdictDialogBg2.fa7893e2.png",import.meta.url).href,uc=""+new URL("voice.f9966b53.svg",import.meta.url).href,Ap=""+new URL("loading.52d42914.gif",import.meta.url).href,Cp=""+new URL("send.90d66b6b.svg",import.meta.url).href,Qt=y=>(wo("data-v-a9a4ca3d"),y=y(),Fo(),y),Tp=Qt(()=>J("img",{src:Ip},null,-1)),Dp=Qt(()=>J("p",{class:"title"},"Upgrade to unlock Character Voice Messages",-1)),Sp=Qt(()=>J("p",{class:"desc"},"Hurry up, Upgrade Pro now to listen to your character\u2019s voices",-1)),Lp={class:"interdictDialog"},Ep={key:0,src:Mp},kp={key:1,src:yp},Rp={key:2,class:"cont"},Np=Qt(()=>J("p",{class:"title"},"You ran out of messages",-1)),Op=Qt(()=>J("p",{class:"desc"},"Looks like you've ran out of messages. Upgrade Pro now to get more messages!",-1)),Gp={key:3,class:"cont"},Pp=Qt(()=>J("p",{class:"title"},"There are 1000 messages/day. The limit has been reached today. Please come back tomorrow.",-1)),Up={"h-100p":"","position-absolute":"","w-100p":""},bp={class:"top","h-80":"","font-weight-bold":"","fs-20":"","color-ffffff":"","flex-flex-start-center":"","position-absolute":"","z-10":"","bg-131313":"","w-100p":"","left-0":"","top-0":""},wp=["src"],Fp={class:"main","p-x-15":""},qp=Qt(()=>J("div",{class:"tips"}," All chats and related services are Al-generated, and some may incur charges. Please ensure sufficient balance.",-1)),xp={"m-t-24":"","color-ffffff":"",op50:"","text-center":"","w-100p":""},Vp={key:0,class:"dialogue"},Bp={style:{display:"flex","justify-content":"space-between",width:"100%"}},Hp={key:0},Kp={key:1},Wp=["onClick"],Yp={key:1,class:"imgPrice flex"},jp={key:0,class:"coin"},Jp={key:1},zp=Qt(()=>J("div",{center:""},[J("p",{class:"dithering",center:"",style:{padding:"0 30px",color:"#FF9C31",border:"1px solid #FF9C31"}}," Pro ")],-1)),Xp={key:1,class:"reply"},$p={key:0,class:"dialogue flex dialogue_login"},Qp=Qt(()=>J("div",{class:"content"},[J("div",{class:"text"},[J("img",{width:"30",src:Ap})])],-1)),Zp=[Qp],e_={class:"send","position-absolute":"","left-0":"","bottom-0":"","w-100p":"","p-b-25":"","bg-131313":"","p-10":"","z-10":""},t_={"position-relative":""},n_={key:0,"position-absolute":"","top-50p":"","left-50p":""},o_=Tt({__name:"dialogue",props:{changeStatus:{type:Number}},emits:["changePosition"],setup(y,{emit:A}){const T=Cs(),l=bo(),O=l==null?void 0:l.appContext.config.globalProperties.$sensors,D=bn(),w=fn(),R=Fe(""),H=Ra(),z=Fe(!1),oe=A,_e=()=>{oe("changePosition",200)},ve=()=>{oe("changePosition",0)},Ie=y;Wt(()=>Ie.changeStatus,Ne=>{R.value=""});let j=null;const Z=async Ne=>{var re;if(O.track("h5_AI_function_click",{node_name:"\u8BED\u97F3\u6D88\u606F",ai_name:w.aiInfo.name,entrance_source:"\u6D88\u606F\u5217\u8868",ai_id:w.aiInfo.ai_uid,is_login:D.Token?"\u662F":"\u5426",from_our_platform:"ponrh.ai",ref_name:"pornh.ai:"+Mt("ref")}),((re=D.userInfo)==null?void 0:re.vip_info.vip_type)==0)O.track("h5_voice_pop_view",{from_our_platform:"ponrh.ai",ref_name:"pornh.ai:"+Mt("ref")}),Ee.value=!0;else{const ae={msg_id:Ne.content.data.extra.messageId},we=await Gl(ae);j&&j.pause(),we.code==200?(j=new Audio(we.data.url),j.play(),j.onended=function(){j=null}):H.error(we.msg)}};Wt(()=>w.chatList,()=>{const Ne=new Set,re=w.chatList.filter(ae=>{const we=ae.content.data.extra.messageId;return Ne.has(we)?!1:(Ne.add(we),!0)});if((re.length!==w.chatList.length||!re.every((ae,we)=>ae.content.data.extra.messageId===w.chatList[we].content.data.extra.messageId))&&(w.chatList=re),!w.isScroll)return!1;Uo(()=>{He()})},{deep:!0});const K=Fe(!1),X=Fe(!1),$=async()=>{var ae,we,nt,L;if(!D.Token){D.isPopupLogin=!0;return}const Ne={ai_uid:w.aiInfo.ai_uid};if((await Pl(Ne)).data.wake_up_in>0){D.userInfo.vip_info.vip_type==0&&O.track("h5_msg_pro_limit",{from_our_platform:"ponrh.ai",ref_name:"pornh.ai:"+Mt("ref")}),ft.value=!0,O.track("h5_msg_limit_view",{from_our_platform:"ponrh.ai",ref_name:"pornh.ai:"+Mt("ref")});return}if(R.value!=""&&w.isSend==0){X.value=!0;const de={targetId:(ae=w.aiInfo)==null?void 0:ae.ai_uid,content:{content:R.value,extra:{messageId:Go(10),dataType:"text",data:{context:R.value}}}};w.isSend=1;const Rt=await w.getChatV3(de);X.value=!1,Rt.code==200&&(w.chatList.push({content:{data:{targetId:(we=w.aiInfo)==null?void 0:we.ai_uid,content:{content:R.value},extra:{messageId:Go(10),dataType:"text",data:{context:R.value}}},description:"",extension:""},to:(nt=w.aiInfo)==null?void 0:nt.ai_uid}),w.chatIm.sendToAiText({targetId:(L=w.aiInfo)==null?void 0:L.ai_uid,content:{content:R.value},extra:{messageId:Go(10),dataType:"text",data:{context:R.value}}}),R.value="",w.isSend=2)}},b=async(Ne,re,ae,we)=>{w.isScroll=!1;const nt=await w.getUnlockImage(Ne,re);nt.code!=200&&(nt.code==1011?w.isPopupCoin=!0:H.error(nt.msg)),Uo(()=>{w.isScroll=!1})},Qe=Fe(),He=()=>{var Ne;(Ne=Qe.value)==null||Ne.scrollBy({top:1e4})};document.addEventListener("keydown",function(Ne){Ne.keyCode===13&&z.value&&$()});const ut={common:{primaryColor:"#8650D0",primaryColorHover:"#8650D0"}},Je=Ne=>{O.track("h5_AI_function_click",{node_name:Ne,ai_name:w.aiInfo.name,entrance_source:"\u6D88\u606F\u5217\u8868",ai_id:w.aiInfo.ai_uid,is_login:D.Token?"\u662F":"\u5426",from_our_platform:"ponrh.ai",ref_name:"pornh.ai:"+Mt("ref")})},ft=Fe(!1),Ee=Fe(!1),V=()=>{ft.value=!1,Ee.value=!1},_=()=>{O.track("h5_msg_limit_click",{from_our_platform:"ponrh.ai",ref_name:"pornh.ai:"+Mt("ref")}),O.track("h5_pro_page_view",{from_our_platform:"ponrh.ai",entrance_source:"\u6D88\u606F\u4E0A\u9650\u5F39\u7A97",ref_name:"pornh.ai:"+Mt("ref")}),T.push("/becomePro")},Me=()=>{O.track("h5_pro_page_view",{from_our_platform:"ponrh.ai",entrance_source:"\u8BED\u97F3\u5F39\u7A97",ref_name:"pornh.ai:"+Mt("ref")}),O.track("h5_voice_pop_click",{from_our_platform:"ponrh.ai",ref_name:"pornh.ai:"+Mt("ref")}),T.push("/becomePro")},Yt=()=>{z.value=!1,!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&window.scrollBy(0,0)},ke=()=>{D.isPopupLogin=!0};return Un(async()=>{var Ne,re;if(D.Token)w.chatList=w.chatList.filter(ae=>ae.type=="TIMCustomElem");else{const ae=await Ol();w.chatList.push({content:{data:{targetId:(Ne=w.aiInfo)==null?void 0:Ne.ai_uid,content:{context:ae.data[Math.floor(Math.random()*ae.data.length)]},extra:{messageId:Go(10),dataType:"text",data:{context:ae.data[Math.floor(Math.random()*ae.data.length)]}}},description:"",extension:""},to:D.userInfo.uid},{content:{data:{targetId:(re=w.aiInfo)==null?void 0:re.ai_uid,content:{content:"[\u56FE\u7247]"},extra:{messageId:Go(10),dataType:"image",data:{url:w.aiInfo.introduce_image}}},description:"",extension:""},to:D.userInfo.uid})}}),(Ne,re)=>(ee(),ne(yt,null,[Ue(B(ys),{show:Ee.value,"onUpdate:show":re[0]||(re[0]=ae=>Ee.value=ae),"on-after-leave":V},{default:it(()=>[J("div",{class:"interdictDialog"},[Tp,J("img",{src:ec,"square-24":"",class:"close",onClick:V}),J("div",{class:"cont"},[Dp,Sp,J("p",{class:"btn",onClick:Me},"Get voice messages")])])]),_:1},8,["show"]),Ue(B(ys),{show:ft.value,"onUpdate:show":re[1]||(re[1]=ae=>ft.value=ae),"on-after-leave":V},{default:it(()=>{var ae,we,nt,L;return[J("div",Lp,[((we=(ae=B(D).userInfo)==null?void 0:ae.vip_info)==null?void 0:we.vip_type)==0?(ee(),ne("img",Ep)):(ee(),ne("img",kp)),J("img",{src:ec,"square-24":"",class:"close",onClick:V}),((L=(nt=B(D).userInfo)==null?void 0:nt.vip_info)==null?void 0:L.vip_type)==0?(ee(),ne("div",Rp,[Np,Op,J("p",{class:"btn",onClick:_},"Get more messages")])):(ee(),ne("div",Gp,[Pp,J("p",{class:"btn",onClick:V},"Confirm")]))])]}),_:1},8,["show"]),J("div",Up,[J("div",bp,[J("img",{src:Ts,class:"prev",onClick:ve}),J("img",{"square-45":"","border-radius-50p":"","m-l-15":"","m-r-12":"",src:B(w).aiInfo.avatar,onClick:_e},null,8,wp),J("span",{onClick:_e},$e(B(w).aiInfo.ai_name),1)]),Ue(B(Pd),{ref_key:"NScrollbarRef",ref:Qe,"h-100p":""},{default:it(()=>[J("div",Fp,[qp,(ee(!0),ne(yt,null,on(B(w).chatList,(ae,we)=>{var nt,L,de,Rt,xt,Nt;return ee(),ne(yt,{key:we},[J("div",xp,$e(ae.time),1),ae.to==B(D).userInfo.uid?(ee(),ne(yt,{key:0},[ae.content.data.extra.dataType=="text"||ae.content.data.extra.dataType=="audio"?(ee(),ne("div",Vp,[J("div",Bp,[ae.content.data.extra.dataType=="text"?(ee(),ne("span",Hp,$e(ae.content.data.extra.data.context),1)):(ee(),ne("span",Kp,$e(ae.content.data.extra.data.audioContext),1)),ae.content.data.extra.dataType=="audio"?(ee(),ne("img",{key:2,class:"video","square-32":"",onClick:_t=>Z(ae),src:uc},null,8,Wp)):ct("",!0),B(D).Token?ct("",!0):(ee(),ne("img",{key:3,class:"video","square-32":"",onClick:ke,src:uc}))])])):ae.content.data.extra.dataType=="image"?(ee(),ne("div",Yp,[ae.content.data.extra.data.price==0?(ee(),ne("div",jp,[Ue(B(sn),{class:"nimage",width:"150",src:ae.content.data.extra.data.url},null,8,["src"])])):(ee(),ne("div",Jp,[ae.content.data.extra.data.pay_url?(ee(),hn(B(sn),{key:0,class:"nimage",width:"150","preview-disabled":((L=(nt=B(D).userInfo)==null?void 0:nt.vip_info)==null?void 0:L.vip_type)==0||!B(D).Token,src:ae.content.data.extra.data.pay_url,onClick:re[2]||(re[2]=_t=>Je("\u6D88\u606F\u56FE"))},null,8,["preview-disabled","src"])):(ee(),hn(B(sn),{key:1,class:"nimage",width:"150",style:ka(B(D).Token?"":"filter: blur(20px)"),"preview-disabled":((Rt=(de=B(D).userInfo)==null?void 0:de.vip_info)==null?void 0:Rt.vip_type)==0||!B(D).Token,src:ae.content.data.extra.data.url,onClick:_t=>b(ae,we,ae.content.data.extra.messageId,ae.content.data.extra.data.picId)},null,8,["style","preview-disabled","src","onClick"])),((Nt=(xt=B(D).userInfo)==null?void 0:xt.vip_info)==null?void 0:Nt.vip_type)==0||!B(D).Token?(ee(),ne("div",{key:2,class:"buy",onClick:re[3]||(re[3]=_c(_t=>B(D).Token?B(T).push("/becomePro"):B(D).isPopupLogin=!0,["stop"]))},[zp,gn(" Subcribe Pro to Unlock More Pics ")])):ct("",!0)]))])):ct("",!0)],64)):(ee(),ne("div",Xp,[J("span",null,$e(ae.content.data.extra.data.context),1)]))],64)}),128)),B(w).isSend==2?(ee(),ne("div",$p,Zp)):ct("",!0)])]),_:1},512)]),J("div",e_,[J("div",t_,[Ue(B(Ld),{"preflight-style-disabled":"","w-90p":"",class:"textareaBox"},{default:it(()=>[Ue(B(Bl),{placeholder:"Say something\u2026",type:"textarea",class:"textarea",value:R.value,"onUpdate:value":re[4]||(re[4]=ae=>R.value=ae),autosize:{minRows:1,maxRows:5},"theme-overrides":ut,onBlur:Yt,onFocus:re[5]||(re[5]=ae=>z.value=!0),onkeydown:"if(event.keyCode==13)return false;"},null,8,["value"])]),_:1}),X.value?(ee(),hn(B(As),{key:0,class:"send_message","square-48":"","position-absolute":"","r-10":"","top-50p":"",size:"small"})):(ee(),ne("img",{key:1,class:"send_message","square-48":"",onClick:re[6]||(re[6]=ae=>$()),"c-p":"","position-absolute":"","r-10":"","top-50p":"",src:Cp}))])]),K.value?(ee(),ne("div",n_,[Ue(B(As),{size:"large"})])):ct("",!0)],64))}});const s_=mn(o_,[["__scopeId","data-v-a9a4ca3d"]]),lc="data:image/webp;base64,UklGRggFAABXRUJQVlA4WAoAAAAwAAAAYgAAYgAASUNDUBgCAAAAAAIYAAAAAAQwAABtbnRyUkdCIFhZWiAAAAAAAAAAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAAHRyWFlaAAABZAAAABRnWFlaAAABeAAAABRiWFlaAAABjAAAABRyVFJDAAABoAAAAChnVFJDAAABoAAAAChiVFJDAAABoAAAACh3dHB0AAAByAAAABRjcHJ0AAAB3AAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAFgAAAAcAHMAUgBHAEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFhZWiAAAAAAAABvogAAOPUAAAOQWFlaIAAAAAAAAGKZAAC3hQAAGNpYWVogAAAAAAAAJKAAAA+EAAC2z3BhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABYWVogAAAAAAAA9tYAAQAAAADTLW1sdWMAAAAAAAAAAQAAAAxlblVTAAAAIAAAABwARwBvAG8AZwBsAGUAIABJAG4AYwAuACAAMgAwADEANlZQOEzJAgAAL2KAGBCvMf/zP/8M27aNHK5stHn63AQXGDcAEIAgFIwJwVgQAACFgmA0ADAWAkAAEwAkBEEAwAAgEPgRCAQCHwKBB0iOJCmSYpiZmSlmlnf//7eBhsjKPUf0n4Hbto2K+JDbO856AQAAAAAAAAAAAAAAAAAAyFVa/clssz2eeT5uN7NJv1XJAQAAAAAAAAAAAAAAAJCty9cH8wNJkiRJkiTJw3xQzwexpNCc7kmSJBOt2k+bBWutOn5Zkm7BuGq4JNtckCQpWLBoZm20THtFkjJl1c4YoLYkSamyrKm10uhMyuU8KknR2ZKkgbLt6LTikCSNlGFRhPKaNJR1WYLGjjSVXUOA7ok0llM3NXoX0lwuvZTok2QASj+dTgYivTR7vKwNYWU3+Ykij2Z/sEbS/zD2rNYnLSezJYn+dNt/P5F9SWytLG1YEotLBiedeNZIadOt7H0sp4zIAGUUx60S5rPgxlq0fyBjbz3HR/oRbTJQaUd5USvt0PpDET5XkwxWmq9jYTF0vuOrN2txyW+f71fRBb74wGO9dvv9+/v7vWkucfzs8+9t8Pf3db9GhS9feNraAk/jR7nx1ADP41t0mdNH7LXX42W8UzSbB+pm+JBdaR0YmEF3qQNgbgXhtc6RO4SFZPF0rmIE7UuttGwg/jJbfRPIPeuJBeRWaDIzgN5YzzZ6GBDOZiuHiR93lFzcNQomjHs8a7g1AjZunMg1/IiiDRtxMTlqrs56sYvdXPyPLqyKC9vowsK74CkXbOvCZ/Dg+bjw31x4oaa+9JvMl/YQERjGNY/wTBXXuIjOPMSYCSNljZ/y/vUmi5Q9xPsushYuci8eMkgu8mAesnkecpIuMqse8sMestwucvUeKg4e6iYeqj8ealgeKnEe6okeqqIearseKtQe6uwOugU89Dw46Nzw0H/ioIsm/F4gBx1N/0JflofuMgAA",i_="data:image/webp;base64,UklGRkIIAABXRUJQVlA4WAoAAAAwAAAANQAANQAASUNDUBgCAAAAAAIYAAAAAAQwAABtbnRyUkdCIFhZWiAAAAAAAAAAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAAHRyWFlaAAABZAAAABRnWFlaAAABeAAAABRiWFlaAAABjAAAABRyVFJDAAABoAAAAChnVFJDAAABoAAAAChiVFJDAAABoAAAACh3dHB0AAAByAAAABRjcHJ0AAAB3AAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAFgAAAAcAHMAUgBHAEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFhZWiAAAAAAAABvogAAOPUAAAOQWFlaIAAAAAAAAGKZAAC3hQAAGNpYWVogAAAAAAAAJKAAAA+EAAC2z3BhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABYWVogAAAAAAAA9tYAAQAAAADTLW1sdWMAAAAAAAAAAQAAAAxlblVTAAAAIAAAABwARwBvAG8AZwBsAGUAIABJAG4AYwAuACAAMgAwADEANlZQOEwDBgAALzVADRB/B7e2bdXKvefsK0/+/7i7SwM/pAAnggaI3DNSdyjAIneNXDK3zLUCBjlNOGzbyJGoufvQf7WXD85t26aevc4593v6YltVOqvNr2aZ9Kps25UIsm1xDb7XQRDxqggSoVkEiSAlhoU0y9jyqv7LIoiQsyRCrkAuQTMhZ4klIbkEucPzqgiVCEm6Sv1nk0tiVTSJUHFJhBJd/0EAsQJIhJwRQHI0q13XgUCwxApWAIEAAiIEX6g+RppfjiQqbC6nAjI151iai1eanF3EhXWIVRlbthBnmdJzIEeSqKCEOBlfxpO0LBu+54uWOEzPsZgvEAGzNefi5IZnR4ISGM2kqKs7x9ubS8WazXUoTQPFXc4Dhwu/3dNMrFKs3Gx7zuaWK4mUczmP695n/tuPpTmVrcF2ZwJqAmrOlhtd1+Te+0SMYcDszrlsTYisdwoQo+QKAIaoJ++vHxc9ilfoOxb66ZvmPMnVPGFwOSPsd0WB4gwTVHPeHQIFBJ5Ec8fdMAwYAgkERFyu7ZzIcrc901yczGOvrnrC8NQ7zYH56Zthpo6lAK99AjAIADAwwwAQcNYtBmYkYQAwwwCGgUGS0+4AAMwAiJGEASCAgeG8WwIIJGFg5t8DnHYHwACGQBIwBAAwDHc9YxAAIJCEGQAo/P+/1kqX9sXuxG5swe4Au7uxG7C7Abu7C7Gb2NET5NL7j+kuvc37/+s5elbefAy87s62OyL678BtJEUqXS2DD+feAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD73bXBmug5c+desgZ68Zw5c64uvxfNmz9v/t2l9+xGo9FovFh2t6/X6/V6vT663I5+pVar1Wq12oXl5rZqtVqtVqvVr0vtkb/+1jk9q8y8XKlUKpVKpVKpfLV+eT1BURRFURRFURTl2vLyUldX1+8Z2/ctq/tYlmVZlmVZlmVZ1ndbl5RbTdM0TdM0TdM0TdN8qKS8YRiGYRiGYRiGYRiGcWYp3VvXdV3XdV3XdV3XdV3XtysjZ2iapmmapmmapmmapmna6+uNQLnV8ekb3Kuqqqqqqqqqqqqqqqqq6mXFe9K3i49LAR5bvKjIdNui3WvZwmW3pASvLVtYZPpowW756tIFS79JERYsLTbds1hu7l7SvaR7mLTFakGx6SOFurnjOI7jPJxFcBzHcRzHcRwnbRpTJJf++UdqejowZrWg4PSaInnXtm3btu3vt8Eetm3btm3btm3btm3bnaQC3Y1zzjnnnPMbTuScc84555xzzrNEu+fnaMYYY4wxxhhjjDHGGGOMMcYYY4wxxhg7LT/XU0oppZRSSimllFJKKaWUUkoppZRSSuk9+XmSEEIIIYQQQgghhBBCCCGEEEIIIYQQQt7JzxNSSimllFJKKaWUUkoppZRSSimllFJKKfPzthBCCCGEEEIIIYQQQgghhBBCCCGEEEKIzXLT09PzV4HtD+Rbds2N7/u+7/u+7/u+7/u+7/v+VXgrV3JEbt70PM/zPM/zPM/zPM/zvI+Bo3Ipu+TmWdd1Xdd1Xdd1Xdd1XdedBGBSHmXd3Ny/atXKVXnbDwew7kc5lvzTrlu+In+6zrDnsGzJc/k5NI7jOI7jOI7jOI7jOP4xDbozk3JTftb5IYqiKIqiKIqi6MPh7WnQzpmcQwp82R4PwzAMwzAMw/C+g8Mw/KAD9EyaMywp8r0+KAiCIAiCIAiCidjp6fcndoBuzODcUein56l2u91ut9vtdntCtmdCp+a9TQvlwH//65yOz/aM79RcWfAn9fZWq9VqtVqt1rnZnCs6MF8W/fVe+4Vms9lsNpvN6dmc6WnLL5sUHik2+Xnon6Gh4e3jsjDjOizHjmBU2vGLvwdT05kbd1I2npmWXFBo6MuwzRgYGOgfGBiY0fEY+3nK8dPYEY6Ya03p6+vr6+vr65tyzAE7nPpg2vDZRiMfaff/9P/e3t7s7bPPL+fPwCnTkiRJkiRJkiRJpl0+qrR/OaNOnjz1+VmzPpk6+bwNC7kAAA==",Ic=y=>(wo("data-v-8e9c1c10"),y=y(),Fo(),y),a_={key:0,class:"banner"},r_={key:0,class:"btn"},c_=["src"],u_=["onClick"],l_=["onClick"],d_={class:"custom-dots",center:""},p_=["onClick"],__={class:"details","w-100p":"","h-280":"","position-absolute":"","bottom-0":"","left-0":""},g_={"p-y-20":"","p-x-15":""},h_={"color-fff":"","fs-22":"","font-weight-bold":"","flex-between-center":"","m-b-10":""},f_={"flex-end-center":""},m_=Ic(()=>J("img",{"square-18":"",src:i_},null,-1)),v_={"color-fff":"","fs-16":"","m-l-4":""},I_={class:"tag","flex-flex-start-center":"","flex-wrap":""},M_=Ic(()=>J("div",{"color-fff":"","fs-24":"","line-height-32":""},"introduce",-1)),y_={class:"introduce","m-t-10":"","fs-14":"","line-height-24":""},A_=Tt({__name:"detalis",emits:["changePosition"],setup(y,{emit:A}){const T=Cs(),l=bn(),O=bo(),D=O==null?void 0:O.appContext.config.globalProperties.$sensors,w=fn(),R=A,H=()=>{R("changePosition",100)};Wt(()=>w.aiInfo,()=>{w.aiInfo&&w.aiInfo.name&&D.track("h5_chat_page_view",{entrance_source:"\u6D88\u606F\u5217\u8868",ai_name:w.aiInfo.name,ai_id:w.aiInfo.ai_uid,is_login:l.Token?"\u662F":"\u5426",from_our_platform:"ponrh.ai",ref_name:"pornh.ai:"+Mt("ref")})},{immediate:!0});const z=ve=>{D.track("h5_AI_function_click",{node_name:ve,ai_name:w.aiInfo.name,entrance_source:"\u6D88\u606F\u5217\u8868",ai_id:w.aiInfo.ai_uid,is_login:l.Token?"\u662F":"\u5426",from_our_platform:"ponrh.ai",ref_name:"pornh.ai:"+Mt("ref")})},oe=()=>{l.Token?w.isPopupPhoto=!0:l.isPopupLogin=!0,D.track("h5_AI_function_click",{node_name:"\u76F8\u518C",ai_name:w.aiInfo.name,entrance_source:"\u6D88\u606F\u5217\u8868",ai_id:w.aiInfo.ai_uid,is_login:l.Token?"\u662F":"\u5426",from_our_platform:"ponrh.ai",ref_name:"pornh.ai:"+Mt("ref")})},_e=()=>{D.track("h5_pro_page_view",{entrance_source:"\u6D77\u62A5\u56FE",from_our_platform:"ponrh.ai",ref_name:"pornh.ai:"+Mt("ref")}),l.Token?T.push("/becomePro"):l.isPopupLogin=!0};return(ve,Ie)=>{var j,Z,K,X;return ee(),ne(yt,null,[B(w).aiInfo?(ee(),ne("div",a_,[J("img",{src:Ts,class:"prevM",onClick:H}),((Z=(j=B(l).userInfo)==null?void 0:j.vip_info)==null?void 0:Z.vip_type)==0||!B(l).Token?(ee(),ne("div",{key:0,class:"mask",onClick:_e},[((X=(K=B(l).userInfo)==null?void 0:K.vip_info)==null?void 0:X.vip_type)==0||!B(l).Token?(ee(),ne("div",r_,"Pro Unlock")):ct("",!0)])):ct("",!0),B(w).aiInfo.posters?(ee(),hn(B(Td),{key:1,autoplay:"",interval:5e3,"show-arrow":""},{arrow:it(({prev:$,next:b})=>[B(w).aiInfo.posters.length>1?(ee(),ne("div",{key:0,class:"custom-arrow","flex-between-center":"",onClick:Ie[1]||(Ie[1]=Qe=>z("\u5207\u6362\u6D77\u62A5\u56FE"))},[J("img",{"square-34":"","m-l-12":"","c-p":"",class:"prev",onClick:$,src:lc},null,8,u_),J("img",{"square-34":"","m-r-12":"","c-p":"",class:"next",onClick:b,src:lc},null,8,l_)])):ct("",!0)]),dots:it(({total:$,currentIndex:b,to:Qe})=>[J("ul",d_,[(ee(!0),ne(yt,null,on($,He=>(ee(),ne("li",{key:He,class:Ca({["is-active"]:b===He-1}),onClick:ut=>Qe(He-1)},null,10,p_))),128))])]),default:it(()=>[(ee(!0),ne(yt,null,on(B(w).aiInfo.posters,$=>(ee(),ne("img",{key:$,class:"carousel-img",src:$,onClick:Ie[0]||(Ie[0]=b=>z("\u6D77\u62A5\u56FE"))},null,8,c_))),128))]),_:1})):ct("",!0)])):ct("",!0),J("div",__,[J("div",g_,[J("div",h_,[gn($e(B(w).aiInfo.ai_name)+" ",1),J("p",f_,[m_,J("span",v_,$e(B(w).aiInfo.heat),1)])]),J("div",I_,[(ee(!0),ne(yt,null,on(B(w).aiInfo.tags,$=>(ee(),ne("span",{key:$,"fs-12":"","p-x-12":"","p-y-6":""},$e($),1))),128)),(ee(!0),ne(yt,null,on(B(w).aiInfo.common_tags,$=>(ee(),ne("span",{key:$,"fs-12":"","p-x-12":"","p-y-6":""},$e($.tag_name),1))),128))]),M_,J("div",y_,$e(B(w).aiInfo.ai_desc),1)]),J("div",{class:"photoBtn",onClick:oe},$e(B(w).aiInfo.ai_name)+"'s Gallery",1)])],64)}}});const C_=mn(A_,[["__scopeId","data-v-8e9c1c10"]]),T_=""+new URL("null.49a2f2b0.webp",import.meta.url).href,D_={},S_={"h-100p":"",center:""},L_=J("div",null,[J("img",{"w-300":"",src:T_}),J("p",{"color-B5B1FF":"",op30:"","m-t-10":"","text-center":"","fs-15":""}," It's empty ")],-1),E_=[L_];function k_(y,A){return ee(),ne("div",S_,E_)}const R_=mn(D_,[["render",k_]]);var Mc={exports:{}};(function(y,A){(function(T,l){y.exports=l()})(gs,function(){function T(e,t){var n,o=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),o.push.apply(o,n)),o}function l(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?T(Object(n),!0).forEach(function(o){H(e,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(n,o))})}return e}function O(e){return(O=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function R(e,t,n){return t&&w(e.prototype,t),n&&w(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function z(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_e(e,t)}function oe(e){return(oe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(e)}function _e(e,t){return(_e=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n})(e,t)}function ve(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ie(e,t,n){return(Ie=ve()?Reflect.construct:function(o,r,i){var a=[null],r=(a.push.apply(a,r),new(Function.bind.apply(o,a)));return i&&_e(r,i.prototype),r}).apply(null,arguments)}function j(e){var t=typeof Map=="function"?new Map:void 0;return function(n){if(n===null||Function.toString.call(n).indexOf("[native code]")===-1)return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(n))return t.get(n);t.set(n,o)}function o(){return Ie(n,arguments,oe(this).constructor)}return o.prototype=Object.create(n.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),_e(o,n)}(e)}function Z(e,t){if(e==null)return{};var n,o=function(a,r){if(a==null)return{};for(var c,d={},p=Object.keys(a),h=0;h<p.length;h++)c=p[h],0<=r.indexOf(c)||(d[c]=a[c]);return d}(e,t);if(Object.getOwnPropertySymbols)for(var s=Object.getOwnPropertySymbols(e),i=0;i<s.length;i++)n=s[i],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n]);return o}function K(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function X(e){var t=ve();return function(){var n,o=oe(e),o=(n=t?(n=oe(this).constructor,Reflect.construct(o,arguments,n)):o.apply(this,arguments),this);if(n&&(typeof n=="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return K(o)}}function $(e,t){return Qe(e)||function(n,o){var s=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(s!=null){var i,a,r=[],c=!0,d=!1;try{for(s=s.call(n);!(c=(i=s.next()).done)&&(r.push(i.value),!o||r.length!==o);c=!0);}catch(p){d=!0,a=p}finally{try{c||s.return==null||s.return()}finally{if(d)throw a}}return r}}(e,t)||ut(e,t)||ft()}function b(e){return function(t){if(Array.isArray(t))return Je(t)}(e)||He(e)||ut(e)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Qe(e){if(Array.isArray(e))return e}function He(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ut(e,t){if(e){if(typeof e=="string")return Je(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return(n=n==="Object"&&e.constructor?e.constructor.name:n)==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Je(e,t):void 0}}function Je(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function ft(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ee(e,t){var n,o=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=ut(e))||t&&e&&typeof e.length=="number")return o&&(e=o),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(r){throw r},f:t};throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,i=!0,a=!1;return{s:function(){o=o.call(e)},n:function(){var r=o.next();return i=r.done,r},e:function(r){a=!0,s=r},f:function(){try{i||o.return==null||o.return()}finally{if(a)throw s}}}}var V={SDK_READY:"sdkStateReady",SDK_NOT_READY:"sdkStateNotReady",SDK_DESTROY:"sdkDestroy",MESSAGE_RECEIVED:"onMessageReceived",ROOM_CUSTOM_DATA_RECEIVED:"onRoomCustomDataReceived",MESSAGE_MODIFIED:"onMessageModified",MESSAGE_REVOKED:"onMessageRevoked",MESSAGE_READ_BY_PEER:"onMessageReadByPeer",MESSAGE_READ_RECEIPT_RECEIVED:"onMessageReadReceiptReceived",MESSAGE_EXTENSIONS_UPDATED:"onMessageExtensionsUpdated",MESSAGE_EXTENSIONS_DELETED:"onMessageExtensionsDeleted",MESSAGE_REACTIONS_UPDATED:"onMessageReactionsUpdated",CONVERSATION_LIST_UPDATED:"onConversationListUpdated",TOTAL_UNREAD_MESSAGE_COUNT_UPDATED:"onTotalUnreadMessageCountUpdated",CONVERSATION_GROUP_LIST_UPDATED:"onConversationGroupListUpdated",CONVERSATION_IN_GROUP_UPDATED:"onConversationInGroupUpdated",GROUP_LIST_UPDATED:"onGroupListUpdated",GROUP_ATTRIBUTES_UPDATED:"groupAttributesUpdated",GROUP_COUNTER_UPDATED:"onGroupCounterUpdated",TOPIC_CREATED:"onTopicCreated",TOPIC_DELETED:"onTopicDeleted",TOPIC_UPDATED:"onTopicUpdated",PROFILE_UPDATED:"onProfileUpdated",USER_STATUS_UPDATED:"onUserStatusUpdated",BLACKLIST_UPDATED:"blacklistUpdated",FRIEND_LIST_UPDATED:"onFriendListUpdated",FRIEND_GROUP_LIST_UPDATED:"onFriendGroupListUpdated",FRIEND_APPLICATION_LIST_UPDATED:"onFriendApplicationListUpdated",MY_FOLLOWERS_LIST_UPDATED:"onMyFollowersListUpdated",MY_FOLLOWING_LIST_UPDATED:"onMyFollowingListUpdated",MUTUAL_FOLLOWERS_LIST_UPDATED:"onMutualFollowersListUpdated",KICKED_OUT:"kickedOut",ERROR:"error",NET_STATE_CHANGE:"netStateChange",ALL_RECEIVE_MESSAGE_OPT_UPDATED:"onAllReceiveMessageOptUpdated"},_={MSG_TEXT:"TIMTextElem",MSG_IMAGE:"TIMImageElem",MSG_SOUND:"TIMSoundElem",MSG_AUDIO:"TIMSoundElem",MSG_FILE:"TIMFileElem",MSG_FACE:"TIMFaceElem",MSG_VIDEO:"TIMVideoFileElem",MSG_GEO:"TIMLocationElem",MSG_LOCATION:"TIMLocationElem",MSG_GRP_TIP:"TIMGroupTipElem",MSG_GRP_SYS_NOTICE:"TIMGroupSystemNoticeElem",MSG_CUSTOM:"TIMCustomElem",MSG_MERGER:"TIMRelayElem",MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",CONV_C2C:"C2C",CONV_GROUP:"GROUP",CONV_TOPIC:"TOPIC",CONV_SYSTEM:"@TIM#SYSTEM",CONV_AT_ME:1,CONV_AT_ALL:2,CONV_AT_ALL_AT_ME:3,CONV_MARK_TYPE_STAR:1,CONV_MARK_TYPE_UNREAD:2,CONV_MARK_TYPE_FOLD:4,CONV_MARK_TYPE_HIDE:8,GRP_PRIVATE:"Private",GRP_WORK:"Private",GRP_PUBLIC:"Public",GRP_CHATROOM:"ChatRoom",GRP_MEETING:"ChatRoom",GRP_AVCHATROOM:"AVChatRoom",GRP_COMMUNITY:"Community",GRP_ROOM:"Room",GRP_LIVE:"Live",GRP_MBR_ROLE_OWNER:"Owner",GRP_MBR_ROLE_ADMIN:"Admin",GRP_MBR_ROLE_MEMBER:"Member",GRP_MBR_ROLE_CUSTOM:"Custom",GRP_TIP_MBR_JOIN:1,GRP_TIP_MBR_QUIT:2,GRP_TIP_MBR_KICKED_OUT:3,GRP_TIP_MBR_SET_ADMIN:4,GRP_TIP_MBR_CANCELED_ADMIN:5,GRP_TIP_GRP_PROFILE_UPDATED:6,GRP_TIP_MBR_PROFILE_UPDATED:7,GRP_TIP_BAN_AVCHATROOM_MEMBER:10,GRP_TIP_UNBAN_AVCHATROOM_MEMBER:11,MSG_REMIND_ACPT_AND_NOTE:"AcceptAndNotify",MSG_REMIND_ACPT_NOT_NOTE:"AcceptNotNotify",MSG_REMIND_DISCARD:"Discard",RECEIVE_WITH_OFFLINE_PUSH_EXCEPT_AT:"AcceptNotNotifyExceptAt",GENDER_UNKNOWN:"Gender_Type_Unknown",GENDER_FEMALE:"Gender_Type_Female",GENDER_MALE:"Gender_Type_Male",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",KICKED_OUT_REST_API:"REST_API_Kick",ALLOW_TYPE_ALLOW_ANY:"AllowType_Type_AllowAny",ALLOW_TYPE_NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_TYPE_DENY_ANY:"AllowType_Type_DenyAny",FORBID_TYPE_NONE:"AdminForbid_Type_None",FORBID_TYPE_SEND_OUT:"AdminForbid_Type_SendOut",JOIN_OPTIONS_FREE_ACCESS:"FreeAccess",JOIN_OPTIONS_NEED_PERMISSION:"NeedPermission",JOIN_OPTIONS_DISABLE_APPLY:"DisableApply",JOIN_STATUS_SUCCESS:"JoinedSuccess",JOIN_STATUS_ALREADY_IN_GROUP:"AlreadyInGroup",JOIN_STATUS_WAIT_APPROVAL:"WaitAdminApproval",INVITE_OPTIONS_DISABLE_INVITE:"DisableInvite",INVITE_OPTIONS_NEED_PERMISSION:"NeedPermission",INVITE_OPTIONS_FREE_ACCESS:"FreeAccess",GRP_PROFILE_OWNER_ID:"ownerID",GRP_PROFILE_CREATE_TIME:"createTime",GRP_PROFILE_LAST_INFO_TIME:"lastInfoTime",GRP_PROFILE_MEMBER_NUM:"memberNum",GRP_PROFILE_MAX_MEMBER_NUM:"maxMemberNum",GRP_PROFILE_JOIN_OPTION:"joinOption",GRP_PROFILE_INVITE_OPTION:"inviteOption",GRP_PROFILE_INTRODUCTION:"introduction",GRP_PROFILE_NOTIFICATION:"notification",GRP_PROFILE_MUTE_ALL_MBRS:"muteAllMembers",SNS_ADD_TYPE_SINGLE:"Add_Type_Single",SNS_ADD_TYPE_BOTH:"Add_Type_Both",SNS_DELETE_TYPE_SINGLE:"Delete_Type_Single",SNS_DELETE_TYPE_BOTH:"Delete_Type_Both",SNS_APPLICATION_TYPE_BOTH:"Pendency_Type_Both",SNS_APPLICATION_SENT_TO_ME:"Pendency_Type_ComeIn",SNS_APPLICATION_SENT_BY_ME:"Pendency_Type_SendOut",SNS_APPLICATION_AGREE:"Response_Action_Agree",SNS_APPLICATION_AGREE_AND_ADD:"Response_Action_AgreeAndAdd",SNS_CHECK_TYPE_BOTH:"CheckResult_Type_Both",SNS_CHECK_TYPE_SINGLE:"CheckResult_Type_Single",SNS_TYPE_NO_RELATION:"CheckResult_Type_NoRelation",SNS_TYPE_A_WITH_B:"CheckResult_Type_AWithB",SNS_TYPE_B_WITH_A:"CheckResult_Type_BWithA",SNS_TYPE_BOTH_WAY:"CheckResult_Type_BothWay",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected",MSG_AT_ALL:"__kImSDK_MesssageAtALL__",READ_ALL_C2C_MSG:"readAllC2CMessage",READ_ALL_GROUP_MSG:"readAllGroupMessage",READ_ALL_MSG:"readAllMessage",USER_STATUS_UNKNOWN:0,USER_STATUS_ONLINE:1,USER_STATUS_OFFLINE:2,USER_STATUS_UNLOGINED:3,IOS_OFFLINE_PUSH_NO_SOUND:"push.no_sound",IOS_OFFLINE_PUSH_DEFAULT_SOUND:"default"},Me={NEW_INVITATION_RECEIVED:"newInvitationReceived",INVITEE_ACCEPTED:"ts_invitee_accepted",INVITEE_REJECTED:"ts_invitee_rejected",INVITATION_CANCELLED:"ts_invitation_cancelled",INVITATION_TIMEOUT:"ts_invitation_timeout",INVITATION_MODIFIED:"ts_invitation_modified",ACTION_TYPE_UNKNOWN:0,ACTION_TYPE_INVITE:1,ACTION_TYPE_CANCEL_INVITE:2,ACTION_TYPE_ACCEPT_INVITE:3,ACTION_TYPE_REJECT_INVITE:4,ACTION_TYPE_INVITE_TIMEOUT:5},Yt=(R(Nt,[{key:"use",value:function(e){if(typeof e!="function")throw"middleware must be a function";return this.cache.push(e),this}},{key:"next",value:function(e){if(this.middlewares&&0<this.middlewares.length)return this.middlewares.shift().call(this,this.options,this.next.bind(this))}},{key:"run",value:function(e){return this.middlewares=this.cache.map(function(t){return t}),this.options=e,this.next()}}]),Nt),ke=(R(xt,[{key:"equal",value:function(e){return e!==null&&this.low===e.low&&this.high===e.high}},{key:"toString",value:function(){var e=Number(this.high).toString(16),t=Number(this.low).toString(16);if(t.length<8)for(var n=8-t.length;n;)t="0"+t,n--;return e+t}}]),xt),Ne={TEST:{CHINA:{DEFAULT:"wss://wss-dev.tim.qq.com"},OVERSEA:{DEFAULT:"wss://wss-dev.tim.qq.com"},SINGAPORE:{DEFAULT:"wss://wsssgp-dev.im.qcloud.com"},KOREA:{DEFAULT:"wss://wsskr-dev.im.qcloud.com"},GERMANY:{DEFAULT:"wss://wssger-dev.im.qcloud.com"},IND:{DEFAULT:"wss://wssind-dev.im.qcloud.com"},JPN:{DEFAULT:"wss://wssjpn-dev.im.qcloud.com"},USA:{DEFAULT:"wss://wssusa-dev.im.qcloud.com"},INDONESIA:{DEFAULT:"wss://wssidn-dev.im.qcloud.com"}},PRODUCTION:{CHINA:{DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.tim.qq.com",STAT:"https://events.im.qcloud.com",ANYCAST:"wss://162.14.13.203"},OVERSEA:{DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.my-imcloud.com",STAT:"https://api.my-imcloud.com"},SINGAPORE:{DEFAULT:"wss://wsssgp.im.qcloud.com",BACKUP:"wss://wsssgp.my-imcloud.com",STAT:"https://apisgp.my-imcloud.com",ANYCAST:"wss://162.14.19.159"},KOREA:{DEFAULT:"wss://wsskr.im.qcloud.com",BACKUP:"wss://wsskr.my-imcloud.com",STAT:"https://apikr.my-imcloud.com",ANYCAST:"wss://162.14.13.104"},GERMANY:{DEFAULT:"wss://wssger.im.qcloud.com",BACKUP:"wss://wssger.my-imcloud.com",STAT:"https://apiger.my-imcloud.com",ANYCAST:"wss://162.14.3.17"},IND:{DEFAULT:"wss://wssind.my-imcloud.com",BACKUP:"wss://wssind.im.qcloud.com",STAT:"https://apiind.my-imcloud.com",ANYCAST:"wss://162.14.18.188"},JPN:{DEFAULT:"wss://wssjpn.im.qcloud.com",BACKUP:"wss://wssjpn.my-imcloud.com",STAT:"https://apijpn.my-imcloud.com"},USA:{DEFAULT:"wss://wssusa.im.qcloud.com",BACKUP:"wss://wssusa.my-imcloud.com",STAT:"https://apiusa.my-imcloud.com",ANYCAST:"wss://162.14.10.42"},INDONESIA:{DEFAULT:"wss://wssidn.im.qcloud.com",BACKUP:"wss://wssidn.my-imcloud.com",STAT:"https://apiidn.my-imcloud.com",ANYCAST:"wss://43.129.34.169"}}},re={ANDROID:2,IOS:3,MAC:4,WEB:7,WX_MP:8,QQ_MP:9,TT_MP:10,BAIDU_MP:11,ALI_MP:12,IPAD:13,UNI_NATIVE_APP:15},ae="1.7.3",we=537048168,nt="CHINA",L={HOST:{CURRENT:{DEFAULT:"wss://wss.im.qcloud.com",STAT:"https://events.im.qcloud.com"},setCurrent:function(){this.CURRENT=Ne.PRODUCTION[0<arguments.length&&arguments[0]!==void 0?arguments[0]:nt]}},NAME:{OPEN_IM:"openim",OPEN_IM_MSG_EXT:"openim_msg_ext_http_svc",GRP:"group_open_http_svc",GRP_AV:"group_open_avchatroom_http_svc",GRP_COMMUNITY:"million_group_open_http_svc",GRP_ATTR:"group_open_attr_http_svc",FD:"sns",PROFILE:"profile",RECENT_CONTACT:"recentcontact",PIC:"openpic",BIG_GRP_NO_AUTH:"group_open_http_noauth_svc",BIG_GRP_POLLING:"group_open_long_polling_http_svc",BIG_GRP_POLLING_NO_AUTH:"group_open_long_polling_http_noauth_svc",IM_OPEN_STAT:"imopenstat",WEB_IM:"webim",IM_COS_SIGN:"im_cos_sign_svr",CUSTOM_UPLOAD:"im_cos_msg",HEARTBEAT:"heartbeat",IM_OPEN_PUSH:"im_open_push",IM_OPEN_STATUS:"im_open_status",IM_LONG_MSG:"im_long_msg",IM_CONFIG_MANAGER:"im_sdk_config_mgr",STAT_SERVICE:"StatSvc",OVERLOAD_PUSH:"OverLoadPush",IM_MSG_AUDIT_MGR:"im_msg_audit_mgr",TUIROOM_SVR:"tui_room_svr",IM_OPEN_TRANSLATE:"im_open_translate",IM_OPEN_SPEECH:"im_open_speech",MSG_SEARCH:"message_search",FOLLOW:"follow",OFFLINE_PUSH_REPORT:"offline_push_report",IM_MSG_LOGIC:"im_msg_db_logic"}},de={SEARCH_GRP_SNS:new ke(0,Math.pow(2,1)).toString(),AV_HISTORY_MSG:new ke(0,Math.pow(2,2)).toString(),GRP_COMMUNITY:new ke(0,Math.pow(2,3)).toString(),MSG_TO_SPECIFIED_GRP_MBR:new ke(0,Math.pow(2,4)).toString(),AV_MBR_LIST:new ke(0,Math.pow(2,6)).toString(),USER_STATUS:new ke(0,Math.pow(2,7)).toString(),CONV_MARK:new ke(0,Math.pow(2,9)).toString(),CONV_GROUP:new ke(0,Math.pow(2,10)).toString(),AV_BAN_MBR:new ke(0,Math.pow(2,11)).toString(),MSG_EXT:new ke(0,Math.pow(2,13)).toString(),GRP_COUNTER:new ke(0,Math.pow(2,15)).toString(),PLUGIN_TRANSLATE:new ke(Math.pow(2,6)).toString(),PLUGIN_VOICE_TO_TEXT:new ke(Math.pow(2,7)).toString(),PLUGIN_CS:new ke(Math.pow(2,8)).toString(),PLUGIN_PUSH:new ke(Math.pow(2,9)).toString(),PLUGIN_BOT:new ke(Math.pow(2,10)).toString(),MSG_REACTION:new ke(Math.pow(2,16)).toString(),FOLLOW:new ke(Math.pow(2,20)).toString()},Rt="group_profile";function xt(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;D(this,xt),this.high=e,this.low=t}function Nt(){D(this,Nt),this.cache=[],this.options=null}L.HOST.setCurrent(nt);var _t=typeof wx<"u"&&typeof wx.getSystemInfoSync=="function"&&Boolean(wx.getSystemInfoSync().fontSizeSetting),xo=_t&&typeof wx.createGamePortal=="function",ot=typeof qq<"u"&&typeof qq.getSystemInfoSync=="function"&&Boolean(qq.getSystemInfoSync().fontSizeSetting),Dt=typeof tt<"u"&&typeof tt.getSystemInfoSync=="function"&&Boolean(tt.getSystemInfoSync().fontSizeSetting),Zt=typeof swan<"u"&&typeof swan.getSystemInfoSync=="function"&&Boolean(swan.getSystemInfoSync().fontSizeSetting),gt=typeof my<"u"&&typeof my.getSystemInfoSync=="function"&&Boolean(my.getSystemInfoSync().fontSizeSetting),he=typeof jd<"u"&&typeof jd.getSystemInfoSync=="function",ze=typeof uni<"u"&&typeof window>"u"&&typeof uni.requireNativePlugin=="function",vn=typeof uni<"u",ge=_t||ot||Dt||Zt||gt||ze||he,qe=(typeof uni<"u"||typeof window<"u")&&!ge,ce=ot?qq:Dt?tt:Zt?swan:gt?my:_t?wx:ze?uni:he?jd:{},xe=qe&&window&&window.navigator&&window.navigator.userAgent||"",he=/(micromessenger|webbrowser)/i.test(xe),U=/AppleWebKit\/([\d.]+)/i.exec(xe);U&&parseFloat(U.pop()),U="WEB",he?U="WEB":ot?U="QQ_MP":Dt?U="TT_MP":Zt?U="BAIDU_MP":gt?U="ALI_MP":_t?U="WX_MP":ze&&(U="UNI_NATIVE_APP");var Ss=re[U],he=/iPad/i.test(xe),U=/iPhone/i.test(xe)&&!he,le=/iPod/i.test(xe),Vt=U||he||le,Ls=(U=xe.match(/OS (\d+)_/i))&&U[1]?U[1]:null,wn=/Android/i.test(xe),In=function(){var e=xe.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(e[1]+"."+e[2]):t||null}(),he=/Edge/i.test(xe),le=!he&&/Chrome/i.test(xe),en=((U=xe.match(/Chrome\/(\d+)/))&&U[1]&&parseFloat(U[1]),/MSIE/.test(xe)||-1<xe.indexOf("Trident")&&-1<xe.indexOf("rv:11.0")),tn=U=!(U=(U=/MSIE\s(\d+)\.\d/.exec(xe))&&parseFloat(U[1]))&&/Trident\/7.0/i.test(xe)&&/rv:11.0/.test(xe)?11:U,Fn=/Safari/i.test(xe)&&!le&&!wn&&!he;(U=xe.match(/TBS\/(\d+)/i))&&U[1]&&U[1];for(var an,Ot=/Windows/i.test(xe),qn=/MAC OS X/i.test(xe),Gt=qe&&typeof Worker<"u"&&!en,rn=wn||Vt,xn=qe&&window.tencent_cloud_im_csig_flutter_for_web_25F_cy!==void 0,cn=function(){if(typeof window>"u"||window.navigator===void 0)return!1;var e=window.navigator.standalone;return!(!Vt||e||Fn)}(),jt=typeof console<"u"?console:typeof gs<"u"&&gs.console?gs.console:typeof window<"u"&&window.console?window.console:{},Vo=function(){},Bo=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],Ho=Bo.length;Ho--;)an=Bo[Ho],console[an]||(jt[an]=Vo);function Ko(){var e=new Date;return e.setTime(kt()),e}function Wo(){un=0}function Mn(){return Math.floor(kt()/1e3)}var Yo=jt,un=0,kt=function(){return new Date().getTime()+un},Pt=0;function jo(){return Ps()?"%c Chat %c":"Chat"}function Jo(){var e=Ko();return e.toLocaleTimeString("en-US",{hour12:!1})+"."+function(t){var n;switch(t.toString().length){case 1:n="00"+t;break;case 2:n="0"+t;break;default:n=t}return n}(e.getMilliseconds())}var u={arguments2String:function(e){var t="";if(e.length===1)t=e[0];else for(var n=0,o=e.length;n<o;n++)Vn(e[n])?Tc(e[n])?t+=Fa(e[n]):t+=JSON.stringify(e[n]):t+=e[n],t+=" ";return t},_exec:function(e,t){Ps()?Yo[e](jo(),"background:#0abf5b; padding:1px; border-radius:3px; color: #fff","background:transparent",Jo(),t):Yo[e]("".concat(jo()," ").concat(Jo()," ").concat(t))},d:function(){var e;Pt<=-1&&(e=this.arguments2String(arguments),this._exec("debug",e))},l:function(){var e;Pt<=0&&(e=this.arguments2String(arguments),this._exec("log",e))},log:function(){var e;Pt<=0&&(e=this.arguments2String(arguments),this._exec("log",e))},i:function(){var e;Pt<=1&&(e=this.arguments2String(arguments),this._exec("info",e))},w:function(){var e;Pt<=2&&(e=this.arguments2String(arguments),this._exec("warn",e))},e:function(){var e;Pt<=3&&(e=this.arguments2String(arguments),this._exec("error",e))},setLevel:function(e){e<4&&this._exec("log","set level from "+Pt+" to "+e),Pt=e},getLevel:function(){return Pt}},Ut={JPG:1,JPEG:1,GIF:2,PNG:3,BMP:4,UNKNOWN:255},le="Tag_Profile_IM_",E={NICK:"".concat(le,"Nick"),GENDER:"".concat(le,"Gender"),BIRTHDAY:"".concat(le,"BirthDay"),LOCATION:"".concat(le,"Location"),SELFSIGNATURE:"".concat(le,"SelfSignature"),ALLOWTYPE:"".concat(le,"AllowType"),LANGUAGE:"".concat(le,"Language"),AVATAR:"".concat(le,"Image"),MESSAGESETTINGS:"".concat(le,"MsgSettings"),ADMINFORBIDTYPE:"".concat(le,"AdminForbidType"),LEVEL:"".concat(le,"Level"),ROLE:"".concat(le,"Role")},W={GROUP:"".concat("Tag_SNS_IM_","Group"),REMARK:"".concat("Tag_SNS_IM_","Remark"),ADDSOURCE:"".concat("Tag_SNS_IM_","AddSource"),ADDWORDING:"".concat("Tag_SNS_IM_","Wording"),ADDTIME:"".concat("Tag_SNS_IM_","AddTime")},he="Gender_Type_",se={UNKNOWN:"".concat(he,"Unknown"),FEMALE:"".concat(he,"Female"),MALE:"".concat(he,"Male")},me={NONE:"".concat("AdminForbid_Type_","None"),SEND_OUT:"".concat("AdminForbid_Type_","SendOut")},Ae={NEED_CONFIRM:"".concat("AllowType_Type_","NeedConfirm"),ALLOW_ANY:"".concat("AllowType_Type_","AllowAny"),DENY_ANY:"".concat("AllowType_Type_","DenyAny")},ue="JoinedSuccess",Ge="WaitAdminApproval",be="@TOPIC#_",At=Object.prototype.hasOwnProperty;function G(e){if(e==null)return!0;if(typeof e=="boolean")return!1;if(typeof e=="number")return e===0;if(typeof e=="string"||typeof e=="function"||Array.isArray(e))return e.length===0;if(e instanceof Error)return e.message==="";if(Ce(e)){for(var t in e)if(At.call(e,t))return!1;return!0}return!!(Pa(e)||Ac(e)||Bt(e))&&e.size===0}function Pa(e){return An(e)==="map"}function Ac(e){return An(e)==="set"}function Bt(e){return An(e)==="file"}function fe(e){return e!==null&&(typeof e=="number"&&!isNaN(+e)||O(e)==="object"&&e.constructor===Number)}function Ht(e){return e!==null&&O(e)==="object"}function Ce(e){if(O(e)==="object"&&e!==null){if((e=Object.getPrototypeOf(e))===null)return 1;for(var t=e;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return e===t}}function F(e){return typeof Array.isArray=="function"?Array.isArray(e):An(e)==="array"}function Xe(e){return typeof e=="function"}function Ua(e){return An(e)==="filelist"}function ba(e){return typeof e=="string"&&(e=e[0],!/[^a-zA-Z0-9]/.test(e))}function bt(e,t,n,o){if(!Vn(e)||!Vn(t))return 0;for(var s,i=0,a=Object.keys(t),r=0,c=a.length;r<c;r++)if(s=a[r],!(C(t[s])||n&&n.includes(s)))if(Vn(e[s])&&Vn(t[s]))i+=bt(e[s],t[s],n,o);else{if(o&&o.includes(t[s]))continue;e[s]!==t[s]&&(e[s]=t[s],i+=1)}return i}function Es(e,t){var n,o=new Map,s=Ee(e.entries());try{for(s.s();!(n=s.n()).done;){var i=$(n.value,2),a=i[0],r=i[1];o.set(a,t?JSON.stringify(r):JSON.parse(JSON.stringify(r)))}}catch(c){s.e(c)}finally{s.f()}return o}function zo(e){if(e.length===0)return 0;for(var t=0,n=0,o=typeof document<"u"&&document.characterSet!==void 0?document.characterSet:"UTF-8";e[t]!==void 0;)n+=e[t++].charCodeAt[t]<=255?1:o===!1?3:2;return n}function St(e){return e=e||99999999,Math.round(Math.random()*e)}function wa(){for(var e="",t=32;0<t;--t)e+=qa[Math.floor(Math.random()*Dc)];return e}function yn(e,t){for(var n in e)if(e[n]===t)return 1}function Xo(e){return e.indexOf("http://")===-1||e.indexOf("https://")===-1?"https://"+e:e.replace(/https|http/,"https")}function ks(e){if(Object.getOwnPropertyNames(e).length===0)return Object.create(null);var t,n,o=Array.isArray(e)?[]:Object.create(null);for(n in e)e[n]!==null?e[n]!==void 0?(t=O(e[n]),0<=["string","number","function","boolean"].indexOf(t)?o[n]=e[n]:o[n]=ks(e[n])):o[n]=void 0:o[n]=null;return o}var Cc=["url"],te=function(e){return typeof e=="string"},C=function(e){return e===void 0},Vn=function(e){return F(e)||Ht(e)},Tc=function(e){return e instanceof Error},An=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()},Fa=(Date.now||(Date.now=function(){return new Date().getTime()}),function(e){return JSON.stringify(e,["message","code"])}),qa="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",Dc=qa.length,$o={};function Bn(e,t){if(!F(e)||!F(t))return!1;var n=!1;return t.forEach(function(i){var s=i.key,i=i.value,a=e.find(function(r){return r.key===s});a?a.value!==i&&(a.value=i,n=!0):(e.push({key:s,value:i}),n=!0)}),n}function Rs(e){return G(e)?[]:e.filter(function(t){return t.isModified===!0})}function Ns(e){return G(e)?[]:e.filter(function(t){return t.isModified===!1})}function st(e){return e===_.GRP_AVCHATROOM}function lt(n){var t=n.type,n=n.groupID;return t===_.GRP_COMMUNITY||"".concat(n).startsWith("@TGS#_")&&!"".concat(n).includes(be)}function Ve(e){return"".concat(e).startsWith("@TGS#_")&&"".concat(e).includes(be)}function dt(e){return te(e)&&e.slice(0,3)===_.CONV_C2C}function at(e){return te(e)&&e.slice(0,5)===_.CONV_GROUP}function Qo(e){return te(e)&&e===_.CONV_SYSTEM}function xa(e,t){var n={};return Object.keys(e).forEach(function(o){n[o]=t(e[o],o)}),n}function Hn(e){return ge?new Promise(function(t,n){ce.getImageInfo({src:e,success:function(o){t({width:o.width,height:o.height})},fail:function(){t({width:0,height:0})}})}):en&&tn===9?Promise.resolve({width:0,height:0}):new Promise(function(t,n){var o=new Image;o.onload=function(){t({width:this.width,height:this.height}),o=null},o.onerror=function(){t({width:0,height:0}),o=null},o.src=e})}function Va(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return"".concat(e()+e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e())}function Ba(){var e=wn?"android":Vt?"ios":Ot?"windows":qn?"mac":"unknown";if(ge)try{var t=ce.getSystemInfoSync().platform;t!==void 0&&(e=t)}catch{}return e}function Ha(e,t){e=e.split("."),t=t.split(".");for(var n=Math.max(e.length,t.length);e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(var o=0;o<n;o++){var s=parseInt(e[o]),i=parseInt(t[o]);if(i<s)return 1;if(s<i)return-1}return 0}function Os(n){var t=n.originUrl,t=t===void 0?void 0:t,o=n.originWidth,s=n.originHeight,n=n.min,n=n===void 0?198:n,o=parseInt(o),s=parseInt(s),i={url:void 0,width:0,height:0};return(o<=s?o:s)<=n?(i.url=t,i.width=o,i.height=s):(s<=o?(i.width=Math.ceil(o*n/s),i.height=n):(i.width=n,i.height=Math.ceil(s*n/o)),s=t&&-1<t.indexOf("?")?"".concat(t,"&"):"".concat(t,"?"),i.url="".concat(s,n===198?"imageView2/3/w/198/h/198":"imageView2/3/w/720/h/720")),C(t)?(i.url,Z(i,Cc)):i}function Ka(e){var t=e[2];e[2]=e[1],e[1]=t;for(var n=0;n<e.length;n++)e[n].setType(n)}function Gs(e){return e=e.servcmd,e.slice(e.indexOf(".")+1)}function wt(e,t){return Math.round(Number(e)*Math.pow(10,t))/Math.pow(10,t)}function Wa(e,t){return e.includes(t)}function Ya(e,t){return e.includes(t)}function Be(e){return e.split(be)[0]}var Kn=function(e,t,n){if(C(t))return"";switch(e){case _.MSG_TEXT:return t.text;case _.MSG_IMAGE:return n?"[Image]":"[\u56FE\u7247]";case _.MSG_LOCATION:return n?"[Location]":"[\u4F4D\u7F6E]";case _.MSG_AUDIO:return n?"[Voice]":"[\u8BED\u97F3]";case _.MSG_VIDEO:return n?"[Video]":"[\u89C6\u9891]";case _.MSG_FILE:return n?"[File]":"[\u6587\u4EF6]";case _.MSG_CUSTOM:return n?"[Custom Messages]":"[\u81EA\u5B9A\u4E49\u6D88\u606F]";case _.MSG_GRP_TIP:return n?"[Group Notification]":"[\u7FA4\u63D0\u793A\u6D88\u606F]";case _.MSG_GRP_SYS_NOTICE:return n?"[Group System Message]":"[\u7FA4\u7CFB\u7EDF\u901A\u77E5]";case _.MSG_FACE:return n?"[Animated Sticker]":"[\u52A8\u753B\u8868\u60C5]";case _.MSG_MERGER:return n?"[Chat Record]":"[\u804A\u5929\u8BB0\u5F55]";default:return""}};function ja(e){return e===_.MSG_TEXT||e===_.MSG_CUSTOM||e===_.MSG_LOCATION||e===_.MSG_FACE}function Zo(e){var t=[];if(!te(e))return t;var n=e.length;if(n===0)return t;for(var o=n-1;0<=o;o--)e[o]==="1"&&t.push(Math.pow(2,n-o-1));return t}function Ps(){return!en&&!ge}function ln(e){return"the length of userIDList cannot exceed ".concat(e)}function mt(e,t){var n;if(e)return n=e,t&&(e.startsWith("http://")?n=e.replace(/^http:\/\/[^/]+/,t):e.startsWith("https://")&&(n=e.replace(/^https:\/\/[^/]+/,t))),n}function Ja(e){var t;if(F(e)&&e.length!==0)return t=0,e.forEach(function(n){t+=n}),t.toFixed(0)}function za(e){var t;if(F(e)&&e.length!==0)return t=0,e.forEach(function(n){t+=n}),(t/e.length).toFixed(0)}function Ke(e,o,s){var o=!(1<arguments.length&&o!==void 0)||o,s=!(2<arguments.length&&s!==void 0)||s,i=Date.now();return o?s?"".concat(i-e," ms"):"".concat(Math.round((i-e)/1e3)," s"):s?i-e:Math.round((i-e)/1e3)}function Xa(e){return!!(e&&1<e)}function $a(e,t,n,o){if(t===void 0)return 1;var s,i,a=!0;return t.required&&G(e)&&(u.e("[".concat(n,'] Missing required params: "').concat(o,'".')),a=!1),G(e)||(s=An(e))!==(i=t.type.toLowerCase())&&(s==="asyncfunction"&&i==="function"||(u.e("[".concat(n,'] Invalid params: type check failed for "').concat(o,'". Expected ').concat(t.type,".")),a=!1)),t.validator&&!t.validator(e,n,o)&&(u.e("[".concat(n,'] Invalid params: custom validator check failed for "').concat(o,'".')),a=!1),a}function nn(e){return!!e&&(!!(dt(e)||at(e)||Qo(e))||((e=ye("InvalidConversationID",e))&&u.w(e),!1))}function P(e){e.desc!==""&&ye("API_REFER")!==""&&u.w("[".concat(e.api,"] | ").concat(e.paramName," | ").concat(e.desc,", ").concat(ye("API_REFER")).concat(e.api))}function Lt(){return ye("StringRequiredLog")}function Cn(e){return ye("NonEmptyStringRequiredLog",e)}function Wn(){return ye("NumberRequiredLog")}function Us(){return ye("UndefinedNotAllowedLog")}function bs(){return ye("FileRequiredLog")}function Jt(){return ye("FunctionRequiredLog")}function pt(){return ye("ArrayRequiredLog")}function Kt(){return ye("NonEmptyArrayLog")}function es(){return ye("CallbackMissingLog")}function Qa(){return ye("PositiveIntegerRequiredLog")}function dn(e,t){return ye("StringNotLongerThanLog",e,t)}function ws(e,t){return ye("NumberGreaterOrEqualLog",e,t)}function ts(e){return ye("KeyValueStringRequiredLog",e)}function Ft(){return ye("PlainObjectRequiredLog")}function Za(){return ye("NonEmptyContentRequiredLog")}function Tn(){return ye("FileNotSelectedLog")}function ns(){return ye("MessageInstanceRequiredLog")}function Yn(){return ye("NonAnonymousFunctionLog")}function Fs(){return ye("MessageExtensionNotAvailableLog")}function qs(){return ye("MessageReactionRequiredLog")}function er(e,t){return ye("MaximumArrayLengthLog",e,t)}function q(e){return{code:0,data:e||{}}}function Q(e){return Promise.resolve(q(e))}function v(e){var t=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(e instanceof Te)return t&&pn!==null&&pn.emit(V.ERROR,e),Promise.reject(e);if(e instanceof Error)return n=new Te({code:M.UNCAUGHT_ERROR}),t&&pn!==null&&pn.emit(V.ERROR,n),Promise.reject(n);if(C(e)||C(e.code))return Promise.reject(new Te({code:M.UNCAUGHT_ERROR}));var n=new Te(e);return t&&pn!==null&&pn.emit(V.ERROR,n),Promise.reject(n)}var tr,os="unSend",Et="success",xs="fail",zt="notStart",nr="pending",jn="resolved",Dn="rejected",U={type:"String",required:!0},le={type:"Array",required:!0},he={type:"Object",required:!0},Ye={type:"Boolean",required:!0},Oe={type:"number",required:!0},ye=null,or={hookGetAPITips:function(e){ye=e},login:{userID:U,userSig:U},addToBlacklist:{userIDList:le},removeFromBlacklist:{userIDList:le},on:[{name:"eventName",type:"String",validator:function(e,t,n){return typeof e=="string"&&e.length!==0||(P({api:t,paramName:n,desc:Cn(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return typeof e!="function"?(P({api:t,paramName:n,desc:Jt()}),!1):(e.name===""&&P({api:t,paramName:n,desc:Yn()}),!0)}}],once:[{name:"eventName",type:"String",validator:function(e,t,n){return typeof e=="string"&&e.length!==0||(P({api:t,paramName:n,desc:Cn(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return typeof e!="function"?(P({api:t,paramName:n,desc:Jt()}),!1):(e.name===""&&P({api:t,paramName:n,desc:Yn()}),!0)}}],off:[{name:"eventName",type:"String",validator:function(e,t,n){return typeof e=="string"&&e.length!==0||(P({api:t,paramName:n,desc:Cn(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return typeof e!="function"?(P({api:t,paramName:n,desc:Jt()}),!1):(e.name===""&&P({api:t,paramName:n,desc:Yn()}),!0)}}],sendMessage:[l({name:"message"},he)],setMessageExtensions:[l(l({name:"message"},he),{},{validator:function(e,t,n){return e.status===Et&&e.isSupportExtension===!0||(P({api:t,paramName:n,desc:Fs()}),!1)}}),l({name:"extensions"},le)],getMessageExtensions:[l(l({name:"message"},he),{},{validator:function(e,t,n){return e.status===Et&&e.isSupportExtension===!0||(P({api:t,paramName:n,desc:Fs()}),!1)}})],deleteMessageExtensions:[l(l({name:"message"},he),{},{validator:function(e,t,n){return e.status===Et&&e.isSupportExtension===!0||(P({api:t,paramName:n,desc:Fs()}),!1)}})],addMessageReaction:[l(l({name:"message"},he),{},{validator:function(e,t,n){return e.status===Et||(P({api:t,paramName:n,desc:qs()}),!1)}}),l({name:"reactionID"},U)],removeMessageReaction:[l(l({name:"message"},he),{},{validator:function(e,t,n){return e.status===Et||(P({api:t,paramName:n,desc:qs()}),!1)}}),l({name:"reactionID"},U)],getMessageReactions:{messageList:l({},le)},getAllUserListOfMessageReaction:{message:l(l({},he),{},{validator:function(e,t,n){return e.status===Et||(P({api:t,paramName:n,desc:qs()}),!1)}}),reactionID:l({},U),nextSeq:{type:"Number"},count:{type:"Number"}},getMessageList:{conversationID:l(l({},U),{},{validator:nn}),nextReqMessageID:{type:"String"},count:{type:"Number",validator:function(e,t,n){return!(!C(e)&&!/^[1-9][0-9]*$/.test(e)&&(P({api:t,paramName:n,desc:Qa()}),1))}}},getMessageListHopping:{conversationID:l(l({},U),{},{validator:nn}),sequence:{type:"Number"},time:{type:"Number"},direction:{type:"Number",validator:function(e,t,n){return!(!C(e)&&e!==0&&e!==1&&(P({api:t,paramName:n,desc:ye("0Or1RequiredLog")}),1))}},count:{type:"Number",validator:function(e,t,n){return!(!C(e)&&!/^[1-9][0-9]*$/.test(e)&&(P({api:t,paramName:n,desc:Qa}),1))}}},setMessageRead:{conversationID:l(l({},U),{},{validator:nn})},setAllMessageRead:{scope:{type:"String",required:!1,validator:function(e,t,n){return!e||[_.READ_ALL_C2C_MSG,_.READ_ALL_GROUP_MSG,_.READ_ALL_MSG].indexOf(e)!==-1||(P({api:t,paramName:n,desc:ye("ValidScopeRequired")}),!1)}}},getConversationProfile:[l(l({name:"conversationID"},U),{},{validator:nn})],clearHistoryMessage:[l(l({name:"conversationID"},U),{},{validator:nn})],pinConversation:{conversationID:l(l({},U),{},{validator:nn}),isPinned:l({},Ye)},setConversationDraft:{conversationID:l(l({},U),{},{validator:nn}),draftText:{type:"String",validator:function(e,t,n){return!!te(e)||(P({api:t,paramName:n,desc:Lt()}),!1)}}},setConversationCustomData:{conversationIDList:l({},le),customData:{type:"String",validator:function(e,t,n){return te(e)?!(256<e.length&&(P({api:t,paramName:n,desc:dn(n,256)}),1)):(P({api:t,paramName:n,desc:Lt()}),!1)}}},markConversation:{conversationIDList:l({},le),markType:{type:"number",validator:function(e,t,n){return fe(e)?e<=0?(P({api:t,paramName:n,desc:ye("NumberGreaterThanLog",n,0)}),!1):!(e>=Math.pow(2,64)&&(P({api:t,paramName:n,desc:ye("NumberLessThanLog",n,"Math.pow(2,64)")}),1)):(P({api:t,paramName:n,desc:Wn()}),!1)}},enableMark:l({},Ye)},createConversationGroup:{conversationIDList:l({},le),groupName:l(l({},U),{},{validator:function(e,t,n){return!(!e||32<e.length&&(P({api:t,paramName:n,desc:dn(n,32)}),1))}})},deleteConversationGroup:[l({name:"groupName"},U)],renameConversationGroup:{oldName:l({},U),newName:l(l({},U),{},{validator:function(e,t,n){return!(!e||32<e.length&&(P({api:t,paramName:n,desc:dn(n,32)}),1))}})},addConversationsToGroup:{conversationIDList:l({},le),groupName:l({},U)},deleteConversationsFromGroup:{conversationIDList:l({},le),groupName:l({},U)},getGroupList:{groupProfileFilter:{type:"Array"}},getGroupProfile:{groupID:U,groupCustomFieldFilter:{type:"Array"},memberCustomFieldFilter:{type:"Array"}},getGroupProfileAdvance:{groupIDList:le},createGroup:{name:U},joinGroup:{groupID:U,type:{type:"String"},applyMessage:{type:"String"}},quitGroup:[l({name:"groupID"},U)],handleApplication:{message:he,handleAction:U,handleMessage:{type:"String"}},changeGroupOwner:{groupID:U,newOwnerID:U},updateGroupProfile:{groupID:U,muteAllMembers:{type:"Boolean"}},dismissGroup:[l({name:"groupID"},U)],searchGroupByID:[l({name:"groupID"},U)],getGroupOnlineMemberCount:[l({name:"groupID"},U)],initGroupAttributes:{groupID:U,groupAttributes:l(l({},he),{},{validator:function(e,t,n){var o=!0;return Object.keys(e).forEach(function(s){if(!te(e[s]))return P({api:t,paramName:n,desc:ts("value")}),o=!1}),o}})},setGroupAttributes:{groupID:U,groupAttributes:l(l({},he),{},{validator:function(e,t,n){var o=!0;return Object.keys(e).forEach(function(s){if(!te(e[s]))return P({api:t,paramName:n,desc:ts("value")}),o=!1}),o}})},deleteGroupAttributes:{groupID:U,keyList:{type:"Array",validator:function(e,t,n){return C(e)||!F(e)?(P({api:t,paramName:n,desc:pt()}),!1):!!G(e)||(o=!0,e.forEach(function(s){if(!te(s))return P({api:t,paramName:n,desc:ye("StringArrayRequiredLog")}),o=!1}),o);var o}}},getGroupAttributes:{groupID:U,keyList:{type:"Array",validator:function(e,t,n){return C(e)||!F(e)?(P({api:t,paramName:n,desc:pt()}),!1):!!G(e)||(o=!0,e.forEach(function(s){if(!te(s))return P({api:t,paramName:n,desc:ts("key")}),o=!1}),o);var o}}},setGroupCounters:{groupID:U,counters:he},increaseGroupCounter:{groupID:U,key:U,value:Oe},decreaseGroupCounter:{groupID:U,key:U,value:Oe},getGroupCounters:{groupID:U},getGroupMemberList:{groupID:U,count:{type:"Number"}},getGroupMemberProfile:{groupID:U,userIDList:le,memberCustomFieldFilter:{type:"Array"}},addGroupMember:{groupID:U,userIDList:le},setGroupMemberRole:{groupID:U,userID:U,role:U},setGroupMemberMuteTime:{groupID:U,userID:U,muteTime:{type:"Number",validator:function(e){return 0<=e}}},setGroupMemberNameCard:{groupID:U,userID:{type:"String"},nameCard:{type:"String",validator:function(e,t,n){return te(e)?(e.length,!0):(P({api:t,paramName:n,desc:Lt()}),!1)}}},setGroupMemberCustomField:{groupID:U,userID:{type:"String"},memberCustomField:le},deleteGroupMember:{groupID:U},markGroupMemberList:{groupID:U,markType:{type:"number",validator:function(e,t,n){return fe(e)?!(e<1e3&&(P({api:t,paramName:n,desc:ws(n,1e3)}),1)):(P({api:t,paramName:n,desc:Wn()}),!1)}},userIDList:l({},le),enableMark:l({},Ye)},createTextMessage:{to:U,conversationType:U,payload:l(l({},he),{},{validator:function(e,t,n){return Ce(e)?te(e.text)?e.text.length!==0||(P({api:t,paramName:"payload.text",desc:Za()}),!1):(P({api:t,paramName:"payload.text",desc:Lt()}),!1):(P({api:t,paramName:n,desc:Ft()}),!1)}})},createTextAtMessage:{to:U,conversationType:U,payload:l(l({},he),{},{validator:function(e,t,n){return Ce(e)?te(e.text)?e.text.length===0?(P({api:t,paramName:"payload.text",desc:Za()}),!1):!(e.atUserList&&!F(e.atUserList)&&(P({api:t,paramName:"payload.atUserList",desc:pt()}),1)):(P({api:t,paramName:"payload.text",desc:Lt()}),!1):(P({api:t,paramName:n,desc:Ft()}),!1)}})},createCustomMessage:{to:U,conversationType:U,payload:l(l({},he),{},{validator:function(e,t,n){return Ce(e)?e.data&&!te(e.data)?(P({api:t,paramName:"payload.data",desc:Lt()}),!1):e.description&&!te(e.description)?(P({api:t,paramName:"payload.description",desc:Lt()}),!1):!(e.extension&&!te(e.extension)&&(P({api:t,paramName:"payload.extension",desc:Lt()}),1)):(P({api:t,paramName:"payload",desc:Ft()}),!1)}})},createImageMessage:{to:U,conversationType:U,payload:l(l({},he),{},{validator:function(e,t,n){if(!Ce(e))return P({api:t,paramName:n,desc:Ft()}),!1;if(C(e.file))return P({api:t,paramName:"payload.file",desc:Us()}),!1;if(qe){if(!(e.file instanceof HTMLInputElement||Bt(e.file)))return Ce(e.file)&&typeof uni<"u"?e.file.tempFilePaths.length!==0&&e.file.tempFiles.length!==0||(P({api:t,paramName:"payload.file",desc:Tn()}),!1):(P({api:t,paramName:"payload.file",desc:bs()}),!1);if(e.file instanceof HTMLInputElement&&e.file.files.length===0)return P({api:t,paramName:"payload.file",desc:Tn()}),!1}return!0},onProgress:{type:"Function",required:!1,validator:function(e,t,n){return C(e)&&P({api:t,paramName:n,desc:es()}),!0}}})},createAudioMessage:{to:U,conversationType:U,payload:l(l({},he),{},{validator:function(e,t,n){return!!Ce(e)||(P({api:t,paramName:n,desc:Ft()}),!1)}}),onProgress:{type:"Function",required:!1,validator:function(e,t,n){return C(e)&&P({api:t,paramName:n,desc:es()}),!0}}},createVideoMessage:{to:U,conversationType:U,payload:l(l({},he),{},{validator:function(e,t,n){if(!Ce(e))return P({api:t,paramName:n,desc:Ft()}),!1;if(C(e.file))return P({api:t,paramName:"payload.file",desc:Us()}),!1;if(qe){if(!(e.file instanceof HTMLInputElement||Bt(e.file)))return Ce(e.file)&&typeof uni<"u"?!!Bt(e.file.tempFile)||(P({api:t,paramName:"payload.file",desc:Tn()}),!1):(P({api:t,paramName:"payload.file",desc:bs()}),!1);if(e.file instanceof HTMLInputElement&&e.file.files.length===0)return P({api:t,paramName:"payload.file",desc:Tn()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e,t,n){return C(e)&&P({api:t,paramName:n,desc:es()}),!0}}},createFaceMessage:{to:U,conversationType:U,payload:l(l({},he),{},{validator:function(e,t,n){return Ce(e)?fe(e.index)?!!te(e.data)||(P({api:t,paramName:"payload.data",desc:Lt()}),!1):(P({api:t,paramName:"payload.index",desc:Wn()}),!1):(P({api:t,paramName:n,desc:Ft()}),!1)}})},createFileMessage:{to:U,conversationType:U,payload:l(l({},he),{},{validator:function(e,t,n){if(!Ce(e))return P({api:t,paramName:n,desc:Ft()}),!1;if(C(e.file))return P({api:t,paramName:"payload.file",desc:Us()}),!1;if(qe){if(!(e.file instanceof HTMLInputElement||Bt(e.file)))return Ce(e.file)&&typeof uni<"u"?e.file.tempFilePaths.length!==0&&e.file.tempFiles.length!==0||(P({api:t,paramName:"payload.file",desc:Tn()}),!1):(P({api:t,paramName:"payload.file",desc:bs()}),!1);if(e.file instanceof HTMLInputElement&&e.file.files.length===0)return P({api:t,paramName:"payload.file",desc:Tn()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e,t,n){return C(e)&&P({api:t,paramName:n,desc:es()}),!0}}},createLocationMessage:{to:U,conversationType:U,payload:l(l({},he),{},{validator:function(e,t,n){return Ce(e)?te(e.description)?fe(e.longitude)?!!fe(e.latitude)||(P({api:t,paramName:"payload.latitude",desc:Wn()}),!1):(P({api:t,paramName:"payload.longitude",desc:Wn()}),!1):(P({api:t,paramName:"payload.description",desc:Lt()}),!1):(P({api:t,paramName:n,desc:Ft()}),!1)}})},createMergerMessage:{to:U,conversationType:U,payload:l(l({},he),{},{validator:function(e,t,n){if(G(e.messageList))return P({api:t,paramName:"payload.messageList",desc:Kt()}),!1;if(G(e.compatibleText))return P({api:t,paramName:"payload.compatibleText",desc:Cn("compatibleText")}),!1;var o=!1;return e.messageList.forEach(function(s){s.status===xs&&(o=!0)}),!o||(P({api:t,paramName:"payload.messageList",desc:ye("MergeFailedMessageLog")}),!1)}})},revokeMessage:[l(l({name:"message"},he),{},{validator:function(e,t,n){return G(e)?(P({api:t,paramName:n,desc:ns()}),!1):e.conversationType===_.CONV_SYSTEM?(P({api:t,paramName:n,desc:ye("MessageCanBeRevokedDesc")}),!1):e.isRevoked!==!0||(P({api:t,paramName:n,desc:ye("MessageRevokedLog")}),!1)}})],deleteMessage:[l(l({name:"messageList"},le),{},{validator:function(e,t,n){return!G(e)||(P({api:t,paramName:n,desc:Kt()}),!1)}})],translateText:{sourceTextList:le,sourceLanguage:U,targetLanguage:U},convertVoiceToText:{message:l(l({},he),{},{validator:function(e,t,n){return G(e)?(P({api:t,paramName:n,desc:ns()}),!1):e.type===_.MSG_AUDIO&&e.status===Et||(P({api:t,paramName:n,desc:ye("AudioMessageRequiredLog")}),!1)}})},modifyMessage:[l(l({name:"message"},he),{},{validator:function(e,t,n){return G(e)?(P({api:t,paramName:n,desc:ns()}),!1):e.conversationType===_.CONV_SYSTEM?(P({api:t,paramName:n,desc:ye("MessageCanBeModifiedLog")}),!1):e._onlineOnlyFlag!==!0||(P({api:t,paramName:n,desc:ye("OnlineMessageNotSupportLog")}),!1)}})],searchCloudMessages:{keywordList:{type:"Array",required:!1,validator:function(e,t,n){return!(e&&(F(e)?e.length===0?(P({api:t,paramName:n,desc:Kt()}),1):5<e.length&&(P({api:t,paramName:n,desc:er(n,5)}),1):(P({api:t,paramName:n,desc:pt()}),1)))}},keywordListMatchType:{type:"String",required:!1,validator:function(e,t,n){return!e||e==="or"||e==="and"||P({api:t,paramName:n,desc:"".concat(e," is invalid match type")})}},senderUserIDList:{type:"Array",required:!1,validator:function(e,t,n){return!(e&&(F(e)?(e.length===0&&P({api:t,paramName:n,desc:Kt()}),5<e.length&&(P({api:t,paramName:n,desc:er(n,5)}),1)):(P({api:t,paramName:n,desc:pt()}),1)))}},messageTypeList:{type:"Array",required:!1,validator:function(e,t,n){if(!e)return!0;if(!F(e))return P({api:t,paramName:n,desc:pt()}),!1;e.length===0&&P({api:t,paramName:n,desc:Kt()});var o=[_.MSG_TEXT,_.MSG_IMAGE,_.MSG_AUDIO,_.MSG_FILE,_.MSG_VIDEO,_.MSG_LOCATION,_.MSG_CUSTOM,_.MSG_MERGER];return!(0<e.filter(function(s){return o.indexOf(s)===-1}).length&&(P({api:t,paramName:n,desc:ye("ContainsUnsupportedMessageTypeLog",n)}),1))}},conversationID:{type:"String",required:!1,validator:function(e){return!e||nn(e)}},timePosition:{type:"number",required:!1,validator:function(e,t,n){return!(e&&e<0&&(P({api:t,paramName:n,desc:ws(n,0)}),1))}},timePeriod:{type:"number",required:!1,validator:function(e,t,n){return!(e&&e<0&&(P({api:t,paramName:n,desc:ws(n,0)}),1))}},cursor:{type:"String",required:!1}},getUserProfile:{userIDList:{type:"Array",validator:function(e,t,n){return F(e)?(e.length===0&&P({api:t,paramName:n,desc:Kt()}),!0):(P({api:t,paramName:n,desc:pt()}),!1)}}},updateMyProfile:{profileCustomField:{type:"Array",validator:function(e,t,n){return!!C(e)||!!F(e)||(P({api:t,paramName:n,desc:pt()}),!1)}}},setSelfStatus:{customStatus:{type:"String",validator:function(e,t,n){return!!te(e)||(P({api:t,paramName:n,desc:Lt()}),!1)}}},getUserStatus:{userIDList:{type:"Array",validator:function(e,t,n){return F(e)?e.length!==0||(P({api:t,paramName:n,desc:Kt()}),!1):(P({api:t,paramName:n,desc:pt()}),!1)}}},subscribeUserStatus:{userIDList:{type:"Array",validator:function(e,t,n){return F(e)?e.length!==0||(P({api:t,paramName:n,desc:Kt()}),!1):(P({api:t,paramName:n,desc:pt()}),!1)}}},unsubscribeUserStatus:{userIDList:{type:"Array",validator:function(e,t,n){return!e||!!F(e)||(P({api:t,paramName:n,desc:pt()}),!1)}}},addFriend:{to:U,source:{type:"String",required:!0,validator:function(e,t,n){return!(!e||(e.startsWith("AddSource_Type_")?8<e.replace("AddSource_Type_","").length&&(P({api:t,paramName:n,desc:dn("keyword",8)}),1):(P({api:t,paramName:n,desc:ye("SourcePrefixLog")}),1)))}},remark:{type:"String",required:!1,validator:function(e,t,n){return!(te(e)&&96<e.length&&(P({api:t,paramName:n,desc:dn(n,96)}),1))}}},deleteFriend:{userIDList:le},checkFriend:{userIDList:le},getFriendProfile:{userIDList:le},updateFriend:{userID:U,remark:{type:"String",required:!1,validator:function(e,t,n){return!(te(e)&&96<e.length&&(P({api:t,paramName:n,desc:dn(n,96)}),1))}},friendCustomField:{type:"Array",required:!1,validator:function(e,t,n){if(e){if(!F(e))return P({api:t,paramName:n,desc:pt()}),!1;var o=!0;return e.forEach(function(s){return te(s.key)&&s.key.indexOf("Tag_SNS_Custom")!==-1?te(s.value)?8<s.key.replace("Tag_SNS_Custom_","").length?(P({api:t,paramName:n,desc:dn("keyword",8)}),o=!1):void 0:(P({api:t,paramName:n,desc:ts("value")}),o=!1):(P({api:t,paramName:n,desc:ye("FriendCustomFieldPrefixLog")}),o=!1)}),o}return!0}}},acceptFriendApplication:{userID:U},refuseFriendApplication:{userID:U},deleteFriendApplication:{userID:U},createFriendGroup:{name:U},deleteFriendGroup:{name:U},addToFriendGroup:{name:U,userIDList:le},removeFromFriendGroup:{name:U,userIDList:le},renameFriendGroup:{oldName:U,newName:U},sendMessageReadReceipt:[{name:"messageList",type:"Array",validator:function(e,t,n){return F(e)?e.length!==0||(P({api:t,paramName:n,desc:Kt()}),!1):(P({api:t,paramName:n,desc:pt()}),!1)}}],getMessageReadReceiptList:[{name:"messageList",type:"Array",validator:function(e,t,n){return F(e)?e.length!==0||(P({api:t,paramName:n,desc:Kt()}),!1):(P({api:t,paramName:n,desc:pt()}),!1)}}],createTopicInCommunity:{groupID:U,topicName:U},deleteTopicFromCommunity:{groupID:U,topicIDList:{type:"Array",validator:function(e,t,n){return!e||!!F(e)||(P({api:t,paramName:n,desc:pt()}),!1)}}},updateTopicProfile:{groupID:U,topicID:U},getTopicList:{groupID:U,topicIDList:{type:"Array",validator:function(e,t,n){return!e||!!F(e)||(P({api:t,paramName:n,desc:pt()}),!1)}}},followUser:[l({name:"userIDList"},le)],unfollowUser:[l({name:"userIDList"},le)],getMyFollowingList:[l(l({name:"startIndex"},U),{},{required:!1})],getMyFollowersList:[l(l({name:"startIndex"},U),{},{required:!1})],getMutualFollowersList:[l(l({name:"startIndex"},U),{},{required:!1})],getUserFollowInfo:[l(l({name:"userIDList"},le),{},{required:!1})],checkFollowType:[l({name:"userIDList"},le)],addSignalingListener:[{name:"eventName",type:"String",validator:function(e,t,n){return typeof e=="string"&&e.length!==0||(P({api:t,paramName:n,desc:Cn(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return typeof e!="function"?(P({api:t,paramName:n,desc:Jt()}),!1):(e.name===""&&P({api:t,paramName:n,desc:Yn()}),!0)}}],removeSignalingListener:[{name:"eventName",type:"String",validator:function(e,t,n){return typeof e=="string"&&e.length!==0||(P({api:t,paramName:n,desc:Cn(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return typeof e!="function"?(P({api:t,paramName:n,desc:Jt()}),!1):(e.name===""&&P({api:t,paramName:n,desc:Yn()}),!0)}}],invite:{userID:U},inviteSync:[l(l({},he),{},{validator:function(e,t,n){return Ce(e)?!!te(e.userID)||(P({api:t,paramName:"options.userID",desc:Lt()}),!1):(P({api:t,paramName:"options",desc:Ft()}),!1)}}),{name:"successCb",type:"Function",required:!1,validator:function(e,t,n){return C(e)&&P({api:t,paramName:n,desc:Jt()}),!0}},{name:"errorCb",type:"Function",required:!1,validator:function(e,t,n){return C(e)&&P({api:t,paramName:n,desc:Jt()}),!0}}],inviteInGroup:{groupID:U,inviteeList:le},inviteInGroupSync:[l(l({},he),{},{validator:function(e,t,n){return Ce(e)?te(e.groupID)?!!F(e.inviteeList)||(P({api:t,paramName:"options.inviteeList",desc:pt()}),!1):(P({api:t,paramName:"options.groupID",desc:Lt()}),!1):(P({api:t,paramName:"options",desc:Ft()}),!1)}}),{name:"successCb",type:"Function",required:!1,validator:function(e,t,n){return C(e)&&P({api:t,paramName:n,desc:Jt()}),!0}},{name:"errorCb",type:"Function",required:!1,validator:function(e,t,n){return C(e)&&P({api:t,paramName:n,desc:Jt()}),!0}}],accept:{inviteID:U},reject:{inviteID:U},getSignalingInfo:[l(l({name:"message"},he),{},{validator:function(e,t,n){return!G(e)||(P({api:t,paramName:n,desc:ns()}),!1)}})],modifyInvitation:{inviteID:U,data:U}},Sc={login:1,logout:1,getLoginUser:1,on:1,once:1,off:1,setLogLevel:1,registerPlugin:1,destroy:1,isReady:1,createTextMessage:1,createTextAtMessage:1,createImageMessage:1,createAudioMessage:1,createVideoMessage:1,createCustomMessage:1,createFaceMessage:1,createFileMessage:1,createLocationMessage:1,createMergerMessage:1,downloadMergerMessage:1,createForwardMessage:1,sendMessage:1,resendMessage:1,revokeMessage:1,deleteMessage:1,translateText:1,convertVoiceToText:1,modifyMessage:1,searchCloudMessages:1,sendMessageReadReceipt:1,getGroupMessageReadMemberList:1,getMessageReadReceiptList:1,setMessageExtensions:1,getMessageExtensions:1,deleteMessageExtensions:1,addMessageReaction:1,removeMessageReaction:1,getMessageReactions:1,getAllUserListOfMessageReaction:1,getMessageList:1,findMessage:1,getMessageListHopping:1,setMessageRead:1,setAllMessageRead:1,getConversationList:1,getConversationProfile:1,deleteConversation:1,setConversationDraft:1,pinConversation:1,getTotalUnreadMessageCount:1,setConversationCustomData:1,markConversation:1,createConversationGroup:1,getConversationGroupList:1,deleteConversationGroup:1,renameConversationGroup:1,addConversationsToGroup:1,deleteConversationsFromGroup:1,clearHistoryMessage:1,setMessageRemindType:1,setAllReceiveMessageOpt:1,getAllReceiveMessageOpt:1,getGroupList:1,getGroupProfile:1,createGroup:1,joinGroup:1,updateGroupProfile:1,quitGroup:1,dismissGroup:1,changeGroupOwner:1,searchGroupByID:1,getGroupApplicationList:1,handleGroupApplication:1,initGroupAttributes:1,setGroupAttributes:1,deleteGroupAttributes:1,getGroupAttributes:1,setGroupCounters:1,increaseGroupCounter:1,decreaseGroupCounter:1,getGroupCounters:1,getJoinedCommunityList:1,createTopicInCommunity:1,deleteTopicFromCommunity:1,updateTopicProfile:1,getTopicList:1,getGroupMemberProfile:1,getGroupMemberList:1,addGroupMember:1,deleteGroupMember:1,setGroupMemberNameCard:1,setGroupMemberMuteTime:1,setGroupMemberRole:1,setGroupMemberCustomField:1,getGroupOnlineMemberCount:1,markGroupMemberList:1,getMyProfile:1,getUserProfile:1,updateMyProfile:1,setSelfStatus:1,getUserStatus:1,subscribeUserStatus:1,unsubscribeUserStatus:1,getBlacklist:1,addToBlacklist:1,removeFromBlacklist:1,getFriendList:1,addFriend:1,deleteFriend:1,checkFriend:1,updateFriend:1,getFriendProfile:1,getFriendApplicationList:1,refuseFriendApplication:1,deleteFriendApplication:1,acceptFriendApplication:1,setFriendApplicationRead:1,getFriendGroupList:1,createFriendGroup:1,renameFriendGroup:1,deleteFriendGroup:1,addToFriendGroup:1,removeFromFriendGroup:1,followUser:1,unfollowUser:1,getMyFollowingList:1,getMyFollowersList:1,getMutualFollowersList:1,getUserFollowInfo:1,checkFollowType:1,callExperimentalAPI:1,addSignalingListener:1,removeSignalingListener:1,invite:1,inviteSync:1,inviteInGroup:1,inviteInGroupSync:1,cancel:1,accept:1,reject:1,getSignalingInfo:1,modifyInvitation:1},Te=(z(is,j(Error)),tr=X(is),R(is)),M={NO_SDKAPPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USERSIG:2003,NO_TINYID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,REPEAT_LOGIN:2025,COS_UNDETECTED:2040,COS_GET_SIG_FAIL:2041,MSG_SEND_FAIL:2100,MSG_SEND_FAIL_NOT_IN_AVCHATROOM:2101,MSG_INSTANCE_REQUIRED:2105,MSG_INVALID_CONV_TYPE:2106,MSG_F_IS_EMPTY:2108,MSG_ONPROGRESS_FUNCTION_ERROR:2109,MSG_REVOKE_FAIL:2110,MSG_DELETE_FAIL:2111,MSG_UNREAD_ALL_FAIL:2112,READ_RECEIPT_MSG_LIST_EMPTY:2114,MSG_SEND_GRP_WITH_TOPIC_FAIL:2115,CANNOT_DELETE_GRP_SYSTEM_NOTICE:2116,TRANSLATE_TEXT_FAIL:2117,VOICE_TO_TEXT_FAIL:2118,UNSUPPORTED_VOICE_FORMAT:2119,MSG_I_SELECT_F_FIRST:2251,MSG_I_TYPES_LIMIT:2252,MSG_I_SIZE_LIMIT:2253,MSG_A_UPLOAD_FAIL:2300,MSG_A_SIZE_LIMIT:2301,MSG_V_UPLOAD_FAIL:2350,MSG_V_SIZE_LIMIT:2351,MSG_V_TYPES_LIMIT:2352,MSG_F_UPLOAD_FAIL:2400,MSG_F_SELECT_F_FIRST:2401,MSG_F_SIZE_LIMIT:2402,MSG_F_URL_IS_EMPTY:2403,MSG_MERGER_TYPE_INVALID:2450,MSG_MERGER_KEY_INVALID:2451,MSG_MERGER_DOWNLOAD_FAIL:2452,MSG_FORWARD_TYPE_INVALID:2453,MSG_FORWARD_INVALID_ELEMENTS:2454,MSG_MODIFY_CONFLICT:2480,MSG_MODIFY_DISABLED_IN_AVCHATROOM:2481,CONV_NOT_FOUND:2500,USER_OR_GRP_NOT_FOUND:2501,CONV_UN_RECORDED_TYPE:2502,INVALID_CONV_ID:2503,ILLEGAL_GRP_TYPE:2600,CANNOT_JOIN_WORK:2601,ILLEGAL_GRP_ID:2602,CANNOT_FIND_GRP:2603,CANNOT_CHANGE_OWNER_IN_AVCHATROOM:2620,CANNOT_CHANGE_OWNER_TO_SELF:2621,CANNOT_DISMISS_WORK:2622,MEMBER_NOT_IN_GRP:2623,JOIN_GRP_FAIL:2660,CANNOT_ADD_MEMBER_IN_AVCHATROOM:2661,CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN:2662,NOT_OWNER:2681,CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM:2682,INVALID_MEMBER_ROLE:2683,CANNOT_SET_SELF_MEMBER_ROLE:2684,CANNOT_MUTE_SELF:2685,BAN_DURATION_INVALID:2686,OPERATION_NOT_SUPPORTED_IN_AVCHATROOM:2687,NOT_MY_FRIEND:2700,ALREADY_MY_FRIEND:2701,FRIEND_GRP_EXISTED:2710,FRIEND_GRP_NOT_EXIST:2711,FRIEND_APPLICATION_NOT_EXIST:2716,UPDATE_PROFILE_INVALID_PARAM:2721,UPDATE_PROFILE_NO_KEY:2722,CANNOT_ADD_SELF_TO_BLACKLIST:2742,NETWORK_ERROR:2800,NETWORK_TIMEOUT:2801,NO_NETWORK:2805,UNCAUGHT_ERROR:2903,INVALID_OPERATION:2905,INVALID_TRTC_CMD:2995,OVER_FREQUENCY_LIMIT:2996,CANNOT_FIND_PROTOCOL:2997,CANNOT_FIND_MODULE:2998,SDK_IS_NOT_READY:2999,LOGGING_IN:3e3,LOGIN_FAILED:3001,KICKED_OUT_MULT_DEVICE:3002,KICKED_OUT_MULT_ACCOUNT:3003,KICKED_OUT_USERSIG_EXPIRED:3004,LOGGED_OUT:3005,KICKED_OUT_REST_API:3006,ILLEGAL_TOPIC_ID:3021,CANNOT_USE_COMMERCIAL_ABILITY:3122,PROFANITY_FOUND:3123,OPTIONS_IS_EMPTY:3153,MSG_A2KEY_EXPIRED:20002,ACCOUNT_A2KEY_EXPIRED:70001,HELLO_ANSWER_KICKED_OUT:1002,OPEN_SERVICE_OVERLOAD_ERROR:60022,SIGNALING_INVALID_INVITE_ID:8010,SIGNALING_NO_PERMISSION:8011,SIGNALING_ALREADY_EXISTS:8012,INVALID_CANCEL_MESSAGE:8020,MSG_SEARCH_CURSOR_INVALID:27002,MSG_SEARCH_CURSOR_EXPIRED:27003},pn=null,Oe=(R(di,[{key:"isLoggedIn",value:function(){return this._m.get(12).isLoggedIn()}},{key:"isOversea",value:function(){return this._m.get(12).isOversea()}},{key:"isPrivateNetWork",value:function(){return this._m.get(12).isPrivateNetWork()}},{key:"getFileDownloadProxy",value:function(){return this._m.get(12).getFileDownloadProxy()}},{key:"getMyUserID",value:function(){return this._m.get(12).getUserID()}},{key:"getMyTinyID",value:function(){return this._m.get(12).getTinyID()}},{key:"getSDKAppID",value:function(){return this._m.get(12).getSDKAppID()}},{key:"isIntl",value:function(){return this._m.get(12).isIntl()}},{key:"isUsingChatCore",value:function(){return this._m.get(12).isUsingChatCore()}},{key:"isDevMode",value:function(){return this._m.get(12).isDevMode()}},{key:"get",value:function(e){return this._m.get(e)}},{key:"getPlatform",value:function(){return Ss}},{key:"getCloudConfig",value:function(e){return this._m.get(23).getCloudConfig(e)}},{key:"emitOuterEvent",value:function(e,t){this._m.getOuterEmitterInstance().emit(e,t)}},{key:"emitInnerEvent",value:function(e,t){this._m.getInnerEmitterInstance().emit(e,t)}},{key:"getInnerEmitterInstance",value:function(){return this._m.getInnerEmitterInstance()}},{key:"generateTjgID",value:function(e){return this._m.get(12).getTinyID()+"-"+e.random}},{key:"req",value:function(e){return this._m.get(20).req(e)}},{key:"canIUse",value:function(e){return this._m.get(27).canIUse(e)}},{key:"getErrorMessage",value:function(e,t,n){return this._m.getErrorMessage(e,t,n)}},{key:"outputWarning",value:function(e,t,n){e=this.getErrorMessage(e,t,n),e&&u.w(e)}},{key:"cannotUseCommercialAbility",value:function(e){var t=M.CANNOT_USE_COMMERCIAL_ABILITY;return v({code:t,message:this.getErrorMessage(t,e)})}}]),di),g={LOGIN:"wslogin",LOGOUT:"wslogout",HELLO:"wshello",KICK_OTHER:"KickOther",SYNC_UNREAD_MSG:"getmsg",SEND_C2C_MSG:"sendmsg",SEND_GRP_MSG:"send_group_msg",GET_USER_PROFILE:"portrait_get_all",UPDATE_MY_PROFILE:"portrait_set",GET_BL:"black_list_get",ADD_TO_BL:"black_list_add",RM_FROM_BL:"black_list_delete",GET_FD_LIST:"friend_get",GET_FD_PROFILE:"friend_get_specified",CHECK_FD:"friend_check",DEL_FD:"friend_delete",ADD_FD:"friend_add",UPDATE_FD:"friend_update",RESPOND_FD_APPLICATION:"friend_response",GET_FD_APPLICATION_LIST:"pendency_get",DEL_FD_APPLICATION:"pendency_delete",REFUSE_FD_APPLICATION:"pendency_refuse",REPORT_FD_APPLICATION:"pendency_report",GET_FD_GRP_LIST:"group_get",CREATE_FD_GRP:"group_add",DEL_FD_GRP:"group_delete",UPDATE_FD_GRP:"group_update",REVOKE_C2C_MSG:"msgwithdraw",SET_C2C_MSG_READ:"msgreaded",SET_C2C_PEER_MUTE_NOTIFICATIONS:"set_c2c_peer_mute_notifications",GET_C2C_PEER_MUTE_NOTIFICATIONS:"get_c2c_peer_mute_notifications",GET_C2C_ROAMING_MSG:"getroammsg",GET_C2C_PEER_READ_TIME:"get_peer_read_time",DEL_C2C_MSG:"delete_c2c_msg_ramble",MODIFY_C2C_MSG:"modify_c2c_msg",MODIFY_C2C_MSG_EXT:"set_key_values",GET_C2C_MSG_EXT:"get_key_values",ADD_C2C_MSG_REACTION:"reaction_add",RM_C2C_MSG_REACTION:"reaction_del",GET_C2C_MSG_REACTIONS:"reaction_multi_stat",GET_C2C_MSG_REACTION_USER_LIST:"reaction_iterate",PAGING_GET_CONV_LIST:"page_get",DEL_CONV:"batch_delete",CLEAR_HISTORY_MSG:"clear_msg",PIN_CONV:"top",DEL_GROUP_AT_TIPS:"deletemsg",SET_CONV_CUSTOM_DATA:"set_conv_custom_data",MARK_CONV:"mark_contact",CREATE_CONV_GRP:"create_contact_group",DEL_CONV_GRP:"del_contact_group",RENAME_CONV_GRP:"update_contact_group",ADD_CONV_TO_GRP:"add_conv_to_group",DEL_CONV_FROM_GRP:"del_conv_from_group",GET_CONV_GRP_LIST:"get_contact_group",SEARCH_CONV_GRP_MARK:"search_contact_group",GET_GRP_LIST:"get_joined_group_list",GET_GRP_PROFILE:"get_group_self_member_info",CREATE_GRP:"create_group",DISMISS_GRP:"destroy_group",UPDATE_GRP_PROFILE:"modify_group_base_info",APPLY_JOIN_GRP:"apply_join_group",APPLY_JOIN_GRP_NOAUTH:"apply_join_group_noauth",QUIT_GRP:"quit_group",SEARCH_GRP:"get_group_public_info",CHANGE_GRP_OWNER:"change_group_owner",HANDLE_GRP_APPLICATION:"handle_apply_join_group",HANDLE_INVITE_JOIN_GRP:"handle_invite_join_permission_group",HANDLE_GRP_INVITATION:"handle_invite_join_group",REVOKE_GRP_MSG:"group_msg_recall",SET_GRP_MSG_READ:"msg_read_report",SET_ALL_MSG_READ:"read_all_unread_msg",GET_GRP_ROAMING_MSG:"group_msg_get",GET_READ_RECEIPT:"get_group_msg_receipt",SEND_READ_RECEIPT:"group_msg_receipt",SEND_C2C_READ_RECEIPT:"c2c_msg_read_receipt",GET_READ_RECEIPT_DETAIL:"get_group_msg_receipt_detail",GET_GRP_PENDENCY:"get_pendency",DEL_GRP_SYSTEM_NOTICE:"deletemsg",AV_POLLING:"get_msg",AV_NOAUTH_POLLING:"get_msg_noauth",GET_ONLINE_MBR_NUM:"get_online_member_num",DEL_GRP_MSG:"delete_group_ramble_msg_by_seq",MODIFY_GRP_MSG:"modify_group_msg",SET_GRP_ATTR:"set_group_attr",MODIFY_GRP_ATTR:"modify_group_attr",DEL_GRP_ATTR:"delete_group_attr",CLEAR_GRP_ATTR:"clear_group_attr",GET_GRP_ATTR:"get_group_attr",MODIFY_GRP_MSG_EXT:"group_set_key_values",GET_GRP_MSG_EXT:"group_get_key_values",GET_GRP_NOTIFY:"batch_get_group_notify",UPDATE_GRP_COUNTER:"update_group_counter",GET_GRP_COUNTER:"get_group_counter",ADD_GRP_MSG_REACTION:"group_reaction_add",RM_GRP_MSG_REACTION:"group_reaction_del",GET_GRP_MSG_REACTIONS:"group_reaction_multi_stat",GET_GRP_MSG_REACTION_USER_LIST:"group_reaction_iterate",GET_GRP_MBR_LIST:"get_group_member_info",GET_AV_MBR_LIST:"get_members",GET_GRP_MBR_PROFILE:"get_specified_group_member_info",ADD_GRP_MBR:"add_group_member",DEL_GRP_MBR:"delete_group_member",BAN_AV_MBR:"ban_group_member",MODIFY_GRP_MBR_INFO:"modify_group_member_info",MARK_AV_MBR_INFO:"modify_user_info",COS_SIGN:"cos",COS_PRE_SIG:"pre_sig",SIMPLE_COS_PRE_SIG:"simple_sig",GET_IMAGE_INFO:"get_imageinfo",GET_IP:"get_final_ip",VIDEO_COVER:"video_cover",SSO_STAT:"tim_web_report_v2",PING:"alive",MSG_PUSH:"msg_push",MSG_CLOUD_SEARCH:"query",MULTI_MSG_PUSH:"multi_msg_push_ws",MSG_PUSH_ACK:"ws_msg_push_ack",STATUS_FORCE_OFFLINE:"stat_forceoffline",UPLOAD_MERGER_MSG:"save_relay_json_msg",DOWNLOAD_MERGER_MSG:"get_relay_json_msg",FETCH_CLOUD_CTRL_CONFIG:"fetch_config",PUSHED_CLOUD_CTRL_CONFIG:"push_configv2",FETCH_COMMERCIAL_CONFIG:"fetch_imsdk_purchase_bitsv2",PUSHED_COMMERCIAL_CONFIG:"push_imsdk_purchase_bitsv2",OVERLOAD_NOTIFY:"notify2",CREATE_TOPIC:"create_topic",DEL_TOPIC:"destroy_topic",UPDATE_TOPIC_PROFILE:"modify_topic",GET_TOPIC_LIST:"get_topic",SET_SELF_STATUS:"ws_set_custom_status",GET_USER_STATUS:"ws_get_user_status",SUB_USER_STATUS:"ws_status_subscribe",UNSUB_USER_STATUS:"ws_status_unsubscribe",STAT_BACKGROUND:"ws_stat_background",STAT_FOREGROUND:"ws_stat_foreground",SET_TOKEN:"ws_stat_settoken",PUSH_REPORT:"uniapp_sdk_report",GET_PROFANITY_LIST:"get_local_words",TRANSLATE_TEXT:"ws_batch_trans_text",VOICE_TO_TEXT:"ws_sentence_recognition",FOLLOW:"follow_add",UNFOLLOW:"follow_delete",GET_FOLLOW:"follow_get",GET_FOLLOW_INFO:"follow_get_info",CHECK_FOLLOW_TYPE:"follow_check",SET_ALL_RECEIVE_MSG_OPT:"ws_set_do_not_disturb",GET_ALL_RECEIVE_MSG_OPT:"ws_get_do_not_disturb"},Vs="networkRTT",Bs="messageE2EDelay",Sn="sendMessageC2C",Ln="sendMessageGroup",En="sendMessageGroupAV",_n="sendMessageRichMedia",vt="cosUpload",kn="messageReceivedGroup",Jn="messageReceivedGroupAVPush",zn="messageReceivedGroupAVPull",Lc=(H(Ye={},Vs,2),H(Ye,Bs,3),H(Ye,Sn,4),H(Ye,Ln,5),H(Ye,En,6),H(Ye,_n,7),H(Ye,kn,8),H(Ye,Jn,9),H(Ye,zn,10),H(Ye,vt,11),Ye),Ec={info:4,warning:5,error:6},sr={wifi:1,"2g":2,"3g":3,"4g":4,"5g":5,unknown:6,none:7,online:8},kc={login:4,plugin_search:16,plugin_translate:16,plugin_voice_to_text:16,plugin_cs:16,plugin_push:16,plugin_bot:16,plugin_emoji_reaction:16},S=(R(Xn,[{key:"updateTimeStamp",value:function(){this.timestamp=kt()}},{key:"start",value:function(e){return this._startts=e,this}},{key:"end",value:function(){var e,t=this,n=0<arguments.length&&arguments[0]!==void 0&&arguments[0];this._sentFlag||(this._netMonitorModule&&(e=this._netMonitorModule.getNetworkType(),this.setNetworkType(e)),e=kt(),this.costTime===0&&(this.costTime=e-this._startts),this.setMoreMessage("startts:".concat(this._startts," endts:").concat(e)),n?(this._sentFlag=!0,this._eventStatModule&&this._eventStatModule.pushIn(this)):setTimeout(function(){t._sentFlag=!0,t._eventStatModule&&t._eventStatModule.pushIn(t)},0))}},{key:"setError",value:function(e){if(!(e instanceof Error))return u.w("".concat(this._n,".setError value not instanceof Error, please check!")),this;if(this._sentFlag)return this;var t=!0;return(t=this._netMonitorModule?this._netMonitorModule.isOnline():t)?(e.code&&this.setCode(e.code),e.message&&this.setMoreMessage(e.message)):this.setCode(M.NO_NETWORK),this.setLevel("error"),this}},{key:"setCode",value:function(e){return C(e)||this._sentFlag||(e==="ECONNABORTED"&&(this.code=103),fe(e)?this.code=e:u.w("".concat(this._n,".setCode value not a number, please check!"),e,O(e))),this}},{key:"setMessage",value:function(e){return C(e)||this._sentFlag||(fe(e)&&(this.message=e.toString()),te(e)&&(this.message=e)),this}},{key:"setCostTime",value:function(e){return this.costTime=e,this}},{key:"setLevel",value:function(e){return C(e)||this._sentFlag||(this.level=Ec[e]),this}},{key:"setMoreMessage",value:function(e){return G(this.moreMessage)?this.moreMessage="".concat(e):this.moreMessage+=" ".concat(e),this}},{key:"setNetworkType",value:function(e){return C(e)?u.w("".concat(this._n,".setNetworkType value is undefined, please check!")):(e=sr[e.toLowerCase()],C(e)||(this.networkType=e)),this}},{key:"getStartTs",value:function(){return this._startts}},{key:"setUIPlatform",value:function(e){return this.uiPlatform=e,this}},{key:"setExtension",value:function(e){return this.extension=e,this}},{key:"setEventType",value:function(e){return this.eventType=e,this}}],[{key:"bindEventStatModule",value:function(e){Xn.prototype._eventStatModule=e}},{key:"bindNetMonitorModule",value:function(e){Xn.prototype._netMonitorModule=e}}]),Xn),Hs=(R(li,[{key:"setText",value:function(e){this.content.text=e}},{key:"sendable",value:function(){return this.content.text.length!==0}}]),li),Ks=(R(ui,[{key:"_initImageInfoModel",value:function(){var e=this;this._ImageInfoModel=function(t){this.instanceID=St(9999999),this.sizeType=t.type||0,this.type=0,this.size=t.size||0,this.width=t.width||0,this.height=t.height||0,this.imageUrl=t.imageUrl||t.url||"",this.url=mt(t.url||e._imageMemoryURL,e._fileDownloadProxy)},this._ImageInfoModel.prototype={setSizeType:function(t){this.sizeType=t},setType:function(t){this.type=t},setImageUrl:function(t){t&&(this.imageUrl=t)},getImageUrl:function(){return this.imageUrl}}}},{key:"initImageInfoArray",value:function(e){for(var t,n=0,o=null;n<=2;)t=C(e)||C(e[n])?{type:0,size:0,width:0,height:0,url:""}:e[n],(o=new this._ImageInfoModel(t)).setSizeType(n+1),o.setType(n),this.addImageInfo(o),n++;this.updateAccessSideImageInfoArray()}},{key:"updateImageInfoArray",value:function(e){for(var t,n=this.content.imageInfoArray.length,o=0;o<n;o++)t=this.content.imageInfoArray[o],e[o].size&&(t.size=e[o].size),e[o].url&&t.setImageUrl(e[o].url),e[o].width&&(t.width=e[o].width),e[o].height&&(t.height=e[o].height)}},{key:"_autoFixUrl",value:function(){for(var e=this.content.imageInfoArray.length,t="",n="",o=["http","https"],s=null,i=0;i<e;i++)this.content.imageInfoArray[i].url&&(s=this.content.imageInfoArray[i]).imageUrl!==""&&(n=s.imageUrl.slice(0,s.imageUrl.indexOf("://")+1),t=s.imageUrl.slice(s.imageUrl.indexOf("://")+1),o.indexOf(n)<0&&(n="https:"),this.content.imageInfoArray[i].setImageUrl([n,t].join("")))}},{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateImageFormat",value:function(e){this.content.imageFormat=Ut[e.toUpperCase()]||Ut.UNKNOWN}},{key:"createImageDataASURLInWeb",value:function(e){e!==void 0&&0<e.files.length&&(this._imageMemoryURL=window.URL.createObjectURL(e.files[0]))}},{key:"createImageDataASURLInWXMiniApp",value:function(e){e&&e.url&&(this._imageMemoryURL=e.url)}},{key:"replaceImageInfo",value:function(e,t){this.content.imageInfoArray[t]instanceof this._ImageInfoModel||(this.content.imageInfoArray[t]=e)}},{key:"addImageInfo",value:function(e){3<=this.content.imageInfoArray.length||this.content.imageInfoArray.push(e)}},{key:"updateAccessSideImageInfoArray",value:function(){var e=this.content.imageInfoArray,n=e[0],t=n.width,t=t===void 0?0:t,n=n.height,n=n===void 0?0:n;t!==0&&n!==0&&(Ka(e),Object.assign(e[2],Os({originWidth:t,originHeight:n,min:720})))}},{key:"sendable",value:function(){return this.content.imageInfoArray.length!==0&&this.content.imageInfoArray[0].imageUrl!==""&&this.content.imageInfoArray[0].size!==0}}]),ui),Ws=(R(ci,[{key:"sendable",value:function(){return this.content!==null}}]),ci),Ys=(R(ri,[{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateAudioUrl",value:function(e){this.content.remoteAudioUrl=e}},{key:"sendable",value:function(){return this.content.remoteAudioUrl!==""}}]),ri),Rc={from:!0,groupID:!0,groupName:!0,to:!0},ir=(R(ai,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach(function(n){switch(n){case"remarkInfo":break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;case"operatorInfo":break;case"memberInfoList":case"msgMemberInfo":t._updateMemberList(e[n]);break;case"memberExtraInfo":case"onlineMemberInfo":break;case"memberNum":t.content[n]=e[n],t.content.memberCount=e[n];break;case"newGroupProfile":t.content.newGroupProfile={},t._initNewGroupProfile(e[n]);break;default:t.content[n]=e[n]}}),this.content.userIDList||(this.content.userIDList=[this.content.operatorID])}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];Rc[o]&&(this.content.groupProfile[o]=e[o])}}},{key:"_updateMemberList",value:function(e){G(this.content.memberList)?this.content.memberList=e:this.content.memberList.forEach(function(t){e.forEach(function(n){t.userID===n.userID&&Object.assign(t,n)})})}},{key:"_initNewGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];this.content.newGroupProfile[o]=o!=="muteAllMembers"?e[o]:e[o]===1}}}]),ai),Nc={from:!0,groupID:!0,groupName:!0,to:!0,groupType:!0},ar=(R(ii,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach(function(n){switch(n){case"memberInfoList":break;case"remarkInfo":t.content.handleMessage=e[n];break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;default:t.content[n]=e[n]}})}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];Nc[o]&&(o==="groupName"?this.content.groupProfile.name=e[o]:this.content.groupProfile[o]=e[o])}}}]),ii),js=(R(si,[{key:"_getFileInfo",value:function(n){if(!C(n.fileName)&&!C(n.fileSize))return{size:n.fileSize,name:n.fileName};var t,n=n.file.files[0];return ze&&(n.path&&n.path.indexOf(".")!==-1&&(t=n.path.slice(n.path.lastIndexOf(".")+1).toLowerCase(),n.type=t,n.name||(n.name="".concat(St(999999),".").concat(t))),n.name||(n.type="",n.name=n.path.slice(n.path.lastIndexOf("/")+1).toLowerCase()),n.suffix&&(n.type=n.suffix),n.url||(n.url=n.path)),{size:n.size,name:n.name}}},{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateFileUrl",value:function(e){this.content.fileUrl=e}},{key:"sendable",value:function(){return this.content.fileUrl!==""&&this.content.fileName!==""&&this.content.fileSize!==0}}]),si),Js=(R(oi,[{key:"setData",value:function(e){return this.content.data=e,this}},{key:"setDescription",value:function(e){return this.content.description=e,this}},{key:"setExtension",value:function(e){return this.content.extension=e,this}},{key:"sendable",value:function(){return this.content.data.length!==0||this.content.description.length!==0||this.content.extension.length!==0}}]),oi),zs=(R(ni,[{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateVideoUrl",value:function(e){e&&(this.content.remoteVideoUrl=e)}},{key:"updateSnapshotInfo",value:function(o){var t=o.snapshotUrl,n=o.snapshotWidth,o=o.snapshotHeight;G(t)||(this.content.thumbUrl=this.content.snapshotUrl=t),G(n)||(this.content.thumbWidth=this.content.snapshotWidth=Number(n)),G(o)||(this.content.thumbHeight=this.content.snapshotHeight=Number(o))}},{key:"sendable",value:function(){return this.content.remoteVideoUrl!==""}}]),ni),Xs=(R(ti,[{key:"sendable",value:function(){return!0}}]),ti),rr=(R(ei,[{key:"_patchRichMediaPayload",value:function(e,t){e===_.MSG_IMAGE?t.imageInfoArray.forEach(function(n){!n.imageUrl&&n.url&&(n.imageUrl=n.url,n.sizeType=n.type,n.type===1?n.type=0:n.type===3&&(n.type=1))}):e===_.MSG_VIDEO?!t.remoteVideoUrl&&t.videoUrl&&(t.remoteVideoUrl=t.videoUrl):e===_.MSG_AUDIO?!t.remoteAudioUrl&&t.url&&(t.remoteAudioUrl=t.url):e===_.MSG_FILE&&!t.fileUrl&&t.url&&(t.fileUrl=t.url,t.url=void 0)}},{key:"_updateRichMediaDownloadUrl",value:function(e,t,n){n&&(e===_.MSG_IMAGE?t.imageInfoArray.forEach(function(o){o.url=mt(o.url,n)}):e===_.MSG_VIDEO?(t.videoUrl=mt(t.videoUrl,n),t.snapshotUrl=mt(t.thumbUrl,n),t.snapshotHeight=t.thumbHeight,t.snapshotWidth=t.thumbWidth):e===_.MSG_AUDIO?t.url=mt(t.url,n):e===_.MSG_FILE&&(t.fileUrl=mt(t.fileUrl,n)))}}]),ei),ss=(R(Zs,[{key:"sendable",value:function(){return!G(this.content.messageList)||!G(this.content.downloadKey)}}]),Zs),$s={1:_.MSG_PRIORITY_HIGH,2:_.MSG_PRIORITY_NORMAL,3:_.MSG_PRIORITY_LOW,4:_.MSG_PRIORITY_LOWEST},We=(R(Qs,[{key:"elements",get:function(){return this._elements}},{key:"getElements",value:function(){return this._elements}},{key:"extractGroupInfo",value:function(e){e!==null&&(te(e.nick)&&(this.nick=e.nick),te(e.avatar)&&(this.avatar=e.avatar),e=e.messageFromAccountExtraInformation,Ce(e)&&te(e.nameCard)&&(this.nameCard=e.nameCard))}},{key:"handleGroupAtInfo",value:function(e){var t=this;e.payload&&e.payload.atUserList&&e.payload.atUserList.forEach(function(n){n!==_.MSG_AT_ALL?(t._groupAtInfoList.push({groupAtAllFlag:0,groupAtUserID:n}),t.atUserList.push(n)):(t._groupAtInfoList.push({groupAtAllFlag:1}),t.atUserList.push(_.MSG_AT_ALL))}),F(e.groupAtInfo)&&e.groupAtInfo.forEach(function(n){n.groupAtAllFlag===0?t.atUserList.push(n.groupAtUserID):n.groupAtAllFlag===1&&t.atUserList.push(_.MSG_AT_ALL)})}},{key:"getGroupAtInfoList",value:function(){return this._groupAtInfoList}},{key:"_initProxy",value:function(){this._elements[0]&&(this.payload=this._elements[0].content,this.type=this._elements[0].type)}},{key:"reInitialize",value:function(e){e&&(this.status=this.from?Et:os,this.from||(this.from=e)),this._initFlow(e),this._initSequence(e),this._concatConversationID(e),this.generateMessageID()}},{key:"isSendable",value:function(){return this._elements.length!==0&&(this._relayFlag===!0||typeof this._elements[0].sendable=="function"&&this._elements[0].sendable())}},{key:"_initTo",value:function(e){this.conversationType===_.CONV_GROUP&&(this.to=e.groupID)}},{key:"_initSequence",value:function(e){var t,n,o;this.clientSequence===0&&e&&(this.clientSequence=!!(e=e)&&($o[e]===void 0&&(o=new Date,t="3".concat(o.getHours()).slice(-2),n="0".concat(o.getMinutes()).slice(-2),o="0".concat(o.getSeconds()).slice(-2),$o[e]=parseInt([t,n,o,"0001"].join("")),o=n=t=null,u.l("autoIncrementIndex start index:".concat($o[e]))),$o[e]++)),this.sequence===0&&this.conversationType===_.CONV_C2C&&(this.sequence=this.clientSequence)}},{key:"generateMessageID",value:function(){this.from===_.CONV_SYSTEM&&(this.senderTinyID="144115198244471703"),this.ID="".concat(this.senderTinyID,"-").concat(this.clientTime,"-").concat(this.random)}},{key:"_initFlow",value:function(e){e!==""&&(e===this.from?(this.flow="out",this.isRead=!0):this.flow="in")}},{key:"_concatConversationID",value:function(e){var t=this.to,n=this.conversationType;n!==_.CONV_SYSTEM?(e=n===_.CONV_C2C?e===this.from?t:this.from:this.to,this.conversationID=e?"".concat(n).concat(e):null):this.conversationID=_.CONV_SYSTEM}},{key:"isElement",value:function(e){return e instanceof Hs||e instanceof Ks||e instanceof Ws||e instanceof Ys||e instanceof js||e instanceof zs||e instanceof ir||e instanceof ar||e instanceof Js||e instanceof Xs||e instanceof ss}},{key:"setElement",value:function(e,t){var n=this;if(this.isElement(e))return this._elements=[e],void this._initProxy();function o(i){if(i.type&&i.content)switch(i.type){case _.MSG_TEXT:n.setTextElement(i.content);break;case _.MSG_IMAGE:n.setImageElement(i.content,t);break;case _.MSG_AUDIO:n.setAudioElement(i.content,t);break;case _.MSG_FILE:n.setFileElement(i.content,t);break;case _.MSG_VIDEO:n.setVideoElement(i.content,t);break;case _.MSG_CUSTOM:n.setCustomElement(i.content);break;case _.MSG_LOCATION:n.setLocationElement(i.content);break;case _.MSG_GRP_TIP:n.setGroupTipElement(i.content);break;case _.MSG_GRP_SYS_NOTICE:n.setGroupSystemNoticeElement(i.content);break;case _.MSG_FACE:n.setFaceElement(i.content);break;case _.MSG_MERGER:n.setMergerElement(i.content,t)}}if(F(e))for(var s=0;s<e.length;s++)o(e[s]);else o(e);this._initProxy()}},{key:"clearElement",value:function(){this._elements.length=0}},{key:"setTextElement",value:function(e){e=typeof e=="string"?e:e.text,e=new Hs({text:e}),this._elements.push(e)}},{key:"setImageElement",value:function(e,t){e=new Ks(e,t),this._elements.push(e)}},{key:"setAudioElement",value:function(e,t){e=new Ys(e,t),this._elements.push(e)}},{key:"setFileElement",value:function(e,t){e=new js(e,t),this._elements.push(e)}},{key:"setVideoElement",value:function(e,t){e=new zs(e,t),this._elements.push(e)}},{key:"setLocationElement",value:function(e){e=new Xs(e),this._elements.push(e)}},{key:"setCustomElement",value:function(e){e=new Js(e),this._elements.push(e)}},{key:"setGroupTipElement",value:function(e){var t,n={},o=e.operationType;G(e.memberInfoList)?e.operatorInfo&&(n=e.operatorInfo):o!==_.GRP_TIP_MBR_JOIN&&o!==_.GRP_TIP_MBR_KICKED_OUT&&o!==_.GRP_TIP_MBR_SET_ADMIN&&o!==_.GRP_TIP_MBR_CANCELED_ADMIN||(n=e.memberInfoList[0]),G(e.memberExtraInfo)||(t=e.memberExtraInfo.reason,e.msgMemberInfo.forEach(function(s){s.reason=t})),o=n.nick,n=n.avatar,te(o)&&(this.nick=o),te(n)&&(this.avatar=n),o=new ir(e),this._elements.push(o)}},{key:"setGroupSystemNoticeElement",value:function(e){e=new ar(e),this._elements.push(e)}},{key:"setFaceElement",value:function(e){e=new Ws(e),this._elements.push(e)}},{key:"setMergerElement",value:function(e,t){e=new ss(e,t),this._elements.push(e)}},{key:"setIsRead",value:function(e){this.isRead=e}},{key:"setRelayFlag",value:function(e){this._relayFlag=e}},{key:"_computePriority",value:function(e){return C(e)?_.MSG_PRIORITY_NORMAL:te(e)&&Object.values($s).indexOf(e)!==-1?e:fe(e)&&(e=""+e,Object.keys($s).indexOf(e)!==-1)?$s[e]:_.MSG_PRIORITY_NORMAL}},{key:"setNickAndAvatar",value:function(n){var t=n.nick,n=n.avatar;te(t)&&(this.nick=t),te(n)&&(this.avatar=n)}},{key:"setNameCard",value:function(e){te(e)&&(this.nameCard=e)}},{key:"initC2CReadReceiptInfo",value:function(e){this.conversationType===_.CONV_C2C&&this.needReadReceipt===!0&&(this.readReceiptInfo.isPeerRead=e===1)}}]),Qs);function Qs(e){D(this,Qs),this.ID="",this.conversationID=e.conversationID||null,this.conversationType=e.conversationType||_.CONV_C2C,this.conversationSubType=e.conversationSubType,this.time=e.time||Math.ceil(Date.now()/1e3),this.sequence=e.sequence||0,this.clientSequence=e.clientSequence||e.sequence||0,this.random=e.random||e.random===0?e.random:St(),this.priority=this._computePriority(e.priority),this.nick=e.nick||"",this.avatar=e.avatar||"",this.isPeerRead=!1,this.nameCard="",this.hasRiskContent=Xa(e.checkResult),this._elements=[],this.isPlaceMessage=e.isPlaceMessage||0,this.isRevoked=e.isPlaceMessage===2||e.msgFlagBits===8,this.from=e.from||null,this.to=e.to||null,this.flow="",this.isSystemMessage=e.isSystemMessage||!1,this.protocol=e.protocol||"JSON",this.isResend=!1,this.isRead=!1,this.status=e.status||Et,this._onlineOnlyFlag=!1,this._groupAtInfoList=[],this._relayFlag=!1,this.atUserList=[],this.cloudCustomData=e.cloudCustomData||"",this.isDeleted=!1,this.isModified=!1,this._isExcludedFromUnreadCount=!(!e.messageControlInfo||e.messageControlInfo.excludedFromUnreadCount!==1),this._isExcludedFromLastMessage=!(!e.messageControlInfo||e.messageControlInfo.excludedFromLastMessage!==1),this.clientTime=e.clientTime||Mn()||0,this.senderTinyID=e.senderTinyID||e.tinyID||"",this.readReceiptInfo=e.readReceiptInfo||{readCount:void 0,unreadCount:void 0,isPeerRead:void 0},this.needReadReceipt=e.needReadReceipt===!0||e.needReadReceipt===1,this.version=e.messageVersion||0,this.isBroadcastMessage=e.isBroadcastMessage||!1,this._receiverList=e.receiverList||void 0,this.isSupportExtension=e.isSupportExtension===!0||e.isSupportExtension===1,this._cmConfigID=e.customModerationConfigurationID,this.revoker=e.revokerInfo&&e.revokerInfo.revoker||"",this.revokerInfo=e.revokerInfo||{userID:"",nick:"",avatar:""},this.revokeReason=e.revokeReason||"",this.reInitialize(e.currentUser),this.extractGroupInfo(e.groupProfile||null),this.handleGroupAtInfo(e),this.initC2CReadReceiptInfo(e.readReceiptSentByPeer)}function Zs(e,t){var n,o,s,i,a,r,c;D(this,Zs),this.type=_.MSG_MERGER,this.content={downloadKey:"",pbDownloadKey:"",messageList:[],title:"",abstractList:[],compatibleText:"",version:0,layersOverLimit:!1},e.downloadKey?(o=e.downloadKey,s=e.pbDownloadKey,i=e.title,a=e.abstractList,r=e.compatibleText,n=e.version,this.content.downloadKey=o,this.content.pbDownloadKey=s,this.content.title=i,this.content.abstractList=a,this.content.compatibleText=r,this.content.version=n||0):G(e.messageList)?e.layersOverLimit===1&&(this.content.layersOverLimit=!0):(o=e.messageList,s=e.title,i=e.abstractList,a=e.compatibleText,r=e.version,c=[],o.forEach(function(d){G(d)||(d=new rr(d,t),c.push(d))}),this.content.messageList=c,this.content.title=s,this.content.abstractList=i,this.content.compatibleText=a,this.content.version=r||0)}function ei(e,t){var n,o;D(this,ei),this.from=e.from,this.messageSender=e.from,this.time=e.time,this.messageSequence=e.sequence,this.clientSequence=e.clientSequence||e.sequence,this.messageRandom=e.random,this.cloudCustomData=e.cloudCustomData||"",this.clientTime=e.clientTime||void 0,e.ID?(this.ID=e.ID||"",this.nick=e.nick||"",this.avatar=e.avatar||"",e.messageBody?this.messageBody=JSON.parse(JSON.stringify(e.messageBody)):this.messageBody=[{type:e.type,payload:e.payload}],e.conversationType?e.conversationType.startsWith(_.CONV_C2C)?this.receiverUserID=e.to:e.conversationType.startsWith(_.CONV_GROUP)&&(this.receiverGroupID=e.to):e.receiverGroupID?this.receiverGroupID=e.receiverGroupID:e.receiverUserID&&(this.receiverUserID=e.receiverUserID),this.messageReceiver=e.to||e.messageReceiver):(this.nick=e.nick||"",this.avatar=e.avatar||"",this.messageBody=[],n=e.elements[0].type,o=e.elements[0].content,this._patchRichMediaPayload(n,o),this._updateRichMediaDownloadUrl(n,o,t),n===_.MSG_MERGER?this.messageBody.push({type:n,payload:new ss(o).content}):this.messageBody.push({type:n,payload:o}),e.groupID&&(this.receiverGroupID=e.groupID,this.messageReceiver=e.groupID),e.to&&(this.receiverUserID=e.to,this.messageReceiver=e.to),this.ID="".concat(e.tinyID,"-").concat(e.clientTime,"-").concat(e.random))}function ti(o){D(this,ti),this.type=_.MSG_LOCATION;var t=o.description,n=o.longitude,o=o.latitude;this.content={description:t,longitude:n,latitude:o}}function ni(e,t){D(this,ni),this.type=_.MSG_VIDEO,this._percent=0,this.content={remoteVideoUrl:e.remoteVideoUrl||e.videoUrl||"",videoFormat:e.videoFormat,videoSecond:parseInt(e.videoSecond,10),videoSize:e.videoSize,videoUrl:mt(e.videoUrl,t),videoDownloadFlag:2,videoUUID:e.videoUUID,thumbUUID:e.thumbUUID,thumbFormat:e.thumbFormat,thumbWidth:e.thumbWidth,snapshotWidth:e.thumbWidth,thumbHeight:e.thumbHeight,snapshotHeight:e.thumbHeight,thumbSize:e.thumbSize,snapshotSize:e.thumbSize,thumbDownloadFlag:2,thumbUrl:mt(e.thumbUrl,t),snapshotUrl:mt(e.thumbUrl,t)}}function oi(e){D(this,oi),this.type=_.MSG_CUSTOM,this.content={data:e.data||"",description:e.description||"",extension:e.extension||""}}function si(e,t){D(this,si),this.type=_.MSG_FILE,this._percent=0;var n=this._getFileInfo(e);this.content={downloadFlag:2,fileUrl:mt(e.url||e.fileUrl,t)||"",uuid:e.uuid,fileName:n.name||"",fileSize:n.size||0}}function ii(e){D(this,ii),this.type=_.MSG_GRP_SYS_NOTICE,this.content={},this._initContent(e)}function ai(e){D(this,ai),this.type=_.MSG_GRP_TIP,this.content={},this._initContent(e)}function ri(e,t){D(this,ri),this.type=_.MSG_AUDIO,this._percent=0,this.content={downloadFlag:2,second:e.second,size:e.size,url:mt(e.url,t),remoteAudioUrl:e.url||"",uuid:e.uuid}}function ci(e){D(this,ci),this.type=_.MSG_FACE,this.content=e||null}function ui(e,t){D(this,ui),this._imageMemoryURL="",this._fileDownloadProxy=t,ge?this.createImageDataASURLInWXMiniApp(e.file):this.createImageDataASURLInWeb(e.file),this._initImageInfoModel(),this.type=_.MSG_IMAGE,this._percent=0,this.content={imageFormat:e.imageFormat||Ut.UNKNOWN,uuid:e.uuid,imageInfoArray:[]},this.initImageInfoArray(e.imageInfoArray),this._autoFixUrl()}function li(e){D(this,li),this.type=_.MSG_TEXT,this.content={text:e.text||""}}function Xn(e){D(this,Xn),this._n="SSOLogData",this.eventType=kc[e]||0,this.timestamp=0,this.networkType=8,this.code=0,this.message="",this.moreMessage="",this.extension=e,this.costTime=0,this.duplicate=!1,this.level=4,this.uiPlatform=void 0,this._sentFlag=!1,this._startts=kt()}function di(e){D(this,di),this._m=e,this._n=""}function is(s){D(this,is),t=tr.call(this);var t,n=s.code,o=s.message,s=s.data;return t.code=n,o?t.message=o:t._getErrorMessage&&(t.message=t._getErrorMessage(t.code)),t.data=s||{},t}function as(e){if(Ce(e))return{pushFlag:e.disablePush===!0?1:0,title:e.title||"",desc:e.description||"",ext:e.extension||"",apnsInfo:(n=(n=(t=e).apnsInfo)===void 0?{}:n,o=t.ignoreIOSBadge,t=t.disableVoipPush,o=n.ignoreIOSBadge===!0||(o!==void 0&&o)===!0?1:0,s=void 0,C(t)||(s=t===!1?1:0),C(n.disableVoipPush)||(s=n.disableVoipPush===!1?1:0),l(l({},n),{},{badgeMode:o,isVoipPush:s})),androidInfo:(n=(n=(t=e).androidInfo)===void 0?{}:n,t=t.androidOPPOChannelID,t=n.OPPOChannelID||(t===void 0?"":t),l(l({},n),{},{Sound:(s=(o=n.sound||"").lastIndexOf("."))===-1?o:o.slice(0,s),OPPOChannelID:t,GoogleChannelID:n.FCMChannelID||""}))};var t,n,o,s}z($n,Oe),cr=X($n),R($n,[{key:"onNewC2CMessage",value:function(n){var i=n.dataList,t=n.isInstantMessage,o=n.C2CRemainingUnreadList,s=n.C2CPairUnreadList,n=n.isSyncingEnded,i=(u.d("".concat(this._n,".onNewC2CMessage count:").concat(i.length," isInstantMessage:").concat(t)),this._newC2CMessageStoredAndSummary({dataList:i,C2CRemainingUnreadList:o,C2CPairUnreadList:s,isInstantMessage:t})),o=i.conversationOptionsList,s=i.messageList,i=i.isUnreadC2CMessage,a=Rs(s),a=(0<a.length&&this.emitOuterEvent(V.MESSAGE_MODIFIED,a),this.get(11).onNewMessage({conversationOptionsList:o,isInstantMessage:t,isUnreadC2CMessage:i,isSyncingEnded:n}),Ns(s));t&&0<a.length&&this.emitOuterEvent(V.MESSAGE_RECEIVED,a),s.length=0}},{key:"_newC2CMessageStoredAndSummary",value:function(e){for(var t=e.dataList,n=e.C2CRemainingUnreadList,o=e.C2CPairUnreadList,s=e.isInstantMessage,i=null,a=[],r=[],c={},d=this.get(26),p=!1,h=this.get(11),m=this.get(4),f=this.getFileDownloadProxy(),I=0,k=t.length;I<k;I++)if(this._isC2CNotice(t[I]))this._noticeFromUnreadDBList.push(t[I].eventArray[0].c2CNotifyMsgArray[0]);else{var N=t[I],x=(N.currentUser=this.getMyUserID(),N.conversationType=_.CONV_C2C,N.isSystemMessage=!!N.isSystemMessage,(C(N.nick)||C(N.avatar))&&(p=!0,u.d("".concat(this._n,"._newC2CMessageStoredAndSummary nick or avatar missing!"))),(i=new We(N)).setElement(N.elements,f),i.setNickAndAvatar({nick:N.nick,avatar:N.avatar}),i.conversationID);if(s){if(this._messageFromUnreadDBMap.get(i.ID))continue;var Y,ie,Le=!1,Ze=(i.from!==this.getMyUserID()?(ie=h.getLatestMessageSentByPeer(x))&&(Y=ie.nick,ie=ie.avatar,p?i.setNickAndAvatar({nick:Y,avatar:ie}):Y===i.nick&&ie===i.avatar||(Le=!0)):(Y=h.getLatestMessageSentByMe(x))&&(ie=Y.nick,Ze=Y.avatar,ie===i.nick&&Ze===i.avatar||(h.modifyMessageSentByMe({conversationID:x,latestNick:i.nick,latestAvatar:i.avatar}),m.mockOnNickAvatarModified(i.nick,i.avatar))),t[I].isModified===1);if(h.isMessageSentByCurrentInstance(i)?i.isModified=Ze:Ze=!1,N.msgLifeTime===0)i._onlineOnlyFlag=!0,h.isMessageSentByCurrentInstance(i)||r.push(i);else{if(!h.pushIntoMessageList(r,i,Ze))continue;Le&&(h.modifyMessageSentByPeer({conversationID:x,latestNick:i.nick,latestAvatar:i.avatar}),h.updateUserProfileSpecifiedKey({conversationID:x,nick:i.nick,avatar:i.avatar}))}s&&0<i.clientTime&&d.addMessageDelay(i.clientTime)}else this._messageFromUnreadDBMap.set(i.ID,i);if(N.msgLifeTime!==0){if(i._onlineOnlyFlag===!1){if(Le=h.getLastMessageTime(x),fe(Le)&&i.time<Le)continue;C(c[x])?(N=0,i.flow==="in"&&(i._isExcludedFromUnreadCount||(N=1)),c[x]=a.push({conversationID:x,unreadCount:N,type:i.conversationType,subType:i.conversationSubType,lastMessage:i._isExcludedFromLastMessage?"":i})-1):(N=c[x],a[N].type=i.conversationType,a[N].subType=i.conversationSubType,a[N].lastMessage=i._isExcludedFromLastMessage?"":i,i.flow==="in"&&(i._isExcludedFromUnreadCount||a[N].unreadCount++))}}else i._onlineOnlyFlag=!0}this._handleRevokedNoticeFromUnreadDB();var et=!1;if(F(o))for(var rt=0,Eo=o.length;rt<Eo;rt++)(function($t){var _s;0<o[$t].unreadCount&&(et=!0,(_s=a.find(function(yl){return yl.conversationID==="C2C".concat(o[$t].from)}))?_s.unreadCount=o[$t].unreadCount:a.push({conversationID:"C2C".concat(o[$t].from),unreadCount:o[$t].unreadCount,type:_.CONV_C2C}))})(rt);if(F(n))for(var ko=0,Nn=n.length;ko<Nn;ko++)(function($t){a.find(function(_s){return _s.conversationID==="C2C".concat(n[$t].from)})||a.push({conversationID:"C2C".concat(n[$t].from),type:_.CONV_C2C,lastMsgTime:n[$t].lastMsgTime})})(ko);return{conversationOptionsList:a,messageList:r,isUnreadC2CMessage:et}}},{key:"getMessageListFromUnreadDB",value:function(){return b(this._messageFromUnreadDBMap.values())}},{key:"_isC2CNotice",value:function(e){return e=e.eventArray,!(!F(e)||e[0].event!==10)}},{key:"_handleRevokedNoticeFromUnreadDB",value:function(){var e,t=this._noticeFromUnreadDBList.length;t!==0&&(u.l("".concat(this._n,"._handleRevokedNoticeFromUnreadDB count:").concat(t)),e=[],this._noticeFromUnreadDBList.forEach(function(n){n.hasOwnProperty("c2cMessageRevokedNotify")&&e.push(n)}),this.onC2CMessageRevoked({dataList:e}),this._noticeFromUnreadDBList.length=0,e.length=0)}},{key:"onC2CMessageRevoked",value:function(e){var t,n=this,o=this.get(11),s=[];e.dataList.forEach(function(i){i.c2cMessageRevokedNotify&&(i=i.c2cMessageRevokedNotify.revokedInfos,C(i)||i.forEach(function(a){var r=n.getMyUserID()===a.from?"".concat(_.CONV_C2C).concat(a.to):"".concat(_.CONV_C2C).concat(a.from);t=o.revoke(r,a.sequence,a.random);var c,d=a.revokerInfo&&a.revokerInfo.revoker,p=a.revokerInfo&&a.revokerInfo.reason||"";t?c=t:(c={conversationID:r,sequence:a.sequence},a.tinyID&&a.clientTime&&a.random&&(c.ID="".concat(a.tinyID,"-").concat(a.clientTime,"-").concat(a.random)),a.time&&(c.time=a.time)),c&&(c.revoker=d,c.revokeReason=p,c.revokerInfo={userID:d,nick:"",avatar:""},s.push(c))}))}),s.length!==0&&(o.onMessageRevoked(s),u.l("".concat(this._n,".onC2CMessageRevoked count:").concat(s.length)),o.updateRevokerInfo(s).then(function(i){n.emitOuterEvent(V.MESSAGE_REVOKED,i)}))}},{key:"onC2CMessageReadReceipt",value:function(e){var t=this;e.dataList.forEach(function(n){var o;G(n.c2cMessageReadReceipt)||(o=n.c2cMessageReadReceipt.to,n.c2cMessageReadReceipt.uinPairReadArray.forEach(function(i){var i=i.peerReadTime,a=(u.d("".concat(t._n,"._onC2CMessageReadReceipt to:").concat(o," peerReadTime:").concat(i)),"".concat(_.CONV_C2C).concat(o)),r=t.get(11);r.recordPeerReadTime(a,i),r.updateMessageIsPeerReadProperty(a,i)}))})}},{key:"onC2CMessageReadNotice",value:function(e){var t=this;e.dataList.forEach(function(n){var o;G(n.c2cMessageReadNotice)||(o=t.get(11),n.c2cMessageReadNotice.uinPairReadArray.forEach(function(i){var a=i.from,i=i.peerReadTime,a=(u.d("".concat(t._n,".onC2CMessageReadNotice from:").concat(a," lastReadTime:").concat(i)),"".concat(_.CONV_C2C).concat(a));o.updateIsReadAfterReadReport({conversationID:a,lastMessageTime:i}),o.updateUnreadCount(a)}))})}},{key:"onC2CMessageModified",value:function(e){u.d("".concat(this._n,".onC2CMessageModified options:"),JSON.stringify(e));var t=this.get(11);e.dataList.forEach(function(n){t.onMessageModified(l(l({},n),{},{conversationType:_.CONV_C2C}))})}},{key:"onReadReceiptList",value:function(n){u.d("".concat(this._n,".onReadReceiptList options:"),JSON.stringify(n));var n=n.dataList,t=n.userID,n=n.readReceiptList;this.get(11).updateReadReceiptInfo({userID:t,readReceiptList:n})}},{key:"sendMessage",value:function(e,t){return e=this._createC2CMessagePack(e,t),this.req(e)}},{key:"_createC2CMessagePack",value:function(e,t){var n,o,s=null,i=(t&&(t.offlinePushInfo&&(s=t.offlinePushInfo),t.onlineUserOnly===!0&&(s?s.disablePush=!0:s={disablePush:!0})),""),a=(te(e.cloudCustomData)&&0<e.cloudCustomData.length&&(i=e.cloudCustomData),[]),r=(Ce(t)&&Ce(t.messageControlInfo)&&(r=(o=t.messageControlInfo).excludedFromUnreadCount,n=o.excludedFromLastMessage,o=o.excludedFromContentModeration,r===!0&&a.push("NoUnread"),n===!0&&a.push("NoLastMsg"),o===!0&&a.push("NoMsgCheck")),this.isOnlineMessage(e,t)?0:void 0);return{proto:g.SEND_C2C_MSG,tjgID:this.generateTjgID(e),data:{fromAccount:this.getMyUserID(),toAccount:e.to,msgBody:e.getElements(),cloudCustomData:i,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:r,nick:e.nick,avatar:e.avatar,offlinePushInfo:as(s),messageControlInfo:r!==0?a:void 0,clientTime:e.clientTime,needReadReceipt:e.needReadReceipt===!0?1:0,isSupportExtension:e.isSupportExtension===!0?1:0,isRelayMessage:e._relayFlag===!0?1:0,cmConfigID:e._cmConfigID}}}},{key:"isOnlineMessage",value:function(e,t){return!(!t||t.onlineUserOnly!==!0)}},{key:"revokeMessage",value:function(e){return this.req({proto:g.REVOKE_C2C_MSG,data:{msgInfo:{fromAccount:e.from,toAccount:e.to,msgSeq:e.sequence,msgRandom:e.random,msgTimeStamp:e.time}}})}},{key:"deleteMessage",value:function(n){var t=n.to,n=n.keyList;return u.l("".concat(this._n,".deleteMessage toAccount:").concat(t," count:").concat(n.length)),this.req({proto:g.DEL_C2C_MSG,data:{fromAccount:this.getMyUserID(),to:t,keyList:n}})}},{key:"modifyRemoteMessage",value:function(d){var t=d.from,n=d.to,o=d.version,o=o===void 0?0:o,s=d.sequence,i=d.random,a=d.time,r=d.payload,c=d.type,d=d.cloudCustomData,p=void 0;return ja(c)&&(p=[]).push({type:c,content:r}),this.req({proto:g.MODIFY_C2C_MSG,data:{from:t,to:n,version:o,sequence:s,random:i,time:a,elements:p,cloudCustomData:d}})}},{key:"setMessageRead",value:function(i){var t=this,n=i.conversationID,o=i.lastMessageTime,s="".concat(this._n,".").concat("setMessageRead"),i="conversationID:".concat(n," lastMessageTime:").concat(o),a=(u.l("".concat(s," ").concat(i)),fe(o)||this.outputWarning("DoNotModifyLastTime"),new S("setMessageRead"));return a.setMessage(i),this.req({proto:g.SET_C2C_MSG_READ,data:{C2CMsgReaded:{cookie:"",C2CMsgReadedItem:[{toAccount:n.replace("C2C",""),lastMessageTime:o,receipt:1}]}}}).then(function(){a.end(),u.l("".concat(s," ok"));var r=t.get(11);return r.updateIsReadAfterReadReport({conversationID:n,lastMessageTime:o}),r.updateUnreadCount(n),q()}).catch(function(r){return a.setError(r).end(),u.l("".concat(s," failed. error:"),r),v(r)})}},{key:"getRoamingMessage",value:function(r){var t=this,n="".concat(this._n,".getRoamingMessage"),o=r.peerAccount,s=r.conversationID,i=r.count,a=r.lastMessageTime,r=r.messageKey,c="peerAccount:".concat(o," count:").concat(i||15," lastMessageTime:").concat(a||0," messageKey:").concat(r),d=(u.l("".concat(n," ").concat(c)),new S("getC2CRoamingMessages"));return this.req({proto:g.GET_C2C_ROAMING_MSG,data:{peerAccount:o,count:i||15,lastMessageTime:a||0,messageKey:r}}).then(function(k){var k=k.data,f=k.complete,I=k.messageList,h=k.messageKey,k=k.lastMessageTime,m=(C(I)?u.l("".concat(n," ok. complete:").concat(f," but messageList is undefined!")):u.l("".concat(n," ok. complete:").concat(f," count:").concat(I.length)),d.setMessage("".concat(c," complete:").concat(f," length:").concat(I.length)).end(),t.get(11)),f=(f===1&&m.setCompleted(s),m.onRoamingMessage(I,s)),I=(m.modifyMessageList(s),m.updateIsRead(s),m.updateRoamingMessageKeyAndTime(s,h,k),m.getPeerReadTime(s)),k=(u.l("".concat(n," update isPeerRead property. conversationID:").concat(s," peerReadTime:").concat(I)),I?m.updateMessageIsPeerReadProperty(s,I):(h=s.replace(_.CONV_C2C,""),t.getRemotePeerReadTime([h]).then(function(){m.updateMessageIsPeerReadProperty(s,m.getPeerReadTime(s))})),"");return 0<f.length?k=f[0].ID:(I=m.getLocalOldestMessage(s))&&(k=I.ID),u.l("".concat(n," nextReqID:").concat(k," stored message count:").concat(f.length)),{nextReqID:k,storedMessageList:f}}).catch(function(p){return d.setMessage(c).setError(p).end(),u.w("".concat(n," failed. error:"),p),v(p)})}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessagesHopping"),o=e.peerAccount,s=e.time,s=s===void 0?0:s,i=e.count,a=e.direction,r="".concat(_.CONV_C2C).concat(o),c="peerAccount:".concat(o," count:").concat(i," time:").concat(s," direction:").concat(a),d=(u.l("".concat(n," ").concat(c)),new S("getC2CRoamingMessagesHopping"));return this.req({proto:g.GET_C2C_ROAMING_MSG,data:{peerAccount:o,count:i+1,lastMessageTime:s,direction:a}}).then(function(h){var h=h.data,I=h.complete,f=h.messageList,f=f===void 0?[]:f,h=h.lastMessageTime,m=(u.l("".concat(n," ok. complete:").concat(I," count:").concat(f.length)),d.setMessage("".concat(c," complete:").concat(I," length:").concat(f.length)).end(),I!==1&&(a===1?f.pop():f.shift()),t.get(11)),f=m.onRoamingMessage(f,r,!1),I=(t._modifyMessageList(r,f),t._computeResult({complete:I,lastMessageTime:h,resultList:f}));return m.storeHoppingMessageList(I.messageList),q(I)}).catch(function(p){return d.setMessage(c).setError(p).end(),u.w("".concat(n," failed. error:"),p),v(p)})}},{key:"_computeResult",value:function(o){var t=o.complete,t=t===void 0?0:t,n=o.lastMessageTime,o=o.resultList,o={messageList:b(o===void 0?[]:o),isCompleted:!1,nextMessageTime:""};return t===1?o.isCompleted=!0:o.nextMessageTime=n,o}},{key:"_modifyMessageList",value:function(e,t){if(e=this.get(11).getLocalConversation(e),e)for(var n=e.userProfile.nick,o=e.userProfile.avatar,e=this.get(4).getNickAndAvatarByUserID(this.getMyUserID()),s=e.nick,i=e.avatar,a=t.length-1;0<=a;a--){var r=t[a];r.flow==="in"&&(r.nick!==n&&r.setNickAndAvatar({nick:n}),r.avatar!==o&&r.setNickAndAvatar({avatar:o})),r.flow==="out"&&(r.nick!==s&&r.setNickAndAvatar({nick:s}),r.avatar!==i&&r.setNickAndAvatar({avatar:i}))}}},{key:"getRemotePeerReadTime",value:function(e){var t=this,n="".concat(this._n,".getRemotePeerReadTime");if(G(e))return u.w("".concat(n," userIDList is empty!")),Promise.resolve();var o=new S("getPeerReadTime");return u.l("".concat(n," userIDList:").concat(e)),this.req({proto:g.GET_C2C_PEER_READ_TIME,data:{userIDList:e}}).then(function(s){var i=s.data.peerReadTimeList;u.l("".concat(n," ok. peerReadTimeList:").concat(i));for(var a="",r=t.get(11),c=0;c<e.length;c++)a+="".concat(e[c],"-").concat(i[c]," "),0<i[c]&&r.recordPeerReadTime("C2C".concat(e[c]),i[c]);o.setMessage(a).end()}).catch(function(s){o.setError(s).end(),u.w("".concat(n," failed. error:"),s)})}},{key:"sendReadReceipt",value:function(s){var t=s[0].conversationID.replace(_.CONV_C2C,""),n=new S("sendReadReceipt"),o=(n.setMessage("peerAccount:".concat(t)),this.getMyUserID()),s=s.filter(function(a){return a.from!==o&&a.needReadReceipt===!0}).map(function(a){return{fromAccount:a.from,toAccount:a.to,sequence:a.sequence,random:a.random,time:a.time,clientTime:a.clientTime}});if(s.length===0)return v({code:M.READ_RECEIPT_MSG_LIST_EMPTY});var i="".concat(this._n,".").concat("sendReadReceipt");return u.l("".concat(i,". peerAccount:").concat(t," length:").concat(s.length)),this.req({proto:g.SEND_C2C_READ_RECEIPT,data:{peerAccount:t,messageInfoList:s}}).then(function(a){return n.end(),u.l("".concat(i," ok")),q()}).catch(function(a){return n.setError(a).end(),u.w("".concat(i," failed. error:"),a),v(a)})}},{key:"getReadReceiptList",value:function(o){var t="".concat(this._n,".getReadReceiptList"),n=this.getMyUserID(),o=o.filter(function(s){return s.from===n&&s.needReadReceipt===!0});return u.l("".concat(t," userID:").concat(n," messageList length:").concat(o.length)),Q({messageList:o})}},{key:"getMessageExtensions",value:function(e,t){return u.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.req({proto:g.GET_C2C_MSG_EXT,data:{from:e.from,to:e.to,messageKey:this.getMessageKey(e),startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;return u.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n)),this.req({proto:g.MODIFY_C2C_MSG_EXT,data:{from:e.from,to:e.to,messageKey:this.getMessageKey(e),extensionList:t,operateType:n}})}},{key:"getMessageKey",value:function(o){var t=o.clientSequence,n=o.random,o=o.time;return"".concat(t,"_").concat(n,"_").concat(o)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._messageFromUnreadDBMap.clear(),this._noticeFromUnreadDBList.length=0}}]);var cr,Oc=$n,Gc=(R(pi,[{key:"getLocalOldestMessageByConversationID",value:function(e){return!e||!this.list.has(e)?null:(e=this.list.get(e).values(),e?e.next().value:null)}},{key:"pushIn",value:function(e){var t=1<arguments.length&&arguments[1]!==void 0&&arguments[1],n=e.conversationID,o=!0,s=(this.list.has(n)||this.list.set(n,new Map),this._getUniqueIDOfMessage(e));if(this.list.get(n).has(s)){var i=this.list.get(n).get(s);if(!t||i.isModified===!0)return!1}return this.list.get(n).set(s,e),this._setLatestMessageSentByPeer(n,e),this._setLatestMessageSentByMe(n,e),o}},{key:"unshift",value:function(e,t){var n;if(F(e)?0<e.length&&(n=e[0].conversationID,this._unshiftMultipleMessages(e,t)):(n=e.conversationID,this._unshiftSingleMessage(e,t)),n){var o=Array.from(this.list.get(n).values()),e=o.length;if(e!==0){for(var s=e-1;0<=s;s--)if(o[s].flow==="out"){this._setLatestMessageSentByMe(n,o[s]);break}if(n.startsWith(_.CONV_C2C)){for(var i=e-1;0<=i;i--)if(o[i].flow==="in"){this._setLatestMessageSentByPeer(n,o[i]);break}}}}}},{key:"_unshiftSingleMessage",value:function(e,t){var n=e.conversationID,o=this._getUniqueIDOfMessage(e);if(!this.list.has(n))return this.list.set(n,new Map),this.list.get(n).set(o,e),void t.push(e);var s=this.list.get(n),i=Array.from(s);s.has(o)||(i.unshift([o,e]),this.list.set(n,new Map(i)),t.push(e))}},{key:"_unshiftMultipleMessages",value:function(e,t){for(var n=e.length,o=[],s=e[0].conversationID,i=this.list.get(s),a=this.list.has(s)?Array.from(i):[],r=0;r<n;r++){var c=this._getUniqueIDOfMessage(e[r]);i&&i.has(c)||(o.push([c,e[r]]),t.push(e[r]))}this.list.set(s,new Map(o.concat(a)))}},{key:"remove",value:function(n){var t=n.conversationID,n=this._getUniqueIDOfMessage(n);this.list.has(t)&&this.list.get(t).delete(n)}},{key:"revoke",value:function(e,t,n){var o;return u.d("revoke message",e,t,n),this.list.has(e)?(o=this.list.get(e),this._updateMessageIsRevoked(o,t,n)):this._hoppingMessageMap.has(e)?(o=this._hoppingMessageMap.get(e),this._updateMessageIsRevoked(o,t,n)):null}},{key:"_updateMessageIsRevoked",value:function(e,t,n){var o,s=Ee(e);try{for(s.s();!(o=s.n()).done;){var i=$(o.value,2)[1];if(i.sequence===t&&(C(n)||i.random===n))return i.isRevoked||(i.isRevoked=!0),i}}catch(a){s.e(a)}finally{s.f()}}},{key:"removeByConversationID",value:function(e){var t=this.list.has(e);u.l("".concat(this._n,".removeByConversationID conversationID:").concat(e," has:").concat(t)),t&&(this.list.delete(e),this._latestMessageSentByPeerMap.delete(e),this._latestMessageSentByMeMap.delete(e))}},{key:"findMessage",value:function(e){var t=null;return t=(t=this._findMessage(e,this.list))?t:this._findMessage(e,this._hoppingMessageMap)}},{key:"_findMessage",value:function(e,t){var n,o=null,s=Ee(t);try{for(s.s();!(n=s.n()).done;)for(var i=b($(n.value,2)[1].values()),a=i.length,r=0;r<a;r++)if(i[r].ID===e){o=i[r];break}}catch(c){s.e(c)}finally{s.f()}return o}},{key:"updateMessageIsPeerReadProperty",value:function(e,t){var n,o=[];return this.list.has(e)?(n=this.list.get(e),o=this._updateMessageIsPeerReadProperty(n,t)):this._hoppingMessageMap.has(e)&&(n=this._hoppingMessageMap.get(e),o=this._updateMessageIsPeerReadProperty(n,t)),u.l("".concat(this._n,".updateMessageIsPeerReadProperty conversationID:").concat(e," peerReadTime:").concat(t," count:").concat(o.length)),o}},{key:"_updateMessageIsPeerReadProperty",value:function(e,t){var n,o=[],s=Ee(e);try{for(s.s();!(n=s.n()).done;){var i=$(n.value,2)[1];i.time<=t&&!i.isPeerRead&&i.flow==="out"&&(i.isPeerRead=!0,o.push(i))}}catch(a){s.e(a)}finally{s.f()}return o}},{key:"updateMessageIsModifiedProperty",value:function(e){var t=e.conversationID;this.list.has(t)&&(e=this._getUniqueIDOfMessage(e),(t=this.list.get(t).get(e))&&(t.isModified=!0))}},{key:"hasLocalMessageList",value:function(e){return this.list.has(e)}},{key:"getLocalMessageList",value:function(e){return this.hasLocalMessageList(e)?b(this.list.get(e).values()):[]}},{key:"getLocalMaxSequence",value:function(e){return this.hasLocalMessageList(e)?(e=b(this.list.get(e).values()).map(function(t){return t.sequence}),Math.max.apply(Math,b(e))):0}},{key:"getLocalMaxTime",value:function(e){return this.hasLocalMessageList(e)?(e=b(this.list.get(e).values()).map(function(t){return t.time}),Math.max.apply(Math,b(e))):0}},{key:"hasLocalMessage",value:function(e,t){for(var n=!1,o=this.getLocalMessageList(e),s=o.length,i=0;i<s;i++)o[i].ID===t&&(n=!0);return n}},{key:"getLocalMessage",value:function(e,t){for(var n=null,o=this.getLocalMessageList(e),s=o.length,i=0;i<s;i++)if(o[i].ID===t){n=o[i];break}return n}},{key:"getLocalLastMessage",value:function(e){return e=this.getLocalMessageList(e),e[e.length-1]}},{key:"getLocalSecondLastMessage",value:function(e){return e=this.getLocalMessageList(e),e[e.length-2]}},{key:"getLocalOldestMessage",value:function(e){return this.getLocalMessageList(e)[0]}},{key:"_setLatestMessageSentByPeer",value:function(e,t){e.startsWith(_.CONV_C2C)&&t.flow==="in"&&this._latestMessageSentByPeerMap.set(e,t)}},{key:"_setLatestMessageSentByMe",value:function(e,t){t.flow==="out"&&this._latestMessageSentByMeMap.set(e,t)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._latestMessageSentByPeerMap.get(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._latestMessageSentByMeMap.get(e)}},{key:"modifyMessageSentByPeer",value:function(s){var t=s.conversationID,n=s.latestNick,o=s.latestAvatar,s=this.list.get(t);if(!G(s)){var i=Array.from(s.values()),s=i.length;if(s!==0){for(var a=null,r=0,c=!1,d=s-1;0<=d;d--)i[d].flow==="in"&&((a=i[d]).nick!==n&&(a.setNickAndAvatar({nick:n}),c=!0),a.avatar!==o&&(a.setNickAndAvatar({avatar:o}),c=!0),c&&(r+=1));u.l("".concat(this._n,".modifyMessageSentByPeer conversationID:").concat(t," count:").concat(r))}}}},{key:"modifyMessageSentByMe",value:function(s){var t=s.conversationID,n=s.latestNick,o=s.latestAvatar,s=this.list.get(t);if(!G(s)){var i=Array.from(s.values()),s=i.length;if(s!==0){for(var a=null,r=0,c=!1,d=s-1;0<=d;d--)i[d].flow==="out"&&((a=i[d]).nick!==n&&(a.setNickAndAvatar({nick:n}),c=!0),a.avatar!==o&&(a.setNickAndAvatar({avatar:o}),c=!0),c&&(r+=1));u.l("".concat(this._n,".modifyMessageSentByMe conversationID:").concat(t," count:").concat(r))}}}},{key:"getTopicConversationIDList",value:function(e){return b(this.list.keys()).filter(function(t){return t.startsWith("".concat(_.CONV_GROUP).concat(e))})}},{key:"traversal",value:function(){if(this.list.size!==0&&u.getLevel()===-1){console.group("conversationID-messageCount");var e,t=Ee(this.list);try{for(t.s();!(e=t.n()).done;){var n=$(e.value,2),o=n[0],s=n[1];"".concat(o,"-").concat(s.size)}}catch(i){t.e(i)}finally{t.f()}console.groupEnd()}}},{key:"onMessageModified",value:function(e,t){if(!this.list.has(e)&&!this._hoppingMessageMap.has(e))return{isUpdated:!1,message:null};var n="".concat(this._n,".onMessageModified"),o=this._getUniqueIDOfMessage(t),s=this._getTargetMessage(e,o),i=!!s;return u.l("".concat(n," conversationID:").concat(e," uniqueID:").concat(o," has:").concat(i)),i?(e=t.messageVersion,o=t.elements,i=t.cloudCustomData,t=t.checkResult,u.l("".concat(n," localVersion:").concat(s.version," remoteVersion:").concat(e)),s.version<e?(s.version=e,s._elements=JSON.parse(JSON.stringify(o)),s.payload=JSON.parse(JSON.stringify(o[0].content)),s.type=o[0].type,s.cloudCustomData=i,s.isModified=!0,s.hasRiskContent=Xa(t),{isUpdated:!0,message:s}):{isUpdated:!1,message:s}):{isUpdated:!1,message:null}}},{key:"_getUniqueIDOfMessage",value:function(i){var t=i.from,n=i.to,o=i.random,s=i.sequence,i=i.time;return"".concat(t,"-").concat(n,"-").concat(o,"-").concat(s,"-").concat(i)}},{key:"_getTargetMessage",value:function(e,t){if(this.list.has(e))return this.list.get(e).get(t);var n=void 0;if(this._hoppingMessageMap.has(e)){for(var o=b(this._hoppingMessageMap.get(e).values()),s=0;s<o.length;s++)if(this._getUniqueIDOfMessage(o[s])===t){n=o[s];break}}return n}},{key:"storeHoppingMessageList",value:function(e){if(e.length!==0){var t=e[0].conversationID,n=e.length;this._hoppingMessageMap.has(t)||this._hoppingMessageMap.set(t,new Map);for(var o=this._hoppingMessageMap.get(t),s=0;s<n;s++){var i=e[s];o.has(i.ID)||o.set(i.ID,i)}}}},{key:"getHoppingMessage",value:function(e,t){if(this._hoppingMessageMap.has(e))return this._hoppingMessageMap.get(e).get(t)}},{key:"reset",value:function(){this.list.clear(),this._latestMessageSentByPeerMap.clear(),this._latestMessageSentByMeMap.clear(),this._hoppingMessageMap.clear()}}]),pi),Re={A2KEY_AND_TINYID_UPDATED:"_inner".concat(1),CLOUD_CONFIG_UPDATED:"_inner".concat(2),PROFILE_UPDATED:"_inner".concat(3),CONV_SYNC_COMPLETED:"_inner".concat(4),C2C_UNREAD_HANDLE_COMPLETED:"_inner".concat(5)};function pi(){D(this,pi),this.list=new Map,this._n="MessageListHandler",this._latestMessageSentByPeerMap=new Map,this._latestMessageSentByMeMap=new Map,this._hoppingMessageMap=new Map}function $n(e){return D(this,$n),(e=cr.call(this,e))._n="C2CModule",e._messageFromUnreadDBMap=new Map,e._noticeFromUnreadDBList=[],e}function _i(e){this.mixin(e)}_i.mixin=function(e){e=e.prototype||e,e._isReady=!1,e.ready=function(t){if(t)return this._isReady?void(1<arguments.length&&arguments[1]!==void 0&&arguments[1]?t.call(this):setTimeout(t,1)):(this._readyQueue=this._readyQueue||[],void this._readyQueue.push(t))},e.triggerReady=function(){var t=this;this._isReady=!0,setTimeout(function(){var n=t._readyQueue;t._readyQueue=[],n&&0<n.length&&n.forEach(function(o){o.call(this)},t)},1)},e.resetReady=function(){this._isReady=!1,this._readyQueue=[]},e.isReady=function(){return this._isReady}};function ur(e,t,n){return C(e)?{lastTime:0,lastSequence:0,fromAccount:"",messageForShow:"",payload:null,type:"",isRevoked:!1,cloudCustomData:"",onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:!1,revoker:null}:n&&e.ID||e instanceof We?{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",messageForShow:Kn(e.type,e.payload,t),payload:e.payload||null,type:e.type||null,isRevoked:e.isRevoked||!1,cloudCustomData:e.cloudCustomData||"",onlineOnlyFlag:e._onlineOnlyFlag||!1,nick:e.nick||"",nameCard:e.nameCard||"",version:e.version||0,isPeerRead:e.isPeerRead||!1,revoker:e.revoker||null}:l(l({},e),{},{messageForShow:Kn(e.type,e.payload,t)})}function lr(e,t){return G(e)?{lastTime:0,lastSequence:0,fromAccount:"",payload:null,type:"",messageForShow:"",nick:"",avatar:"",version:0,cloudCustomData:"",isRevoked:!1,revoker:null}:{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",payload:e.payload||null,type:e.type||"",messageForShow:Kn(e.type,e.payload,t),nick:e.nick||"",avatar:e.avatar||"",version:e.version||0,cloudCustomData:e.cloudCustomData||"",isRevoked:e.isRevoked||!1,revoker:e.revoker||null}}function rs(e){var t=String(e).replace(/[=]+$/,""),n="";if(t.length%4==1)return"";for(var o,s,i=0,a=0;s=t.charAt(a++);~s&&(o=i%4?64*o+s:s,i++%4)&&(n+=String.fromCharCode(255&o>>(-2*i&6))))s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(s);try{return decodeURIComponent(escape(n))}catch{return""}}var dr,pr,_r,gr,hr,Pc=["jpg","jpeg","gif","png","bmp","image","webp"],Uc=["mp4","quicktime","mov"],Qn=(R(Pi,[{key:"validate",value:function(e){var t,n=!0,o="";if(G(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var s=e.profileCustomField.length,i=null,a=0;a<s;a++){if(i=e.profileCustomField[a],!te(i.key)||i.key.indexOf("Tag_Profile_Custom")===-1)return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!te(i.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(t in e)if(Object.prototype.hasOwnProperty.call(e,t)){if(t==="profileCustomField")continue;if(G(e[t])&&!te(e[t])&&!fe(e[t])){o="key:"+t+", invalid value:"+e[t],n=!1;continue}switch(t){case"nick":te(e[t])||(n=!(o="nick must be a string")),500<zo(e[t])&&(o="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(zo(e[t])," bytes"),n=!1);break;case"gender":yn(se,e.gender)||(o="key:gender, invalid value:"+e.gender,n=!1);break;case"birthday":fe(e.birthday)||(n=!(o="birthday must be a number"));break;case"location":te(e.location)||(n=!(o="location must be a string"));break;case"selfSignature":te(e.selfSignature)||(n=!(o="selfSignature must be a string"));break;case"allowType":yn(Ae,e.allowType)||(o="key:allowType, invalid value:"+e.allowType,n=!1);break;case"language":fe(e.language)||(n=!(o="language must be a number"));break;case"avatar":te(e.avatar)||(n=!(o="avatar must be a string"));break;case"messageSettings":e.messageSettings!==0&&e.messageSettings!==1&&(n=!(o="messageSettings must be 0 or 1"));break;case"adminForbidType":yn(me,e.adminForbidType)||(o="key:adminForbidType, invalid value:"+e.adminForbidType,n=!1);break;case"level":fe(e.level)||(n=!(o="level must be a number"));break;case"role":fe(e.role)||(n=!(o="role must be a number"));break;default:o="unknown key:"+t+"  "+e[t],n=!1}}return{valid:n,tips:o}}}]),Pi),bc=R(function e(t){D(this,e),this.value=t,this.next=null}),gi=(R(Gi,[{key:"set",value:function(e){var t,n=new bc(e);this.map.size<this.MAX_LENGTH?this.pTail===null?(this.pTail=n,this.pNodeToDel=n):(this.pTail.next=n,this.pTail=n):(t=this.pNodeToDel,this.pNodeToDel=this.pNodeToDel.next,this.map.delete(t.value),t.next=null,t=null,this.pTail.next=n,this.pTail=n),this.map.set(e,1)}},{key:"has",value:function(e){return this.map.has(e)}},{key:"delete",value:function(e){this.has(e)&&this.map.delete(e)}},{key:"tail",value:function(){return this.pTail}},{key:"size",value:function(){return this.map.size}},{key:"data",value:function(){return Array.from(this.map.keys())}},{key:"reset",value:function(){for(var e;this.pNodeToDel!==null;)e=this.pNodeToDel,this.pNodeToDel=this.pNodeToDel.next,e.next=null,e=null;this.pTail=null,this.map.clear()}}]),Gi),wc=["groupID","name","avatar","type","introduction","notification","ownerID","selfInfo","createTime","infoSequence","lastInfoTime","lastMessage","nextMessageSeq","memberNum","maxMemberNum","memberList","joinOption","groupCustomField","muteAllMembers","isSupportTopic","inviteOption","_lastRevokedTime"],Xt=(R(Oi,[{key:"memberNum",get:function(){return this.memberCount},set:function(e){}},{key:"maxMemberNum",get:function(){return this.maxMemberCount},set:function(e){}},{key:"_initGroup",value:function(e){for(var t in e)wc.indexOf(t)<0||(t!=="selfInfo"?(t==="memberNum"&&(this.memberCount=e[t]),t==="maxMemberNum"&&(this.maxMemberCount=e[t]),t!=="isSupportTopic"?this[t]=e[t]:this.isSupportTopic=e[t]===1):this.updateSelfInfo(e[t]))}},{key:"updateGroup",value:function(n){var t=this,n=(n.appid=void 0,n.grossTopicNextMsgSeq=void 0,n.selfInfo&&(n.selfInfo.grossTopicReadSeq=void 0),JSON.parse(JSON.stringify(n)));n.lastMsgTime&&(this.lastMessage.lastTime=n.lastMsgTime),C(n.muteAllMembers)||(n.muteAllMembers==="On"?n.muteAllMembers=!0:n.muteAllMembers=!1),n.groupCustomField&&Bn(this.groupCustomField,n.groupCustomField),C(n.memberNum)||(this.memberCount=n.memberNum),C(n.maxMemberNum)||(this.maxMemberCount=n.maxMemberNum),C(n.isSupportTopic)||(this.isSupportTopic=fe(n.isSupportTopic)?n.isSupportTopic===1:n.isSupportTopic),bt(this,n,["members","errorCode","lastMsgTime","groupCustomField","memberNum","maxMemberNum","isSupportTopic"]),F(n.members)&&0<n.members.length&&n.members.forEach(function(o){o.userID===t.selfInfo.userID&&bt(t.selfInfo,o,["sequence"])})}},{key:"updateSelfInfo",value:function(e){e={nameCard:e.nameCard,joinTime:e.joinTime,role:e.role,messageRemindType:e.messageRemindType,readedSequence:e.readedSequence,excludedUnreadSequenceList:e.excludedUnreadSequenceList},bt(this.selfInfo,l({},e),[],["",null,void 0,0,NaN])}},{key:"setSelfNameCard",value:function(e){this.selfInfo.nameCard=e}}]),Oi),cs=(R(Ni,[{key:"toAccount",get:function(){return this.conversationID.startsWith(_.CONV_C2C)?this.conversationID.replace(_.CONV_C2C,""):this.conversationID.startsWith(_.CONV_GROUP)?this.conversationID.replace(_.CONV_GROUP,""):""}},{key:"_initProfile",value:function(e){var t=this;Object.keys(e).forEach(function(n){switch(n){case"userProfile":t.userProfile=e.userProfile;break;case"groupProfile":t.groupProfile=e.groupProfile}}),C(this.userProfile)&&this.type===_.CONV_C2C?this.userProfile=new Qn({userID:e.conversationID.replace("C2C","")}):C(this.groupProfile)&&this.type===_.CONV_GROUP&&(this.groupProfile=new Xt({groupID:e.conversationID.replace("GROUP","")}))}},{key:"updateUnreadCount",value:function(o){var t=o.nextUnreadCount,n=o.isFromGetConversations,o=o.isUnreadC2CMessage;C(t)||(st(this.subType)?this.unreadCount=0:n&&this.type===_.CONV_GROUP||n&&this.type===_.CONV_TOPIC||o&&this.type===_.CONV_C2C?this.unreadCount=t:this.unreadCount=this.unreadCount+t)}},{key:"updateLastMessage",value:function(e){this.lastMessage=ur(e)}},{key:"updateGroupAtInfoList",value:function(e){var t;this._isNeedMergeGroupAtInfo(e)||((t=(Qe(t=e.groupAtType)||He(t)||ut(t)||ft()).slice(0)).indexOf(_.CONV_AT_ME)!==-1&&t.indexOf(_.CONV_AT_ALL)!==-1&&(t=[_.CONV_AT_ALL_AT_ME]),t={from:e.from,groupID:e.groupID,topicID:e.topicID,messageSequence:e.sequence,atTypeArray:t,__random:e.__random,__sequence:e.__sequence},this.groupAtInfoList.push(t))}},{key:"_isNeedMergeGroupAtInfo",value:function(e){var t=e.groupID,n=e.sequence;if(!lt({groupID:t}))return!1;var o=!1;return this.groupAtInfoList.forEach(function(s){s.messageSequence===n&&(-1<s.atTypeArray.indexOf(_.CONV_AT_ME)&&-1<e.groupAtType.indexOf(_.CONV_AT_ALL)&&(s.atTypeArray=[_.CONV_AT_ALL_AT_ME]),-1<s.atTypeArray.indexOf(_.CONV_AT_ALL)&&-1<e.groupAtType.indexOf(_.CONV_AT_ME)&&(s.atTypeArray=[_.CONV_AT_ALL_AT_ME],s.__random=e.__random,s.__sequence=e.__sequence),o=!0)}),o}},{key:"clearGroupAtInfoList",value:function(){this.groupAtInfoList.length=0}},{key:"reduceUnreadCount",value:function(){return 1<=this.unreadCount&&(--this.unreadCount,!0)}},{key:"isLastMessageRevoked",value:function(n){var t=n.sequence,n=n.time;return this.type===_.CONV_C2C&&t===this.lastMessage.lastSequence&&n===this.lastMessage.lastTime||this.type===_.CONV_GROUP&&t===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}},{key:"setDraftText",value:function(e){this.draftText=e}}]),Ni),fr=(H(le={},_.MSG_REMIND_ACPT_AND_NOTE,0),H(le,_.MSG_REMIND_DISCARD,1),H(le,_.MSG_REMIND_ACPT_NOT_NOTE,2),le),Fc=(R(Ri,[{key:"onAllReceiveMessageOptNotify",value:function(e){e=this._handleResult(e),this._convM.emitOuterEvent(V.ALL_RECEIVE_MESSAGE_OPT_UPDATED,e)}},{key:"getC2CMessageRemindType",value:function(e){var t=this,n="".concat(this._n,".getC2CMessageRemindType");return this._convM.req({proto:g.GET_C2C_PEER_MUTE_NOTIFICATIONS,data:{toAccount:this._convM.getMyUserID(),userIDList:e}}).then(function(o){u.l("".concat(n," ok. userIDList:").concat(e)),o=o.data.muteFlagList,t._convM.onC2CMessageRemindTypeFetched(o)}).catch(function(o){u.e("".concat(n," failed. error:"),o)})}},{key:"set",value:function(e){return e.groupID?this._setGroupMessageRemindType(e):F(e.userIDList)?this._setC2CMessageRemindType(e):void 0}},{key:"_setGroupMessageRemindType",value:function(e){var t=this,n="".concat(this._n,"._setGroupMessageRemindType"),o=e.groupID,s=e.messageRemindType,i="groupID:".concat(o," messageRemindType:").concat(s),a=new S("setMessageRemindType"),r=(a.setMessage(i),this._get(7));return r?r.modifyGroupMemberInfo({groupID:o,messageRemindType:s,userID:this._convM.getMyUserID()}).then(function(){a.end(),u.l("".concat(n," ok. ").concat(i));var c=t.onGroupMessageRemindTypeUpdated(e);return t._convM.emitTotalUnreadMessageCountUpdate(),q(c)}).catch(function(c){return a.setError(c).end(),u.e("".concat(n," failed. error:"),c),v(c)}):v({code:M.CANNOT_FIND_MODULE})}},{key:"onGroupMessageRemindTypeUpdated",value:function(s){var t,n,o=s.groupID,s=s.messageRemindType,i=(u.l("".concat(this._n,".onGroupMessageRemindTypeUpdated groupID:").concat(o," messageRemindType:").concat(s)),this._get(7).getLocalGroupProfile(o));return i&&(i.selfInfo.messageRemindType=s),Ve(o)?(t=Be(n=o),(n=this._get(10).getLocalTopic(t,n))&&(n.updateSelfInfo({messageRemindType:s}),this._convM.emitOuterEvent(V.TOPIC_UPDATED,{groupID:t,topic:n})),{topic:n}):(this._convM.patchMessageRemindType({ID:o,isC2CConversation:!1,messageRemindType:s})&&this._emitConversationUpdate(),{group:i})}},{key:"_setC2CMessageRemindType",value:function(a){var t=this,n="".concat(this._n,"._setC2CMessageRemindType"),o=a.userIDList,s=a.messageRemindType,i=o.slice(0,30),a=fr[s]||0,r="userIDList:".concat(i," messageRemindType:").concat(s),c=new S("setMessageRemindType");return c.setMessage(r),this._convM.req({proto:g.SET_C2C_PEER_MUTE_NOTIFICATIONS,data:{userIDList:i,muteFlag:a}}).then(function(m){c.end();var m=m.data.errorList,p=[],h=[],m=(F(m)&&m.forEach(function(I){p.push(I.userID),h.push({userID:I.userID,code:I.errorCode})}),i.filter(function(I){return p.indexOf(I)===-1})),f=(u.l("".concat(n," ok. ").concat(r," successUserIDList:").concat(m," failureUserIDList:").concat(JSON.stringify(h))),0);return m.forEach(function(I){t._convM.patchMessageRemindType({ID:I,isC2CConversation:!0,messageRemindType:s})&&(f+=1)}),1<=f&&t._emitConversationUpdate(),i.length=p.length=0,t._convM.emitTotalUnreadMessageCountUpdate(),Q({successUserIDList:m.map(function(I){return{userID:I}}),failureUserIDList:h})}).catch(function(d){return c.setError(d).end(),u.e("".concat(n," failed. error:"),d),v(d)})}},{key:"_get",value:function(e){return this._convM.get(e)}},{key:"_emitConversationUpdate",value:function(){this._convM.emitConversationUpdate(!0,!1)}},{key:"setAllReceiveMessageOpt",value:function(a){var t="".concat(this._n,".").concat("setAllReceiveMessageOpt"),n=a.messageRemindType,n=n===void 0?_.MSG_REMIND_ACPT_NOT_NOTE:n,o=a.isRepeated,o=o===void 0||o,i=this._calcStartAndEndTime(a),s=i.startTime,s=s===void 0?0:s,i=i.endTime,i=i===void 0?0:i,a=JSON.stringify(a),r=new S("setAllReceiveMessageOpt");return r.setMessage(a),u.l("".concat(t," options:").concat(a)),this._convM.req({proto:g.SET_ALL_RECEIVE_MSG_OPT,data:{messageRemindType:fr[n],startTime:s,endTime:i,isRepeated:o?1:0}}).then(function(c){return r.end(),u.l("".concat(t," ok.")),q(c)}).catch(function(c){return r.setError(c).end(),u.e("".concat(t," failed. error:"),c),v(c)})}},{key:"_calcStartAndEndTime",value:function(i){var t=i.startHour,t=t===void 0?0:t,n=i.startMinute,n=n===void 0?0:n,o=i.startSecond,o=o===void 0?0:o,s=i.duration,s=s===void 0?0:s,i=i.isRepeated,i=i===void 0||i,r=new Date,c=r.getFullYear(),a=r.getMonth(),r=r.getDate(),c=Math.round(new Date(c,a,r,t,n,o).getTime()/1e3);return{startTime:c,endTime:i&&86400<=s?c+86400:c+s}}},{key:"getAllReceiveMessageOpt",value:function(){var e=this,t="".concat(this._n,".").concat("getAllReceiveMessageOpt"),n=new S("getAllReceiveMessageOpt");return this._convM.req({proto:g.GET_ALL_RECEIVE_MSG_OPT,data:{toAccount:this._convM.getMyUserID()}}).then(function(o){return o=o.data,n.setMessage(JSON.stringify(o)).end(),u.l("".concat(t," ok. data:").concat(JSON.stringify(o))),o=e._handleResult(o),q(o)}).catch(function(o){return n.setError(o).end(),u.e("".concat(t," failed. error:"),o),v(o)})}},{key:"_handleResult",value:function(s){var t=s.messageRemindType,n=s.startTime,o=s.endTime,s=s.isRepeated,i=_.MSG_REMIND_ACPT_AND_NOTE;return t===1&&(i=_.MSG_REMIND_DISCARD),{messageRemindType:i=t===2?_.MSG_REMIND_ACPT_NOT_NOTE:i,startTime:n,endTime:o,isRepeated:s===1}}},{key:"reset",value:function(){u.l("".concat(this._n,".reset"))}}]),Ri),qc=(R(ki,[{key:"setConvCustomData",value:function(e){var t=this,n="".concat(this._n,".").concat("setConvCustomData"),o=e.conversationIDList,s=e.customData,i=(u.l("".concat(n," options:"),e),new S("setConvCustomData")),a=(i.setMessage(JSON.stringify(e)),{fromAccount:this._getMyUserID(),itemList:[]}),r=[],c=[];return o.forEach(function(d){if(!t._hasLocalConversation(d))return t._onConversationNotFound(c,d),!0;if(!dt(d)&&!at(d))return t._onConversationIDInvalid(c,d),!0;var p={operationType:2,contactItem:void 0,customMark:s};dt(d)?p.contactItem={type:1,toAccount:d.replace(_.CONV_C2C,"")}:at(d)&&(p.contactItem={type:2,groupID:d.replace(_.CONV_GROUP,"")}),a.itemList.push(p)}),c.length===o.length?Q({successConversationIDList:r,failureConversationIDList:c}):this._convM.req({proto:g.SET_CONV_CUSTOM_DATA,data:a}).then(function(f){i.end(),u.l("".concat(n," ok"));var p,h,m,f=f.data.resultItem;return F(f)&&(m=!1,f.forEach(function(I){p=t._concatConversationID(I.contactItem),I.resultCode===0?(r.push(p),(h=t._getLocalConversation(p))&&h.customData!==s&&(h.customData=s,m=!0)):c.push({conversationID:p,code:I.resultCode,message:I.resultInfo})}),m===!0&&t._emitConversationUpdate()),q({successConversationIDList:r,failureConversationIDList:c})}).catch(function(d){return i.setError(d).end(),u.e("".concat(n," failed. error:"),d),v(d)})}},{key:"markConversation",value:function(d){var t=this;if(!this._convM.canIUse(de.CONV_MARK))return this._convM.cannotUseCommercialAbility("markConversation");var n="".concat(this._n,".").concat("markConversation"),o=d.conversationIDList,s=d.markType,i=d.enableMark,a=(u.l("".concat(n," options:"),d),new S("markConversation")),r=(a.setMessage(JSON.stringify(d)),void 0),c=void 0,d=this._getFlagBit(s),p=(i===!0?c=[d]:r=[d],{fromAccount:this._getMyUserID(),itemList:[]}),h=[],m=[];return o.forEach(function(f){if(!t._hasLocalConversation(f))return t._onConversationNotFound(m,f),!0;if(!dt(f)&&!at(f))return t._onConversationIDInvalid(m,f),!0;var I={operationType:1,contactItem:void 0,clearMark:r,setMark:c};dt(f)?I.contactItem={type:1,toAccount:f.replace(_.CONV_C2C,"")}:at(f)&&(I.contactItem={type:2,groupID:f.replace(_.CONV_GROUP,"")}),p.itemList.push(I)}),m.length===o.length?Q({successConversationIDList:h,failureConversationIDList:m}):this._convM.req({proto:g.MARK_CONV,data:p}).then(function(x){a.end(),u.l("".concat(n," ok"));var I,k,N,x=x.data.resultItem;return F(x)&&(N=!1,x.forEach(function(Y){var ie;I=t._concatConversationID(Y.contactItem),Y.resultCode===0?(h.push(I),(k=t._getLocalConversation(I))&&(ie=k.markList.indexOf(s),i===!0?ie===-1&&(k.markList.push(s),N=!0):ie!==-1&&(k.markList.splice(ie,1),N=!0))):m.push({conversationID:I,code:Y.resultCode,message:Y.resultInfo})}),N===!0&&t._emitConversationUpdate()),q({successConversationIDList:h,failureConversationIDList:m})}).catch(function(f){return a.setError(f).end(),u.e("".concat(n," failed. error:"),f),v(f)})}},{key:"getLocalConvGroupList",value:function(){var e=this;return u.l("".concat(this._n,".getLocalConvGroupList pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===Dn?this.getRemoteConvGroupList().then(function(){return q(b(e._convGroupMap.values()))}):Q(b(this._convGroupMap.values()))}},{key:"searchConvGroupAndMark",value:function(e,t){var n=this,o="".concat(this._n,".searchConvGroupAndMark"),s=[];return e.forEach(function(i){t===1?s.push({type:1,toAccount:i}):t===2&&s.push({type:2,groupID:i})}),u.l("".concat(o," type:").concat(t," list:"),e),this._convM.req({proto:g.SEARCH_CONV_GRP_MARK,data:{fromAccount:this._getMyUserID(),contactItem:s}}).then(function(r){var r=r.data,a=r.contactItem,r=r.groupItem;u.l("".concat(o," ok. contactItem:"),a,"groupItem:",r),n._fillConvGroupMap(r),n._handleContactItem(a),n._emitConversationUpdate()}).catch(function(i){u.w("".concat(o," failed. error:"),i)})}},{key:"_fillConvGroupMap",value:function(e){var t=this;F(e)&&e.forEach(function(s){var o=s.convGroupID,s=s.groupName;t._convGroupMap.set(o,s)})}},{key:"_handleContactItem",value:function(e){var t,n=this;F(e)&&e.forEach(function(o){var s=[],i=o.standardMark,a=o.customData,r=o.convGroupIDList;F(r)&&r.forEach(function(c){n._convGroupMap.has(c)&&s.push(n._convGroupMap.get(c))}),t=n._concatConversationID(o),(t=n._getLocalConversation(t))&&(t.markList=Zo(i),t.customData=a||"",t.conversationGroupList=[].concat(s))})}},{key:"getRemoteConvGroupList",value:function(){var e=this,t="".concat(this._n,".getRemoteConvGroupList");return this._pagingStatus=nr,this._convM.req({proto:g.GET_CONV_GRP_LIST,data:{fromAccount:this._getMyUserID(),startIndex:this._startIndex}}).then(function(a){var a=a.data,o=a.completeFlag,s=a.contactItem,i=a.nextStartIndex,i=i===void 0?0:i,a=a.groupItem;if(e._startIndex=i,u.l("".concat(t," completeFlag:").concat(o," nextStartIndex:").concat(i,", groupItem:"),a,"contactItem:",s),e._fillConvGroupMap(a),e._handleContactItem(s),o===0)return e.getRemoteConvGroupList();o===1&&(e._pagingStatus=jn,e._emitConversationUpdate(),e._emitConvGroupListUpdate())}).catch(function(n){e._pagingStatus=Dn,u.w("".concat(t," failed. error:"),n)})}},{key:"createConvGroup",value:function(e){var t=this,i="createConversationGroup";if(!this._convM.canIUse(de.CONV_GROUP))return this._convM.cannotUseCommercialAbility(i);var n="".concat(this._n,".").concat(i),o=(u.l("".concat(n," options:"),e),new S(i)),s=(o.setMessage(JSON.stringify(e)),e.groupName),i=e.conversationIDList,a={fromAccount:this._getMyUserID(),itemList:[{groupName:s,contactItem:[]}]},r=[],c=[];return i.forEach(function(d){return t._hasLocalConversation(d)?dt(d)||at(d)?void(dt(d)?a.itemList[0].contactItem.push({type:1,toAccount:d.replace(_.CONV_C2C,"")}):at(d)&&a.itemList[0].contactItem.push({type:2,groupID:d.replace(_.CONV_GROUP,"")})):(t._onConversationIDInvalid(c,d),!0):(t._onConversationNotFound(c,d),!0)}),c.length===i.length?Q({successConversationIDList:r,failureConversationIDList:c}):this._convM.req({proto:g.CREATE_CONV_GRP,data:a}).then(function(I){o.end(),u.l("".concat(n," ok"));var p,h,m,I=I.data.groupResultItem[0],f=I.groupItem,I=I.resultItem;return Ce(f)&&(t._convGroupMap.set(f.convGroupID,f.groupName),t._emitConvGroupListUpdate()),F(I)&&(m=!1,I.forEach(function(k){p=t._concatConversationID(k.contactItem),k.resultCode===0?(r.push(p),(h=t._getLocalConversation(p))&&h.conversationGroupList.indexOf(s)===-1&&(h.conversationGroupList.push(s),m=!0)):c.push({conversationID:p,code:k.resultCode,message:k.resultInfo})}),m===!0&&(t._emitConversationUpdate(),t._emitConvGroupListUpdate())),q({successConversationIDList:r,failureConversationIDList:c})}).catch(function(d){return o.setError(d).end(),u.e("".concat(n," failed. error:"),d),v(d)})}},{key:"deleteConvGroup",value:function(e){var t=this,n="deleteConversationGroup";if(!this._convM.canIUse(de.CONV_GROUP))return this._convM.cannotUseCommercialAbility(n);var o="".concat(this._n,".").concat(n),s=(u.l("".concat(o," groupName:").concat(e)),new S(n));return s.setMessage(e),this._convM.req({proto:g.DEL_CONV_GRP,data:{fromAccount:this._getMyUserID(),groupName:[e]}}).then(function(r){s.end(),u.l("".concat(o," ok"));var a,r=r.data.groupItem;F(r)&&(a=!1,r.forEach(function(c){t._convGroupMap.has(c.convGroupID)&&(t._convGroupMap.delete(c.convGroupID),a=!0)}),a===!0&&t._emitConvGroupListUpdate()),t._eraseFromConversationGroupList([e])}).catch(function(i){return s.setError(i).end(),u.e("".concat(o," failed. error:"),i),v(i)})}},{key:"renameConvGroup",value:function(e){var t=this,n="renameConversationGroup";if(!this._convM.canIUse(de.CONV_GROUP))return this._convM.cannotUseCommercialAbility(n);var o="".concat(this._n,".").concat(n),s=(u.l("".concat(o," options:"),e),new S(n)),i=(s.setMessage(JSON.stringify(e)),e.oldName),a=e.newName;return this._convM.req({proto:g.RENAME_CONV_GRP,data:{fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:1,oldName:i,newName:a}}}).then(function(p){s.end(),u.l("".concat(o," ok")),p=p.data.updateGroupResult.convGroupID,t._convGroupMap.set(p,a),t._emitConvGroupListUpdate();var c,d,p=t._convM.getLocalConversationList(),h=!1;p.forEach(function(m){c=m.conversationGroupList,(d=c.indexOf(i))!==-1&&(c.splice(d,1,a),h=!0)}),h===!0&&t._emitConversationUpdate()}).catch(function(r){return s.setError(r).end(),u.e("".concat(o," failed. error:"),r),v(r)})}},{key:"addConvsToGroup",value:function(e){var t=this,s="addConversationsToGroup";if(!this._convM.canIUse(de.CONV_GROUP))return this._convM.cannotUseCommercialAbility(s);var n="".concat(this._n,".").concat(s),o=(u.l("".concat(n," options:"),e),new S(s)),s=(o.setMessage(JSON.stringify(e)),e.conversationIDList),i=e.groupName,a={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:i,updateItem:[]}},r=[],c=[];return s.forEach(function(d){return t._hasLocalConversation(d)?dt(d)||at(d)?void(dt(d)?a.updateGroup.updateItem.push({operationType:1,contactItem:{type:1,toAccount:d.replace(_.CONV_C2C,"")}}):at(d)&&a.updateGroup.updateItem.push({operationType:1,contactItem:{type:2,groupID:d.replace(_.CONV_GROUP,"")}})):(t._onConversationIDInvalid(c,d),!0):(t._onConversationNotFound(c,d),!0)}),c.length===s.length?Q({successConversationIDList:r,failureConversationIDList:c}):this._convM.req({proto:g.ADD_CONV_TO_GRP,data:a}).then(function(f){o.end(),u.l("".concat(n," ok"));var p,h,m,f=f.data.updateGroupResult.contactResultItem;return F(f)&&(m=!1,f.forEach(function(I){p=t._concatConversationID(I.contactItem),I.resultCode===0?(h=t._getLocalConversation(p))&&h.conversationGroupList.indexOf(i)===-1&&(h.conversationGroupList.push(i),r.push(p),m=!0):c.push({conversationID:p,code:I.resultCode,message:I.resultInfo})}),m===!0&&(t._emitConversationUpdate(),t._emitConvInGroupUpdate(i))),q({successConversationIDList:r,failureConversationIDList:c})}).catch(function(d){return o.setError(d).end(),u.e("".concat(n," failed. error:"),d),v(d)})}},{key:"deleteConvsFromGroup",value:function(e){var t=this,s="deleteConversationsFromGroup";if(!this._convM.canIUse(de.CONV_GROUP))return this._convM.cannotUseCommercialAbility(s);var n="".concat(this._n,".").concat(s),o=(u.l("".concat(n," options:"),e),new S(s)),s=(o.setMessage(JSON.stringify(e)),e.conversationIDList),i=e.groupName,a={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:i,updateItem:[]}},r=[],c=[];return s.forEach(function(d){return t._hasLocalConversation(d)?dt(d)||at(d)?void(dt(d)?a.updateGroup.updateItem.push({operationType:2,contactItem:{type:1,toAccount:d.replace(_.CONV_C2C,"")}}):at(d)&&a.updateGroup.updateItem.push({operationType:2,contactItem:{type:2,groupID:d.replace(_.CONV_GROUP,"")}})):(t._onConversationIDInvalid(c,d),!0):(t._onConversationNotFound(c,d),!0)}),c.length===s.length?Q({successConversationIDList:r,failureConversationIDList:c}):this._convM.req({proto:g.DEL_CONV_FROM_GRP,data:a}).then(function(f){o.end(),u.l("".concat(n," ok"));var p,h,m,f=f.data.updateGroupResult.contactResultItem;return F(f)&&(m=!1,f.forEach(function(I){var k;p=t._concatConversationID(I.contactItem),I.resultCode===0?!(h=t._getLocalConversation(p))||(k=h.conversationGroupList.indexOf(i))!==-1&&(h.conversationGroupList.splice(k,1),r.push(p),m=!0):c.push({conversationID:p,code:I.resultCode,message:I.resultInfo})}),m===!0&&(t._emitConversationUpdate(),t._emitConvInGroupUpdate(i))),q({successConversationIDList:r,failureConversationIDList:c})}).catch(function(d){return o.setError(d).end(),u.e("".concat(n," failed. error:"),d),v(d)})}},{key:"onConvMarkUpdated",value:function(e){var t,n,o=this;G(e)||(u.l("".concat(this._n,".onConvMarkUpdated markItemList:"),e),n=!1,e.forEach(function(c){var i=c.recentContactItem,a=c.optType,r=c.standardMark,c=c.customMark;t=o._concatConversationID(i),(t=o._getLocalConversation(t))&&(a===1?n=o._diffStandardMark(t,r):a===2?n=o._diffCustomMark(t,c):a===3&&(n=o._diffStandardMark(t,r)||o._diffCustomMark(t,c)))}),n===!0&&this._emitConversationUpdate())}},{key:"_diffStandardMark",value:function(e,n){var n=Zo(n),o=!1;return function(s,i){if(s===i)return!0;if(!s||!i||s.length!==i.length)return!1;for(var a=0,r=s.length;a<r;a++)if(s[a]!==i[a])return!1;return!0}(e.markList,n)!==!0&&(e.markList=n,o=!0),o}},{key:"_diffCustomMark",value:function(e,t){var n=!1;return e.customData!==t&&t!==void 0&&(e.customData=t,n=!0),n}},{key:"onConvGroupCreated",value:function(e){var t=this,n=(u.l("".concat(this._n,".onConvGroupCreated resultList:"),e),!1),o=!1;F(e)&&(e.forEach(function(s){var c=s.msgGroupItem,i=c.groupID,a=c.groupName;t._convGroupMap.get(i)!==a&&(t._convGroupMap.set(i,a),o=!0);var r,c=s.msgRecentContactItem;F(c)&&c.forEach(function(d){r=t._concatConversationID(d),(r=t._getLocalConversation(r))&&r.conversationGroupList.indexOf(a)===-1&&(r.conversationGroupList.push(a),n=!0)})}),n===!0&&this._emitConversationUpdate(),o===!0&&this._emitConvGroupListUpdate())}},{key:"onConvGroupDeleted",value:function(e){var t,n=this,o=(u.l("".concat(this._n,".onConvGroupDeleted groupItemList:"),e),[]);F(e)&&(t=!1,e.forEach(function(a){var i=a.groupID,a=a.groupName;n._convGroupMap.has(i)&&(n._convGroupMap.delete(i),t=!0,o.push(a))}),t===!0&&this._emitConvGroupListUpdate()),this._eraseFromConversationGroupList(o)}},{key:"_eraseFromConversationGroupList",value:function(e){G(e)||(this._convM.getLocalConversationList().forEach(function(t){t.conversationGroupList=t.conversationGroupList.filter(function(n){return!e.includes(n)})}),this._emitConversationUpdate())}},{key:"onConvGroupNameUpdated",value:function(e){u.l("".concat(this._n,".onConvGroupNameUpdated options:"),e);var t,n,o,s=e.groupID,i=e.groupName,a=e.oldGroupName;this._convGroupMap.get(s)!==i&&(this._convGroupMap.set(s,i),this._emitConvGroupListUpdate(),e=this._convM.getLocalConversationList(),o=!1,e.forEach(function(r){t=r.conversationGroupList,(n=t.indexOf(a))!==-1&&(t.splice(n,1,i),o=!0)}),o===!0&&this._emitConversationUpdate())}},{key:"onConvInGroupUpdated",value:function(a){var t,n,o,s=this,i=(u.l("".concat(this._n,".onConvInGroupUpdated options:"),a),a.oldGroupName),a=a.recentContactUpdateGroupItem;F(a)&&(o=!1,a.forEach(function(d){var c=d.contactOptType,d=d.recentContactItem;t=s._concatConversationID(d),(t=s._getLocalConversation(t))&&(n=t.conversationGroupList.indexOf(i),c===1?n===-1&&(t.conversationGroupList.push(i),o=!0):c===2&&n!==-1&&(t.conversationGroupList.splice(n,1),o=!0))}),o===!0&&(this._emitConversationUpdate(),this._emitConvInGroupUpdate(i)))}},{key:"onConvAddedToOrDeletedFromGroup",value:function(s){var t,n,o=this,i=(u.l("".concat(this._n,".onConvAddedToOrDeletedFromGroup options:"),s),s.msgRecentContactItem),s=s.msgRecentContactUpdateContactItem,i=this._concatConversationID(i),a=this._getLocalConversation(i);a&&F(s)&&(n=!1,s.forEach(function(d){var c=d.groupOptType,d=d.recentContactGroupItem.groupName;t=a.conversationGroupList.indexOf(d),c===1?t===-1&&(a.conversationGroupList.push(d),n=!0):c===2&&t!==-1&&(a.conversationGroupList.splice(t,1),n=!0),n===!0&&o._emitConvInGroupUpdate(d)}),n===!0&&this._emitConversationUpdate())}},{key:"onConvGroupListSynced",value:function(e){F(e)&&e.length!==0&&(u.l("".concat(this._n,".onConvGroupListSynced groupItem:"),e),this._fillConvGroupMap(e))}},{key:"getConvGroupListByID",value:function(e){var t,n=this;if(!G(e))return t=[],e.forEach(function(o){n._convGroupMap.has(o)&&t.push(n._convGroupMap.get(o))}),t}},{key:"_onConversationNotFound",value:function(e,t){e.push({conversationID:t,code:M.CONV_NOT_FOUND,message:this._convM.getErrorMessage(M.CONV_NOT_FOUND)})}},{key:"_onConversationIDInvalid",value:function(e,t){e.push({conversationID:t,code:M.INVALID_CONV_ID,message:this._convM.getErrorMessage(M.INVALID_CONV_ID)})}},{key:"_getFlagBit",value:function(e){for(var t=e.toString(2),n=t.length,o=n-1;0<=o;o--)if(t[o]==="1")return n-o-1}},{key:"_concatConversationID",value:function(i){var t,n=i.type,o=i.to,s=i.groupID,i=i.userID;return n===1?C(i)?C(o)||(t="".concat(_.CONV_C2C).concat(o)):t="".concat(_.CONV_C2C).concat(i):n===2&&(t="".concat(_.CONV_GROUP).concat(s)),t}},{key:"_getMyUserID",value:function(){return this._convM.getMyUserID()}},{key:"_getLocalConversation",value:function(e){return this._convM.getLocalConversation(e)}},{key:"_hasLocalConversation",value:function(e){return this._convM.hasLocalConversation(e)}},{key:"_emitConversationUpdate",value:function(){this._convM.emitConversationUpdate(!0,!1)}},{key:"_emitConvGroupListUpdate",value:function(){this._convM.emitOuterEvent(V.CONVERSATION_GROUP_LIST_UPDATED,b(this._convGroupMap.values()))}},{key:"_emitConvInGroupUpdate",value:function(e){var t={groupName:e,conversationList:[]},n=this._convM.getLocalConversationList();t.conversationList=n.filter(function(o){return o.conversationGroupList.includes(e)}),this._convM.emitOuterEvent(V.CONVERSATION_IN_GROUP_UPDATED,t)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._convGroupMap.clear(),this._startIndex=0,this._pagingStatus=zt}}]),ki),xc=(z(oo,Oe),hr=X(oo),R(oo,[{key:"_initListeners",value:function(){var e=this.getInnerEmitterInstance();e.on(Re.A2KEY_AND_TINYID_UPDATED,this._init,this),e.on(Re.PROFILE_UPDATED,this._onProfileUpdated,this)}},{key:"onCheckTimer",value:function(e){e%60==0&&this._messageListHandler.traversal()}},{key:"_init",value:function(){var e=this,t=(u.l("".concat(this._n,"._init")),this.get(13).getItem("conversationMap")),n=this.isIntl(),o=this.isUsingChatCore();if(t){for(var s=t.length,i=0;i<s;i++){var a=t[i];if(a){if(this._isNonExistentAccount(a.conversationID))continue;if(a.groupProfile){var r=a.groupProfile.type;if(st(r))continue}}this._conversationMap.set(a.conversationID,new cs(t[i],n,o))}this.emitConversationUpdate(!0,!1)}this.ready(function(){0<e._tmpGroupList.length&&(e.updateConversationGroupProfile(e._tmpGroupList),e._tmpGroupList.length=0)}),this.syncConversationList()}},{key:"_isNonExistentAccount",value:function(e){var t;return(t=e.startsWith(_.CONV_C2C)?e.replace(_.CONV_C2C,""):t)==="@TLS#ERROR"||t==="@TLS#NOT_FOUND"}},{key:"onMessageSent",value:function(e){this._onSendOrReceiveMessage({conversationOptionsList:e.conversationOptionsList,isInstantMessage:!0})}},{key:"onNewMessage",value:function(e){this._onSendOrReceiveMessage(e)}},{key:"_onSendOrReceiveMessage",value:function(e){var t=this,n=e.conversationOptionsList,o=e.isInstantMessage,o=o===void 0||o,s=e.isUnreadC2CMessage,s=s!==void 0&&s,i=e.updateUnreadCount,i=i===void 0||i,a=e.isSyncingEnded,a=a!==void 0&&a;this._isReady?n.length!==0?(o===!0&&this._checkNewConversation(n),this._updateLocalConversationList({conversationOptionsList:n,isInstantMessage:o,isUnreadC2CMessage:s,isFromGetConversations:!1,updateUnreadCount:i}),o||(this._convIDFromUnreadDBMap=new Map([].concat(b(this._convIDFromUnreadDBMap),b(n.map(function(r){return[r.conversationID,1]})))),this._diffAndDeleteConversation(),a&&this.emitInnerEvent(Re.C2C_UNREAD_HANDLE_COMPLETED)),0<n.filter(function(r){return!t._isConvNeedShow(r.conversationID)}).length||this.emitConversationUpdate()):a&&this.emitInnerEvent(Re.C2C_UNREAD_HANDLE_COMPLETED):this.ready(function(){t._onSendOrReceiveMessage(e)})}},{key:"updateConversationGroupProfile",value:function(e){var t,n=this;F(e)&&e.length===0||(this._conversationMap.size!==0?(t=!1,e.forEach(function(o){var s="GROUP".concat(o.groupID);n._conversationMap.has(s)&&(t=!0,(s=n._conversationMap.get(s)).groupProfile=JSON.parse(JSON.stringify(o)),s.lastMessage.lastSequence<o.nextMessageSeq&&(s.lastMessage.lastSequence=o.nextMessageSeq-1),s.subType||(s.subType=o.type))}),t&&this.emitConversationUpdate(!0,!1)):this._tmpGroupList=e)}},{key:"_updateConversationUserProfile",value:function(e){var t=this;e.data.forEach(function(n){var o="C2C".concat(n.userID);t._conversationMap.has(o)&&(t._conversationMap.get(o).userProfile=n)}),this.emitConversationUpdate(!0,!1)}},{key:"onMessageRevoked",value:function(e){var t,n,o,s=this;e.length!==0&&(t=null,n=!1,o=[],e.forEach(function(i){(t=s._conversationMap.get(i.conversationID))&&(t.reduceUnreadCount()&&(n=t.type!==_.CONV_TOPIC),t.type===_.CONV_TOPIC?o.push(i):t.isLastMessageRevoked({sequence:i.sequence,time:i.time})&&(t.setLastMessageRevoked(!0),t.setLastMessageRevoker(i.revoker),n=!0))}),this.get(10).onMessageRevoked(o),n&&this.emitConversationUpdate(!0,!1))}},{key:"updateRevokerInfo",value:function(e){for(var t=new Set,n=0;n<e.length;n++){var o=e[n].revoker;t.add(o)}var s=b(t),i=this.get(4);return new Promise(function(a){i.getUserProfile({userIDList:s}).then(function(r){if(r=r.data,!F(r)||r.length===0)return a(e);var c,d={},p=Ee(r);try{for(p.s();!(c=p.n()).done;){var h=c.value,m=h.userID,f=h.nick,I=h.avatar;d[m]={nick:f,avatar:I}}}catch(k){p.e(k)}finally{p.f()}e.forEach(function(k){var N=k.revoker;d[N]&&(k.revokerInfo.nick=d[N].nick||"",k.revokerInfo.avatar=d[N].avatar||"")}),a(e)}).catch(function(){a(e)})})}},{key:"isLastMessageRevoked",value:function(e){var t=!1,n=e.conversationID,o=e.sequence,s=e.time,i=this._conversationMap.get(n);return i&&(t=i.type===_.CONV_TOPIC?this.get(10).isLastMessageRevoked({topicID:n.replace(_.CONV_GROUP,""),sequence:o}):i.isLastMessageRevoked({sequence:o,time:s})),u.l("".concat(this._n,".isLastMessageRevoked options:").concat(JSON.stringify(e)," ret:").concat(t)),t}},{key:"onMessageDeleted",value:function(e){var t=this;if(e.length!==0){var n=null;e.forEach(function(c){(n=t._messageListHandler.getLocalMessage(c.conversationID,c.ID))&&(n.isDeleted=!0),c!==n&&(c.isDeleted=!0)});for(var e=e[0].conversationID,o=this._messageListHandler.getLocalMessageList(e),s={},i=o.length-1;0<=i;i--)if(!o[i].isDeleted){s=o[i];break}var a,r=this._conversationMap.get(e);r&&(a=!1,r.lastMessage.lastSequence===s.sequence&&r.lastMessage.lastTime===s.time||(G(s)&&(s=void 0),r.updateLastMessage(s),r.type!==_.CONV_TOPIC&&(a=!0),u.l("".concat(this._n,".onMessageDeleted. update conversationID:").concat(e," with lastMessage:"),r.lastMessage)),e.startsWith(_.CONV_C2C)&&this.updateUnreadCount(e),a&&this.emitConversationUpdate(!0,!1))}}},{key:"onMessageModified",value:function(e){var t="".concat(this._n,".onMessageModified"),p=e.conversationType,n=e.from,o=e.to,s=e.time,i=e.sequence,a=e.elements,r=e.cloudCustomData,c=e.messageVersion,h=this.getMyUserID(),d="".concat(p).concat(o),h=(o===h&&p===_.CONV_C2C&&(d="".concat(p).concat(n)),this._messageListHandler.onMessageModified(d,e)),p=h.isUpdated,h=h.message,m=(p===!0&&this.emitOuterEvent(V.MESSAGE_MODIFIED,[h]),this._isTopicConversation(d));return h===null?u.l("".concat(t," message is null! options:").concat(JSON.stringify(e),"}")):u.l("".concat(t," isUpdated:").concat(p," isTopicMessage:").concat(m," from:").concat(n," to:").concat(o," sequence:").concat(h.sequence," time:").concat(h.time)),m?this.get(10).onMessageModified(e):!(p=this._conversationMap.get(d))||(n=p.lastMessage)&&n.lastTime===s&&n.lastSequence===i&&n.version!==c&&(u.l("".concat(t," conversationID:").concat(d," lastMessage updated")),n.type=a[0].type,n.payload=a[0].content,n.messageForShow=Kn(n.type,n.payload,this.isIntl()),n.cloudCustomData=r,n.version=c,this.emitConversationUpdate(!0,!1)),h}},{key:"onNewGroupAtTips",value:function(n){var t=this,n=n.dataList,o=null;n.forEach(function(s){s.groupAtTips?o=s.groupAtTips:s.elements?o=l(l({},s.elements),{},{sync:!0}):s.groupAtType&&(o=l(l({},s),{},{sync:!0})),o.__random=s.random,o.__sequence=s.clientSequence,t._tmpGroupAtTipsList.push(o)}),u.d("".concat(this._n,".onNewGroupAtTips isReady:").concat(this._isReady),this._tmpGroupAtTipsList),this._isReady&&this._handleGroupAtTipsList()}},{key:"_handleGroupAtTipsList",value:function(){var e,t=this;this._tmpGroupAtTipsList.length!==0&&(e=!1,this._tmpGroupAtTipsList.forEach(function(n){var o,s=n.groupID,i=n.from,a=n.topicID,a=a===void 0?void 0:a,r=n.sync,r=r!==void 0&&r;i!==t.getMyUserID()&&(C(a)?(i=t._conversationMap.get("".concat(_.CONV_GROUP).concat(s)))&&(i.updateGroupAtInfoList(n),e=!0):((s=t._conversationMap.get("".concat(_.CONV_GROUP).concat(a)))&&(s.updateGroupAtInfoList(n),i=t.get(10),o=s.groupAtInfoList,i.onConversationProxy({topicID:a,groupAtInfoList:o})),G(s)&&r&&(t.updateTopicConversation([{conversationID:"".concat(_.CONV_GROUP).concat(a),type:_.CONV_TOPIC}]),t._conversationMap.get("".concat(_.CONV_GROUP).concat(a)).updateGroupAtInfoList(n))))}),e&&this.emitConversationUpdate(!0,!1),this._tmpGroupAtTipsList.length=0)}},{key:"_checkNewConversation",value:function(e){var t=this,n=[],o=[];e.forEach(function(s){t._conversationMap.has(s.conversationID)||(s.type===_.CONV_C2C?n.push(s.conversationID.replace(_.CONV_C2C,"")):s.type===_.CONV_GROUP&&o.push(s.conversationID.replace(_.CONV_GROUP,"")))}),0<n.length&&(this._onNewC2CConversation(n),n=null),0<o.length&&(this._onNewGroupConversation(o),o=null)}},{key:"_onNewC2CConversation",value:function(e){this.get(6).getRemotePeerReadTime(e),this._messageRemindHandler.getC2CMessageRemindType(e),this._convGroupHandler.searchConvGroupAndMark(e,1)}},{key:"_onNewGroupConversation",value:function(e){var t=this.get(7);t&&t.getMessageRemindType(e),this._convGroupHandler.searchConvGroupAndMark(e,2)}},{key:"_setStorageConversationList",value:function(){var e=0<arguments.length&&arguments[0]!==void 0&&arguments[0],t=this.getLocalConversationList().filter(function(n){return n.type===_.CONV_C2C||n.type===_.CONV_GROUP&&n.lastMessage.type!==_.MSG_GRP_TIP}).slice(0,20).map(function(n){return{conversationID:n.conversationID,type:n.type,subType:n.subType,lastMessage:n.lastMessage,groupProfile:n.groupProfile,userProfile:n.userProfile}});this.get(13).setItem("conversationMap",t,e)}},{key:"emitConversationUpdate",value:function(){var e=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],t=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],n=this.getLocalConversationList();!t||(t=this.get(7))&&t.updateGroupLastMessage(n),e&&(this.get(12).isPartialUpdatedConvs()?(this._diffConvMap(this._convMapForDiff,this._conversationMap),0<this._partialUpdatedConvMap.size&&(this.emitOuterEvent(V.CONVERSATION_LIST_UPDATED),this.emitTotalUnreadMessageCountUpdate(),this._convMapForDiff.clear(),this._convMapForDiff=Es(this._conversationMap,!0)),this._convMapForDiff.size===0&&(this._convMapForDiff=Es(this._conversationMap,!0))):(this.emitOuterEvent(V.CONVERSATION_LIST_UPDATED),this.emitTotalUnreadMessageCountUpdate()))}},{key:"_diffConvMap",value:function(e,t){var n,o=Ee(e);try{for(o.s();!(n=o.n()).done;){var s=$(n.value,2),i=s[0],a=s[1];t.has(i)&&a===JSON.stringify(t.get(i))||this._partialUpdatedConvMap.set(i,t.get(i))}}catch(r){o.e(r)}finally{o.f()}}},{key:"getPartialUpdatedConvs",value:function(){var e=b(Es(this._partialUpdatedConvMap,!1).values());return this._partialUpdatedConvMap.clear(),e}},{key:"getLocalConversationList",value:function(){var e=this;return b(this._conversationMap.values()).filter(function(t){return e._isConvNeedShow(t.conversationID)})}},{key:"getLocalConversation",value:function(e){return this._conversationMap.get(e)}},{key:"hasLocalConversation",value:function(e){return this._conversationMap.has(e)}},{key:"getLocalOldestMessage",value:function(e){return this._messageListHandler.getLocalOldestMessage(e)}},{key:"syncConversationList",value:function(){var e=this,t=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],n="syncConversationList",o=new S(n);return this._pagingStatus===zt&&this._conversationMap.clear(),this._pagingGetConversationList(t).then(function(s){var i=za(e._pagingGetCostList),a=Ja(e._pagingGetCostList),a=(e._pagingGetCostList.length=0,e._pagingStatus=jn,e._diffAndDeleteConversation(),e.emitConversationUpdate(!0,!1),e._setStorageConversationList(),e._handleC2CPeerReadTime(),e.emitInnerEvent(Re.CONV_SYNC_COMPLETED),"count:".concat(e._conversationMap.size," sum:").concat(a," avg:").concat(i));return u.l("".concat(e._n,".").concat(n,". ").concat(a)),o.setMessage(a).end(),s}).catch(function(s){return e._pagingStatus=Dn,o.setMessage(e._pagingTimeStamp).setError(s).end(),v(s)})}},{key:"_diffAndDeleteConversation",value:function(){var e,t=this;this._isSyncCompleted()&&(e=[],this._conversationMap.forEach(function(n,o){!t._pagingConvIDMap.has(o)&&t._convIDFromUnreadDBMap.has(o)&&(t._conversationMap.delete(o),e.push(o))}),u.l("".concat(this._n,"._diffAndDeleteConversation list:").concat(e)),e=null)}},{key:"_pagingGetConversationList",value:function(){var e=this,t=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],n="".concat(this._n,"._pagingGetConversationList"),o=(u.l("".concat(n," incrementalPullFlag:").concat(t," timeStamp:").concat(this._pagingTimeStamp," startIndex:").concat(this._pagingStartIndex)+" pinnedTimeStamp:".concat(this._pagingPinnedTimeStamp," pinnedStartIndex:").concat(this._pagingPinnedStartIndex)),Date.now());return this._pagingStatus=nr,this.req({proto:g.PAGING_GET_CONV_LIST,data:{fromAccount:this.getMyUserID(),timeStamp:t?this._pagingTimeStamp:0,startIndex:t?this._pagingStartIndex:0,pinnedTimeStamp:t?this._pagingPinnedTimeStamp:0,pinnedStartIndex:t?this._pagingPinnedStartIndex:0,orderType:1}}).then(function(h){var h=h.data,i=h.completeFlag,a=h.conversations,a=a===void 0?[]:a,r=h.timeStamp,c=h.startIndex,d=h.pinnedTimeStamp,p=h.pinnedStartIndex,h=h.groupItem;if(e._pagingGetCostList.push(Ke(o,!1)),u.l("".concat(n," ok. completeFlag:").concat(i," count:").concat(a.length," cost:").concat(Ke(o))),e._convGroupHandler.onConvGroupListSynced(h),0<a.length&&(h=e._getConversationOptions(a),e._pagingConvIDMap=new Map([].concat(b(e._pagingConvIDMap),b(h.map(function(m){return[m.conversationID,1]})))),e._updateLocalConversationList({conversationOptionsList:h,isFromGetConversations:!0,updateUnreadCount:!0}),e.isLoggedIn()&&e.emitConversationUpdate()),!e._isReady){if(!e.isLoggedIn())return Q();e.triggerReady()}return e._pagingTimeStamp=r,e._pagingStartIndex=c,e._pagingPinnedTimeStamp=d,e._pagingPinnedStartIndex=p,i!==1?e._pagingGetConversationList():(e._handleGroupAtTipsList(),e._convGroupHandler.getRemoteConvGroupList(),Q())}).catch(function(s){throw e.isLoggedIn()&&(e._isReady||(u.w("".concat(n," failed. error:"),s),e.triggerReady())),s})}},{key:"_updateLocalConversationList",value:function(o){var t=o.isFromGetConversations,n=Date.now(),o=this._getTmpConversationListMapping(o);this._conversationMap=new Map(this._sortConversationList([].concat(b(o.toBeUpdatedConversationList),b(this._conversationMap)))),t||this._updateUserOrGroupProfile(o.newConversationList),u.l("".concat(this._n,"._updateLocalConversationList cost:").concat(Ke(n)))}},{key:"_getTmpConversationListMapping",value:function(e){for(var t=e.conversationOptionsList,n=e.isFromGetConversations,o=e.isInstantMessage,s=e.isUnreadC2CMessage,i=s!==void 0&&s,a=e.updateUnreadCount,r=[],c=[],d=this.get(7),p=this.get(8),h=this.isIntl(),m=this.isUsingChatCore(),f=0,I=t.length;f<I;f++){var k,N,x,Y,ie=new cs(t[f],h,m),Le=ie.conversationID;this._isNonExistentAccount(Le)||(this._conversationMap.has(Le)?(k=this._conversationMap.get(Le),!(N=["unreadCount","allowType","adminForbidType","payload"])===o&&N.push("lastMessage"),typeof o=="boolean"&&N.push("isPinned"),Y=t[f].lastMessage,(x=!C(Y))||t[f].type===_.CONV_TOPIC||this._onLastMessageNotExist(t[f]),C(o)&&x&&k.lastMessage.payload===null&&(k.lastMessage.payload=Y.payload),G(k.lastMessage.revoker)||(k.lastMessage.revoker=null),bt(k,ie,N,[null,void 0,"",0,NaN]),a===!0&&k.updateUnreadCount({nextUnreadCount:ie.unreadCount,isFromGetConversations:n,isUnreadC2CMessage:i}),o&&x&&(Y.payload&&(k.lastMessage.payload=Y.payload),k.type===_.CONV_GROUP&&(k.lastMessage.nameCard=Y.nameCard,k.lastMessage.nick=Y.nick)),x&&k.lastMessage.cloudCustomData!==Y.cloudCustomData&&(k.lastMessage.cloudCustomData=Y.cloudCustomData||""),this._conversationMap.delete(Le),r.push([Le,k])):(ie.type===_.CONV_GROUP&&d?(N=ie.groupProfile.groupID,(x=d.getLocalGroupProfile(N))&&(ie.groupProfile=x,a===!0&&ie.updateUnreadCount({nextUnreadCount:0}))):ie.type===_.CONV_C2C&&(Y=Le.replace(_.CONV_C2C,""),p&&p.isMyFriend(Y)&&(ie.remark=p.getFriendRemark(Y))),c.push(ie),r.push([Le,ie])))}for(var Ze,et,rt,Eo=this.get(10),ko=r.length,Nn=0;Nn<ko;Nn++)r[Nn][1].type===_.CONV_TOPIC&&(Ze=(rt=r[Nn][1]).conversationID,et=rt.unreadCount,rt=rt.groupAtInfoList,Eo.onConversationProxy({topicID:Ze.replace(_.CONV_GROUP,""),unreadCount:et,groupAtInfoList:G(rt)?void 0:rt}));return{toBeUpdatedConversationList:r,newConversationList:c}}},{key:"_onLastMessageNotExist",value:function(e){new S("lastMessageNotExist").setMessage(JSON.stringify(e)).end()}},{key:"_sortConversationList",value:function(e){var t=[],n=[],o=[],s=[];return e.forEach(function(i){(i[1].isPinned===!0?G(i[1].lastMessage.lastTime)?n:t:G(i[1].lastMessage.lastTime)?s:o).push(i)}),t.sort(function(i,a){return a[1].lastMessage.lastTime-i[1].lastMessage.lastTime}).concat(n).concat(o.sort(function(i,a){return a[1].lastMessage.lastTime-i[1].lastMessage.lastTime})).concat(s)}},{key:"_sortConversationListAndEmitEvent",value:function(){this._conversationMap=new Map(this._sortConversationList(b(this._conversationMap))),this.emitConversationUpdate(!0,!1)}},{key:"_updateUserOrGroupProfile",value:function(e){var t,n,o,s,i=this;e.length!==0&&(t=[],n=[],o=this.get(4),s=this.get(7),e.forEach(function(a){var r;a.type===_.CONV_C2C?t.push(a.toAccount):a.type===_.CONV_GROUP&&(r=a.toAccount,s.hasLocalGroup(r)?a.groupProfile=s.getLocalGroupProfile(r):n.push(r))}),u.l("".concat(this._n,"._updateUserOrGroupProfile c2cUserIDList:").concat(t," groupIDList:").concat(n)),0<t.length&&o.getUserProfile({userIDList:t}).then(function(a){a=a.data,F(a)?a.forEach(function(r){i._doUpdateUserProfile("C2C".concat(r.userID),r)}):i._doUpdateUserProfile("C2C".concat(a.userID),a)}),0<n.length&&s.getGroupProfileAdvance({groupIDList:n,responseFilter:{groupBaseInfoFilter:["Type","Name","FaceUrl"]}}).then(function(r){var r=r.data.successGroupList,c=!1;r.forEach(function(d){var p="GROUP".concat(d.groupID);i._conversationMap.has(p)&&(p=i._conversationMap.get(p),bt(p.groupProfile,d,[],[null,void 0,"",0,NaN]),!p.subType&&d.type&&(p.subType=d.type),c=!0)}),c&&i.emitConversationUpdate()}))}},{key:"_doUpdateUserProfile",value:function(e,t){this.hasLocalConversation(e)&&(this.getLocalConversation(e).userProfile=t,this.emitConversationUpdate())}},{key:"_getConversationOptions",value:function(s){var t=this,n=[],s=s.filter(function(r){var a=r.type,r=r.userID;return a===1&&!t._isNonExistentAccount(r)||a===2}),o=this.getMyUserID(),s=s.map(function(i){var a;return C(i.lastMsg)&&(i.lastMsg={elements:[]}),i.type===1?(a={userID:i.userID,nick:i.peerNick,avatar:i.peerAvatar},n.push(a),{conversationID:"C2C".concat(i.userID),type:"C2C",lastMessage:{lastTime:i.time,lastSequence:i.sequence,fromAccount:i.lastC2CMsgFromAccount,type:i.lastMsg.elements[0]?i.lastMsg.elements[0].type:null,payload:i.lastMsg.elements[0]?t._amendLayersOverLimitProperty(i.lastMsg.elements[0].content):null,cloudCustomData:i.lastMsg.cloudCustomData||"",isRevoked:i.lastMessageFlag===8,onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:i.lastC2CMsgFromAccount===o&&i.time<=i.c2cPeerReadTime,revoker:i.lastMsg.revokerInfo?i.lastMsg.revokerInfo.revoker:null},userProfile:new Qn(a),peerReadTime:i.c2cPeerReadTime,isPinned:i.isPinned===1,customData:i.customMark||"",markList:Zo(i.standardMark),conversationGroupList:t._convGroupHandler.getConvGroupListByID(i.contactGroupId),remark:i.friendRemark||"",messageRemindType:t._transMessageRemindType(i.messageRemindType)}):{conversationID:"GROUP".concat(i.groupID),type:"GROUP",lastMessage:l(l({lastTime:i.time,lastSequence:i.sequence,fromAccount:i.msgGroupFromAccount},t._patchTypeAndPayload(i)),{},{cloudCustomData:i.lastMsg.cloudCustomData||"",isRevoked:i.lastMessageFlag===2,onlineOnlyFlag:!1,nick:i.senderNick||"",nameCard:i.senderNameCard||"",revoker:i.lastMsg.revokerInfo?i.lastMsg.revokerInfo.revoker:null}),groupProfile:new Xt({groupID:i.groupID,name:i.groupNick,avatar:i.groupImage,type:i.groupType,nextMessageSeq:i.nextMessageSeq}),unreadCount:t._computeGroupUnreadCount(i),peerReadTime:0,isPinned:i.isPinned===1,version:0,customData:i.customMark||"",markList:Zo(i.standardMark),conversationGroupList:t._convGroupHandler.getConvGroupListByID(i.contactGroupId),messageRemindType:t._transMessageRemindType(i.messageRemindType)}});return 0<n.length&&this.get(4).onConversationsProfileUpdated(n),s}},{key:"_transMessageRemindType",value:function(e){var t="";return e===0?t=_.MSG_REMIND_ACPT_AND_NOTE:e===1?t=_.MSG_REMIND_DISCARD:e===2?t=_.MSG_REMIND_ACPT_NOT_NOTE:e===3&&(t=_.RECEIVE_WITH_OFFLINE_PUSH_EXCEPT_AT),t}},{key:"_computeGroupUnreadCount",value:function(t){var n=t.unreadCount,t=t.noUnreadCount,n=(n===void 0?0:n)-(t===void 0?0:t);return 0<n?n:0}},{key:"_patchTypeAndPayload",value:function(o){var o=o.lastMsg,t=o.event,n=o.elements,n=n===void 0?[]:n,o=o.groupTips,o=o===void 0?{}:o;return C(t===void 0?void 0:t)||G(o)?{type:n[0]?n[0].type:null,payload:n[0]?this._amendLayersOverLimitProperty(n[0].content):null}:((t=new We(o)).setElement({type:_.MSG_GRP_TIP,content:l(l({},o.elements),{},{groupProfile:o.groupProfile})}),n=JSON.parse(JSON.stringify(t.payload)),t=null,{type:_.MSG_GRP_TIP,payload:n})}},{key:"_amendLayersOverLimitProperty",value:function(e){var t=e.layersOverLimit;return t===0?e.layersOverLimit=!1:t===1&&(e.layersOverLimit=!0),e}},{key:"getLocalMessageList",value:function(e){return this._messageListHandler.getLocalMessageList(e)}},{key:"deleteLocalMessage",value:function(e){e instanceof We&&this._messageListHandler.remove(e)}},{key:"onConversationDeleted",value:function(e){F(e)&&(e=e.map(function(s){var n=s.type,o=s.userID,s=s.groupID;return n===1?"".concat(_.CONV_C2C).concat(o):n===2?"".concat(_.CONV_GROUP).concat(s):void 0}),u.l("".concat(this._n,".onConversationDeleted conversationIDList:").concat(e)),this.deleteLocalConversationList(e))}},{key:"onConversationPinned",value:function(e){var t,n=this;F(e)&&(t=!1,e.forEach(function(r){var s,i=r.type,a=r.userID,r=r.groupID;i===1?s=n.getLocalConversation("".concat(_.CONV_C2C).concat(a)):i===2&&(s=n.getLocalConversation("".concat(_.CONV_GROUP).concat(r))),s&&(u.l("".concat(n._n,".onConversationPinned conversationID:").concat(s.conversationID," isPinned:").concat(s.isPinned)),s.isPinned||(s.isPinned=!0,t=!0))}),t&&this._sortConversationListAndEmitEvent())}},{key:"onConversationUnpinned",value:function(e){var t,n=this;F(e)&&(t=!1,e.forEach(function(r){var s,i=r.type,a=r.userID,r=r.groupID;i===1?s=n.getLocalConversation("".concat(_.CONV_C2C).concat(a)):i===2&&(s=n.getLocalConversation("".concat(_.CONV_GROUP).concat(r))),s&&(u.l("".concat(n._n,".onConversationUnpinned conversationID:").concat(s.conversationID," isPinned:").concat(s.isPinned)),s.isPinned&&(s.isPinned=!1,t=!0))}),t&&this._sortConversationListAndEmitEvent())}},{key:"getMessageList",value:function(s){var t=this,n=s.conversationID,o=s.nextReqMessageID,s=s.count,i="".concat(this._n,".getMessageList"),c=this.getLocalConversation(n),a="";if(c&&c.groupProfile&&(a=c.groupProfile.type),st(a))return u.l("".concat(i," not available in avchatroom. conversationID:").concat(n)),Q({messageList:[],nextReqMessageID:"",isCompleted:!0});(C(s)||15<s)&&(s=15),!o&&this._isNotInCommunity(n)&&(this._messageListHandler.removeByConversationID(n),this._completedMap.delete(n),this._roamingMessageSequenceMap.delete(n));var r=this._computeRemainingCount({conversationID:n,nextReqMessageID:o}),c=this._completedMap.has(n);return u.l("".concat(i," conversationID:").concat(n," nextReqMessageID:").concat(o)+" remainingCount:".concat(r," count:").concat(s," isCompleted:").concat(c)),this._needGetHistory({conversationID:n,remainingCount:r,count:s})?this.getHistoryMessages({conversationID:n,nextReqMessageID:o,count:20}).then(function(I){var f=I.nextReqID,I=I.storedMessageList,p=t._completedMap.has(n),h=I,m={nextReqMessageID:p?"":f,messageList:h=0<r?t._messageListHandler.getLocalMessageList(n).slice(0,I.length+r):h,isCompleted:p},f=m.messageList.filter(function(k){return k.isRevoked})||[],I=h.map(function(k){return k.sequence});return u.l("".concat(i," ret.nextReqMessageID:").concat(m.nextReqMessageID," ret.isCompleted:").concat(m.isCompleted," ret.length:").concat(h.length," sequenceList:"),I),F(f)&&f.length!==0?t.updateRevokerInfo(f).then(function(k){return k.forEach(function(N){var x=N.revokerInfo;m.messageList=m.messageList.map(function(Y){return Y.ID===N.ID&&x&&(Y.revokeReason=x.reason||"",Y.revokerInfo={userID:x.revoker||Y.revoker,nick:x.nick,avatar:x.avatar}),Y})}),q(m)}):q(m)}):(this.modifyMessageList(n),a=this._getMessageListFromMemory({conversationID:n,nextReqMessageID:o,count:s}),Q(a))}},{key:"_getMessageListFromMemory",value:function(o){var t=o.conversationID,n=o.nextReqMessageID,o=o.count,s="".concat(this._n,"._getMessageListFromMemory"),i=this._messageListHandler.getLocalMessageList(t),a=i.length,r=0,c={isCompleted:!1,nextReqMessageID:"",messageList:[]};return n?(r=i.findIndex(function(d){return d.ID===n}))>o?(c.messageList=i.slice(r-o,r),c.nextReqMessageID=i[r-o].ID):(c.messageList=i.slice(0,r),c.isCompleted=!0):o<a?(c.messageList=i.slice(r=a-o,a),c.nextReqMessageID=i[r].ID):(c.messageList=i.slice(0,a),c.isCompleted=!0),u.l("".concat(s," conversationID:").concat(t)+" ret.nextReqMessageID:".concat(c.nextReqMessageID," ret.isCompleted:").concat(c.isCompleted," ret.length:").concat(c.messageList.length)),c}},{key:"getMessageListHopping",value:function(r){var t,n,o=r.conversationID,s=r.sequence,i=r.time,a=r.count,r=r.direction,r=r===void 0?0:r;return(C(a)||15<a)&&(a=15),o.startsWith(_.CONV_C2C)?(t=this.get(6),n=o.replace(_.CONV_C2C,""),t.getRoamingMessagesHopping({peerAccount:n,time:i,count:a,direction:r})):o.startsWith(_.CONV_GROUP)?(t=this.get(7),n=o.replace(_.CONV_GROUP,""),t.getRoamingMessagesHopping({groupID:n,sequence:s,count:a,direction:r})):void 0}},{key:"_computeRemainingCount",value:function(o){var t=o.conversationID,n=o.nextReqMessageID,o=this._messageListHandler.getLocalMessageList(t),s=o.length;return u.l("".concat(this._n,"._computeRemainingCount conversationID:").concat(t," nextReqMessageID:").concat(n," length:").concat(s)),n?(s=0,dt(t)?s=o.findIndex(function(i){return i.ID===n}):at(t)&&(s=n.indexOf("-")!==-1?o.findIndex(function(i){return i.ID===n}):o.findIndex(function(i){return i.sequence===n})),s=s===-1?0:s):s}},{key:"_getMessageListSize",value:function(e){return this._messageListHandler.getLocalMessageList(e).length}},{key:"_needGetHistory",value:function(o){var t=o.conversationID,n=o.remainingCount,o=o.count,s=this.getLocalConversation(t),i="";if(s&&s.groupProfile&&(i=s.groupProfile.type),Qo(t)||st(i))return!1;if(s=!1,i="".concat(this._n,"._needGetHistory conversationID:").concat(t),at(t)){var a=this._isPagingGetGroupListCompleted(),r=this._getLocalGroupCount(),c=this._hasLocalGroup(t),d=this._isTopicConversation(t);if(u.l("".concat(i," isGroupListCompleted:").concat(a," localGroupCount:").concat(r)+" isGroupInList:".concat(c," isTopic:").concat(d)),a&&r<=500&&!c&&!d)return s}return s=n<=o&&!this._completedMap.has(t),u.l("".concat(i," ret:").concat(s)),s}},{key:"_isTopicConversation",value:function(e){return e=e.replace(_.CONV_GROUP,""),Ve(e)}},{key:"getHistoryMessages",value:function(o){var t=o.conversationID,o=o.count;if(t===_.CONV_SYSTEM)return Q();var n=15,o=(20<o&&(n=20),null);if(dt(t))return s=this._roamingMessageKeyAndTimeMap.has(t),(o=this.get(6))?o.getRoamingMessage({conversationID:t,peerAccount:t.replace(_.CONV_C2C,""),count:n,lastMessageTime:s?this._roamingMessageKeyAndTimeMap.get(t).lastMessageTime:0,messageKey:s?this._roamingMessageKeyAndTimeMap.get(t).messageKey:""}):v({code:M.CANNOT_FIND_MODULE});if(at(t)){if(!(o=this.get(7)))return v({code:M.CANNOT_FIND_MODULE});var s=t.replace(_.CONV_GROUP,""),a=null,i=0,a=((a=this._conversationMap.has(t)&&!Ve(s)?this._conversationMap.get(t).lastMessage:a)&&(i=a.lastSequence),this._roamingMessageSequenceMap.get(t));return o.getRoamingMessage({conversationID:t,groupID:s,count:n,sequence:a||i})}return Q()}},{key:"patchConversationLastMessage",value:function(e){var t,n,o=1<arguments.length&&arguments[1]!==void 0&&arguments[1],s=this.getLocalConversation(e);s&&(t=(n=s.lastMessage).messageForShow,n=n.payload,!(G(t)||G(n)||o)||(t=this._messageListHandler.getLocalMessageList(e)).length!==0&&(n=t[t.length-1],u.l("".concat(this._n,".patchConversationLastMessage bForceUpdate:").concat(o," conversationID:").concat(e," payload:"),n.payload),s.updateLastMessage(n)))}},{key:"onRoamingMessage",value:function(){for(var e,t,n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],o=1<arguments.length?arguments[1]:void 0,s=!(2<arguments.length&&arguments[2]!==void 0)||arguments[2],i=o.startsWith(_.CONV_C2C)?_.CONV_C2C:_.CONV_GROUP,a=null,r=[],c=[],f=0,I=n.length,d=i===_.CONV_GROUP,p=this.getFileDownloadProxy(),h=function(){d?--f:++f},m=function(){return d?I<=f:f<I},f=d?n.length-1:0,I=d?0:n.length;m();h())d&&n[f].sequence===1&&s&&this.setCompleted(o),n[f].isPlaceMessage!==1&&((a=new We(n[f])).to=n[f].to,i!==_.CONV_GROUP||C(n[f].topicID)||(a.to=n[f].topicID),a.isSystemMessage=!!n[f].isSystemMessage,a.conversationType=i,e=n[f].event===4?{type:_.MSG_GRP_TIP,content:l(l({},n[f].elements),{},{groupProfile:n[f].groupProfile})}:n[f].elements,d||a.setNickAndAvatar({nick:n[f].nick,avatar:n[f].avatar}),G(e)?((t=new S("emptyMessageBody")).setMessage("from:".concat(a.from," to:").concat(a.to," sequence:").concat(a.sequence," event:").concat(n[f].event)),t.setLevel("warning").end()):(a.setElement(e,p),a.reInitialize(this.getMyUserID()),r.push(a)));return h=m=null,s?(this._messageListHandler.unshift(r,c),r=null,c):(c=null,r)}},{key:"findMessage",value:function(e){return this._messageListHandler.findMessage(e)}},{key:"_isNotInCommunity",value:function(e){var t=!1;return e.startsWith(_.CONV_GROUP)&&this._isTopicConversation(e)&&(e=Be(e.replace(_.CONV_GROUP,"")),this.get(7).hasLocalGroup(e)||(t=!0)),t}},{key:"deleteTopicRoamingMessageInfo",value:function(e){var t=this;lt({groupID:e})&&this._messageListHandler.getTopicConversationIDList(e).forEach(function(n){t._completedMap.delete(n),t._roamingMessageSequenceMap.delete(n)})}},{key:"deleteGroupRoamingMessageInfo",value:function(e){e="".concat(_.CONV_GROUP).concat(e),this._completedMap.delete(e),this._roamingMessageSequenceMap.delete(e)}},{key:"setMessageRead",value:function(o){var t=o.conversationID,n=this.getLocalConversation(t),o="".concat(this._n,".setMessageRead");if(u.l("".concat(o," conversationID:").concat(t," unreadCount:").concat(n?n.unreadCount:0)),!n||(n.type!==_.CONV_GROUP&&n.type!==_.CONV_TOPIC||G(n.groupAtInfoList)||this.deleteGroupAtTips(t),n.unreadCount===0))return Q();var s=this._messageListHandler.getLocalLastMessage(t),i=n.lastMessage.lastTime,a=this._messageListHandler.getLocalMaxTime(t),a=(i<a&&(u.l("".concat(o," update lastMessageTime from ").concat(i," to ").concat(a)),i=a),this._messageListHandler.getLocalMaxSequence(t)),r=n.lastMessage.lastSequence,c=(r<a&&(u.l("".concat(o," update lastMessageSeq from ").concat(r," to ").concat(a)),r=a),n.type===_.CONV_TOPIC&&C(s)&&(o=this.get(10),s=Be(a=t.replace(_.CONV_GROUP,"")),(o=o.getLocalTopic(s,a))&&(r=o.nextMessageSeq-1)),null);switch(n.type){case _.CONV_C2C:return(c=this.get(6))?c.setMessageRead({conversationID:t,lastMessageTime:i}):v({code:M.CANNOT_FIND_MODULE});case _.CONV_GROUP:case _.CONV_TOPIC:return(c=this.get(7))?c.setMessageRead({conversationID:t,lastMessageSeq:r}):v({code:M.CANNOT_FIND_MODULE});case _.CONV_SYSTEM:return n.unreadCount=0,this.emitConversationUpdate(!0,!1),Q();default:return Q()}}},{key:"setAllMessageRead",value:function(){var e=this,t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},n="setAllMessageRead",o="".concat(this._n,".").concat(n),s=(t.scope||(t.scope=_.READ_ALL_MSG),u.l("".concat(o," options:"),t),this._createSetAllMessageReadPack(t));if(s.readAllC2CMessage===0&&s.groupMessageReadInfoList.length===0)return Q();var i=new S(n);return this.req({proto:g.SET_ALL_MSG_READ,data:s}).then(function(a){return a=a.data,a=e._handleAllMessageRead(a),i.setMessage("scope:".concat(t.scope," failureGroups:").concat(JSON.stringify(a))).end(),Q()}).catch(function(a){return i.setError(a).end(),u.w("".concat(o," failed. error:"),a),v({code:a&&a.code?a.code:M.MSG_UNREAD_ALL_FAIL,message:a&&a.message?a.message:void 0})})}},{key:"setConversationCustomData",value:function(e){return this._convGroupHandler.setConvCustomData(e)}},{key:"markConversation",value:function(e){return this._convGroupHandler.markConversation(e)}},{key:"getConversationGroupList",value:function(){return this._convGroupHandler.getLocalConvGroupList()}},{key:"createConversationGroup",value:function(e){return this._convGroupHandler.createConvGroup(e)}},{key:"deleteConversationGroup",value:function(e){return this._convGroupHandler.deleteConvGroup(e)}},{key:"renameConversationGroup",value:function(e){return this._convGroupHandler.renameConvGroup(e)}},{key:"addConversationsToGroup",value:function(e){return this._convGroupHandler.addConvsToGroup(e)}},{key:"deleteConversationsFromGroup",value:function(e){return this._convGroupHandler.deleteConvsFromGroup(e)}},{key:"onConversationMarkUpdated",value:function(e){this._convGroupHandler.onConvMarkUpdated(e)}},{key:"onConversationGroupCreated",value:function(e){this._convGroupHandler.onConvGroupCreated(e)}},{key:"onConversationGroupDeleted",value:function(e){this._convGroupHandler.onConvGroupDeleted(e)}},{key:"onConversationGroupNameUpdated",value:function(e){this._convGroupHandler.onConvGroupNameUpdated(e)}},{key:"onConversationInGroupUpdated",value:function(e){this._convGroupHandler.onConvInGroupUpdated(e)}},{key:"onConversationAddedToOrDeletedFromGroup",value:function(e){this._convGroupHandler.onConvAddedToOrDeletedFromGroup(e)}},{key:"_getConversationLastMessageSequence",value:function(n){var t=this._messageListHandler.getLocalLastMessage(n.conversationID),n=n.lastMessage.lastSequence;return n=t&&n<t.sequence?t.sequence:n}},{key:"_getConversationLastMessageTime",value:function(n){var t=this._messageListHandler.getLocalLastMessage(n.conversationID),n=n.lastMessage.lastTime;return n=t&&n<t.time?t.time:n}},{key:"_createSetAllMessageReadPack",value:function(e){var t,n={readAllC2CMessage:0,groupMessageReadInfoList:[]},o=e.scope,s=Ee(this._conversationMap);try{for(s.s();!(t=s.n()).done;){var i,a=$(t.value,2)[1];if(0<a.unreadCount)if(a.type===_.CONV_C2C&&n.readAllC2CMessage===0){if(o===_.READ_ALL_MSG)n.readAllC2CMessage=1;else if(o===_.READ_ALL_C2C_MSG){n.readAllC2CMessage=1;break}}else a.type!==_.CONV_GROUP||o!==_.READ_ALL_GROUP_MSG&&o!==_.READ_ALL_MSG||(i=this._getConversationLastMessageSequence(a),n.groupMessageReadInfoList.push({groupID:a.groupProfile.groupID,messageSequence:i}))}}catch(r){s.e(r)}finally{s.f()}return n}},{key:"onPushedAllMessageRead",value:function(e){this._handleAllMessageRead(e)}},{key:"_handleAllMessageRead",value:function(t){var n=t.groupMessageReadInfoList,t=t.readAllC2CMessage,n=this._parseGroupReadInfo(n);return 1<=this._updateAllConversationUnreadCount({readAllC2CMessage:t})&&this.emitConversationUpdate(!0,!1),n}},{key:"_parseGroupReadInfo",value:function(e){var t=[];if(e&&e.length)for(var n=0,o=e.length;n<o;n++){var r=e[n],s=r.groupID,i=r.sequence,a=r.retCode,r=r.lastMessageSeq;C(a)?this._remoteGroupReadSequenceMap.set(s,r):(this._remoteGroupReadSequenceMap.set(s,i),a!==0&&t.push("".concat(s,"-").concat(i,"-").concat(a)))}return t}},{key:"_updateAllConversationUnreadCount",value:function(e){var t,n=e.readAllC2CMessage,o=0,s=Ee(this._conversationMap);try{for(s.s();!(t=s.n()).done;){var i,a,r,c,d=$(t.value,2),p=d[0],h=d[1];1<=h.unreadCount&&(n===1&&h.type===_.CONV_C2C?(i=this._getConversationLastMessageTime(h),this.updateIsReadAfterReadReport({conversationID:p,lastMessageTime:i})):h.type===_.CONV_GROUP&&(a=p.replace(_.CONV_GROUP,""),this._remoteGroupReadSequenceMap.has(a)&&(r=this._remoteGroupReadSequenceMap.get(a),c=this._getConversationLastMessageSequence(h),this.updateIsReadAfterReadReport({conversationID:p,remoteReadSequence:r}),r<=c&&this._remoteGroupReadSequenceMap.delete(a))),this.updateUnreadCount(p,!1)&&(o+=1))}}catch(m){s.e(m)}finally{s.f()}return o}},{key:"isRemoteRead",value:function(o){var t,n=o.conversationID,o=o.sequence,s=n.replace(_.CONV_GROUP,""),i=!1;return this._remoteGroupReadSequenceMap.has(s)&&(o<=(t=this._remoteGroupReadSequenceMap.get(s))&&(i=!0,u.l("".concat(this._n,".isRemoteRead conversationID:").concat(n," messageSequence:").concat(o," remoteReadSequence:").concat(t))),t+10<=o&&this._remoteGroupReadSequenceMap.delete(s)),i}},{key:"updateIsReadAfterReadReport",value:function(e){var t=e.conversationID,n=e.lastMessageSeq,o=e.lastMessageTime,s=this._messageListHandler.getLocalMessageList(t);if(s.length!==0){for(var i,a=s.length-1;0<=a;a--)if(i=s[a],!(o&&i.time>o||n&&i.sequence>n)){if(i.flow==="in"&&i.isRead)break;i.setIsRead(!0)}}}},{key:"updateUnreadCount",value:function(e){var t,n=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],o=!1,s=this.getLocalConversation(e),i=this._messageListHandler.getLocalMessageList(e);if(s)return(t=s.unreadCount)!==(i=i.filter(function(a){return!a.isRead&&!a._onlineOnlyFlag&&!a.isDeleted}).length)&&(s.unreadCount=i,o=!0,u.l("".concat(this._n,".updateUnreadCount from ").concat(t," to ").concat(i,", conversationID:").concat(e)),n===!0&&this.emitConversationUpdate(!0,!1)),o&&s.type===_.CONV_TOPIC&&(t=s.unreadCount,i=this.get(10),n=e.replace(_.CONV_GROUP,""),i.onConversationProxy({topicID:n,unreadCount:t})),o}},{key:"clearGroupAtInfoList",value:function(e){var t,n=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],o=this.getLocalConversation(e);o&&0<o.groupAtInfoList.length&&(o.clearGroupAtInfoList(),u.l("".concat(this._n,".clearGroupAtInfoList conversationID:").concat(e)),o.type===_.CONV_TOPIC&&(o=o.groupAtInfoList,t=this.get(10),e=e.replace(_.CONV_GROUP,""),t.onConversationProxy({topicID:e,groupAtInfoList:o})),n===!0&&this.emitConversationUpdate(!0,!1))}},{key:"updateReadReceiptInfo",value:function(e){var t,n,o,s=this,r=e.userID,i=r===void 0?void 0:r,r=e.groupID,a=r===void 0?void 0:r,r=e.readReceiptList;G(r)||(t=[],C(i)?C(a)||(n="".concat(_.CONV_GROUP).concat(a),r.forEach(function(p){var h=p.tinyID,m=p.clientTime,f=p.random,d=p.readCount,p=p.unreadCount,h="".concat(h,"-").concat(m,"-").concat(f),m=s._messageListHandler.getLocalMessage(n,h)||s._messageListHandler.getHoppingMessage(n,h),f={groupID:a,messageID:h,readCount:0,unreadCount:0};m&&(fe(d)&&(m.readReceiptInfo.readCount=d,f.readCount=d),fe(p)&&(m.readReceiptInfo.unreadCount=p,f.unreadCount=p),t.push(f))})):(o="".concat(_.CONV_C2C).concat(i),r.forEach(function(d){var p=d.tinyID,h=d.clientTime,d=d.random,p="".concat(p,"-").concat(h,"-").concat(d),h=s._messageListHandler.getLocalMessage(o,p)||s._messageListHandler.getHoppingMessage(o,p);h&&!h.readReceiptInfo.isPeerRead&&(h.readReceiptInfo.isPeerRead=!0,t.push({userID:i,messageID:p,isPeerRead:!0}))})),0<t.length&&this.emitOuterEvent(V.MESSAGE_READ_RECEIPT_RECEIVED,t))}},{key:"updateIsRead",value:function(e){var t=this.getLocalConversation(e),n=this.getLocalMessageList(e);if(t&&n.length!==0&&!Qo(t.type)){for(var o=[],s=0,i=n.length;s<i;s++)n[s].flow!=="in"?n[s].flow!=="out"||n[s].isRead||n[s].setIsRead(!0):o.push(n[s]);var a=0;a=t.type===_.CONV_C2C?(e=o.slice(-t.unreadCount).filter(function(c){return c.isRevoked}).length,o.length-t.unreadCount-e):o.length-t.unreadCount;for(var r=0;r<a&&!o[r].isRead;r++)o[r].setIsRead(!0)}}},{key:"deleteGroupAtTips",value:function(e){var t=this,n="".concat(this._n,".deleteGroupAtTips"),s=(u.l("".concat(n)),this._conversationMap.get(e));if(!s)return Promise.resolve();var o=s.groupAtInfoList;if(o.length===0)return Promise.resolve();var s=void 0,i=(e.startsWith(_.CONV_GROUP)&&(s=e.replace(_.CONV_GROUP,"")),b(o));if((lt({groupID:s})||Ve(s))&&(i=o.filter(function(r){return!r.atTypeArray.includes(_.CONV_AT_ALL)})).length===0)return this.clearGroupAtInfoList(e,!1),Promise.resolve();var a=this.getMyUserID();return this.req({proto:g.DEL_GROUP_AT_TIPS,data:{messageListToDelete:i.map(function(r){return{from:r.from,to:a,messageSeq:r.__sequence,messageRandom:r.__random,groupID:C(r.topicID)?r.groupID:r.topicID}})}}).then(function(){return u.l("".concat(n," ok. count:").concat(o.length)),t.clearGroupAtInfoList(e,!1),Promise.resolve()}).catch(function(r){return u.e("".concat(n," failed. error:"),r),v(r)})}},{key:"appendToMessageList",value:function(e){return this._messageListHandler.pushIn(e)}},{key:"setMessageRandom",value:function(e){this.singlyLinkedList.set(e.random)}},{key:"deleteMessageRandom",value:function(e){this.singlyLinkedList.delete(e.random)}},{key:"pushIntoMessageList",value:function(e,t,n){return!(!this._messageListHandler.pushIn(t,n)||this._isMessageFromCurrentInstance(t)&&!n||(e.push(t),0))}},{key:"_isMessageFromCurrentInstance",value:function(e){return this.singlyLinkedList.has(e.random)}},{key:"revoke",value:function(e,t,n){return this._messageListHandler.revoke(e,t,n)}},{key:"getPeerReadTime",value:function(e){return this._peerReadTimeMap.get(e)}},{key:"recordPeerReadTime",value:function(e,t){(!this._peerReadTimeMap.has(e)||this._peerReadTimeMap.get(e)<t)&&this._peerReadTimeMap.set(e,t)}},{key:"updateMessageIsPeerReadProperty",value:function(e,t){var n;e.startsWith(_.CONV_C2C)&&0<t&&(0<(n=this._messageListHandler.updateMessageIsPeerReadProperty(e,t)).length&&this.emitOuterEvent(V.MESSAGE_READ_BY_PEER,n),this._conversationMap.has(e)&&(G(n=this._conversationMap.get(e).lastMessage)||n.fromAccount===this.getMyUserID()&&n.lastTime<=t&&!n.isPeerRead&&(n.isPeerRead=!0,this.emitConversationUpdate(!0,!1))))}},{key:"updateMessageIsModifiedProperty",value:function(e){this._messageListHandler.updateMessageIsModifiedProperty(e)}},{key:"setCompleted",value:function(e){u.l("".concat(this._n,".setCompleted. conversationID:").concat(e)),this._completedMap.set(e,!0)}},{key:"updateRoamingMessageKeyAndTime",value:function(e,t,n){this._roamingMessageKeyAndTimeMap.set(e,{messageKey:t,lastMessageTime:n})}},{key:"updateRoamingMessageSequence",value:function(e,t){this._roamingMessageSequenceMap.set(e,t)}},{key:"getConversationList",value:function(e){var t,n=this,o="".concat(this._n,".").concat("getConversationList"),s="pagingStatus:".concat(this._pagingStatus,", local conversation count:").concat(this._conversationMap.size,", options:").concat(JSON.stringify(e));return u.l("".concat(o,". ").concat(s)),this._pagingStatus===Dn?((t=new S("getConversationList")).setMessage(s),this.syncConversationList().then(function(){t.end();var i=n._getConversationList(e);return q({conversationList:i,isSyncCompleted:n._isSyncCompleted()})}).catch(function(i){return t.setError(i).end(),u.e("".concat(o," failed. error:"),i),v(i)})):(s=this._getConversationList(e),u.l("".concat(o,". returned conversation count:").concat(s.length)),Q({conversationList:s,isSyncCompleted:this._isSyncCompleted()}))}},{key:"_getConversationList",value:function(e){var t,n,o,s,i,a=this;return C(e)?this.getLocalConversationList():F(e)?e.length===0?[]:this.getLocalConversationList().filter(function(r){return e.includes(r.conversationID)}):Ce(e)?(t=e.type,n=e.markType,o=e.groupName,s=e.hasUnreadCount,i=e.hasGroupAtInfo,this.getLocalConversationList().filter(function(r){return a._filterType(r,t)&&a._filterMarkType(r,n)&&a._filterGroupName(r,o)&&a._filterUnreadCount(r,s)&&a._filterGroupAtInfo(r,i)})):[]}},{key:"_filterType",value:function(e,t){return t!==_.CONV_C2C&&t!==_.CONV_GROUP||e.type===t}},{key:"_filterGroupName",value:function(e,t){return!te(t)||(t===""?e.conversationGroupList.length===0:e.conversationGroupList.includes(t))}},{key:"_filterMarkType",value:function(e,t){return!fe(t)||(t===0?e.markList.length===0:e.markList.includes(t))}},{key:"_filterUnreadCount",value:function(e,t){var n=!0;return t===!0?n=1<=e.unreadCount:t===!1&&(n=e.unreadCount===0),n}},{key:"_filterGroupAtInfo",value:function(e,t){var n=!0;return t===!0?n=1<=e.groupAtInfoList.length:t===!1&&(n=e.groupAtInfoList.length===0),n}},{key:"_handleC2CPeerReadTime",value:function(){var e,t=Ee(this._conversationMap);try{for(t.s();!(e=t.n()).done;){var n=$(e.value,2),o=n[0],s=n[1];s.type===_.CONV_C2C&&(u.d("".concat(this._n,"._handleC2CPeerReadTime conversationID:").concat(o," peerReadTime:").concat(s.peerReadTime)),this.recordPeerReadTime(o,s.peerReadTime))}}catch(i){t.e(i)}finally{t.f()}}},{key:"_isPagingGetGroupListCompleted",value:function(){var e=this.get(7);return!e||e.isPagingGetCompleted()}},{key:"_getLocalGroupCount",value:function(){var e=this.get(7);return e?e.getLocalGroupList().length:0}},{key:"_hasLocalGroup",value:function(e){var t=this.get(7);return!!t&&t.hasLocalGroup(e.replace(_.CONV_GROUP,""))}},{key:"getConversationProfile",value:function(e){var t,n=this;if((t=this._conversationMap.has(e)?this._conversationMap.get(e):new cs({conversationID:e,type:e.slice(0,3)===_.CONV_C2C?_.CONV_C2C:_.CONV_GROUP},this.isIntl(),this.isUsingChatCore()))._isInfoCompleted||t.type===_.CONV_SYSTEM)return Q({conversation:t});if(at(e)&&!this._hasLocalGroup(e))return Q({conversation:t});var o="".concat(this._n,".").concat("getConversationProfile"),s=new S("getConversationProfile");return u.l("".concat(o,". conversationID:").concat(e," remark:").concat(t.remark," lastMessage:"),t.lastMessage),this._updateUserOrGroupProfileCompletely(t).then(function(i){s.setMessage("conversationID:".concat(e," unreadCount:").concat(i.data.conversation.unreadCount)).end();var a,r=n.get(8);return r&&t.type===_.CONV_C2C&&(a=e.replace(_.CONV_C2C,""),r.isMyFriend(a)&&(r=r.getFriendRemark(a),t.remark!==r&&(t.remark=r,u.l("".concat(o,". conversationID:").concat(e," patch remark:").concat(t.remark))))),u.l("".concat(o," ok. conversationID:").concat(e)),i}).catch(function(i){return s.setError(i).setMessage("conversationID:".concat(e)).end(),u.e("".concat(o," failed. error:"),i),v(i)})}},{key:"_updateUserOrGroupProfileCompletely",value:function(e){var t=this;return e.type===_.CONV_C2C?this.get(4).getUserProfile({userIDList:[e.toAccount]}).then(function(n){return n=n.data,n.length===0?v(new Te({code:M.USER_OR_GRP_NOT_FOUND})):(e.userProfile=n[0],e._isInfoCompleted=!0,t._unshiftConversation(e),Q({conversation:e}))}):this.get(7).getGroupProfile({groupID:e.toAccount}).then(function(n){return e.groupProfile=n.data.group,e._isInfoCompleted=!0,t._unshiftConversation(e),Q({conversation:e})})}},{key:"_unshiftConversation",value:function(e){e instanceof cs&&!this._conversationMap.has(e.conversationID)&&(this._conversationMap=new Map([[e.conversationID,e]].concat(b(this._conversationMap))),this._setStorageConversationList(),this.emitConversationUpdate(!0,!1))}},{key:"_onProfileUpdated",value:function(e){var t=this;e.data.forEach(function(n){var o=n.userID;o===t.getMyUserID()?t._onMyProfileModified({latestNick:n.nick,latestAvatar:n.avatar}):(o=t._conversationMap.get("".concat(_.CONV_C2C).concat(o)))&&(o.userProfile=n)})}},{key:"_isSyncCompleted",value:function(){return this._pagingStatus===jn}},{key:"_errorLog",value:function(e,t,n,o){var s=new Error("Params validate failed."),i="".concat(this.getErrorMessage("API_REFER")).concat(e);throw u.w("[".concat(e,"] | ").concat(t," | ").concat(this.getErrorMessage(n,o),", ").concat(i)),u.e("[".concat(e,"] Invalid ").concat(t,": type check failed for ").concat(t,".")),s}},{key:"_isValidConversationID",value:function(e){return dt(e)||at(e)||Qo(e)}},{key:"deleteConversation",value:function(e){var t=this,n="deleteConversation";return te(e)||Ht(e)||this._errorLog(n,"options","StringOrObjectRequiredLog"),te(e)?(this._isValidConversationID(e)||this._errorLog(n,"options","InvalidConversationID",e),u.l("".concat(this._n,".").concat(n," conversationID:").concat(e)),this.deleteConversationList({conversationIDList:[e],flag:1})):(F(e.conversationIDList)||this._errorLog(n,"conversationIDList","ArrayRequiredLog"),e.conversationIDList.length===0&&this._errorLog(n,"conversationIDList","NonEmptyArrayLog"),e.conversationIDList.forEach(function(o){t._isValidConversationID(o)||t._errorLog(n,"conversationIDList","InvalidConversationID",o)}),"clearHistoryMessage"in e&&typeof e.clearHistoryMessage!="boolean"&&this._errorLog(n,"clearHistoryMessage","BooleanRequiredLog"),100<e.conversationIDList.length&&(e.conversationIDList=e.conversationIDList.slice(0,100)),this.deleteConversationList(e))}},{key:"deleteConversationList",value:function(o){var t=o.conversationIDList,t=t===void 0?[]:t,n=o.clearHistoryMessage,n=n===void 0||n,o=o.flag,s=o===void 0?0:o,i="".concat(this._n,".").concat("deleteConversationList"),a=(u.l("".concat(i," conversationIDList.length:").concat(t.length," clearHistoryMessage:").concat(n)),new S("deleteConversationList"));return a.setMessage("conversationIDList:".concat(t)),Promise.all([this.rmLocalOnlyConversationList(t),this.rmLocalAndRemoteConversationList(t,n)]).then(function(r){return a.end(),r=[].concat(b(r[0]),b(r[1])),r.length===0?v(new Te({code:M.CONV_NOT_FOUND})):(u.l("".concat(i," ok")),Q(s===1?{conversationID:r[0]}:{conversationIDList:r}))}).catch(function(r){return a.setError(r).end(),u.e("".concat(i," failed. error:"),r),v(r)})}},{key:"rmLocalOnlyConversationList",value:function(e){var t=this;return e.filter(function(n){if(!t._conversationMap.has(n))return!1;var o=t.getLocalConversation(n).type;return o!==_.CONV_GROUP||t._hasLocalGroup(n)?o===_.CONV_SYSTEM&&(t.get(7).deleteGroupSystemNotice({messageList:t._messageListHandler.getLocalMessageList(n)}),t.deleteLocalConversation(n),!0):(t.deleteLocalConversation(n),!0)})}},{key:"rmLocalAndRemoteConversationList",value:function(e,t){var n=this,o={fromAccount:this.getMyUserID(),conversationList:[],clearHistoryMessage:t?1:0};return e.forEach(function(s){var i;n._conversationMap.has(s)&&((i=n.getLocalConversation(s).type)===_.CONV_C2C?o.conversationList.push({toAccount:s.replace(i,""),type:1}):i===_.CONV_GROUP&&n._hasLocalGroup(s)&&o.conversationList.push({toGroupID:s.replace(i,""),type:2}))}),o.conversationList.length===0?[]:this.req({proto:g.DEL_CONV,data:o}).then(function(s){var i=[];return 0<s.data.resultList.length&&s.data.resultList.map(function(a){a.code===0&&(a=a.type===1?"".concat(_.CONV_C2C).concat(a.to):"".concat(_.CONV_GROUP).concat(a.groupID),i.push(a))}),n.deleteLocalConversationList(i),i})}},{key:"setConversationDraft",value:function(n){var t=n.conversationID,n=n.draftText,o="".concat(this._n,".").concat("setConversationDraft");return u.l("".concat(o," conversationID:").concat(t," draftText:").concat(n)),this._conversationMap.has(t)?(o=this._conversationMap.get(t),o.setDraftText(n),Q({code:0,conversation:o})):v({code:M.CONV_NOT_FOUND})}},{key:"clearHistoryMessage",value:function(e){var t=this,n={fromAccount:this.getMyUserID(),toAccount:void 0,type:void 0,toGroupID:void 0};if(!this._conversationMap.has(e))return v({code:M.CONV_NOT_FOUND});var o=this._conversationMap.get(e).type;if(o===_.CONV_C2C)n.type=1,n.toAccount=e.replace(_.CONV_C2C,"");else{if(o!==_.CONV_GROUP)return o===_.CONV_SYSTEM?(this.get(7).deleteGroupSystemNotice({messageList:this._messageListHandler.getLocalMessageList(e)}),Q({conversationID:e})):v({code:M.CONV_UN_RECORDED_TYPE});n.type=2,n.toGroupID=e.replace(_.CONV_GROUP,"")}var s="".concat(this._n,".").concat("clearHistoryMessage"),i=new S("clearHistoryMessage");return i.setMessage("conversationID:".concat(e)),u.l("".concat(s,". conversationID:").concat(e)),this.setMessageRead({conversationID:e}).then(function(){return t.req({proto:g.CLEAR_HISTORY_MSG,data:n})}).then(function(){i.end(),u.l("".concat(s," ok")),t._messageListHandler.removeByConversationID(e),t.setCompleted(e);var a=t.getLocalConversation(e);return a&&(a.updateLastMessage(),t._sortConversationListAndEmitEvent()),Q({conversationID:e})}).catch(function(a){return i.setError(a).end(),u.e("".concat(s," failed. error:"),a),v(a)})}},{key:"pinConversation",value:function(r){var t=this,n=r.conversationID,o=r.isPinned;if(!this._conversationMap.has(n))return v({code:M.CONV_NOT_FOUND});var s=this.getLocalConversation(n);if(s.isPinned===o)return Q({conversationID:n});var i="".concat(this._n,".").concat("pinConversation"),a=new S("pinConversation"),r=(a.setMessage("conversationID:".concat(n," isPinned:").concat(o)),u.l("".concat(i,". conversationID:").concat(n," isPinned:").concat(o)),null);return dt(n)?r={type:1,toAccount:n.replace(_.CONV_C2C,"")}:at(n)&&(r={type:2,groupID:n.replace(_.CONV_GROUP,"")}),this.req({proto:g.PIN_CONV,data:{fromAccount:this.getMyUserID(),operationType:o===!0?1:2,itemList:[r]}}).then(function(){return a.end(),u.l("".concat(i," ok")),s.isPinned!==o&&(s.isPinned=o,t._sortConversationListAndEmitEvent()),q({conversationID:n})}).catch(function(c){return a.setError(c).end(),u.e("".concat(i," failed. error:"),c),v(c)})}},{key:"setMessageRemindType",value:function(e){return this._messageRemindHandler.set(e)}},{key:"patchMessageRemindType",value:function(e){var t=e.ID,s=e.isC2CConversation,n=e.messageRemindType,o=!1,s=this.getLocalConversation("".concat(s?_.CONV_C2C:_.CONV_GROUP).concat(t));return s&&s.messageRemindType!==n&&(s.messageRemindType=n,o=!0),u.d("".concat(this._n,".patchMessageRemindType options:"),e,"ret:".concat(o)),o}},{key:"onC2CMessageRemindTypeFetched",value:function(e){var t,n=this;F(e)&&0<e.length&&(t=0,e.forEach(function(i){var s=i.userID,i=i.muteFlag,i=n._transMessageRemindType(i);n.patchMessageRemindType({ID:s,isC2CConversation:!0,messageRemindType:i})===!0&&(t+=1)}),u.l("".concat(this._n,".onC2CMessageRemindTypeFetched updateCount:").concat(t)),1<=t&&this.emitConversationUpdate(!0,!1))}},{key:"onC2CMessageRemindTypeSynced",value:function(e){var t=this,n="".concat(this._n,".onC2CMessageRemindTypeSynced");u.d(n,e),e.dataList.forEach(function(o){var s;G(o.muteNotificationsSync)||(s=(o=o.muteNotificationsSync).to,o=o.muteFlag,o=t._transMessageRemindType(o),t.patchMessageRemindType({ID:s,isC2CConversation:!(s=0),messageRemindType:o})&&(s+=1),u.l("".concat(n," updateCount:").concat(s)),1<=s&&t.emitConversationUpdate(!0,!1))})}},{key:"onGroupMessageRemindTypeUpdated",value:function(e){u.d("".concat(this._n,".onGroupMessageRemindTypeUpdated options:"),e),this._messageRemindHandler.onGroupMessageRemindTypeUpdated(e)}},{key:"deleteLocalConversation",value:function(e){var t=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],n=this._conversationMap.has(e);u.l("".concat(this._n,".deleteLocalConversation conversationID:").concat(e," has:").concat(n)),n&&(this._conversationMap.delete(e),this._roamingMessageKeyAndTimeMap.has(e)&&this._roamingMessageKeyAndTimeMap.delete(e),this._roamingMessageSequenceMap.has(e)&&this._roamingMessageSequenceMap.delete(e),this._setStorageConversationList(),this._messageListHandler.removeByConversationID(e),this._completedMap.delete(e),t)&&(n=!this._isTopicConversation(e),this.emitConversationUpdate(n,!1))}},{key:"recoverMessageOnInviteGroup",value:function(e){var t,n,o,s,i=this.get(7);i&&(s=this.getLocalLastMessage(e),t=this.getLocalSecondLastMessage(e),o=n=1,s&&(n=s.sequence),t&&(o=t.sequence),s=i.getGroupRemoteLastSeq(e.replace(_.CONV_GROUP,"")),u.l("".concat(this._n,".recoverMessageOnInviteGroup conversationID:").concat(e," localLastSeq:").concat(n," localSecondLastSeq:").concat(o)+" remoteLastSeq:".concat(s)),this._roamingMessageSequenceMap.has(e)&&this._roamingMessageSequenceMap.delete(e),this._messageListHandler.removeByConversationID(e),this._completedMap.delete(e),1<n-o?this._recursiveGetMessageList([],e,!1,n,o):1<s-n&&this._recursiveGetMessageList([],e,!0,s,n))}},{key:"_recursiveGetMessageList",value:function(e,t,n,o,s,i){var a=this;this.getMessageList({conversationID:t,nextReqMessageID:i}).then(function(c){var c=c.data.messageList,d=c.filter(function(p){return n?p.sequence>s&&p.sequence<=o:p.sequence>s&&p.sequence<o});e.unshift.apply(e,b(d)),0<c.length&&c[0].sequence>s&&e.length<100?a._recursiveGetMessageList(e,t,n,o,s,c[0].ID):a._emitMessageReceived(t,e)})}},{key:"_emitMessageReceived",value:function(e,t){var n,o=this;0<t.length&&(n=this.hasLocalConversation(e),u.l("".concat(this._n,"._emitMessageReceived conversationID:").concat(e," has:").concat(n," sequenceList:"),t.map(function(s){return s.sequence})),this.emitOuterEvent(V.MESSAGE_RECEIVED,t),n?this.patchConversationLastMessage(e,!0):this.getConversationProfile(e).then(function(){o.patchConversationLastMessage(e,!0)}))}},{key:"deleteLocalConversationList",value:function(e){var t=this,n=!1;e.forEach(function(o){t._conversationMap.has(o)&&(t.deleteLocalConversation(o,!1),n=!0)}),u.l("".concat(this._n,".deleteLocalConversationList conversationIDList.length:").concat(e.length," isConvIDExisted:").concat(n)),n&&this.emitConversationUpdate(!0,!1)}},{key:"isMessageSentByCurrentInstance",value:function(e){return!(!this._messageListHandler.hasLocalMessage(e.conversationID,e.ID)&&!this.singlyLinkedList.has(e.random))}},{key:"modifyMessageList",value:function(e){var t,n;e.startsWith(_.CONV_C2C)&&this._conversationMap.has(e)&&(n=this._conversationMap.get(e),t=Date.now(),this._messageListHandler.modifyMessageSentByPeer({conversationID:e,latestNick:n.userProfile.nick,latestAvatar:n.userProfile.avatar}),n=this.get(4).getNickAndAvatarByUserID(this.getMyUserID()),this._messageListHandler.modifyMessageSentByMe({conversationID:e,latestNick:n.nick,latestAvatar:n.avatar}),u.l("".concat(this._n,".modifyMessageList conversationID:").concat(e," cost:").concat(Ke(t))))}},{key:"updateUserProfileSpecifiedKey",value:function(o){u.l("".concat(this._n,".updateUserProfileSpecifiedKey options:"),o);var t=o.conversationID,n=o.nick,o=o.avatar;this._conversationMap.has(t)&&(t=this._conversationMap.get(t).userProfile,te(n)&&t.nick!==n&&(t.nick=n),te(o)&&t.avatar!==o&&(t.avatar=o),this.emitConversationUpdate(!0,!1))}},{key:"_onMyProfileModified",value:function(e){var t=this,n=this.getLocalConversationList(),o=Date.now();n.forEach(function(s){t.modifyMessageSentByMe(l({conversationID:s.conversationID},e))}),u.l("".concat(this._n,"._onMyProfileModified. modify all messages sent by me, cost:").concat(Ke(o)))}},{key:"modifyMessageSentByMe",value:function(e){this._messageListHandler.modifyMessageSentByMe(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._messageListHandler.getLatestMessageSentByMe(e)}},{key:"modifyMessageSentByPeer",value:function(e){this._messageListHandler.modifyMessageSentByPeer(e)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._messageListHandler.getLatestMessageSentByPeer(e)}},{key:"pushIntoNoticeResult",value:function(e,t){return!(!this._messageListHandler.pushIn(t)||this.singlyLinkedList.has(t.random)||(e.push(t),0))}},{key:"getLocalLastMessage",value:function(e){return this._messageListHandler.getLocalLastMessage(e)}},{key:"getLocalSecondLastMessage",value:function(e){return this._messageListHandler.getLocalSecondLastMessage(e)}},{key:"checkAndPatchRemark",value:function(){var e,t,n=this.get(8);this._conversationMap.size===0||!n||(e=b(this._conversationMap.values()).filter(function(o){return o.type===_.CONV_C2C})).length!==0&&(t=0,e.forEach(function(o){var s=o.conversationID.replace(_.CONV_C2C,"");n.isMyFriend(s)&&(s=n.getFriendRemark(s),o.remark!==s&&(o.remark=s,t+=1))}),u.l("".concat(this._n,".checkAndPatchRemark. c2c conversation count:").concat(e.length,", patched count:").concat(t)))}},{key:"updateTopicConversation",value:function(e){this._updateLocalConversationList({conversationOptionsList:e,isFromGetConversations:!0,updateUnreadCount:!0})}},{key:"sendReadReceipt",value:function(e){var t=e[0],n=null;return t.conversationType===_.CONV_C2C?n=this._m.get(6):t.conversationType===_.CONV_GROUP&&(n=this._m.get(7)),n?n.sendReadReceipt(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getReadReceiptList",value:function(e){var t=e[0],n=null;return t.conversationType===_.CONV_C2C?n=this._m.get(6):t.conversationType===_.CONV_GROUP&&(n=this._m.get(7)),n?n.getReadReceiptList(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getLastMessageTime",value:function(e){return e=this.getLocalConversation(e),e?e.lastMessage.lastTime:0}},{key:"getTotalUnreadMessageCount",value:function(){var e=this.getLocalConversationList(),t=0;return e.forEach(function(n){n.type!==_.CONV_SYSTEM&&(n.messageRemindType!==""&&n.messageRemindType!==_.MSG_REMIND_ACPT_AND_NOTE||(t+=n.unreadCount))}),t}},{key:"emitTotalUnreadMessageCountUpdate",value:function(){var e=this.getTotalUnreadMessageCount();this._convTotalUnreadCount!==e&&(u.l("".concat(this._n,".emitTotalUnreadMessageCountUpdate from ").concat(this._convTotalUnreadCount," to ").concat(e)),this._convTotalUnreadCount=e,this.emitOuterEvent(V.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED))}},{key:"_isConvNeedShow",value:function(o){if(o=this.getLocalConversation(o),C(o))return!0;var t=o.type===_.CONV_TOPIC,n=o.type===_.CONV_GROUP&&o.groupProfile.type===_.GRP_ROOM,o=o.type===_.CONV_GROUP&&o.groupProfile.type===_.GRP_LIVE;return!(t||n||o)}},{key:"setAllReceiveMessageOpt",value:function(e){return this._messageRemindHandler.setAllReceiveMessageOpt(e)}},{key:"getAllReceiveMessageOpt",value:function(){return this._messageRemindHandler.getAllReceiveMessageOpt()}},{key:"onAllReceiveMessageOptNotify",value:function(e){this._messageRemindHandler.onAllReceiveMessageOptNotify(e)}},{key:"clearUnreadCount",value:function(e){e=this.getLocalConversation(e),e&&0<e.unreadCount&&(e.unreadCount=0,this.emitConversationUpdate(!0,!1))}},{key:"storeHoppingMessageList",value:function(e){this._messageListHandler.storeHoppingMessageList(e)}},{key:"getHoppingMessage",value:function(e,t){return this._messageListHandler.getHoppingMessage(e,t)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._setStorageConversationList(!0),this._pagingStatus=zt,this._messageListHandler.reset(),this._messageRemindHandler.reset(),this._roamingMessageKeyAndTimeMap.clear(),this._roamingMessageSequenceMap.clear(),this.singlyLinkedList.reset(),this._peerReadTimeMap.clear(),this._completedMap.clear(),this._conversationMap.clear(),this._pagingTimeStamp=0,this._pagingStartIndex=0,this._pagingPinnedTimeStamp=0,this._pagingPinnedStartIndex=0,this._remoteGroupReadSequenceMap.clear(),this._convTotalUnreadCount=0,this._pagingGetCostList.length=0,this._pagingConvIDMap.clear(),this._convIDFromUnreadDBMap.clear(),this._pagingGetCostList.length=0,this._convMapForDiff.clear(),this._partialUpdatedConvMap.clear(),this.resetReady()}}]),oo),Vc=(R(Ei,[{key:"onCheckTimer",value:function(e){e%1==0&&0<this._cachedGroupTipsMap.size&&this._checkCachedGroupTips()}},{key:"_checkCachedGroupTips",value:function(){var e=this;this._cachedGroupTipsMap.forEach(function(t,n){var o=e._checkCountMap.get(n),s=e._grpM.hasLocalGroup(n);u.l("".concat(e._n,"._checkCachedGroupTips groupID:").concat(n," hasLocalGroup:").concat(s," checkCount:").concat(o)),s?(e._notifyCachedGroupTips(n),e._checkCountMap.delete(n),e._grpM.deleteUnjoinedAVChatRoom(n)):o>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupTips(n),e._checkCountMap.delete(n)):e._checkCountMap.set(n,++o)})}},{key:"onNewGroupTips",value:function(o){u.l("".concat(this._n,".onNewGroupTips options:").concat(JSON.stringify(o.dataList)));var o=this.newGroupTipsStoredAndSummary(o),t=o.eventDataList,n=o.result,o=o.AVChatRoomMessageList;0<o.length&&this._grpM.onAVChatRoomMessage(o),0<t.length&&(this._grpM.updateNextMessageSeq(t),this._grpM.get(11).onNewMessage({conversationOptionsList:t,isInstantMessage:!0})),0<n.length&&(this._grpM.emitOuterEvent(V.MESSAGE_RECEIVED,n),this.handleMessageList(n))}},{key:"newGroupTipsStoredAndSummary",value:function(e){for(var t=e.event,n=e.dataList,o=null,s=[],i=[],a={},r=[],c=0,d=n.length;c<d;c++){var p=ks(n[c]);if(!(t===6&&(this._grpM.isGroupAttributesUpdatedNotice(p)||this._grpM.isGroupCountersNotice(p)))){var I=p.groupProfile,h=I.groupID,m=I.communityType,m=m===void 0?0:m,f=I.topicID,f=f===void 0?void 0:f,I=I.invisible,k=void 0,N=this._grpM.isMessageFromTopic(m,f),x=(N&&(k=_.CONV_TOPIC,p.to=f),this._grpM.hasLocalGroup(h));if(x||!this._grpM.isUnjoinedAVChatRoom(h))if(x||N)if(this._grpM.isMessageFromOrToAVChatroom(h))p.event=t,r.push(p);else if(p.currentUser=this._grpM.getMyUserID(),p.conversationType=_.CONV_GROUP,(o=new We(p)).setElement({type:_.MSG_GRP_TIP,content:l(l({},p.elements),{},{groupProfile:p.groupProfile})}),o.isSystemMessage=!1,I!==1){var x=this._grpM.get(11),N=o,I=N.conversationID,N=N.sequence;if(t===6)o._onlineOnlyFlag=!0,i.push(o);else if(!x.pushIntoNoticeResult(i,o))continue;this._grpM.isMessageFromCommunityOfTopic(m,f)||t===6&&x.getLocalConversation(I)||(t!==6&&this._qualityStat(o),m=x.isRemoteRead({conversationID:I,sequence:N}),C(a[I])?(f=0,o.flow==="in"&&(o._isExcludedFromUnreadCount||o._onlineOnlyFlag||m||(f=1)),a[I]=s.push({conversationID:I,unreadCount:f,type:C(k)?o.conversationType:k,subType:o.conversationSubType,lastMessage:o._isExcludedFromLastMessage?"":o})-1):(s[x=a[I]].type=o.conversationType,s[x].subType=o.conversationSubType,s[x].lastMessage=o._isExcludedFromLastMessage?"":o,o.flow==="in"&&(o._isExcludedFromUnreadCount||o._onlineOnlyFlag||m||s[x].unreadCount++)))}else this._qualityStat(o);else this._cacheGroupTipsAndProbe({groupID:h,event:t,item:p})}}return{eventDataList:s,result:i,AVChatRoomMessageList:r}}},{key:"_qualityStat",value:function(e){this._grpM.get(26).addMessageSequence({key:kn,message:e})}},{key:"handleMessageList",value:function(e){var t=this;e.forEach(function(n){switch(n.payload.operationType){case 1:t._onNewMemberComeIn(n);break;case 2:t._onMemberQuit(n);break;case 3:t._onMemberKickedOut(n);break;case 4:t._onMemberSetAdmin(n);break;case 5:t._onMemberCancelledAdmin(n);break;case 6:t._onGroupProfileModified(n);break;case 7:t._onMemberInfoModified(n);break;case 8:t._onTopicProfileUpdated(n);break;default:u.w("".concat(t._n,".handleMessageList unknown operationType:").concat(n.payload.operationType))}})}},{key:"_onNewMemberComeIn",value:function(n){var n=n.payload,t=n.memberNum,n=n.groupProfile.groupID,n=this._grpM.getLocalGroupProfile(n);n&&fe(t)&&n.memberCount!==t&&(n.memberCount=t,this._updateConversationGroupProfile(n))}},{key:"_onMemberQuit",value:function(e){var n=e.payload,t=n.memberNum,n=n.groupProfile.groupID,o=this._grpM.getLocalGroupProfile(n);o&&fe(t)&&o.memberCount!==t&&(o.memberCount=t,this._updateConversationGroupProfile(o)),this._grpM.getGroupMemberHandler().deleteLocalGroupMembers(n,e.payload.userIDList)}},{key:"_onMemberKickedOut",value:function(e){var n=e.payload,t=n.memberNum,n=n.groupProfile.groupID,o=this._grpM.getLocalGroupProfile(n);o&&fe(t)&&o.memberCount!==t&&(o.memberCount=t,this._updateConversationGroupProfile(o)),this._grpM.getGroupMemberHandler().deleteLocalGroupMembers(n,e.payload.userIDList)}},{key:"_updateConversationGroupProfile",value:function(e){this._grpM.get(11).updateConversationGroupProfile([e])}},{key:"_onMemberSetAdmin",value:function(n){var t=n.payload.groupProfile.groupID,n=n.payload.userIDList,o=this._grpM.getGroupMemberHandler();n.forEach(function(s){s=o.getLocalGroupMemberInfo(t,s),s&&s.updateRole(_.GRP_MBR_ROLE_ADMIN)})}},{key:"_onMemberCancelledAdmin",value:function(n){var t=n.payload.groupProfile.groupID,n=n.payload.userIDList,o=this._grpM.getGroupMemberHandler();n.forEach(function(s){s=o.getLocalGroupMemberInfo(t,s),s&&s.updateRole(_.GRP_MBR_ROLE_MEMBER)})}},{key:"_onGroupProfileModified",value:function(s){var t=this,s=s.payload,n=s.newGroupProfile,s=s.groupProfile.groupID,o=this._grpM.getLocalGroupProfile(s),s=(Object.keys(n).forEach(function(i){switch(i){case"ownerID":t._ownerChanged(o,n);break;case"groupName":o.name=n[i];break;default:o[i]=n[i]}}),!o.isSupportTopic);this._grpM.emitGroupListUpdate(!0,s)}},{key:"_ownerChanged",value:function(n,t){var n=n.groupID,o=this._grpM.getLocalGroupProfile(n),s=this._grpM.getMyUserID();s===t.ownerID&&(o.updateGroup({selfInfo:{role:_.GRP_MBR_ROLE_OWNER}}),o=(t=this._grpM.getGroupMemberHandler()).getLocalGroupMemberInfo(n,s),s=this._grpM.getLocalGroupProfile(n).ownerID,t=t.getLocalGroupMemberInfo(n,s),o&&o.updateRole(_.GRP_MBR_ROLE_OWNER),t&&t.updateRole(_.GRP_MBR_ROLE_MEMBER))}},{key:"_onMemberInfoModified",value:function(e){var t=e.to,o=e.payload,n=o.groupProfile,o=o.memberList,s=n.groupID,i=(Ve(t)&&this._updateTopicMuteTime(e),this._grpM.getGroupMemberHandler());o.forEach(function(a){var r=i.getLocalGroupMemberInfo(s,a.userID);r&&fe(a.muteTime)&&r.updateMuteUntil(a.muteTime)})}},{key:"_updateTopicMuteTime",value:function(o){var t=o.to,o=o.payload,s=o.groupProfile,o=o.memberList,n=o===void 0?[]:o,o=this._grpM.get(10),s=s.groupID,i=o.getLocalTopic(s,t);if(i){for(var a=!1,r=0;r<n.length;r++){var c=n[r];if(c.userID===this._grpM.getMyUserID()&&0<=c.muteTime){i.updateSelfInfo({muteTime:c.muteTime}),a=!0;break}}a&&this._grpM.emitOuterEvent(V.TOPIC_UPDATED,{groupID:s,topic:i})}}},{key:"_onTopicProfileUpdated",value:function(e){var n=e.payload,t=n.groupProfile.groupID,n=n.newTopicInfo;this._grpM.get(10).onTopicProfileUpdated(l({groupID:t,topicID:e.to},n))}},{key:"_cacheGroupTips",value:function(e,t){this._cachedGroupTipsMap.has(e)||this._cachedGroupTipsMap.set(e,[]),this._cachedGroupTipsMap.get(e).push(t)}},{key:"_deleteCachedGroupTips",value:function(e){this._cachedGroupTipsMap.has(e)&&this._cachedGroupTipsMap.delete(e)}},{key:"_notifyCachedGroupTips",value:function(e){var t=this,n=this._cachedGroupTipsMap.get(e)||[];n.forEach(function(o){t.onNewGroupTips(o)}),this._deleteCachedGroupTips(e),u.l("".concat(this._n,"._notifyCachedGroupTips groupID:").concat(e," count:").concat(n.length))}},{key:"_cacheGroupTipsAndProbe",value:function(s){var t=this,n=s.groupID,o=s.event,s=s.item;this._cacheGroupTips(n,{event:o,dataList:[s]}),this._grpM.getGroupSimplifiedInfo(n).then(function(i){i.type===_.GRP_AVCHATROOM?t._grpM.hasLocalGroup(n)?t._notifyCachedGroupTips(n):t._grpM.setUnjoinedAVChatRoom(n):(t._grpM.updateGroupMap([i]),t._notifyCachedGroupTips(n))}),this._checkCountMap.has(n)||this._checkCountMap.set(n,0),u.l("".concat(this._n,"._cacheGroupTipsAndProbe groupID:").concat(n))}},{key:"reset",value:function(){this._cachedGroupTipsMap.clear(),this._checkCountMap.clear()}}]),Ei),Bc=(R(Li,[{key:"onCheckTimer",value:function(e){e%1==0&&0<this._cachedGroupMessageMap.size&&this._checkCachedGroupMessage()}},{key:"_checkCachedGroupMessage",value:function(){var e=this;this._cachedGroupMessageMap.forEach(function(t,n){var o=e._checkCountMap.get(n),s=e._grpM.hasLocalGroup(n);u.l("".concat(e._n,"._checkCachedGroupMessage groupID:").concat(n," hasLocalGroup:").concat(s," checkCount:").concat(o)),s?(e._notifyCachedGroupMessage(n),e._checkCountMap.delete(n),e._grpM.deleteUnjoinedAVChatRoom(n)):o>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupMessage(n),e._checkCountMap.delete(n)):e._checkCountMap.set(n,++o)})}},{key:"handleUpdateGroupLastMessage",value:function(e){var t="".concat(this._n,".handleUpdateGroupLastMessage");if(this._grpM.getGroupMap().size!==0){for(var n,o,s,i,a=!1,r=0,c=e.length;r<c;r++)(n=e[r]).type===_.CONV_GROUP&&n.lastMessage.lastSequence!==0&&n.lastMessage.payload!==null&&(o=n.conversationID.split(/^GROUP/)[1],(o=this._grpM.getLocalGroupProfile(o))&&(s=o.lastMessage,i=n.lastMessage,JSON.stringify(s)!==JSON.stringify(i)&&(o.lastMessage=l({},n.lastMessage),a=!0)));u.l("".concat(t," conversation count:").concat(e.length,", local group count:").concat(this._grpM.getLocalGroupList().length," isGroupListUpdated:").concat(a)),a&&(this._grpM.sortLocalGroupList(),this._grpM.emitGroupListUpdate(!0,!1))}else this.tempConversationList=e}},{key:"onNewGroupMessage",value:function(e){u.d("".concat(this._n,".onNewGroupMessage count:").concat(e.dataList.length));var o=this._newGroupMessageStoredAndSummary(e),t=o.conversationOptionsList,n=o.messageList,o=o.AVChatRoomMessageList,o=(0<o.length&&this._grpM.onAVChatRoomMessage(o),Rs(n)),o=(0<o.length&&this._grpM.emitOuterEvent(V.MESSAGE_MODIFIED,o),0<t.length&&(this._grpM.updateNextMessageSeq(t),this._grpM.get(11).onNewMessage({conversationOptionsList:t,isInstantMessage:e.isInstantMessage||!0,updateUnreadCount:e.updateUnreadCount||!0})),Ns(n));0<o.length&&this._grpM.emitOuterEvent(V.MESSAGE_RECEIVED,o),n.length=0}},{key:"_newGroupMessageStoredAndSummary",value:function(e){var t=e.dataList,n=e.event,o=e.isInstantMessage,s=null,i=[],a=[],r=[],c={},d=this._grpM.getFileDownloadProxy(),p=t.length;1<p&&t.sort(function(rt,Eo){return rt.sequence-Eo.sequence});for(var h=this._grpM.get(11),m=this._grpM.get(4),f=0;f<p;f++){var I,k=ks(t[f]),ie=k.groupProfile,N=ie.groupID,x=ie.communityType,x=x===void 0?0:x,Y=ie.topicID,Y=Y===void 0?void 0:Y,ie=ie.invisible,Le=void 0,Ze=this._grpM.isMessageFromTopic(x,Y),et=(Ze&&(Le=_.CONV_TOPIC,k.to=Y),this._grpM.hasLocalGroup(N));!et&&this._grpM.isUnjoinedAVChatRoom(N)||(et||Ze?this._grpM.isMessageFromOrToAVChatroom(N)?(k.event=n,r.push(k)):(k.currentUser=this._grpM.getMyUserID(),k.conversationType=_.CONV_GROUP,k.isSystemMessage=!!k.isSystemMessage,(s=new We(k)).setElement(k.elements,d),ie!==1?(et=t[f].isModified===1,h.isMessageSentByCurrentInstance(s)?s.isModified=et:et=!1,k.onlineOnlyFlag===1?(s._onlineOnlyFlag=!0,h.isMessageSentByCurrentInstance(s)||a.push(s)):this._grpM.isMessageFromCommunityOfTopic(x,Y)?a.push(s):(s.from!==this._grpM.getMyUserID()||(Ze=h.getLatestMessageSentByMe(s.conversationID))&&(ie=Ze.nick,x=Ze.avatar,ie===s.nick&&x===s.avatar||(h.modifyMessageSentByMe({conversationID:I,latestNick:s.nick,latestAvatar:s.avatar}),m.mockOnNickAvatarModified(s.nick,s.avatar))),h.pushIntoMessageList(a,s,et)&&(this._qualityStat(o,s),I=(Y=s).conversationID,Ze=Y.sequence,ie=h.isRemoteRead({conversationID:I,sequence:Ze}),C(c[I])?(x=0,s.flow==="in"&&(s._isExcludedFromUnreadCount||ie||(x=1)),c[I]=i.push({conversationID:I,unreadCount:x,type:C(Le)?s.conversationType:Le,subType:s.conversationSubType,lastMessage:s._isExcludedFromLastMessage?"":s})-1):(i[et=c[I]].type=C(Le)?s.conversationType:Le,i[et].subType=s.conversationSubType,i[et].lastMessage=s._isExcludedFromLastMessage?"":s,s.flow==="in"&&(s._isExcludedFromUnreadCount||ie||i[et].unreadCount++))))):this._qualityStat(o,s)):this._cacheGroupMessageAndProbe({groupID:N,event:n,item:k}))}return{conversationOptionsList:i,messageList:a,AVChatRoomMessageList:r}}},{key:"_qualityStat",value:function(e,t){var n=this._grpM.get(26);n.addMessageSequence({key:kn,message:t}),e&&0<t.clientTime&&n.addMessageDelay(t.clientTime)}},{key:"onGroupMessageRevoked",value:function(e){var t=this,n=this._grpM.get(11),o=[],s=[];e.dataList.forEach(function(i){var a=i.elements.revokedInfos,r=i.revokerInfo,c=i.groupProfile,d=!1;c&&(d=lt({groupID:c.groupID})||!G(c.topicID)),C(a)||a.forEach(function(p){var h,m=G(p.topicID)?"GROUP".concat(p.groupID):"GROUP".concat(p.topicID),f=n.getLocalConversation(m),I=p.revokerInfo&&p.revokerInfo.revoker||r&&r.revoker,k=r&&r.reason||"";f&&st(f.type)?h={conversationID:m,sequence:p.sequence,ID:"".concat(p.tinyID,"-").concat(p.clientTime,"-").concat(p.random)}:(f=n.revoke(m,p.sequence,p.random))?h=f:(h={conversationID:m,sequence:p.sequence},p.tinyID&&p.clientTime&&p.random&&(h.ID="".concat(p.tinyID,"-").concat(p.clientTime,"-").concat(p.random)),p.time&&(h.time=p.time)),h&&(h.revoker=I,h.revokeReason=k,h.revokerInfo={userID:I,nick:"",avatar:""},d?(h.revokerInfo.nick=c.nick,h.revokerInfo.avatar=c.avatar,o.push(h)):s.push(h))})}),s.length===0&&o.length===0||(n.onMessageRevoked([].concat(o,s)),0<o.length&&this._grpM.emitOuterEvent(V.MESSAGE_REVOKED,o),0<s.length&&n.updateRevokerInfo(s).then(function(i){t._grpM.emitOuterEvent(V.MESSAGE_REVOKED,i)}))}},{key:"_groupListTreeShaking",value:function(e){for(var t=new Map(b(this._grpM.getGroupMap())),n=0,o=e.length;n<o;n++)t.delete(e[n].groupID);this._grpM.hasJoinedAVChatRoom()&&this._grpM.getJoinedAVChatRoom().forEach(function(r){t.delete(r)}),this._grpM.getGroupMap().forEach(function(r,c){r.isSupportTopic&&t.delete(c)});for(var s=b(t.keys()),i=0,a=s.length;i<a;i++)this._grpM.deleteGroup(s[i])}},{key:"syncGroupList",value:function(){var e=this,s=0<arguments.length&&arguments[0]!==void 0&&arguments[0],t=(this._pagingStatus===zt&&this._grpM.clearGroupMap(),["Type","Name","FaceUrl","NextMsgSeq","LastMsgTime","AtInfoList","LastRecallTime"]),n=this.PAGING_GRP_COUNT_LIMIT,o=[];if(s===!0)return this._pagingGetGroupListWithTopic({limit:n,offset:0,groupBaseInfoFilter:t,groupList:o});var s="syncGroupList",i="".concat(this._n,".").concat(s),a=new S(s);return this._pagingGetGroupList({limit:n,offset:0,groupBaseInfoFilter:t,groupList:o}).then(function(){var r=za(e._pagingGetCostList),c=Ja(e._pagingGetCostList),d=(e._pagingGetCostList.length=0,e._pagingStatus=jn,e._groupListTreeShaking(o),e._grpM.updateGroupMap(o),e._grpM.getLocalGroupList().length),d="count:".concat(d," sum:").concat(c," avg:").concat(r);return u.l("".concat(i," ok. ").concat(d)),a.setMessage(d).end(),e.tempConversationList&&(e.handleUpdateGroupLastMessage(e.tempConversationList),e.tempConversationList=null),e._grpM.emitGroupListUpdate(!0,!0),q({groupList:e._grpM.getLocalGroupList()})}).catch(function(r){return e._pagingStatus=Dn,a.setError(r).end(),u.e("".concat(i," failed. error:"),r),v(r)})}},{key:"getGroupList",value:function(){var e=this,t="".concat(this._n,".").concat("getGroupList");if(u.l("".concat(t," pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===Dn||this._pagingStatus===zt)return this.syncGroupList().then(function(){var o=e._grpM.getLocalGroupList();return q({groupList:o,isSyncCompleted:e.isPagingGetCompleted()})}).catch(function(o){return u.e("".concat(t," failed. error:"),o),v(o)});var n=this._grpM.getLocalGroupList();return u.l("".concat(t,". returned group count:").concat(n.length)),Q({groupList:n,isSyncCompleted:this.isPagingGetCompleted()})}},{key:"isPagingGetCompleted",value:function(){return this._pagingStatus===jn}},{key:"_pagingGetGroupList",value:function(e){var t=this,n="".concat(this._n,".").concat("_pagingGetGroupList"),o=e.isCommunityRelay,s=o!==void 0&&o,i=e.limit,a=e.offset,r=e.groupBaseInfoFilter,c=e.groupList,d=Date.now();return this._grpM.req({proto:g.GET_GRP_LIST,data:{type:s?_.GRP_COMMUNITY:void 0,memberAccount:this._grpM.getMyUserID(),limit:i,offset:a,responseFilter:{groupBaseInfoFilter:r,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]}}}).then(function(f){var f=f.data,h=f.groups,h=h===void 0?[]:h,f=f.totalCount,h=(c.push.apply(c,b(h)),t._handleGroupAtInfoWithoutTopic(s,h),a+i),m=!(h<f),f="offset:".concat(a," limit:").concat(i," totalCount:").concat(f," isCompleted:").concat(m," ")+"currentCount:".concat(c.length," isCommunityRelay:").concat(s);return t._pagingGetCostList.push(Ke(d,!1)),u.l("".concat(n," ok. ").concat(f," cost:").concat(Ke(d))),s||m?!s&&m?(u.l("".concat(n," start to get community list")),a=0,t._pagingGetGroupList({limit:i,offset:a,groupBaseInfoFilter:r,groupList:c,isCommunityRelay:!0})):s&&!m?(a=h,t._pagingGetGroupList({limit:i,offset:a,groupBaseInfoFilter:r,groupList:c,isCommunityRelay:!0})):q({groupList:c}):(a=h,t._pagingGetGroupList({limit:i,offset:a,groupBaseInfoFilter:r,groupList:c}))}).catch(function(p){return p.code===10018?(u.w("".concat(t.logPrefix," response size exceeds the limit, request count:").concat(i)),i=50,t._pagingGetGroupList({limit:i,offset:a,groupBaseInfoFilter:r,groupList:c,isCommunityRelay:s})):s?(p.code===11e3&&u.l("".concat(n," ok. community unavailable")),Q({groupList:c})):v(p)})}},{key:"_pagingGetGroupListWithTopic",value:function(e){var t=this,n="".concat(this._n,"._pagingGetGroupListWithTopic"),o=e.limit,s=e.offset,i=e.groupBaseInfoFilter,a=e.groupList,r=Date.now();return this._grpM.req({proto:g.GET_GRP_LIST,data:{type:_.GRP_COMMUNITY,memberAccount:this._grpM.getMyUserID(),limit:o,offset:s,responseFilter:{groupBaseInfoFilter:i,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]},isSupportTopic:1}}).then(function(d){var d=d.data,p=d.groups,d=d.totalCount,p=(a.push.apply(a,b(p===void 0?[]:p)),s+o),h=!(p<d);return u.l("".concat(n," ok. offset:").concat(s," limit:").concat(o," totalCount:").concat(d," isCompleted:").concat(h," currentCount:").concat(a.length," cost:").concat(Ke(r))),h?(t._grpM.updateGroupMap(a),t._grpM.emitGroupListUpdate(!0,!1),d=t._grpM.getLocalGroupList().filter(function(m){return m.isSupportTopic===!0}),q({groupList:d})):(s=p,t._pagingGetGroupListWithTopic({limit:o,offset:s,groupBaseInfoFilter:i,groupList:a}))}).catch(function(c){return c.code===10018?(u.w("".concat(t.logPrefix," response size exceeds the limit, request count:").concat(o)),o=50,t._pagingGetGroupListWithTopic({limit:o,offset:s,groupBaseInfoFilter:i,groupList:a})):v(c)})}},{key:"_cacheGroupMessage",value:function(e,t){this._cachedGroupMessageMap.has(e)||this._cachedGroupMessageMap.set(e,[]),this._cachedGroupMessageMap.get(e).push(t)}},{key:"_deleteCachedGroupMessage",value:function(e){this._cachedGroupMessageMap.has(e)&&this._cachedGroupMessageMap.delete(e)}},{key:"_notifyCachedGroupMessage",value:function(e){var t=this,n=this._cachedGroupMessageMap.get(e)||[];n.forEach(function(o){t.onNewGroupMessage(o)}),this._deleteCachedGroupMessage(e),u.l("".concat(this._n,"._notifyCachedGroupMessage groupID:").concat(e," count:").concat(n.length))}},{key:"_cacheGroupMessageAndProbe",value:function(s){var t=this,n=s.groupID,o=s.event,s=s.item;this._cacheGroupMessage(n,{event:o,dataList:[s]}),this._grpM.getGroupSimplifiedInfo(n).then(function(i){i.type===_.GRP_AVCHATROOM?t._grpM.hasLocalGroup(n)?t._notifyCachedGroupMessage(n):t._grpM.setUnjoinedAVChatRoom(n):(t._grpM.updateGroupMap([i]),t._notifyCachedGroupMessage(n))}),this._checkCountMap.has(n)||this._checkCountMap.set(n,0),u.l("".concat(this._n,"._cacheGroupMessageAndProbe groupID:").concat(n))}},{key:"_handleGroupAtInfoWithoutTopic",value:function(e,t){var n=this;e&&t.length!==0&&t.forEach(function(i){var s=i.groupID,i=i.groupAtInfoList,a=[];C(i)||(i.forEach(function(r){a.push(l(l({},r),{},{groupID:s}))}),n._grpM.get(11).onNewGroupAtTips({dataList:a}))})}},{key:"setPagingGroupCount",value:function(e){C(e)||(this.PAGING_GRP_COUNT_LIMIT=parseInt(e,10))}},{key:"reset",value:function(){this.PAGING_GRP_COUNT_LIMIT=200,this._cachedGroupMessageMap.clear(),this._checkCountMap.clear(),this._pagingStatus=zt,this._pagingGetCostList=[]}}]),Li),Hc=(R(Si,[{key:"_onCloudConfigUpdated",value:function(){var e=this._grpM.getCloudConfig("grp_attr_cache_time");C(e)||(this.CACHE_EXPIRE_TIME=Number(e))}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesMap.forEach(function(e){e.localMainSequence=0})}},{key:"isGroupAttributesUpdatedNotice",value:function(n){var t=n.to,n=n.elements.newGroupProfile,o=!C(n)&&!G(n.groupAttributeOption);return o&&this._onGroupAttributesUpdated({groupID:t,groupAttributeOption:n.groupAttributeOption}),o}},{key:"_onGroupAttributesUpdated",value:function(a){var t=this,n=a.groupID,a=a.groupAttributeOption,o=a.mainSequence,s=a.isWithChangedAttributeInfo,i=a.groupAttributeList,i=i===void 0?[]:i,a=a.operationType;if(u.l("".concat(this._n,".onGroupAttributesUpdated. ")+"groupID:".concat(n," isWithChangedAttributeInfo:").concat(s," operationType:").concat(a)),!C(a)){this._groupAttributesCopy=this._getCachedAttributes({groupID:n});var r=o-this._getLocalGroupAttributes(n).localMainSequence;if(r!=0){if(s===1&&r==1)return this._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:o,groupAttributeList:i,operationType:a}),void this._emitGroupAttributesUpdated(n);this._hasLocalGroupAttributes(n)&&(s=this._getLocalGroupAttributes(n).avChatRoomKey,this._getGroupAttributes({groupID:n,avChatRoomKey:s}).then(function(){t._emitGroupAttributesUpdated(n)}))}}}},{key:"initGroupAttributesCache",value:function(n){var t=n.groupID,n=n.avChatRoomKey,n=n===void 0?void 0:n;this._groupAttributesMap.set(t,{lastUpdateTime:0,localMainSequence:0,remoteMainSequence:0,attributes:new Map,avChatRoomKey:n}),u.l("".concat(this._n,".initGroupAttributesCache groupID:").concat(t," avChatRoomKey:").concat(n))}},{key:"initGroupAttributes",value:function(i){var t=this,n=i.groupID,o=i.groupAttributes,i=this._getLocalGroupAttributes(n),s=i.remoteMainSequence,i=i.avChatRoomKey,a=new S("initGroupAttributes");return a.setMessage("groupID:".concat(n," avChatRoomKey:").concat(i," mainSequence:").concat(s)),this._grpM.req({proto:g.SET_GRP_ATTR,data:{groupID:n,avChatRoomKey:i,mainSequence:s,groupAttributeList:this._transformGroupAttributes(o)}}).then(function(d){u.l("".concat(t._n,".").concat("initGroupAttributes"," ok. groupID:").concat(n));var d=d.data,c=d.mainSequence,d=b(d.groupAttributeList);return d.forEach(function(p){p.value=o[p.key]}),t._groupAttributesCopy=t._getCachedAttributes({groupID:n}),t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:c,groupAttributeList:d,operationType:1}),t._emitGroupAttributesUpdated(n),a.end(),q({groupAttributes:o})}).catch(function(r){return a.setError(r).end(),v(r)})}},{key:"setGroupAttributes",value:function(c){var t=this,n="".concat(this._n,".").concat("setGroupAttributes"),o=c.groupID,s=c.groupAttributes,c=this._getLocalGroupAttributes(o),i=c.remoteMainSequence,a=c.avChatRoomKey,r=c.attributes,c=this._transformGroupAttributes(s),d=(c.forEach(function(p){var h=p.key;p.sequence=0,r.has(h)&&(p.sequence=r.get(h).sequence)}),new S("setGroupAttributes"));return d.setMessage("groupID:".concat(o," groupAttributes:").concat(JSON.stringify(s))),u.l("".concat(n,". groupID:").concat(o," mainSequence:").concat(i)),this._grpM.req({proto:g.MODIFY_GRP_ATTR,data:{groupID:o,avChatRoomKey:a,mainSequence:i,groupAttributeList:c}}).then(function(m){u.l("".concat(n," ok."));var m=m.data,h=m.mainSequence,m=b(m.groupAttributeList);return m.forEach(function(f){f.value=s[f.key]}),t._groupAttributesCopy=t._getCachedAttributes({groupID:o}),t._refreshCachedGroupAttributes({groupID:o,remoteMainSequence:h,groupAttributeList:m,operationType:2}),t._emitGroupAttributesUpdated(o),d.end(),q({groupAttributes:s})}).catch(function(p){return d.setError(p).end(),v(p)})}},{key:"deleteGroupAttributes",value:function(o){var t=this,n=o.groupID,o=o.keyList,o=o===void 0?[]:o,r=this._getLocalGroupAttributes(n),s=r.remoteMainSequence,d=r.avChatRoomKey,i=r.attributes,a=b(i.keys()),r=g.CLEAR_GRP_ATTR,c=3,d={groupID:n,avChatRoomKey:d,mainSequence:s},p=[],h=(0<o.length&&(a=[],r=g.DEL_GRP_ATTR,c=4,o.forEach(function(m){var f=0;i.has(m)&&(f=i.get(m).sequence,a.push(m)),p.push({key:m,sequence:f})}),d.groupAttributeList=p),new S("deleteGroupAttributes"));return h.setMessage("groupID:".concat(n," mainSequence:").concat(s," keyList:").concat(o," proto:").concat(r)),this._grpM.req({proto:r,data:d}).then(function(m){return u.l("".concat(t._n,".").concat("deleteGroupAttributes"," ok. groupID:").concat(n)),m=m.data.mainSequence,t._groupAttributesCopy=t._getCachedAttributes({groupID:n}),t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:m,groupAttributeList:p,operationType:c}),t._emitGroupAttributesUpdated(n),h.end(),q({keyList:a})}).catch(function(m){return h.setError(m).end(),v(m)})}},{key:"getGroupAttributes",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupAttributes"),o=e.groupID,r=this._getLocalGroupAttributes(o),s=r.avChatRoomKey,i=r.lastUpdateTime,a=r.localMainSequence,r=r.remoteMainSequence,c=new S("getGroupAttributes");return c.setMessage("groupID:".concat(o," localMainSequence:").concat(a," remoteMainSequence:").concat(r," keyList:").concat(e.keyList)),Date.now()-i>=this.CACHE_EXPIRE_TIME||a<r?this._getGroupAttributes({groupID:o,avChatRoomKey:s}).then(function(d){return c.setMoreMessage("get attributes from remote. count:".concat(d.length)).end(),u.l("".concat(n," from remote. groupID:").concat(o)),d=t._getCachedAttributes(e),q({groupAttributes:d})}).catch(function(d){return c.setError(d).end(),v(d)}):(c.setMoreMessage("get attributes from cache").end(),u.l("".concat(n," from cache. groupID:").concat(o)),i=this._getCachedAttributes(e),Q({groupAttributes:i}))}},{key:"_getGroupAttributes",value:function(e){var t=this,n=0;return C(e.avChatRoomKey)||(n=1),this._grpM.req({proto:g.GET_GRP_ATTR,data:l(l({},e),{},{groupType:n})}).then(function(i){u.l("".concat(t._n,"._getGroupAttributes ok. groupID:").concat(e.groupID));var i=i.data,s=i.mainSequence,i=i.groupAttributeList,a=b(i);return C(s)||t._refreshCachedGroupAttributes({groupID:e.groupID,remoteMainSequence:s,groupAttributeList:a,operationType:5}),i}).catch(function(o){return v(o)})}},{key:"_refreshCachedGroupAttributes",value:function(s){var t=s.groupID,n=s.remoteMainSequence,o=s.groupAttributeList,s=s.operationType;if(this._hasLocalGroupAttributes(t)){var i=this._getLocalGroupAttributes(t),a=i.localMainSequence;if(s===5||n-a==1)i.remoteMainSequence=n,i.localMainSequence=n,i.lastUpdateTime=Date.now(),this._updateCachedAttributes({groupAttributes:i,groupAttributeList:o,operationType:s});else{if(a===n)return;i.remoteMainSequence=n}this._groupAttributesMap.set(t,i),o="operationType:".concat(s," localMainSequence:").concat(a," remoteMainSequence:").concat(n),u.l("".concat(this._n,"._refreshCachedGroupAttributes. ").concat(o))}}},{key:"_getCachedAttributes",value:function(n){var t=n.groupID,n=n.keyList,n=n===void 0?[]:n,o={};if(this._hasLocalGroupAttributes(t)){var s=this._getLocalGroupAttributes(t).attributes;if(0<n.length)n.forEach(function(c){s.has(c)&&(o[c]=s.get(c).value)});else{var i,a=Ee(s.keys());try{for(a.s();!(i=a.n()).done;){var r=i.value;o[r]=s.get(r).value}}catch(c){a.e(c)}finally{a.f()}}}return o}},{key:"_updateCachedAttributes",value:function(o){var t=o.groupAttributes,n=o.groupAttributeList,o=o.operationType;o!==3?o!==4?(o===1&&t.attributes.clear(),n.forEach(function(r){var i=r.key,a=r.value,r=r.sequence;t.attributes.set(i,{value:a,sequence:r})})):n.forEach(function(s){t.attributes.delete(s.key)}):t.attributes.clear()}},{key:"_hasLocalGroupAttributes",value:function(e){return this._groupAttributesMap.has(e)}},{key:"_getLocalGroupAttributes",value:function(e){return this._hasLocalGroupAttributes(e)||this.initGroupAttributesCache({groupID:e}),this._groupAttributesMap.get(e)}},{key:"_transformGroupAttributes",value:function(e){var t=[];return Object.keys(e).forEach(function(n){t.push({key:n,value:e[n]})}),t}},{key:"_emitGroupAttributesUpdated",value:function(e){var t=this._getCachedAttributes({groupID:e}),o=this._computeAttrChangedInfo(t),n=o.updatedKeyList,o=o.deletedKeyList;u.l("".concat(this._n,"._emitGroupAttributesUpdated update:").concat(n.length,", delete:").concat(o.length)),n.length===0&&o.length===0||this._grpM.emitOuterEvent(V.GROUP_ATTRIBUTES_UPDATED,{groupID:e,groupAttributes:t,updatedKeyList:n,deletedKeyList:o})}},{key:"_computeAttrChangedInfo",value:function(e){var t=this,n=[],o=[];return Object.keys(e).forEach(function(s){e[s]!==t._groupAttributesCopy[s]&&n.push(s)}),Object.keys(this._groupAttributesCopy).forEach(function(s){C(e[s])&&o.push(s)}),this._groupAttributesCopy={},{updatedKeyList:n,deletedKeyList:o}}},{key:"deleteLocalGroupAttributes",value:function(e){this._hasLocalGroupAttributes(e)&&this._groupAttributesMap.delete(e)}},{key:"reset",value:function(){this._groupAttributesMap.clear(),this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4}}]),Si),Kc=(R(Di,[{key:"_onCloudConfigUpdated",value:function(){var e=this._grpM.getCloudConfig("grp_counter_expire_time");C(e)||(this.EXPIRE_TIME=Number(e))}},{key:"isGroupCountersNotice",value:function(n){var t=n.to,n=n.elements.groupCounterInfo,o=!1;return G(n)||(this._onGroupCountersUpdated({groupID:t,groupCounterInfo:n}),o=!0),o}},{key:"_onGroupCountersUpdated",value:function(e){var t=this,n=e.groupID;e.groupCounterInfo.forEach(function(a){var s=a.type,i=a.groupCounterSeq,a=a.counterList,a=a===void 0?[]:a;s!==0&&s!==2||(t._updateLocalGroupCounters({groupID:n,groupCounterSeq:i,counterList:a}),a.forEach(function(r){t._grpM.emitOuterEvent(V.GROUP_COUNTER_UPDATED,{groupID:n,key:r.key,value:r.value})})),s===1&&t._deleteLocalGroupCounters({groupID:n,groupCounterSeq:i,counterList:a})}),u.l("".concat(this._n,"._onGroupCountersUpdated groupID:").concat(n))}},{key:"initGroupCountersCache",value:function(n){var t=n.groupID,n=n.avChatRoomKey;this._groupCountersMap.set(t,{lastUpdateTime:0,groupCounterSeq:0,counters:new Map,avChatRoomKey:n}),u.l("".concat(this._n,".initGroupCountersCache groupID:").concat(t," avChatRoomKey:").concat(n))}},{key:"setGroupCounters",value:function(o){if(!this._grpM.canIUse(de.GRP_COUNTER))return this._grpM.cannotUseCommercialAbility("setGroupCounters");var t="".concat(this._n,".").concat("setGroupCounters"),n=o.groupID,o=o.counters,o=this._convertObjectToList(o),s=this._getLocalGroupCounters(n).avChatRoomKey,i="groupID:".concat(n," count:").concat(o.length),a=new S("setGroupCounters");return a.setMessage("".concat(i)),u.l("".concat(t,". ").concat(i)),this._updateGroupCounters({groupID:n,counterList:o,avChatRoomKey:s,mode:"Set"}).then(function(r){return a.end(),u.l("".concat(t," ok.")),q({counters:r})}).catch(function(r){return a.setError(r).end(),u.e("".concat(t," failed. error:"),r),v(r)})}},{key:"increaseGroupCounter",value:function(i){var t="increaseGroupCounter";if(!this._grpM.canIUse(de.GRP_COUNTER))return this._grpM.cannotUseCommercialAbility(t);var n="".concat(this._n,".").concat(t),o=i.groupID,s=i.key,i=i.value,a=this._getLocalGroupCounters(o).avChatRoomKey,r="groupID:".concat(o," key:").concat(s," value:").concat(i),c=new S(t);return c.setMessage("".concat(r)),u.l("".concat(n,". ").concat(r)),this._updateGroupCounters({groupID:o,counterList:[{key:s,value:i}],avChatRoomKey:a,mode:"Increase"}).then(function(d){return c.end(),u.l("".concat(n," ok.")),q({counters:d})}).catch(function(d){return c.setError(d).end(),u.e("".concat(n," failed. error:"),d),v(d)})}},{key:"decreaseGroupCounter",value:function(i){var t="decreaseGroupCounter";if(!this._grpM.canIUse(de.GRP_COUNTER))return this._grpM.cannotUseCommercialAbility(t);var n="".concat(this._n,".").concat(t),o=i.groupID,s=i.key,i=i.value,a=this._getLocalGroupCounters(o).avChatRoomKey,r="groupID:".concat(o," key:").concat(s," value:").concat(i),c=new S(t);return c.setMessage("".concat(r)),u.l("".concat(n,". ").concat(r)),this._updateGroupCounters({groupID:o,counterList:[{key:s,value:i}],avChatRoomKey:a,mode:"Decrease"}).then(function(d){return c.end(),u.l("".concat(n," ok.")),q({counters:d})}).catch(function(d){return c.setError(d).end(),u.e("".concat(n," failed. error:"),d),v(d)})}},{key:"getGroupCounters",value:function(a){var t=this;if(!this._grpM.canIUse(de.GRP_COUNTER))return this._grpM.cannotUseCommercialAbility("getGroupCounters");var n="".concat(this._n,".").concat("getGroupCounters"),o=a.groupID,a=a.keyList,s=a===void 0?[]:a,a=this._getLocalGroupCounters(o),i=a.avChatRoomKey,a=a.lastUpdateTime,r=new S("getGroupCounters");return r.setMessage("groupID:".concat(o)),Date.now()-a>=this.EXPIRE_TIME?this._getRemoteGroupCounters({groupID:o,avChatRoomKey:i}).then(function(c){return r.setMoreMessage("from remote. count:".concat(c.length)).end(),u.l("".concat(n," from remote. groupID:").concat(o)),c=t._getLocalCounters(o,s),q({counters:c})}).catch(function(c){return r.setError(c).end(),v(c)}):(r.setMoreMessage("from cache").end(),u.l("".concat(n," from cache. groupID:").concat(o)),a=this._getLocalCounters(o,s),Q({counters:a}))}},{key:"_getRemoteGroupCounters",value:function(e){var t=this;return this._grpM.req({proto:g.GET_GRP_COUNTER,data:l({},e)}).then(function(s){var s=s.data,o=s.counterList,o=o===void 0?[]:o,s=s.groupCounterSeq;return t._updateLocalGroupCounters({groupID:e.groupID,counterList:o,groupCounterSeq:s}),u.l("".concat(t._n,"._getRemoteGroupCounters ok. groupID:").concat(e.groupID)),o}).catch(function(n){return v(n)})}},{key:"_convertObjectToList",value:function(e){var t=[];return Object.keys(e).forEach(function(n){t.push({key:n,value:e[n]})}),t}},{key:"_updateGroupCounters",value:function(e){var t="".concat(this._n,"._updateGroupCounters"),n=e.groupID,o=e.avChatRoomKey,s=e.mode;return u.l("".concat(t,". groupID:").concat(n," avChatRoomKey:").concat(o," mode:").concat(s)),this._grpM.req({proto:g.UPDATE_GRP_COUNTER,data:l({},e)}).then(function(a){u.l("".concat(t," ok."));var a=a.data.counterList,r={};return(a===void 0?[]:a).forEach(function(p){var d=p.key,p=p.value;r[d]=p}),r}).catch(function(i){return v(i)})}},{key:"_hasLocalGroupCounters",value:function(e){return this._groupCountersMap.has(e)}},{key:"_getLocalGroupCounters",value:function(e){return this._hasLocalGroupCounters(e)||this.initGroupCountersCache({groupID:e}),this._groupCountersMap.get(e)}},{key:"_updateLocalGroupCounters",value:function(a){var t,n,o,s=a.groupID,i=a.counterList,i=i===void 0?[]:i,a=a.groupCounterSeq;this._hasLocalGroupCounters(s)&&(o=this._getLocalGroupCounters(s),t=o.counters,n=o.avChatRoomKey,o=o.groupCounterSeq,0<a&&a<o||(i.forEach(function(d){var c=d.key,d=d.value;t.set(c,d)}),this._groupCountersMap.set(s,{lastUpdateTime:Date.now(),groupCounterSeq:a,counters:t,avChatRoomKey:n})))}},{key:"_deleteLocalGroupCounters",value:function(i){var t,n,o=i.groupID,s=i.counterList,s=s===void 0?[]:s,i=i.groupCounterSeq;this._hasLocalGroupCounters(o)&&(n=this._getLocalGroupCounters(o),t=n.counters,n=n.avChatRoomKey,s.forEach(function(a){t.delete(a.key)}),this._groupCountersMap.set(o,{lastUpdateTime:Date.now(),groupCounterSeq:i,counters:t,avChatRoomKey:n}))}},{key:"_getLocalCounters",value:function(e,t){var n={};if(!this._hasLocalGroupCounters(e))return n;var o=this._getLocalGroupCounters(e).counters;if(0<t.length)t.forEach(function(r){o.has(r)&&(n[r]=o.get(r))});else{var s,i=Ee(o.keys());try{for(i.s();!(s=i.n()).done;){var a=s.value;n[a]=o.get(a)}}catch(r){i.e(r)}finally{i.f()}}return n}},{key:"reset",value:function(){this._groupCountersMap.clear(),this.EXPIRE_TIME=3e4}}]),Di),Wc=(R(Ti,[{key:"start",value:function(){var e=this._grpM.isLoggedIn();e||(this._proto=g.AV_NOAUTH_POLLING),u.l("".concat(this._n,".start pollingInterval:").concat(this._manager.getPollingInterval()," isLoggedIn:").concat(e)),this._isRunning=!0,this._request()}},{key:"isRunning",value:function(){return this._isRunning}},{key:"_request",value:function(){var e=this,t=this._onInit(this._groupID);this._grpM.req({proto:this._proto,data:t}).then(function(n){e._onSuccess(e._groupID,n),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.getPollingInterval()))}).catch(function(n){e._onFail(e._groupID,n),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.MAX_POLLING_INTERVAL))})}},{key:"stop",value:function(){u.l("".concat(this._n,".stop")),0<this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=-1),this._isRunning=!1}},{key:"getPollingTimerID",value:function(){return this._timeoutID}}]),Ti),mr={3:!0,4:!0,5:!0,6:!0,17:!0,20:!0,21:!0,100:!0},Yc=(R(Ci,[{key:"hasJoinedAVChatRoom",value:function(){var e=[];return 0<(e=0<this._joinedGroupMap.size?b(this._joinedGroupMap.values()).filter(function(t){return t.type===_.GRP_AVCHATROOM}):e).length}},{key:"getJoinedLiveList",value:function(){var e=[];return e=0<this._joinedGroupMap.size?b(this._joinedGroupMap.values()).filter(function(t){return t.type===_.GRP_LIVE}):e}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this._joinedGroupMap.has(e)}},{key:"getJoinedAVChatRoom",value:function(){return 0<this._joinedGroupMap.size?b(this._joinedGroupMap.keys()):[]}},{key:"_updatedata",value:function(e){var t=this._pollingRequestInfoMap.get(e);return e===b(this._pollingInstanceMap.keys())[0]?l(l({},t),{},{startBroadcastSeq:this._startBroadcastSeq,simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG}):l(l({},t),{},{simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG})}},{key:"_handleSuccess",value:function(e,t){var n,c=t.data,o=c.key,s=c.nextSeq,i=c.rspMsgList,a=c.errorCode,r=c.nextBroadcastSeq,c=c.broadcastMessageList;a!==0?(a=this._pollingRequestInfoMap.get(e),n=new S("longPollingAVError"),a=a?"".concat(a.key,"-").concat(a.startSeq):"requestInfo is undefined",n.setMessage("".concat(e,"-").concat(a,"-").concat(t.errorInfo)).setCode(t.errorCode).end(!0)):this.checkJoinedAVChatRoomByID(e)&&(te(o)&&fe(s)&&this._pollingRequestInfoMap.set(e,{key:o,startSeq:s}),fe(r)&&r>this._startBroadcastSeq&&(this._startBroadcastSeq=r),F(i)&&0<i.length?(i.forEach(function(d){d.to=d.groupID}),this.onMessage(i,e)):(this._pollingNoMessageCount+=1,this._pollingNoMessageCount===this.DEFAULT_POLLING_NO_MESSAGE_COUNT&&(this._pollingInterval=this.DEFAULT_POLLING_INTERVAL+this.DEFAULT_POLLING_INTERVAL_PLUS)),this._onBroadcastMessage(c))}},{key:"_handleFailure",value:function(e,t){}},{key:"onMessage",value:function(e,t){if(F(e)&&e.length!==0){var n="".concat(this._n,".onMessage"),o=(t&&(n+=" groupID:".concat(t)),this._pollingNoMessageCount!==0&&(this._pollingNoMessageCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL),null),s=[],i=this._get(11),a=this._get(26),r=e.length,c=(1<r&&e.sort(function(I,k){return I.sequence-k.sequence}),this._get(12).isUnlimitedAVChatRoom()),d=!1;u.getLevel()<=0&&(t=e.map(function(I){return I.sequence}),u.l("".concat(n," count:").concat(t.length," sequenceList:").concat(t)),t.length=0);for(var p=0;p<r;p++){var h=this.restoreMessageFromSimplified(e[p]);if(mr[h.event]){if(h.event===6&&(this._grpM.isGroupAttributesUpdatedNotice(h)||this._grpM.isGroupCountersNotice(h)))continue;if(h.event!==20)if(h.event!==21)if(h.event!==100){var o=this.packMessage(h,h.event),m=h.isModified===1,d=h.isHistoryMessage===1;if(!c){if(this.sequencesLinkedList.has(o.sequence))continue;this.sequencesLinkedList.set(o.sequence)}var f=this.messageIDLinkedList.has(o.ID);f?u.w("".concat(n," ID:").concat(o.ID," has:").concat(f)):(this.messageIDLinkedList.set(o.ID),f=!1,!d&&this._isMessageSentByCurrentInstance(o)?m&&(f=!0,o.isModified=m,i.updateMessageIsModifiedProperty(o)):f=!0,f&&(o.conversationType===_.CONV_SYSTEM&&o.payload.operationType===5&&this._onGroupDismissed(o.payload.groupProfile.groupID),d||o.conversationType===_.CONV_SYSTEM||(m=o.conversationID.replace(_.CONV_GROUP,""),this._pollingInstanceMap.has(m)?this._grpM.isLoggedIn()&&a.addMessageSequence({key:zn,message:o}):(o.type!==_.MSG_GRP_TIP&&0<o.clientTime&&a.addMessageDelay(o.clientTime),a.addMessageSequence({key:Jn,message:o}))),s.push(o)))}else this.onRoomCustomData(h);else this._get(34).onMessageReactionNotify({event:21,dataList:h.elements.messageReactionNotifyList});else this.handleMessageRevokedNotice(h)}else u.w("".concat(n,". unknown event:").concat(h.event))}s.length!==0&&(0<(t=Rs(s)).length&&this._grpM.emitOuterEvent(V.MESSAGE_MODIFIED,t),d||0<(t=this.packConversationOption(s)).length&&i.onNewMessage({conversationOptionsList:t,isInstantMessage:!0}),this._checkMessageStacked(s),0<(t=Ns(s)).length&&this._grpM.emitOuterEvent(V.MESSAGE_RECEIVED,t),s.length=0)}}},{key:"handleMessageRevokedNotice",value:function(e){var t=this,n=e.groupID,o=e.elements.revokeMsgList,s=e.revokerInfo,i=[];o.forEach(function(d){var p=d.tinyID,r=d.clientTime,c=d.random,d=d.sequence,p={conversationID:"".concat(_.CONV_GROUP).concat(n),ID:"".concat(p,"-").concat(r,"-").concat(c),revoker:s.revoker,revokeReason:s.reason||"",revokerInfo:{userID:s.revoker,nick:"",avatar:""},sequence:d};i.push(p)}),i.length!==0&&this._get(11).updateRevokerInfo(i).then(function(a){t._grpM.emitOuterEvent(V.MESSAGE_REVOKED,a)})}},{key:"isBroadcastOrNormal",value:function(e){return e===3||e===17}},{key:"isGroupTip",value:function(e){return e===4||e===6}},{key:"isGroupSystemNotice",value:function(e){return e===5}},{key:"restoreGroupTipElements",value:function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},s=e.operatorInfo,s=s===void 0?{}:s,i=e.operatorID,t=e.userIDList,t=t===void 0?[]:t,n=e.operationType,n=(fe(e.groupJoinType)||n!==1&&n!==2||(e.groupJoinType=n===2?0:1),s.userID),o=s.avatar,s=s.nick,i=(e.operatorInfo={userID:n===void 0?i:n,avatar:o===void 0?"":o,nick:s===void 0?"":s},t.map(function(a){return{userID:a}}));return e.memberInfoList=e.memberInfoList||i,e}},{key:"restoreMessageFromSimplified",value:function(e){var t,n,o,s=e.event;return this.isBroadcastOrNormal(s)&&(e.cloudCustomData=e.cloudCustomData||"",e.elements=e.elements.map(function(i){var a;return i.type===_.MSG_CUSTOM&&(a=i.content,i.content=l({data:"",description:"",extension:""},a===void 0?{}:a)),i})),(this.isGroupTip(s)||this.isGroupSystemNotice(s))&&(e.from=e.from||"@TIM#SYSTEM"),this.isGroupTip(s)&&(e.elements=this.restoreGroupTipElements(e.elements),n=(o=(o=e.elements)===void 0?{}:o).operationType,t=o.operatorInfo,n===1&&(n=[{userID:(t===void 0?{}:t).userID}],o.memberInfoList=o.memberInfoList||n)),this.isGroupSystemNotice(s)&&(o=(t=e.elements).memberInfoList,n=t.operatorInfo,e.elements.memberInfoList=l({userID:e.elements.operatorID,avatar:"",nick:""},o=o||(n===void 0?{}:n)),e.elements=l({authentication:"",remarkInfo:"",messageKey:1e3*e.time},e.elements),s=Object.keys(e.elements).filter(function(i){return i!=="operatorInfo"}).reduce(function(i,a){return l(l({},i),{},H({},a,e.elements[a]))},{}),e.elements=s),e}},{key:"_onGroupDismissed",value:function(e){u.l("".concat(this._n,"._onGroupDismissed groupID:").concat(e)),this._grpM.deleteLocalGroupAndConversation(e),this.reset(e)}},{key:"_checkMessageStacked",value:function(n){var t="MessageStacked",n=n.length;100<=n&&(this._grpM.outputWarning(t,n),this._reportMessageStackedCount<5&&(new S(t).setMessage("count:".concat(n," groupID:").concat(b(this._joinedGroupMap.keys()))).setLevel("warning").end(),this._reportMessageStackedCount+=1))}},{key:"_isMessageSentByCurrentInstance",value:function(e){return!!this._get(11).isMessageSentByCurrentInstance(e)}},{key:"packMessage",value:function(o,t){o.currentUser=this._grpM.getMyUserID(),o.conversationType=t===5?_.CONV_SYSTEM:_.CONV_GROUP,o.isSystemMessage=!!o.isSystemMessage;var n=new We(o),o=this.packElements(o,t);return n.setElement(o,this._grpM.getFileDownloadProxy()),n}},{key:"packElements",value:function(e,t){return t===4||t===6?(this._updateMemberCountByGroupTips(e),{type:_.MSG_GRP_TIP,content:l(l({},e.elements),{},{groupProfile:e.groupProfile})}):t===5?{type:_.MSG_GRP_SYS_NOTICE,content:l(l({},e.elements),{},{groupProfile:l(l({},e.groupProfile),{},{groupID:e.groupID})})}:e.elements}},{key:"packConversationOption",value:function(e){for(var t=new Map,n=0;n<e.length;n++){var o,s=e[n],i=s.conversationID;t.has(i)?((o=t.get(i)).lastMessage=s).flow==="in"&&o.unreadCount++:t.set(i,{conversationID:s.conversationID,unreadCount:s.flow==="out"?0:1,type:s.conversationType,subType:s.conversationSubType,lastMessage:s})}return b(t.values())}},{key:"_updateMemberCountByGroupTips",value:function(i){var t,n,o,s=i.groupProfile.groupID,i=i.elements.onlineMemberInfo,i=i===void 0?void 0:i;G(i)||(t=(t=i.onlineMemberNum)===void 0?0:t,i=(i=i.expireTime)===void 0?this.DEFAULT_EXPIRE_TIME:i,n=this._onlineMemberCountMap.get(s)||{},o=Date.now(),G(n)?Object.assign(n,{lastReqTime:0,lastSyncTime:0,latestUpdateTime:o,memberCount:t,expireTime:i}):(n.latestUpdateTime=o,n.memberCount=t),this._onlineMemberCountMap.set(s,n))}},{key:"_onBroadcastMessage",value:function(e){if(!G(e)){for(var t=[],n=e.length,o=null,s=0;s<n;s++){var i=this.restoreMessageFromSimplified(e[s]);mr[i.event]?((o=this.packMessage(i,i.event)).isBroadcastMessage=!0,this._broadcastMessageIDMap.has(o.ID)||(t.push(o),this._broadcastMessageIDMap.set(o.ID,1))):u.w("".concat(this._n,"._onBroadcastMessage unknown event:").concat(i.event))}0<t.length&&this._grpM.emitOuterEvent(V.MESSAGE_RECEIVED,t)}}},{key:"start",value:function(e){var t;this._pollingInstanceMap.has(e)?(t=this._pollingInstanceMap.get(e)).isRunning()||t.start():((t=new Wc({manager:this,groupID:e,onInit:this._updatedata.bind(this),onSuccess:this._handleSuccess.bind(this),onFail:this._handleFailure.bind(this)})).start(),this._pollingInstanceMap.set(e,t),u.l("".concat(this._n,".start groupID:").concat(e)))}},{key:"handleJoinResult",value:function(e){var t=this;return this._preCheck(e.group).then(function(){var n=e.longPollingKey,o=e.group,s=o.groupID;return t._joinedGroupMap.set(s,o),t._grpM.updateGroupMap([o]),t._grpM.deleteUnjoinedAVChatRoom(s),t._grpM.emitGroupListUpdate(!0,!1),C(n)?Q({status:ue,group:o}):Promise.resolve()})}},{key:"startRunLoop",value:function(e){var t=this;return this.handleJoinResult(e).then(function(){var n=e.longPollingKey,o=e.group,s=e.startSeq,i=o.groupID;return t._pollingRequestInfoMap.set(i,{key:n,startSeq:s===void 0?0:s}),t.start(i),t._grpM.isLoggedIn()?Q({status:ue,group:o}):Q({status:ue})})}},{key:"_preCheck",value:function(n){if(this._get(12).isUnlimitedAVChatRoom()||!this.hasJoinedAVChatRoom()||n.type===_.GRP_LIVE)return Promise.resolve();var n=$(this._joinedGroupMap.entries().next().value,2),t=n[0],n=n[1];if(this._grpM.isLoggedIn()){if(n.selfInfo.role!==_.GRP_MBR_ROLE_OWNER&&n.ownerID!==this._grpM.getMyUserID())return this._grpM.quitGroup(t);this._grpM.deleteLocalGroupAndConversation(t)}else this._grpM.deleteLocalGroupAndConversation(t);return this.reset(t),Promise.resolve()}},{key:"joinWithoutAuth",value:function(e){var t=this,n=e.groupID,o="".concat(this._n,".").concat("joinWithoutAuth"),s=new S("joinWithoutAuth");return this._grpM.req({proto:g.APPLY_JOIN_GRP_NOAUTH,data:e}).then(function(i){if(i=i.data.longPollingKey,s.setMessage("groupID:".concat(n," longPollingKey:").concat(i)).end(!0),C(i))return v({code:M.CANNOT_JOIN_NON_AVCHATROOM_WITHOUT_LOGIN});u.l("".concat(o," ok. groupID:").concat(n)),t._get(11).setCompleted("".concat(_.CONV_GROUP).concat(n));var a=new Xt({groupID:n});return t.startRunLoop({group:a,longPollingKey:i}),q({status:ue})}).catch(function(i){return u.e("".concat(o," failed. groupID:").concat(n," error:"),i),s.setError(i).setMessage("groupID:".concat(n)).end(!0),v(i)}).finally(function(){t._grpM.get(14).reportAtOnce()})}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this._onlineMemberCountMap.get(e)||{},n=Date.now();return G(t)||n-t.lastSyncTime>1e3*t.expireTime&&1e4<n-t.latestUpdateTime&&3e3<n-t.lastReqTime?(t.lastReqTime=n,this._onlineMemberCountMap.set(e,t),this._getGroupOnlineMemberCount(e).then(function(o){return q({memberCount:o.memberCount})}).catch(function(o){return v(o)})):Q({memberCount:t.memberCount})}},{key:"_getGroupOnlineMemberCount",value:function(e){var t=this,n="".concat(this._n,".").concat("_getGroupOnlineMemberCount"),o=new S("_getGroupOnlineMemberCount");return this._grpM.requestOnlineCount(e).then(function(r){var i=t._onlineMemberCountMap.get(e)||{},r=r.data,a=r.memberCount,a=a===void 0?0:a,r=r.expireTime,r=r===void 0?t.DEFAULT_EXPIRE_TIME:r,c=(u.l("".concat(n," ok. groupID:").concat(e," memberCount:").concat(a," expireTime:").concat(r)),Date.now());return G(i)&&(i.lastReqTime=c),t._onlineMemberCountMap.set(e,Object.assign(i,{lastSyncTime:c,latestUpdateTime:c,memberCount:a,expireTime:r})),{memberCount:a}}).catch(function(s){return u.w("".concat(n," failed. error:"),s),o.setCode(s.code).setMessage("groupID:".concat(e," error:").concat(JSON.stringify(s))).end(),Promise.reject(s)})}},{key:"_get",value:function(e){return this._grpM.get(e)}},{key:"setPollingInterval",value:function(e){C(e)||(fe(e)?this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=e:this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=parseInt(e,10))}},{key:"setPollingIntervalPlus",value:function(e){C(e)||(fe(e)?this.DEFAULT_POLLING_INTERVAL_PLUS=e:this.DEFAULT_POLLING_INTERVAL_PLUS=parseInt(e,10))}},{key:"setPollingNoMessageCount",value:function(e){C(e)||(fe(e)?this.DEFAULT_POLLING_NO_MESSAGE_COUNT=e:this.DEFAULT_POLLING_NO_MESSAGE_COUNT=parseInt(e,10))}},{key:"setPollingSimplifiedMessage",value:function(e){C(e)||e!=="0"&&e!=="1"||(this.DEFAULT_POLLING_SIMPLIFIED_MSG=parseInt(e,10))}},{key:"getPollingInterval",value:function(){return this._pollingInterval}},{key:"onAVChatRoomMemberBanned",value:function(e){e=e.payload.groupProfile.groupID,u.l("".concat(this._n,".onAVChatRoomMemberBanned groupID:").concat(e)),this._grpM.deleteLocalGroupAndConversation(e),this.reset(e)}},{key:"restartPolling",value:function(){u.l("".concat(this._n,".restartPolling count:").concat(this._pollingInstanceMap.size));var e,t=Ee(this._pollingInstanceMap.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.stop(),n.start()}}catch(o){t.e(o)}finally{t.f()}}},{key:"getPollingTimerID",value:function(e){if(!this._pollingInstanceMap.has(e))return-1;var t=this._pollingInstanceMap.get(e).getPollingTimerID();return u.l("".concat(this._n,".getPollingTimerID groupID:").concat(e," timerID:").concat(t)),t}},{key:"hasPollingInstance",value:function(e){return this._pollingInstanceMap.has(e)}},{key:"onRoomCustomData",value:function(s){var t=s.groupID,n=s.sequence,o=s.time,s=s.elements,s=s&&s.content;this._get(30).onRoomCustomDataReceived(s),u.l("".concat(this._n,".onRoomCustomData groupID:").concat(t," sequence:").concat(n," time:").concat(o," data:").concat(s))}},{key:"reset",value:function(e){if(e){u.l("".concat(this._n,".reset groupID:").concat(e));var t=this._pollingInstanceMap.get(e);t&&t.stop(),this._pollingInstanceMap.delete(e),this._joinedGroupMap.delete(e),this._pollingRequestInfoMap.delete(e),this._onlineMemberCountMap.delete(e)}else{u.l("".concat(this._n,".reset all"));var n,o=Ee(this._pollingInstanceMap.values());try{for(o.s();!(n=o.n()).done;)n.value.stop()}catch(s){o.e(s)}finally{o.f()}this._pollingInstanceMap.clear(),this._joinedGroupMap.clear(),this._pollingRequestInfoMap.clear(),this._onlineMemberCountMap.clear(),this._broadcastMessageIDMap.clear()}this.sequencesLinkedList.reset(),this.messageIDLinkedList.reset(),this._reportMessageStackedCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=300,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0}}]),Ci),jc=(R(Ai,[{key:"updateMember",value:function(e){C(e.onlineStatus)||(this.isOnline=e.onlineStatus==="Online");var t=[null,void 0,"",0,NaN];e.memberCustomField&&Bn(this.memberCustomField,e.memberCustomField),bt(this,e,["memberCustomField","marks","onlineStatus"],t)}},{key:"updateRole",value:function(e){["Owner","Admin","Member"].indexOf(e)<0||(this.role=e)}},{key:"updateMuteUntil",value:function(e){C(e)||(this.muteUntil=Math.floor((Date.now()+1e3*e)/1e3))}},{key:"updateNameCard",value:function(e){C(e)||(this.nameCard=e)}},{key:"updateMemberCustomField",value:function(e){e&&Bn(this.memberCustomField,e)}}]),Ai),Jc=(R(yi,[{key:"_onProfileUpdated",value:function(e){for(var t=this,n=e.data,o=0;o<n.length;o++)(function(s){var i=n[s];t.groupMemberListMap.forEach(function(a){a.has(i.userID)&&a.get(i.userID).updateMember({nick:i.nick,avatar:i.avatar})})})(o)}},{key:"deleteGroupMemberList",value:function(e){this.groupMemberListMap.delete(e)}},{key:"getGroupMemberList",value:function(r){var t,n=this,o=r.groupID,s=r.role,s=s===void 0?void 0:s,h=r.offset,i=h===void 0?0:h,h=r.count,a=h===void 0?15:h,h=r.filter,r=h===void 0?void 0:h,c="".concat(this._n,".").concat("getGroupMemberList"),h=this._grpM.hasLocalGroup(o);if(u.l("".concat(c," groupID:").concat(o," role:").concat(s," offset:").concat(i," count:").concat(a," hasLocalGroup:").concat(h)),!h)return Q({memberList:[],offset:0});if(this._grpM.getLocalGroupProfile(o).type===_.GRP_AVCHATROOM){if(this._grpM.canIUse(de.AV_MBR_LIST))return this._getAVChatRoomMemberList({groupID:o,offset:i,filter:r});this._grpM.outputWarning("LiveOnlineMember")}s!==_.GRP_MBR_ROLE_ADMIN&&s!==_.GRP_MBR_ROLE_OWNER&&s!==_.GRP_MBR_ROLE_MEMBER||(t=s);var d=new S("getGroupMemberList"),p=0,h={groupID:o,limit:100<a?100:a,memberRoleFilter:t?[t]:void 0,memberInfoFilter:this.DEFAULT_MEMBER_INFO_FILTER},m=(lt({groupID:o})?h.next="".concat(i):(h.offset=i,p=i+a),[]);return this._grpM.req({proto:g.GET_GRP_MBR_LIST,data:h}).then(function(N){var N=N.data,I=N.members,k=N.memberNum,N=N.next,N=N===void 0?void 0:N;return C(N)||(p=G(N)?0:N),F(I)&&I.length!==0?(n._grpM.hasLocalGroup(o)&&(n._grpM.getLocalGroupProfile(o).memberNum=k),m=n._updateLocalGroupMemberMap(o,I),n._grpM.get(4).getUserProfile({userIDList:I.map(function(x){return x.userID}),tagList:[E.NICK,E.AVATAR]})):(p=0,Promise.resolve([]))}).then(function(f){return f=f.data,!F(f)||f.length===0?Q({memberList:[],offset:p}):(f=f.map(function(I){return{userID:I.userID,nick:I.nick,avatar:I.avatar}}),n._updateLocalGroupMemberMap(o,f),m.length<a&&(p=0),d.setMessage("groupID:".concat(o," offset:").concat(i," count:").concat(a)).end(),u.l("".concat(c," ok.")),q({memberList:m,offset:p}))}).catch(function(f){return d.setError(f).end(),u.e("".concat(c," failed. error:"),f),v(f)})}},{key:"_getAVChatRoomMemberList",value:function(s){var t=this,n=s.groupID,o=s.offset,s=s.filter,i="".concat(this._n,".").concat("_getAVChatRoomMemberList"),a=new S("_getAVChatRoomMemberList");return a.setMessage("groupID:".concat(n," offset:").concat(o," filter:").concat(s)),this._grpM.req({proto:g.GET_AV_MBR_LIST,data:{groupID:n,offset:o,filter:s}}).then(function(c){var c=c.data,d=c.memberList,d=d===void 0?[]:d,c=c.offset,c=c===void 0?0:c,d=(a.end(),u.l("".concat(i," ok. member count:").concat(d.length,", next request timestamp:").concat(c)),d.map(function(p){return l(l({},p),{},{onlineStatus:"Online"})})),d=t._updateLocalGroupMemberMap(n,d);return q({memberList:d,offset:c})}).catch(function(r){return a.setError(r).end(),u.e("".concat(i," failed. error:"),r),v(r)})}},{key:"getGroupMemberProfile",value:function(e){var t=this,n="getGroupMemberProfile",a="".concat(this._n,".").concat(n),o="groupID:".concat(e.groupID),s=(5<e.userIDList.length?o+=" userIDList.length:".concat(e.userIDList.length):o+=" userIDList:".concat(e.userIDList),u.l("".concat(a," ").concat(o)),50<e.userIDList.length&&(e.userIDList=e.userIDList.slice(0,50)),e.groupID),i=e.userIDList,a=this._grpM.getLocalGroupProfile(s);if(a&&st(a.type))return v({code:a=M.OPERATION_NOT_SUPPORTED_IN_AVCHATROOM,message:this._grpM.getErrorMessage(a,n)});var r=new S(n);return r.setMessage(o),this._getGroupMemberProfileAdvance(l(l({},e),{},{userIDList:i})).then(function(c){return c=c.data.members,F(c)&&c.length!==0?(t._updateLocalGroupMemberMap(s,c),t._grpM.get(4).getUserProfile({userIDList:c.map(function(d){return d.userID}),tagList:[E.NICK,E.AVATAR]})):Q([])}).then(function(c){return c=c.data.map(function(d){return{userID:d.userID,nick:d.nick,avatar:d.avatar}}),t._updateLocalGroupMemberMap(s,c),c=i.filter(function(d){return t.hasLocalGroupMember(s,d)}).map(function(d){return t.getLocalGroupMemberInfo(s,d)}),r.end(),q({memberList:c})})}},{key:"addGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("addGroupMember"),o=e.groupID,s=this._grpM.getLocalGroupProfile(o),i=s.type,a=new S("addGroupMember");return a.setMessage("groupID:".concat(o," groupType:").concat(i)),st(i)?(i=new Te({code:M.CANNOT_ADD_MEMBER_IN_AVCHATROOM}),a.setError(i).end(),v(i)):(e.userIDList=e.userIDList.map(function(r){return{userID:r}}),u.l("".concat(n," groupID:").concat(o)),this._grpM.req({proto:g.ADD_GRP_MBR,data:e}).then(function(h){var h=h.data.members,c=(u.l("".concat(n," ok")),h.filter(function(f){return f.result===1}).map(function(f){return f.userID})),d=h.filter(function(f){return f.result===0}).map(function(f){return f.userID}),p=h.filter(function(f){return f.result===2}).map(function(f){return f.userID}),h=h.filter(function(f){return f.result===4}).map(function(f){return f.userID}),m="groupID:".concat(e.groupID,", ")+"successUserIDList:".concat(c,", ")+"failureUserIDList:".concat(d,", ")+"existedUserIDList:".concat(p,", ")+"overLimitUserIDList:".concat(h);return a.setMoreMessage(m).end(),c.length===0?q({successUserIDList:c,failureUserIDList:d,existedUserIDList:p,overLimitUserIDList:h}):(t._updateConversationGroupProfile(s),q({successUserIDList:c,failureUserIDList:d,existedUserIDList:p,overLimitUserIDList:h,group:s}))}).catch(function(r){return a.setError(r).end(),u.e("".concat(n," failed. error:"),r),v(r)}))}},{key:"deleteGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteGroupMember"),o=e.groupID,s=e.userIDList,i=this._grpM.getLocalGroupProfile(o);if(C(i))return v({code:M.CANNOT_FIND_GRP});if(st(i.type))return this._grpM.canIUse(de.AV_BAN_MBR)?this._banAVChatRoomMember(e):this._grpM.cannotUseCommercialAbility("deleteGroupMember");var a="groupID:".concat(o," ").concat(5<s.length?"userIDList.length:".concat(s.length):"userIDList:".concat(s)),r=(u.l("".concat(n," groupID:").concat(o," userIDList:"),s),new S("deleteGroupMember"));return r.setMessage(a),this._grpM.req({proto:g.DEL_GRP_MBR,data:e}).then(function(){return r.end(),u.l("".concat(n," ok")),t._updateConversationGroupProfile(i),t.deleteLocalGroupMembers(o,s),q({group:i,userIDList:s})}).catch(function(c){return r.setError(c).end(),u.e("".concat(n," failed. error:"),c),v(c)})}},{key:"_updateConversationGroupProfile",value:function(e){this._grpM.get(11).updateConversationGroupProfile([e])}},{key:"_banAVChatRoomMember",value:function(e){var t=this,n="".concat(this._n,".").concat("_banAVChatRoomMember"),o=e.groupID,s=e.userIDList,i="groupID:".concat(o," ").concat(5<s.length?"userIDList.length:".concat(s.length):"userIDList:".concat(s)),a=new S("_banAVChatRoomMember"),r=(a.setMessage(i),u.l("".concat(n," groupID:").concat(o," userIDList:"),s),this._grpM.getLocalGroupProfile(o));return C(e.duration)||e.duration===0?v({code:M.BAN_DURATION_INVALID}):this._grpM.req({proto:g.BAN_AV_MBR,data:e}).then(function(){return a.end(),u.l("".concat(n," ok")),t.deleteLocalGroupMembers(o,s),q({group:r,userIDList:s})}).catch(function(c){return a.setError(c).end(),u.e("".concat(n," failed. error:"),c),v(c)})}},{key:"setGroupMemberMuteTime",value:function(s){var t=this,n=s.groupID,o=s.userID,s=s.muteTime,i="".concat(this._n,".").concat("setGroupMemberMuteTime");if(o===this._grpM.getMyUserID())return v({code:M.CANNOT_MUTE_SELF});var a="groupID:".concat(n," userID:").concat(o," muteTime:").concat(s),r=(u.l("".concat(i," ").concat(a)),new S("setGroupMemberMuteTime"));return r.setMessage(a),this.modifyGroupMemberInfo({groupID:n,userID:o,muteTime:s}).then(function(c){r.end(),u.l("".concat(i," ok"));var d=t._grpM.getLocalGroupProfile(n);return q({group:d,member:c})}).catch(function(c){return r.setError(c).end(),u.e("".concat(i," failed. error:"),c),v(c)})}},{key:"setGroupMemberRole",value:function(s){var t="".concat(this._n,".").concat("setGroupMemberRole"),n=s.groupID,o=s.userID,s=s.role,i="groupID:".concat(n," userID:").concat(o," role:").concat(s),a=this._grpM.getLocalGroupProfile(n);if(!a||a.type===_.GRP_WORK||a.type===_.GRP_AVCHATROOM)return v({code:M.CANNOT_SET_MEMBER_ROLE_IN_WORK_AND_AVCHATROOM});if(a&&a.selfInfo.role!==_.GRP_MBR_ROLE_OWNER)return v({code:M.NOT_OWNER});var r=[_.GRP_MBR_ROLE_ADMIN,_.GRP_MBR_ROLE_MEMBER];if(lt({groupID:n})&&r.push(_.GRP_MBR_ROLE_CUSTOM),r.indexOf(s)<0)return v({code:M.INVALID_MEMBER_ROLE});if(o===this._grpM.getMyUserID())return v({code:M.CANNOT_SET_SELF_MEMBER_ROLE});var c=new S("setGroupMemberRole");return c.setMessage(i),u.l("".concat(t," ").concat(i)),this.modifyGroupMemberInfo({groupID:n,userID:o,role:s}).then(function(d){return c.end(),u.l("".concat(t," ok")),q({group:a,member:d})}).catch(function(d){return c.setError(d).end(),u.e("".concat(t," failed. error:"),d),v(d)})}},{key:"_filterProfanity",value:function(e,t){var o=this._grpM.get(29);if(!o)return!0;var o=o.filterText(t[e],"group_member_profile"),n=o.isAllowedToSend,o=o.modifiedText;return n===!0&&(t[e]=o,!0)}},{key:"setGroupMemberNameCard",value:function(c){var t=this,n="setGroupMemberNameCard",o="".concat(this._n,".").concat(n);if(c.nameCard&&this._filterProfanity("nameCard",c)===!1)return v({code:M.PROFANITY_FOUND});var s=c.groupID,r=c.userID,i=r===void 0?this._grpM.getMyUserID():r,a=c.nameCard,r="groupID:".concat(s," userID:").concat(i," nameCard:").concat(a),c=(u.l("".concat(o," ").concat(r)),this._grpM.getLocalGroupProfile(s));if(c&&st(c.type))return v({code:c=M.OPERATION_NOT_SUPPORTED_IN_AVCHATROOM,message:this._grpM.getErrorMessage(c,n)});var d=new S(n);return d.setMessage(r),this.modifyGroupMemberInfo({groupID:s,userID:i,nameCard:a}).then(function(p){u.l("".concat(o," ok")),d.end();var h=t._grpM.getLocalGroupProfile(s);return i===t._grpM.getMyUserID()&&h&&h.setSelfNameCard(a),q({group:h,member:p})}).catch(function(p){return d.setError(p).end(),u.e("".concat(o," failed. error:"),p),v(p)})}},{key:"setGroupMemberCustomField",value:function(a){var t=this,n="setGroupMemberCustomField",o="".concat(this._n,".").concat(n),s=a.groupID,i=a.userID,i=i===void 0?this._grpM.getMyUserID():i,a=a.memberCustomField,r="groupID:".concat(s," userID:").concat(i," memberCustomField:").concat(JSON.stringify(a)),c=(u.l("".concat(o," ").concat(r)),this._grpM.getLocalGroupProfile(s));if(c&&st(c.type))return v({code:c=M.OPERATION_NOT_SUPPORTED_IN_AVCHATROOM,message:this._grpM.getErrorMessage(c,n)});var d=new S(n);return d.setMessage(r),this.modifyGroupMemberInfo({groupID:s,userID:i,memberCustomField:a}).then(function(p){d.end(),u.l("".concat(o," ok"));var h=t._grpM.getLocalGroupProfile(s);return q({group:h,member:p})}).catch(function(p){return d.setError(p).end(),u.e("".concat(o," failed. error:"),p),v(p)})}},{key:"modifyGroupMemberInfo",value:function(e){var t=this,n=e.groupID,o=e.userID,s=void 0;return Ve(n)&&(n=Be(s=n)),this._grpM.req({proto:g.MODIFY_GRP_MBR_INFO,data:l(l({},e),{},{groupID:n,topicID:s})}).then(function(){if(t.hasLocalGroupMember(n,o))return i=t.getLocalGroupMemberInfo(n,o),C(e.muteTime)||i.updateMuteUntil(e.muteTime),C(e.role)||i.updateRole(e.role),C(e.nameCard)||i.updateNameCard(e.nameCard),C(e.memberCustomField)||i.updateMemberCustomField(e.memberCustomField),i;var i=t._grpM.getLocalGroupProfile(n);return i&&!st(i.type)?t.getGroupMemberProfile({groupID:n,userIDList:[o]}).then(function(a){return $(a.data.memberList,1)[0]}):void 0})}},{key:"markGroupMemberList",value:function(i){var t="".concat(this._n,".").concat("markGroupMemberList"),n=i.groupID,o=i.markType,c=i.enableMark,i=i.userIDList,s=i===void 0?[]:i,i="groupID:".concat(n," markType:").concat(o," enableMark:").concat(c," userIDList count:").concat(s.length),a=(u.l("".concat(t," ").concat(i)),2),r=[],c=(c===!0&&(a=1),b(s)),d=(500<s.length&&(c=s.slice(0,500),u.w("".concat(t," ").concat(ln(500)))),c.forEach(function(p){r.push({userID:p,markType:[o]})}),c=null,new S("markGroupMemberList"));return d.setMessage(i),this._grpM.req({proto:g.MARK_AV_MBR_INFO,data:{groupID:n,operationType:a,memberList:r}}).then(function(f){var f=f.data.memberList,f=f===void 0?[]:f,h=[],m=[],f=(f.length===s.length?h.push.apply(h,b(s)):(f.forEach(function(I){h.push(I.userID)}),s.forEach(function(I){h.includes(I)||m.push(I)})),"success count:".concat(h.length," fail count:").concat(m.length));return d.setMessage(f).end(),u.l("".concat(t," ok. ").concat(f)),q({successUserIDList:h,failureUserIDList:m})}).catch(function(p){return d.setError(p).end(),u.e("".concat(t," failed. error:"),p),v(p)})}},{key:"_getGroupMemberProfileAdvance",value:function(e){return this._grpM.req({proto:g.GET_GRP_MBR_PROFILE,data:l(l({},e),{},{memberInfoFilter:e.memberInfoFilter||this.DEFAULT_MEMBER_INFO_FILTER})})}},{key:"_updateLocalGroupMemberMap",value:function(e,t){var n=this;return F(t)&&t.length!==0?t.map(function(o){return n.hasLocalGroupMember(e,o.userID)?n.getLocalGroupMemberInfo(e,o.userID).updateMember(o):n.setLocalGroupMember(e,new jc(o)),n.getLocalGroupMemberInfo(e,o.userID)}):[]}},{key:"deleteLocalGroupMembers",value:function(e,t){var n=this.groupMemberListMap.get(e);n&&t.forEach(function(o){n.delete(o)})}},{key:"getLocalGroupMemberInfo",value:function(e,t){return this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).get(t):null}},{key:"setLocalGroupMember",value:function(e,t){this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).set(t.userID,t):(t=new Map().set(t.userID,t),this.groupMemberListMap.set(e,t))}},{key:"getLocalGroupMemberList",value:function(e){return this.groupMemberListMap.get(e)}},{key:"hasLocalGroupMember",value:function(e,t){return this.groupMemberListMap.has(e)&&this.groupMemberListMap.get(e).has(t)}},{key:"hasLocalGroupMemberMap",value:function(e){return this.groupMemberListMap.has(e)}},{key:"reset",value:function(){this.groupMemberListMap.clear()}}]),yi),zc=(R(Mi,[{key:"onNewGroupSystemNotice",value:function(n){var s=n.dataList,t=n.isSyncingEnded,n=n.isInstantMessage,s=(u.d("".concat(this._n,".onReceiveSystemNotice count:").concat(s.length)),this.newSystemNoticeStoredAndSummary({notifiesList:s,isInstantMessage:n})),o=s.eventDataList,s=s.result;0<o.length&&(this._grpM.get(11).onNewMessage({conversationOptionsList:o,isInstantMessage:n}),this._onReceivedGroupSystemNotice({result:s,isInstantMessage:n})),n?0<s.length&&this._grpM.emitOuterEvent(V.MESSAGE_RECEIVED,s):t===!0&&this._clearGroupSystemNotice()}},{key:"newSystemNoticeStoredAndSummary",value:function(e){for(var t=e.notifiesList,n=e.isInstantMessage,o=null,s=t.length,r=0,i=[],a={conversationID:_.CONV_SYSTEM,unreadCount:0,type:_.CONV_SYSTEM,subType:null,lastMessage:null},r=0;r<s;r++){var c=t[r],p=c.groupProfile,d=p.communityType,p=p.topicID,p=p===void 0?void 0:p,m=c.elements,h=m.topicIDList,h=h===void 0?void 0:h,m=m.operationType;if(!((d===void 0?0:d)!==2||G(p)&&G(h))){if([17,18,20].includes(m)){this._handleTopicSystemNotice(c);continue}G(p)||(c.to=p)}c.elements.operationType!==15&&(c.currentUser=this._grpM.getMyUserID(),c.conversationType=_.CONV_SYSTEM,c.conversationID=_.CONV_SYSTEM,(o=new We(c)).setElement({type:_.MSG_GRP_SYS_NOTICE,content:l(l({},c.elements),{},{groupProfile:l({},c.groupProfile)})}),o.isSystemMessage=!0,(o.sequence===1&&o.random===1||o.sequence===2&&o.random===2)&&(o.sequence=St(),o.random=St(),o.generateMessageID(),u.l("".concat(this._n,".newSystemNoticeStoredAndSummary sequence and random maybe duplicated, regenerate. ID:").concat(o.ID))),this._grpM.get(11).pushIntoNoticeResult(i,o)&&(n?a.unreadCount++:o.setIsRead(!0),a.subType=o.conversationSubType))}return a.lastMessage=i[i.length-1],{eventDataList:0<i.length?[a]:[],result:i}}},{key:"_clearGroupSystemNotice",value:function(){var e=this;this._getPendencyList().then(function(n){n.forEach(function(s){e.pendencyMap.set("".concat(s.from,"_").concat(s.groupID,"_").concat(s.to),s)});var n=e._grpM.get(11).getLocalMessageList(_.CONV_SYSTEM),o=[];n.forEach(function(s){var r=s.payload,i=r.operatorID,a=r.operationType,r=r.groupProfile;a===1&&(a="".concat(i,"_").concat(r.groupID,"_").concat(r.to),(i=e.pendencyMap.get(a))&&fe(i.handled)&&i.handled!==0&&o.push(s))}),e.deleteGroupSystemNotice({messageList:o})})}},{key:"deleteGroupSystemNotice",value:function(e){var t=this,n="".concat(this._n,".deleteGroupSystemNotice");return F(e.messageList)&&e.messageList.length!==0?(u.l("".concat(n," ")+e.messageList.map(function(o){return o.ID})),this._grpM.req({proto:g.DEL_GRP_SYSTEM_NOTICE,data:{messageListToDelete:e.messageList.map(function(o){return{from:_.CONV_SYSTEM,messageSeq:o.clientSequence,messageRandom:o.random}})}}).then(function(){u.l("".concat(n," ok"));var o=t._grpM.get(11);return e.messageList.forEach(function(s){o.deleteLocalMessage(s)}),q()}).catch(function(o){return u.e("".concat(n," error:"),o),v(o)})):Q()}},{key:"_getPendencyList",value:function(){var e=this,o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},t=o.type,n=o.startTime,o=o.limit;return this._grpM.req({proto:g.GET_GRP_PENDENCY,data:{type:t===void 0?void 0:t,startTime:n===void 0?0:n,limit:o===void 0?20:o,handleAccount:this._grpM.getMyUserID()}}).then(function(s){var i=s.data.pendencyList;return s.data.nextStartTime!==0?e._getPendencyList({startTime:s.data.nextStartTime}).then(function(a){return[].concat(b(i),b(a))}):i})}},{key:"getGroupApplicationList",value:function(){var e=this;return this._getPendencyList().then(function(t){return e._getPendencyList({type:_.GRP_COMMUNITY}).then(function(n){return t.push.apply(t,b(n)),e._handlePendencyResult(t)}).catch(function(n){return e._handlePendencyResult(t)})})}},{key:"_handlePendencyResult",value:function(e){var t=this,n=[];return e.forEach(function(o){t.pendencyMap.set("".concat(o.from,"_").concat(o.groupID,"_").concat(o.to),o),o.handled===0&&n.push({applicant:o.from,applicantNick:o.fromUserNickName,groupName:o.groupName,groupID:o.groupID,authentication:o.authentication,messageKey:o.time,applicationType:o.applicationType,userID:o.userID,note:o.note})}),Q({applicationList:n})}},{key:"_onReceivedGroupSystemNotice",value:function(e){var t=this,n=e.result;e.isInstantMessage&&n.forEach(function(o){switch(o.payload.operationType){case 1:break;case 2:t._onApplyJoinGroup(o);break;case 3:break;case 4:t._onMemberKicked(o);break;case 5:t._onGroupDismissed(o);break;case 6:break;case 7:t._onInviteGroup(o);break;case 8:t._onQuitGroup(o);break;case 9:t._onSetManager(o);break;case 10:t._onDeleteManager(o);break;case 11:case 12:case 15:break;case 20:t._onMessageRemindTypeSynced(o);break;case 21:t._grpM.onAVChatRoomMemberBanned(o)}})}},{key:"_onApplyJoinGroup",value:function(o){var t=this,o=o.payload.groupProfile,n=o.groupID,o=o.groupType,s=this._grpM.hasLocalGroup(n);u.l("".concat(this._n,"._onApplyJoinGroup groupID:").concat(n," groupType:").concat(o," hasGroup:").concat(s)),s||st(o)||this._grpM.getGroupProfile({groupID:n}).then(function(a){var a=a.data.group;a&&(t._grpM.updateGroupMap([a]),a=!a.isSupportTopic,t._grpM.emitGroupListUpdate(!0,a))})}},{key:"_onMemberKicked",value:function(e){e=e.payload.groupProfile.groupID,this._grpM.hasLocalGroup(e)&&this._grpM.deleteLocalGroupAndConversation(e)}},{key:"_onGroupDismissed",value:function(t){var t=t.payload.groupProfile.groupID,n=(this._grpM.hasLocalGroup(t)&&this._grpM.deleteLocalGroupAndConversation(t),this._grpM._AVChatRoomHandler);n&&n.checkJoinedAVChatRoomByID(t)&&n.reset(t)}},{key:"_onInviteGroup",value:function(o){var t=this,n=o.payload.groupProfile.groupID,o=this._grpM.hasLocalGroup(n);u.l("".concat(this._n,"._onInviteGroup groupID:").concat(n," hasGroup:").concat(o)),this._grpM.getGroupProfile({groupID:n}).then(function(){t._grpM.emitGroupListUpdate(),t._grpM.get(11).recoverMessageOnInviteGroup("".concat(_.CONV_GROUP).concat(n))})}},{key:"_onQuitGroup",value:function(n){var n=n.payload.groupProfile,t=n.groupID,n=n.groupType,o=this._grpM.hasLocalGroup(t);u.l("".concat(this._n,"._onQuitGroup groupID:").concat(t," groupType:").concat(n," hasGroup:").concat(o)),o&&this._grpM.deleteLocalGroupAndConversation(t)}},{key:"_onSetManager",value:function(n){var n=n.payload.groupProfile,t=n.to,n=n.groupID,n=this._grpM.getGroupMemberHandler().getLocalGroupMemberInfo(n,t);n&&n.updateRole(_.GRP_MBR_ROLE_ADMIN)}},{key:"_onDeleteManager",value:function(n){var n=n.payload.groupProfile,t=n.to,n=n.groupID,n=this._grpM.getGroupMemberHandler().getLocalGroupMemberInfo(n,t);n&&n.updateRole(_.GRP_MBR_ROLE_MEMBER)}},{key:"_onMessageRemindTypeSynced",value:function(n){var t=n.payload.groupProfile.groupID,n=n.payload.messageRemindType;this._grpM.get(11).onGroupMessageRemindTypeUpdated({groupID:t,messageRemindType:n})}},{key:"_handleTopicSystemNotice",value:function(i){var n=i.groupProfile,t=n.groupID,n=n.topicID,i=i.elements,o=i.operationType,s=i.topicIDList,i=i.messageRemindType,a=this._grpM.get(10);o===17?a.onTopicCreated({groupID:t,topicID:n}):o===18?a.onTopicDeleted({groupID:t,topicIDList:s}):o===20&&a.onTopicMessageRemindTypeUpdated({groupID:t,topicID:n,messageRemindType:i})}},{key:"reset",value:function(){this.pendencyMap.clear()}}]),Mi),Xc=["relayFlag"],$c=(z(no,Oe),gr=X(no),R(no,[{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("polling_interval"),t=this.getCloudConfig("polling_interval_plus"),n=this.getCloudConfig("polling_no_msg_count"),o=this.getCloudConfig("polling_simplified_msg"),s=this.getCloudConfig("paging_grp_count");u.l("".concat(this._n,"._onCloudConfigUpdated pollingInterval:").concat(e)+" pollingIntervalPlus:".concat(t," pollingNoMessageCount:").concat(n)+" pollingSimplifiedMessage:".concat(o," pagingGroupCount:").concat(s)),this._AVChatRoomHandler.setPollingInterval(e),this._AVChatRoomHandler.setPollingIntervalPlus(t),this._AVChatRoomHandler.setPollingNoMessageCount(n),this._AVChatRoomHandler.setPollingSimplifiedMessage(o),this._commonGroupHandler.setPagingGroupCount(s)}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&(this._commonGroupHandler.onCheckTimer(e),this._groupTipsHandler.onCheckTimer(e))}},{key:"guardForAVChatRoom",value:function(e){var t,n=this;return e.conversationType===_.CONV_GROUP?(t=Ve(e.to)?Be(e.to):e.to,this.hasLocalGroup(t)?Q():this.getGroupProfile({groupID:t}).then(function(s){var s=s.data.group.type;return u.l("".concat(n._n,".guardForAVChatRoom. groupID:").concat(t," type:").concat(s)),s===_.GRP_AVCHATROOM?v(new Te({code:s=M.MSG_SEND_FAIL_NOT_IN_AVCHATROOM,message:n.getErrorMessage(s,e.from,t),data:{message:e}})):Q()})):Q()}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"onNewGroupMessage",value:function(e){this._commonGroupHandler.onNewGroupMessage(e)}},{key:"updateNextMessageSeq",value:function(e){var t,n=this;F(e)&&(t=this.get(10),e.forEach(function(o){var s=o.conversationID.replace(_.CONV_GROUP,"");Ve(s)&&t.updateLastMessage(s,o.lastMessage),n.groupMap.has(s)&&(n.groupMap.get(s).nextMessageSeq=o.lastMessage.sequence+1)}))}},{key:"onNewGroupTips",value:function(e){this._groupTipsHandler.onNewGroupTips(e)}},{key:"onGroupMessageRevoked",value:function(e){this._commonGroupHandler.onGroupMessageRevoked(e)}},{key:"onNewGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler.onNewGroupSystemNotice(e)}},{key:"onGroupMessageReadNotice",value:function(e){var t=this;e.dataList.forEach(function(s){var o,s=s.elements.groupMessageReadNotice;C(s)||(o=t.get(11),s.forEach(function(r){var c=r.groupID,a=r.topicID,a=a===void 0?void 0:a,r=r.lastMessageSeq,c=(u.d("".concat(t._n,".onGroupMessageReadNotice groupID:").concat(c," lastMessageSeq:").concat(r)),"".concat(_.CONV_GROUP).concat(c)),d=!0;G(a)||(c="".concat(_.CONV_GROUP).concat(a),d=!1),o.updateIsReadAfterReadReport({conversationID:c,lastMessageSeq:r}),o.updateUnreadCount(c,d),o.clearGroupAtInfoList(c,d)}))})}},{key:"onReadReceiptList",value:function(e){var t=this;u.d("".concat(this._n,".onReadReceiptList options:"),JSON.stringify(e)),e.dataList.forEach(function(i){var o=i.groupProfile,i=i.elements,o=o.groupID,s=t.get(11),i=i.readReceiptList;s.updateReadReceiptInfo({groupID:o,readReceiptList:i})})}},{key:"onGroupMessageModified",value:function(e){u.d("".concat(this._n,".onGroupMessageModified options:"),JSON.stringify(e));var t=this.get(11);e.dataList.forEach(function(n){t.onMessageModified(l(l({},n),{},{conversationType:_.CONV_GROUP,to:n.topicID||n.groupID}))})}},{key:"deleteGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler.deleteGroupSystemNotice(e)}},{key:"initGroupMap",value:function(e){this.groupMap.set(e.groupID,new Xt(e))}},{key:"clearGroupMap",value:function(){this.groupMap.clear()}},{key:"deleteGroup",value:function(e){this.groupMap.delete(e)}},{key:"updateGroupMap",value:function(e){var t,n=this,o=this.get(11);e.forEach(function(c){t=c.groupID,n.groupMap.has(t)?n.groupMap.get(t).updateGroup(c):(n.groupMap.set(t,new Xt(c)),o.deleteGroupRoamingMessageInfo(t))});var s,i=this.getMyUserID(),a=Ee(this.groupMap);try{for(a.s();!(s=a.n()).done;){var r=$(s.value,2)[1];r.selfInfo.userID=i,r.selfInfo.role==="Owner"&&(r.ownerID=i)}}catch(c){a.e(c)}finally{a.f()}}},{key:"getGroupMap",value:function(){return this.groupMap}},{key:"getLocalGroupList",value:function(){return b(this.groupMap.values()).filter(function(e){return e.type!==_.GRP_ROOM&&e.type!==_.GRP_LIVE})}},{key:"getLocalGroupProfile",value:function(e){return this.groupMap.get(e)}},{key:"sortLocalGroupList",value:function(){var e=b(this.groupMap).filter(function(t){return t=$(t,2),t[0],!G(t[1].lastMessage)});e.sort(function(t,n){return n[1].lastMessage.lastTime-t[1].lastMessage.lastTime}),this.groupMap=new Map(b(e))}},{key:"updateGroupLastMessage",value:function(e){this._commonGroupHandler.handleUpdateGroupLastMessage(e)}},{key:"emitGroupListUpdate",value:function(){var e=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],t=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],n=this.getLocalGroupList();e&&this.emitOuterEvent(V.GROUP_LIST_UPDATED),t&&(e=JSON.parse(JSON.stringify(n)),this.get(11).updateConversationGroupProfile(e))}},{key:"getMyNameCardByGroupID",value:function(e){return e=this.getLocalGroupProfile(e),e?e.selfInfo.nameCard:""}},{key:"isPagingGetCompleted",value:function(){return this._commonGroupHandler.isPagingGetCompleted()}},{key:"getMessageRemindType",value:function(e){var t=this;!F(e)||e.length===0||(e=e.filter(function(n){return!st(t.getLocalGroupProfile(n).type)})).length!==0&&(u.l("".concat(this._n,".getMessageRemindType groupIDList:").concat(e)),this.getGroupProfileAdvance({groupIDList:e,responseFilter:{memberInfoFilter:["MsgFlag"]}}).then(function(o){var o=o.data.successGroupList,s=t.get(11);o.forEach(function(i){s.onGroupMessageRemindTypeUpdated({groupID:i.groupID,messageRemindType:F(i.members)?i.members[0].messageRemindType:""})})}))}},{key:"getGroupList",value:function(){return this._commonGroupHandler.getGroupList()}},{key:"syncCommunityWithTopic",value:function(){return this._commonGroupHandler.syncGroupList(!0)}},{key:"getGroupProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupProfile"),o=new S("getGroupProfile"),s=e.groupID,i=e.groupCustomFieldFilter;return u.l("".concat(n," groupID:").concat(s)),this.getGroupProfileAdvance({groupIDList:[s],responseFilter:{groupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember","InviteJoinOption"],groupCustomFieldFilter:i,memberInfoFilter:["Role","JoinTime","MsgSeq","MsgFlag","NameCard"]}}).then(function(c){var c=c.data,r=c.successGroupList,c=c.failureGroupList;return u.l("".concat(n," ok")),0<c.length?v(c[0]):((c=st(r[0].type)&&!t.hasLocalGroup(s)?new Xt(r[0]):(t.updateGroupMap(r),t.getLocalGroupProfile(s))).isSupportTopic||t.get(11).updateConversationGroupProfile([c]),o.setMessage("groupID:".concat(s," type:").concat(c.type," muteAllMembers:").concat(c.muteAllMembers," ownerID:").concat(c.ownerID)).end(),q({group:c}))}).catch(function(a){return o.setError(a).setMessage("groupID:".concat(e.groupID)).end(),u.e("".concat(n," failed. error:"),a),v(a)})}},{key:"getGroupProfileAdvance",value:function(e){var t,n="".concat(this._n,".getGroupProfileAdvance"),i=e.groupIDList,o=(F(i)&&50<i.length&&(this.outputWarning("GetGroupProfileLimit"),i.length=50),[]),s=[],i=(i.forEach(function(a){(lt({groupID:a})?s:o).push(a)}),[]);return 0<o.length&&(t=this._getGroupProfileAdvance(l(l({},e),{},{groupIDList:o})),i.push(t)),0<s.length&&(t=this._getGroupProfileAdvance(l(l({},e),{},{groupIDList:s,relayFlag:0<o.length})),i.push(t)),Promise.all(i).then(function(a){var r=[],c=[];return a.forEach(function(d){r.push.apply(r,b(d.successGroupList)),c.push.apply(c,b(d.failureGroupList))}),q({successGroupList:r,failureGroupList:c})}).catch(function(a){return u.e("".concat(n," failed. error:"),a),v(a)})}},{key:"_getGroupProfileAdvance",value:function(e){var t=this,n=e.relayFlag,o=n!==void 0&&n,s=Z(e,Xc);return this.req({proto:g.GET_GRP_PROFILE,data:s}).then(function(i){return u.l("".concat(t._n,"._getGroupProfileAdvance ok. options:"),s),i=i.data.groups,{successGroupList:i.filter(function(a){return C(a.errorCode)||a.errorCode===0}),failureGroupList:i.filter(function(a){return a.errorCode&&a.errorCode!==0}).map(function(a){return new Te({code:a.errorCode,message:a.errorInfo,data:{groupID:a.groupID}})})}}).catch(function(i){return o&&lt({groupID:e.groupIDList[0]})?{successGroupList:[],failureGroupList:[]}:v(i)})}},{key:"createGroup",value:function(e){var t=this,n=[_.GRP_PUBLIC,_.GRP_WORK,_.GRP_MEETING,_.GRP_AVCHATROOM,_.GRP_COMMUNITY],o="".concat(this._n,".").concat("createGroup"),s=e.type,i=e.groupID;if(e.name&&this._filterProfanity("name",e)===!1)return v({code:M.PROFANITY_FOUND});if(e.introduction&&this._filterProfanity("introduction",e)===!1)return v({code:M.PROFANITY_FOUND});if(e.notification&&this._filterProfanity("notification",e)===!1)return v({code:M.PROFANITY_FOUND});if(!n.includes(s))return v({code:M.ILLEGAL_GRP_TYPE});if(!lt({type:s})){if(!G(i)&&lt({groupID:i}))return v({code:M.ILLEGAL_GRP_ID});e.isSupportTopic=void 0}if(st(s)&&!C(e.memberList)&&0<e.memberList.length&&(e.memberList=void 0),this._canIUseJoinOption(s)||C(e.joinOption)||(e.joinOption=void 0),lt({type:s})){if(!G(i)&&!lt({groupID:i}))return v({code:M.ILLEGAL_GRP_ID});e.isSupportTopic=e.isSupportTopic===!0?1:0}var a=new S("createGroup"),r=(u.l("".concat(o," options:"),e),null),c=[];return this.req({proto:g.CREATE_GRP,data:l(l({},e),{},{ownerID:this.getMyUserID(),webPushFlag:1})}).then(function(m){var m=m.data,p=m.groupID,m=m.overLimitUserIDList,h=m===void 0?[]:m,m=(r=p,c=h,"groupType:".concat(e.type," groupID:").concat(p," overLimitUserIDList:").concat(h));if(a.setMessage(m).end(),u.l("".concat(o," ok. ").concat(m)),e.type===_.GRP_AVCHATROOM)return t.getGroupProfile({groupID:p});if(e.type===_.GRP_COMMUNITY&&e.isSupportTopic===1)return t.getGroupProfile({groupID:p});G(e.memberList)||G(h)||(e.memberList=e.memberList.filter(function(N){return h.indexOf(N.userID)===-1})),t.updateGroupMap([l(l({},e),{},{groupID:p})]);var m=t.get(2),k="",f=0,I=(e.type===_.GRP_COMMUNITY?(k=t.isIntl()?"Create Community":"\u521B\u5EFA\u793E\u7FA4",f=1):k=t.isIntl()?"Create Group":"\u521B\u5EFA\u7FA4\u7EC4",t.get(4).getMyNick()),k=m.createCustomMessage({to:p,conversationType:_.CONV_GROUP,payload:{data:JSON.stringify({businessID:"group_create",content:k,cmd:f,opUser:I||t.getMyUserID(),version:4})}});return m.sendMessageInstance(k),t.emitGroupListUpdate(),t.getGroupProfile({groupID:p})}).then(function(p){var p=p.data.group,m=p.selfInfo,h=m.nameCard,m=m.joinTime;return p.updateSelfInfo({nameCard:h,joinTime:m,messageRemindType:_.MSG_REMIND_ACPT_AND_NOTE,role:_.GRP_MBR_ROLE_OWNER}),q({group:p,overLimitUserIDList:c})}).catch(function(d){var p;return a.setMessage("groupType:".concat(e.type)).setError(d).end(),d.code===10010||d.code===10007?(t._silentlyGetGroupProfile(d.code,r),t.updateGroupMap([l(l({},e),{},{groupID:r})]),(p=t.getLocalGroupProfile(r)).selfInfo.role=_.GRP_MBR_ROLE_OWNER,q({group:p,overLimitUserIDList:c})):(u.e("".concat(o," failed. error:"),d),v(d))})}},{key:"dismissGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("dismissGroup"),o="groupID:".concat(e);if(this.hasLocalGroup(e)&&this.getLocalGroupProfile(e).type===_.GRP_WORK)return v(new Te({code:M.CANNOT_DISMISS_WORK}));var s=new S("dismissGroup");return s.setMessage(o),u.l("".concat(n," ").concat(o)),this.req({proto:g.DISMISS_GRP,data:{groupID:e}}).then(function(){return s.end(),u.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),t.checkJoinedAVChatRoomByID(e)&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),q({groupID:e})}).catch(function(i){return s.setError(i).end(),u.e("".concat(n," failed. error:"),i),v(i)})}},{key:"updateGroupProfile",value:function(e){var t,n=this,o="".concat(this._n,".").concat("updateGroupProfile");if(this.hasLocalGroup(e.groupID)&&(t=this.getLocalGroupProfile(e.groupID).type,this._canIUseJoinOption(t)||C(e.joinOption)||(u.w("".concat(o," joinOption is unavailable for Work/Meeting/AVChatRoom")),e.joinOption=void 0)),C(e.muteAllMembers)||(e.muteAllMembers?e.muteAllMembers="On":e.muteAllMembers="Off"),e.name&&this._filterProfanity("name",e)===!1)return v({code:M.PROFANITY_FOUND});if(e.introduction&&this._filterProfanity("introduction",e)===!1)return v({code:M.PROFANITY_FOUND});if(e.notification&&this._filterProfanity("notification",e)===!1)return v({code:M.PROFANITY_FOUND});var s=new S("updateGroupProfile");return s.setMessage(JSON.stringify(e)),u.l("".concat(o," groupID:").concat(e.groupID)),this.req({proto:g.UPDATE_GRP_PROFILE,data:e}).then(function(){return s.end(),u.l("".concat(o," ok")),n.hasLocalGroup(e.groupID)&&n.groupMap.get(e.groupID).updateGroup(e),q({group:n.groupMap.get(e.groupID)})}).catch(function(i){return s.setError(i).end(),u.l("".concat(o," failed. error:"),i),v(i)})}},{key:"_filterProfanity",value:function(e,t){var o=this.get(29);if(!o)return!0;var o=o.filterText(t[e],Rt),n=o.isAllowedToSend,o=o.modifiedText;return n===!0&&(t[e]=o,!0)}},{key:"joinGroup",value:function(e){var t=this,n=e.groupID,o=e.type,s="".concat(this._n,".joinGroup");if(o===_.GRP_WORK)return v({code:M.CANNOT_JOIN_WORK});if(this.deleteUnjoinedAVChatRoom(n),this.hasLocalGroup(n)){if(!this.isLoggedIn())return Q({status:_.JOIN_STATUS_ALREADY_IN_GROUP});var i=new S("applyJoinGroup");return this.getGroupProfile({groupID:n}).then(function(){return i.setMessage("groupID:".concat(n," joinedStatus:").concat(_.JOIN_STATUS_ALREADY_IN_GROUP)).end(),Q({status:_.JOIN_STATUS_ALREADY_IN_GROUP})}).catch(function(a){return i.setMessage("groupID:".concat(n," unjoined")).end(),u.w("".concat(s," ").concat(n," was unjoined, now join!")),t.groupMap.delete(n),t.applyJoinGroup(e)})}return u.l("".concat(s," groupID:").concat(n)),this.isLoggedIn()?this.applyJoinGroup(e):this._AVChatRoomHandler.joinWithoutAuth(e)}},{key:"applyJoinGroup",value:function(i){var t=this,n="".concat(this._n,".").concat("applyJoinGroup"),o=i.groupID;if(!G(i.applyMessage)&&this._filterProfanity("applyMessage",i)===!1)return v({code:M.PROFANITY_FOUND});var s=new S("applyJoinGroup"),i=l({},i),a=this.canIUse(de.AV_HISTORY_MSG);return a&&(i.historyMessageFlag=1),this.get(11).deleteTopicRoamingMessageInfo(o),this.req({proto:g.APPLY_JOIN_GRP,data:i}).then(function(I){var I=I.data,c=I.joinedStatus,d=I.longPollingKey,p=I.startSeq,h=I.avChatRoomFlag,m=I.avChatRoomKey,f=I.messageList,I="groupID:".concat(o," joinedStatus:").concat(c," longPollingKey:").concat(d," startSeq:").concat(p)+" avChatRoomFlag:".concat(h," canGetAVChatRoomHistoryMessage:").concat(a,",")+" history message count:".concat(G(f)?0:f.length);switch(s.setMessage(I).end(),u.l("".concat(n," ok. ").concat(I)),c){case Ge:return q({status:Ge});case ue:return t.getGroupProfile({groupID:o}).then(function(N){return N=N.data.group,t._handleJoinResult({group:N,avChatRoomFlag:h,longPollingKey:d,startSeq:p,avChatRoomKey:m,messageList:f})}).catch(function(N){var x;return N.code===10010||N.code===10007?(t._silentlyGetGroupProfile(N.code,o),x=new Xt({groupID:o}),t.updateGroupMap([x]),t._handleJoinResult({group:x,avChatRoomFlag:h,longPollingKey:d,startSeq:p,avChatRoomKey:m,messageList:f})):(u.e("".concat(n," failed. error:"),N),v(N))});default:var k=new Te({code:M.JOIN_GRP_FAIL});return u.e("".concat(n," failed. error:"),k),v(k)}}).catch(function(r){return s.setMessage("groupID:".concat(o)).setError(r).end(),u.e("".concat(n," failed. error:"),r),v(r)})}},{key:"_handleJoinResult",value:function(e){var t=this,n=e.group,o=e.avChatRoomFlag,s=e.longPollingKey,i=e.startSeq,a=e.avChatRoomKey,r=e.messageList,c=n.groupID;return o===1?(this.get(11).setCompleted("".concat(_.CONV_GROUP).concat(c)),this._groupAttributesHandler.initGroupAttributesCache({groupID:c,avChatRoomKey:a}),this._groupCountersHandler.initGroupCountersCache({groupID:c,avChatRoomKey:a}),(e=C(s)?this._AVChatRoomHandler.handleJoinResult({group:n}):this._AVChatRoomHandler.startRunLoop({group:n,longPollingKey:s,startSeq:i})).then(function(){t._onAVChatRoomHistoryMessage(r,c)}),e):(this.emitGroupListUpdate(!0,!1),q({status:ue,group:n}))}},{key:"quitGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("quitGroup"),o="groupID:".concat(e),s=(u.l("".concat(n," ").concat(o)),this.checkJoinedAVChatRoomByID(e));if(!s&&!this.hasLocalGroup(e))return v({code:M.MEMBER_NOT_IN_GRP});if(s&&!this.isLoggedIn())return u.l("".concat(n," anonymously ok. ").concat(o)),this.deleteLocalGroupAndConversation(e),this._AVChatRoomHandler.reset(e),Q({groupID:e});var i=new S("quitGroup");return i.setMessage(o),this.req({proto:g.QUIT_GRP,data:{groupID:e}}).then(function(){return i.end(),u.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),s&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),q({groupID:e})}).catch(function(a){return i.setError(a).end(),u.e("".concat(n," failed. error:"),a),v(a)})}},{key:"searchGroupByID",value:function(e){var t="".concat(this._n,".").concat("searchGroupByID"),n={groupIDList:[e]},o=new S("searchGroupByID");return o.setMessage("groupID:".concat(e)),u.l("".concat(t," groupID:").concat(e)),this.req({proto:g.SEARCH_GRP,data:n}).then(function(s){if(s=s.data.groupProfile,s[0].errorCode!==0)throw new Te({code:s[0].errorCode,message:s[0].errorInfo});return o.end(),u.l("".concat(t," ok")),q({group:new Xt(s[0])})}).catch(function(s){return o.setError(s).end(),u.w("".concat(t," failed. error:"),s),v(s)})}},{key:"changeGroupOwner",value:function(e){var t=this,n="".concat(this._n,".").concat("changeGroupOwner");if(this.hasLocalGroup(e.groupID)&&this.getLocalGroupProfile(e.groupID).type===_.GRP_AVCHATROOM)return v({code:M.CANNOT_CHANGE_OWNER_IN_AVCHATROOM});if(e.newOwnerID===this.getMyUserID())return v({code:M.CANNOT_CHANGE_OWNER_TO_SELF});var o=new S("changeGroupOwner");return o.setMessage("groupID:".concat(e.groupID," newOwnerID:").concat(e.newOwnerID)),u.l("".concat(n," groupID:").concat(e.groupID)),this.req({proto:g.CHANGE_GRP_OWNER,data:e}).then(function(){o.end(),u.l("".concat(n," ok"));var s,i=e.groupID,a=e.newOwnerID,r=(t.groupMap.get(i).ownerID=a,t._groupMemberHandler.getLocalGroupMemberList(i));return r instanceof Map&&(s=r.get(t.getMyUserID()),C(s)||(s.updateRole("Member"),t.groupMap.get(i).selfInfo.role="Member"),s=r.get(a),C(s)||s.updateRole("Owner")),t.emitGroupListUpdate(!0,!1),q({group:t.groupMap.get(i)})}).catch(function(s){return o.setError(s).end(),u.e("".concat(n," failed. error:"),s),v(s)})}},{key:"getGroupApplicationList",value:function(){return this._groupSystemNoticeHandler.getGroupApplicationList()}},{key:"handleGroupApplication",value:function(e){var t,n,o,s,i,a=this,r="".concat(this._n,".").concat("handleGroupApplication"),c=e.handleAction,d=e.handleMessage,p=e.message,h=e.application,m=(p?(t=p.payload.operatorID,n=p.payload.groupProfile.groupID,o=p.payload.authentication,s=p.payload.messageKey):h&&(t=h.applicant,n=h.groupID,o=h.authentication,s=h.messageKey),g.HANDLE_GRP_APPLICATION),f=(h&&h.applicationType===2&&(m=g.HANDLE_INVITE_JOIN_GRP,i=h.userID),new S("handleGroupApplication"));return f.setMessage("groupID:".concat(n)),u.l("".concat(r," groupID:").concat(n)),this.req({proto:m,data:{handleAction:c,handleMessage:d,applicant:t,invitee:i,groupID:n,authentication:o,messageKey:s}}).then(function(){return f.end(),u.l("".concat(r," ok")),p&&a._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),q({group:a.getLocalGroupProfile(n)})}).catch(function(I){return f.setError(I).end(),u.e("".concat(r," failed. error"),I),v(I)})}},{key:"handleGroupInvitation",value:function(e){var t=this,n="".concat(this._n,".").concat("handleGroupInvitation"),a=e.message.payload,o=a.groupProfile.groupID,s=a.authentication,i=a.messageKey,a=a.operatorID,r=e.handleAction,c=new S("handleGroupInvitation");return c.setMessage("groupID:".concat(o," inviter:").concat(a," handleAction:").concat(r)),u.l("".concat(n," groupID:").concat(o," inviter:").concat(a," handleAction:").concat(r)),this.req({proto:g.HANDLE_GRP_INVITATION,data:l(l({},e),{},{inviter:a,groupID:o,authentication:s,messageKey:i})}).then(function(){return c.end(),u.l("".concat(n," ok")),t._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),q({group:t.getLocalGroupProfile(o)})}).catch(function(d){return c.setError(d).end(),u.e("".concat(n," failed. error"),d),v(d)})}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this,n="".concat(this._n,".getGroupOnlineMemberCount"),o=this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e),s=this.hasLocalGroup(e);if(u.l("".concat(n," groupID:").concat(e," isAVChatRoom:").concat(o," has:").concat(s)),o)return this._AVChatRoomHandler.getGroupOnlineMemberCount(e);if(!s)return Q({memberCount:0});if(o=Date.now(),this._onlineMemberCountMap.has(e)){if(s=this._onlineMemberCountMap.get(e),o-s.lastReqTime<=6e4)return Q({memberCount:s.memberCount});s.lastReqTime=o}return this.requestOnlineCount(e).then(function(i){return i=i.data.memberCount,i=i===void 0?0:i,t._onlineMemberCountMap.set(e,{lastReqTime:Date.now(),memberCount:i}),u.l("".concat(n," ok. groupID:").concat(e," memberCount:").concat(i)),Q({memberCount:i})}).catch(function(i){return u.w("".concat(n," failed. error:"),i),Promise.reject(i)})}},{key:"requestOnlineCount",value:function(e){return this.req({proto:g.GET_ONLINE_MBR_NUM,data:{groupID:e}})}},{key:"hasLocalGroup",value:function(e){return this.groupMap.has(e)}},{key:"deleteLocalGroupAndConversation",value:function(e){var t,n=this.checkJoinedAVChatRoomByID(e),o=(u.l("".concat(this._n,".deleteLocalGroupAndConversation groupID:").concat(e," isJoinedAVChatRoom:").concat(n)),this.get(11)),s="".concat(_.CONV_GROUP).concat(e);n&&o.deleteLocalConversation(s),lt({groupID:e})&&(t=this.getLocalGroupProfile(e))&&t.isSupportTopic===!0&&this.get(10).deleteTopicListInCommunity(e),o.clearUnreadCount(s),this._deleteLocalGroup(e),this._onlineMemberCountMap.delete(e),this.emitGroupListUpdate(!0,!1)}},{key:"_deleteLocalGroup",value:function(e){this.groupMap.delete(e),this._groupMemberHandler.deleteGroupMemberList(e)}},{key:"sendMessage",value:function(e,t){return F(e._receiverList)&&0<e._receiverList.length&&!this.canIUse(de.MSG_TO_SPECIFIED_GRP_MBR)?this.cannotUseCommercialAbility("group direct messages"):(e=this.createGroupMessagePack(e,t),this.req(e))}},{key:"createGroupMessagePack",value:function(e,c){var n=null,o=(c&&c.offlinePushInfo&&(n=c.offlinePushInfo),""),s=(te(e.cloudCustomData)&&0<e.cloudCustomData.length&&(o=e.cloudCustomData),[]),i=(Ce(c)&&Ce(c.messageControlInfo)&&(i=(r=c.messageControlInfo).excludedFromUnreadCount,a=r.excludedFromLastMessage,r=r.excludedFromContentModeration,i===!0&&s.push("NoUnread"),a===!0&&s.push("NoLastMsg"),r===!0&&s.push("NoMsgCheck")),void 0),a=(F(e._receiverList)&&0<e._receiverList.length&&(i=e._receiverList,50<e._receiverList.length&&(i=e._receiverList.slice(0,50),this.outputWarning("ReceiverListLimit"))),this.isOnlineMessage(e,c)?1:0),r=e.getGroupAtInfoList(),c={fromAccount:this.getMyUserID(),groupID:e.to,msgBody:e.getElements(),cloudCustomData:o,random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:e.type!==_.MSG_TEXT||G(r)?void 0:r,onlineOnlyFlag:a,clientTime:e.clientTime,offlinePushInfo:as(n),messageControlInfo:a==0?s:void 0,needReadReceipt:e.needReadReceipt!==!0||this.isMessageFromOrToAVChatroom(e.to)?0:1,receiverList:i,isSupportExtension:e.isSupportExtension===!0?1:0,isRelayMessage:e._relayFlag===!0?1:0,cmConfigID:e._cmConfigID};return Ve(e.to)&&(c.groupID=Be(e.to),c.topicID=e.to),{proto:g.SEND_GRP_MSG,tjgID:this.generateTjgID(e),data:c}}},{key:"revokeMessage",value:function(e){var t={groupID:e.to,msgSeqList:[{msgSeq:e.sequence}]};return Ve(e.to)&&(t.groupID=Be(e.to),t.topicID=e.to),this.req({proto:g.REVOKE_GRP_MSG,data:t})}},{key:"deleteMessage",value:function(n){var t=n.to,n=n.keyList,n=(u.l("".concat(this._n,".deleteMessage groupID:").concat(t," count:").concat(n.length)),{groupID:t,deleter:this.getMyUserID(),keyList:n});return Ve(t)&&(n.groupID=Be(t),n.topicID=t),this.req({proto:g.DEL_GRP_MSG,data:n})}},{key:"modifyRemoteMessage",value:function(i){var c=i.to,t=i.sequence,n=i.payload,o=i.type,s=i.version,s=s===void 0?0:s,i=i.cloudCustomData,a=c,r=void 0,c=(Ve(c)&&(a=Be(c),r=c),void 0);return ja(o)&&(c=[]).push({type:o,content:n}),this.req({proto:g.MODIFY_GRP_MSG,data:{groupID:a,topicID:r,sequence:t,version:s,elements:c,cloudCustomData:i}})}},{key:"getRoamingMessage",value:function(i){var t=this,n="".concat(this._n,".getRoamingMessage"),o=i.conversationID,s=i.groupID,i=i.sequence,a=new S("getGroupRoamingMessages"),r=0,c=void 0;return Ve(s)&&(s=Be(c=s)),this._computeLastSequence({groupID:s,topicID:c,sequence:i}).then(function(d){return r=d,u.l("".concat(n," groupID:").concat(s," startSequence:").concat(r)),t.req({proto:g.GET_GRP_ROAMING_MSG,data:{groupID:s,count:21,sequence:r,topicID:c}})}).then(function(f){var m=f.data,p=m.messageList,h=m.complete,m=m.invisibleSequenceList,m=m===void 0?[]:m,f=f.data.nextSequence,f=f===void 0?0:f,I=(C(p)?u.l("".concat(n," ok. complete:").concat(h," nextSequence:").concat(f," but messageList is undefined!")):u.l("".concat(n," ok. complete:").concat(h," nextSequence:").concat(f," count:").concat(p.length)),a.setMessage("groupID:".concat(s," topicID:").concat(c," startSequence:").concat(r," complete:").concat(h," nextSequence:").concat(f)).end(),t.get(11)),k=[];return G(p)?1<=f&&I.updateRoamingMessageSequence(o,f):(I.updateRoamingMessageSequence(o,f),k=I.onRoamingMessage(p,o),I.updateIsRead(o),I.patchConversationLastMessage(o)),(h===2||f<1)&&(I.setCompleted(o),f=""),u.l("".concat(n," nextReqID:").concat(f,", stored message count:").concat(k.length,", invisible sequence count:").concat(m.length)),{nextReqID:f+"",storedMessageList:k}}).catch(function(d){return a.setError(d).setMessage("groupID:".concat(s," topicID:").concat(c," startSequence:").concat(r)).end(),u.w("".concat(n," failed. error:"),d),v(d)})}},{key:"_getGroupIDOfMessage",value:function(e){return e.conversationID.replace(_.CONV_GROUP,"")}},{key:"getReadReceiptList",value:function(e){var t="".concat(this._n,".").concat("getReadReceiptList"),n=this._getGroupIDOfMessage(e[0]),o=this.getMyUserID(),s=e.filter(function(a){return a.from===o&&a.needReadReceipt===!0}).map(function(a){return{sequence:a.sequence}});if(u.l("".concat(t," groupID:").concat(n," sequenceList:").concat(JSON.stringify(s))),s.length===0)return Q({messageList:e});var i=new S("getReadReceiptList");return i.setMessage("groupID:".concat(n)),this.req({proto:g.GET_READ_RECEIPT,data:{groupID:n,sequenceList:s}}).then(function(a){return i.end(),u.l("".concat(t," ok")),a=a.data.readReceiptList,F(a)&&a.forEach(function(r){e.forEach(function(c){r.code===0&&r.sequence===c.sequence&&(c.readReceiptInfo.readCount=r.readCount,c.readReceiptInfo.unreadCount=r.unreadCount)})}),q({messageList:e})}).catch(function(a){return i.setError(a).end(),u.w("".concat(t," failed. error:"),a),v(a)})}},{key:"sendReadReceipt",value:function(i){var t="".concat(this._n,".").concat("sendReadReceipt"),n=this._getGroupIDOfMessage(i[0]),o=new S("sendReadReceipt"),s=(o.setMessage("groupID:".concat(n)),this.getMyUserID()),i=i.filter(function(a){return a.from!==s&&a.needReadReceipt===!0}).map(function(a){return{sequence:a.sequence}});return i.length===0?v({code:M.READ_RECEIPT_MSG_LIST_EMPTY}):(u.l("".concat(t,". sequenceList:").concat(JSON.stringify(i))),this.req({proto:g.SEND_READ_RECEIPT,data:{groupID:n,sequenceList:i}}).then(function(a){return o.end(),u.l("".concat(t," ok")),q()}).catch(function(a){return o.setError(a).end(),u.w("".concat(t," failed. error:"),a),v(a)}))}},{key:"getReadReceiptDetail",value:function(p){var t=this,s=p.message,c=p.filter,d=p.cursor,p=p.count,n=this._getGroupIDOfMessage(s),o=s.ID,s=s.sequence,i="".concat(this._n,".").concat("getReadReceiptDetail"),a=this._receiptDetailCompleteMap.get(o)||!1,r=c!==0&&c!==1?0:c,c=te(d)?d:"",d=!fe(p)||p<=0||100<=p?100:p,p="groupID:".concat(n," sequence:").concat(s," cursor:").concat(c," filter:").concat(r," completeFlag:").concat(a),h=(u.l("".concat(i," ").concat(p)),{cursor:"",isCompleted:!1,messageID:o,unreadUserIDList:[],readUserIDList:[]}),m=new S("getReadReceiptDetail");return m.setMessage(p),this.req({proto:g.GET_READ_RECEIPT_DETAIL,data:{groupID:n,sequence:s,flag:r,cursor:c,count:d}}).then(function(x){m.end();var x=x.data,I=x.cursor,k=x.isCompleted,N=x.unreadUserIDList,x=x.readUserIDList;return h.cursor=I,k===1&&(h.isCompleted=!0,t._receiptDetailCompleteMap.set(o,!0)),r===0?h.readUserIDList=x.map(function(Y){return Y.userID}):r===1&&(h.unreadUserIDList=N.map(function(Y){return Y.userID})),u.l("".concat(i," ok")),q(h)}).catch(function(f){return m.setError(f).end(),u.w("".concat(i," failed. error:"),f),v(f)})}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".getRoamingMessagesHopping"),o=e.groupID,s=e.count,i=e.sequence,a=e.direction,r=i;if(C(i)){if(a===1)return Q({messageList:[],isCompleted:!0,nextMessageSeq:""});this.hasLocalGroup(o)&&(r=1<(c=this.getLocalGroupProfile(o).nextMessageSeq)?c-1:0),Ve(o)&&(r=0)}else a===1&&(r=i+s-1);var c=void 0,d=(Ve(o)&&(o=Be(c=o)),"".concat(c?"topicID:".concat(c):"groupID:".concat(o)," sequence:").concat(i," direction:").concat(a)),p=(u.l("".concat(n," ").concat(d)),new S("getGroupRoamingMessagesHopping"));return this.req({proto:g.GET_GRP_ROAMING_MSG,data:{groupID:o,topicID:c,count:s,sequence:r}}).then(function(f){var f=f.data,m=f.messageList,f=f.complete,I="complete:".concat(f," count:").concat(m?m.length:0);return u.l("".concat(n," ok. ").concat(I)),p.setMessage("".concat(d," ").concat(I)).end(),f===2||G(m)?(I=t._computeResult(),q(I)):(f="".concat(_.CONV_GROUP).concat(e.groupID),I=t.get(11),f=I.onRoamingMessage(m,f,!1),m=t._computeResult({direction:a,sequence:i,remoteMessageList:m,processedMessageList:f}),I.storeHoppingMessageList(m.messageList),q(m))}).catch(function(h){return p.setError(h).setMessage("groupID:".concat(o," sequence:").concat(i," count:").concat(s)).end(),u.w("".concat(n," failed. error:"),h),v(h)})}},{key:"_computeResult",value:function(i){var t={messageList:[],isCompleted:!1,nextMessageSeq:""};if(C(i))return t.isCompleted=!0,t;var n=i.direction,o=i.sequence,s=i.remoteMessageList,s=s===void 0?[]:s,i=i.processedMessageList,i=i===void 0?[]:i,a=s.length;return n===1?(t.nextMessageSeq=s[0].sequence+1,i.forEach(function(r){r.sequence>=o&&t.messageList.push(r)}),t.messageList.length===0&&s[0].sequence<o&&(t.isCompleted=!0,t.nextMessageSeq="")):(t.nextMessageSeq=s[a-1].sequence-1,t.messageList=b(i),t.nextMessageSeq===0&&(t.isCompleted=!0,t.nextMessageSeq="")),t}},{key:"setMessageRead",value:function(i){var t=this,n=i.conversationID,o=i.lastMessageSeq,s="".concat(this._n,".").concat("setMessageRead"),i="conversationID:".concat(n," lastMessageSeq:").concat(o),a=(u.l("".concat(s," ").concat(i)),fe(o)||this.outputWarning("DoNotModifyLastSeq"),new S("setMessageRead")),r=(a.setMessage(i),n.replace(_.CONV_GROUP,"")),c=void 0;return Ve(r)&&(r=Be(c=r)),this.req({proto:g.SET_GRP_MSG_READ,data:{groupID:r,topicID:c,messageReadSeq:o}}).then(function(){a.end(),u.l("".concat(s," ok"));var d,p=t.get(11),h=(p.updateIsReadAfterReadReport({conversationID:n,lastMessageSeq:o}),!0);return C(c)||(h=!1,(d=t.get(10).getLocalTopic(r,c))&&d.updateSelfInfo({readedSequence:o})),p.updateUnreadCount(n,h),q()}).catch(function(d){return a.setError(d).end(),u.l("".concat(s," failed. error:"),d),v(d)})}},{key:"_computeLastSequence",value:function(o){var t=o.groupID,n=o.topicID,n=n===void 0?void 0:n,o=o.sequence;return 0<o?Promise.resolve(o):C(n)?this.getGroupLastSequence(t):Promise.resolve(0)}},{key:"getGroupLastSequence",value:function(e){var t="".concat(this._n,".").concat("getGroupLastSequence"),n=new S("getGroupLastSequence"),o=0,s="",i="groupID:".concat(e);if(this.hasLocalGroup(e)){var a=this.getLocalGroupProfile(e),r=a.lastMessage;if(0<r.lastSequence&&r.onlineOnlyFlag===!1)return o=r.lastSequence,s="".concat(i,", ").concat(o," from group.lastMessage.lastSequence"),u.l("".concat(t," ").concat(s)),n.setMessage(s).end(),Promise.resolve(o);if(1<a.nextMessageSeq)return o=a.nextMessageSeq-1,s="".concat(i,", ").concat(o," from group.nextMessageSeq"),u.l("".concat(t," ").concat(s)),n.setMessage(s).end(),Promise.resolve(o)}return r=this.get(11).getLocalConversation("GROUP".concat(e)),r&&r.lastMessage.lastSequence&&r.lastMessage.onlineOnlyFlag===!1?(o=r.lastMessage.lastSequence,s="".concat(i,", ").concat(o," from conversation.lastMessage.lastSequence"),u.l("".concat(t," ").concat(s)),n.setMessage(s).end(),Promise.resolve(o)):this.getGroupProfileAdvance({groupIDList:[e],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}}).then(function(c){return c=c.data.successGroupList,G(c)?u.w("".concat(t," ").concat(i,", empty successGroupList")):(o=c[0].nextMessageSeq-1,s="".concat(i,", ").concat(o," from remote"),u.l("".concat(t," ").concat(s))),n.setMessage(s).end(),o}).catch(function(c){return n.setError(c).setMessage(i).end(),u.w("".concat(t," failed. error:"),c),v(c)})}},{key:"isMessageFromOrToAVChatroom",value:function(e){return this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"hasJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler.hasJoinedAVChatRoom()}},{key:"getJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler.getJoinedAVChatRoom()}},{key:"getGroupRemoteLastSeq",value:function(e){return e=this.getLocalGroupProfile(e),e?e.nextMessageSeq-1:1}},{key:"isOnlineMessage",value:function(e,t){return!(!this._canIUseOnlineOnlyFlag(e)||!t||t.onlineUserOnly!==!0)}},{key:"_canIUseOnlineOnlyFlag",value:function(e){var t=this.getJoinedAVChatRoom();return!t||!t.includes(e.to)||e.conversationType!==_.CONV_GROUP}},{key:"_onAVChatRoomHistoryMessage",value:function(e,t){var n;G(e)||(u.l("".concat(this._n,"._onAVChatRoomHistoryMessage groupID:").concat(t," count:").concat(e.length)),n=[],e.forEach(function(o){n.push(l(l({},o),{},{isHistoryMessage:1}))}),this.onAVChatRoomMessage(n,t))}},{key:"onAVChatRoomMessage",value:function(e){this._AVChatRoomHandler.onMessage(e,1<arguments.length&&arguments[1]!==void 0?arguments[1]:"")}},{key:"onAVChatRoomMemberBanned",value:function(e){this._AVChatRoomHandler.onAVChatRoomMemberBanned(e)}},{key:"getGroupSimplifiedInfo",value:function(e){var t=new S("getGroupSimplifiedInfo");return this.getGroupProfileAdvance({groupIDList:[e],responseFilter:{groupBaseInfoFilter:["Type","Name"]}}).then(function(n){return n=n.data.successGroupList,t.setMessage("groupID:".concat(e," type:").concat(n[0].type)).end(),n[0]}).catch(function(n){t.setError(n).setMessage("groupID:".concat(e)).end()})}},{key:"setUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.set(e,1)}},{key:"deleteUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.has(e)&&this._unjoinedAVChatRoomList.delete(e)}},{key:"isUnjoinedAVChatRoom",value:function(e){return this._unjoinedAVChatRoomList.has(e)}},{key:"isGroupAttributesUpdatedNotice",value:function(e){return this._groupAttributesHandler.isGroupAttributesUpdatedNotice(e)}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesHandler.updateLocalMainSequenceOnReconnected()}},{key:"initGroupAttributes",value:function(e){return this._groupAttributesHandler.initGroupAttributes(e)}},{key:"setGroupAttributes",value:function(e){return this._groupAttributesHandler.setGroupAttributes(e)}},{key:"deleteGroupAttributes",value:function(e){return this._groupAttributesHandler.deleteGroupAttributes(e)}},{key:"getGroupAttributes",value:function(e){return this._groupAttributesHandler.getGroupAttributes(e)}},{key:"isMessageFromTopic",value:function(e,t){return e===2&&!G(t)}},{key:"isMessageFromCommunityOfTopic",value:function(e,t){return e===2&&G(t)}},{key:"getMessageExtensions",value:function(e,t){return u.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.req({proto:g.GET_GRP_MSG_EXT,data:{groupID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;return u.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n)),this.req({proto:g.MODIFY_GRP_MSG_EXT,data:{groupID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"_genNotifyReqList",value:function(e){for(var t=[],n=0,o=e.length;n<o;n++){var s=e[n],r=this.getLocalGroupProfile(s).type,i=this._getGroupLastRevokedTime(s),a=1e3*kt(),r={notifyType:1,limit:20,type:lt({type:r,groupID:s})?_.GRP_COMMUNITY:void 0,groupID:s,beginTime:i,endTime:a};t.push(r)}return t}},{key:"getGroupNotify",value:function(e){var t=this,n="".concat(this._n,".getGroupNotify"),o=e.filter(function(i){var r=t.getLocalGroupProfile(i),a=r.type,r=r.isSupportTopic;return t.hasLocalGroup(i)&&!st(a)&&!r}),s="filteredGroupIDList.length:".concat(o.length);o.length<=10&&(s="filteredGroupIDList:".concat(JSON.stringify(o))),u.l("".concat(n," ").concat(s)),o.length!==0&&this.req({proto:g.GET_GRP_NOTIFY,data:{notifyReqList:this._genNotifyReqList(e)}}).then(function(c){var a,c=c.data.notifyRspList,r=[],c=(F(c)&&(a={dataList:[]},c.forEach(function(d){var p=d.nextRevokedTime,h=d.groupID;a.dataList.push({elements:{revokedInfos:t._genRevokedInfos(d)}}),p!==0?(t._setGroupLastRevokedTime(h,p),r.push(h)):t._setGroupLastRevokedTime(h,1e3*kt())}),t.onGroupMessageRevoked(a)),0<r.length&&t.getGroupNotify(r),"nextGroupIDList.length:".concat(r.length));r.length<=10&&(c="nextGroupIDList:".concat(JSON.stringify(r))),u.l("".concat(n," ").concat(c))}).catch(function(i){u.e("".concat(n," failed. error:"),i)})}},{key:"_genRevokedInfos",value:function(e){var t=e.notifyList,n=e.groupID,o=[];return F(t)&&t.forEach(function(s){o.push({groupID:n,sequence:s.sequence,random:s.random,revokerInfo:l({},s.revokerInfo)})}),o}},{key:"_getGroupLastRevokedTime",value:function(e){return this.hasLocalGroup(e)?this.getLocalGroupProfile(e)._lastRevokedTime:0}},{key:"_setGroupLastRevokedTime",value:function(e,t){this.hasLocalGroup(e)&&(this.getLocalGroupProfile(e)._lastRevokedTime=t)}},{key:"isGroupCountersNotice",value:function(e){return this._groupCountersHandler.isGroupCountersNotice(e)}},{key:"setGroupCounters",value:function(e){return this._groupCountersHandler.setGroupCounters(e)}},{key:"increaseGroupCounter",value:function(e){return this._groupCountersHandler.increaseGroupCounter(e)}},{key:"decreaseGroupCounter",value:function(e){return this._groupCountersHandler.decreaseGroupCounter(e)}},{key:"getGroupCounters",value:function(e){return this._groupCountersHandler.getGroupCounters(e)}},{key:"getGroupMemberHandler",value:function(){return this._groupMemberHandler}},{key:"getGroupMemberList",value:function(e){return this._groupMemberHandler.getGroupMemberList(e)}},{key:"getGroupMemberProfile",value:function(e){return this._groupMemberHandler.getGroupMemberProfile(e)}},{key:"addGroupMember",value:function(e){return this._groupMemberHandler.addGroupMember(e)}},{key:"deleteGroupMember",value:function(e){return this._groupMemberHandler.deleteGroupMember(e)}},{key:"setGroupMemberMuteTime",value:function(e){return this._groupMemberHandler.setGroupMemberMuteTime(e)}},{key:"setGroupMemberRole",value:function(e){return this._groupMemberHandler.setGroupMemberRole(e)}},{key:"setGroupMemberNameCard",value:function(e){return this._groupMemberHandler.setGroupMemberNameCard(e)}},{key:"setGroupMemberCustomField",value:function(e){return this._groupMemberHandler.setGroupMemberCustomField(e)}},{key:"markGroupMemberList",value:function(e){return this._groupMemberHandler.markGroupMemberList(e)}},{key:"modifyGroupMemberInfo",value:function(e){return this._groupMemberHandler.modifyGroupMemberInfo(e)}},{key:"restartPolling",value:function(){this._AVChatRoomHandler.restartPolling()}},{key:"getPollingTimerID",value:function(e){if(!e)return-1;var t=this.getLocalGroupProfile(e);return t&&st(t.type)?this._AVChatRoomHandler.getPollingTimerID(e):-1}},{key:"_canIUseJoinOption",value:function(e){return e===_.GRP_PUBLIC||lt({type:e})}},{key:"_silentlyGetGroupProfile",value:function(e,t){var n=setTimeout(this.getGroupProfile.bind(this,{groupID:t}),3e3);this._timeoutIDs.push(n),u.l("".concat(this._n,"._silentlyGetGroupProfile errorCode:").concat(e," groupID:").concat(t," timeoutIDs:").concat(this._timeoutIDs))}},{key:"_clearTimeoutIDs",value:function(){this._timeoutIDs.forEach(function(e){clearTimeout(e)}),this._timeoutIDs=[]}},{key:"startMessageLongPolling",value:function(o){var t=o.groupID,n=o.longPollingKey,o=o.longPollingSequence,o=o===void 0?1:o,i=this.get(12).isUnlimitedAVChatRoom(),s=(this._AVChatRoomHandler.hasPollingInstance(t)&&this.stopMessageLongPolling({groupID:t}),this._AVChatRoomHandler.getJoinedLiveList()),i=(!i&&0<s.length&&this.stopMessageLongPolling({groupID:s[0]}),new Xt({groupID:t,type:_.GRP_LIVE}));return u.l("".concat(this._n,".startMessageLongPolling groupID:").concat(t," longPollingKey:").concat(n," longPollingSequence:").concat(o)),this._AVChatRoomHandler.startRunLoop({group:i,longPollingKey:n,startSeq:o})}},{key:"stopMessageLongPolling",value:function(t){var t=t.groupID,n=this.get(11);return this._AVChatRoomHandler.reset(t),this._deleteLocalGroup(t),n.deleteLocalConversation("".concat(_.CONV_GROUP).concat(t)),u.l("".concat(this._n,".stopMessageLongPolling ok, groupID:").concat(t)),Q({groupID:t})}},{key:"reset",value:function(){this.groupMap.clear(),this._unjoinedAVChatRoomList.clear(),this._receiptDetailCompleteMap.clear(),this._onlineMemberCountMap.clear(),this._commonGroupHandler.reset(),this._groupSystemNoticeHandler.reset(),this._groupTipsHandler.reset(),this._groupAttributesHandler.reset(),this._groupCountersHandler.reset(),this._AVChatRoomHandler.reset(),this._groupMemberHandler.reset(),this._clearTimeoutIDs()}}]),no),Qc=["topicID","topicName","avatar","introduction","notification","unreadCount","muteAllMembers","customData","groupAtInfoList","nextMessageSeq","selfInfo"],Zc=(R(Ii,[{key:"_initTopic",value:function(e){for(var t in e)Qc.indexOf(t)<0||(t==="selfInfo"?this.updateSelfInfo(e[t]):this[t]=t==="muteAllMembers"?e[t]===1:e[t])}},{key:"updateUnreadCount",value:function(){this.unreadCount=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0}},{key:"updateNextMessageSeq",value:function(e){this.nextMessageSeq=e}},{key:"updateLastMessage",value:function(e){this.lastMessage=lr(e)}},{key:"updateGroupAtInfoList",value:function(e){this.groupAtInfoList=JSON.parse(JSON.stringify(e))}},{key:"updateTopic",value:function(e){C(e.selfInfo)||this.updateSelfInfo(e.selfInfo),C(e.muteAllMembers)||(this.muteAllMembers=e.muteAllMembers===1),bt(this,e,["groupID","lastMessageTime","selfInfo","muteAllMembers","lastMsg"])}},{key:"updateSelfInfo",value:function(e){return bt(this.selfInfo,e,[],[""])!==0}},{key:"reduceUnreadCount",value:function(){return 1<=this.unreadCount&&(--this.unreadCount,!0)}},{key:"isLastMessageRevoked",value:function(e){return e.sequence===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}}]),Ii),eu=(z(to,Oe),_r=X(to),R(to,[{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("topic_cache_time"),t=this.getCloudConfig("topic_last_active_time");C(e)||(this.TOPIC_CACHE_TIME=Number(e)),C(t)||(this.TOPIC_LAST_ACTIVE_TIME=Number(t))}},{key:"onTopicCreated",value:function(e){var t=e.groupID;this.resetGetTopicTime(t),this.emitOuterEvent(V.TOPIC_CREATED,e)}},{key:"onTopicDeleted",value:function(e){var t=this,n=e.groupID,o=e.topicIDList;(o===void 0?[]:o).forEach(function(s){t._deleteLocalTopic(n,s)}),this.emitOuterEvent(V.TOPIC_DELETED,e)}},{key:"onTopicMessageRemindTypeUpdated",value:function(s){var t,n=s.groupID,o=s.topicID,s=s.messageRemindType,i=this.getLocalTopic(n,o);i&&((t=i.updateSelfInfo({messageRemindType:s}))&&this.emitOuterEvent(V.TOPIC_UPDATED,{groupID:n,topic:i}),u.l("".concat(this._n,".onTopicMessageRemindTypeUpdated topicID:").concat(o)+" messageRemindType:".concat(s," isTopicUpdated:").concat(t)))}},{key:"onTopicProfileUpdated",value:function(e){var t=e.groupID,n=e.topicID,n=this.getLocalTopic(t,n);n&&(n.updateTopic(e),this.emitOuterEvent(V.TOPIC_UPDATED,{groupID:t,topic:n}))}},{key:"onConversationProxy",value:function(n){var s=n.topicID,t=n.unreadCount,n=n.groupAtInfoList,o=Be(s),s=this.getLocalTopic(o,s),i=!1;s&&(C(t)||s.unreadCount===t||(s.updateUnreadCount(t),i=!0),C(n)||(s.updateGroupAtInfoList(n),i=!0)),i&&this.emitOuterEvent(V.TOPIC_UPDATED,{groupID:o,topic:s})}},{key:"onMessageSent",value:function(n){var t=n.groupID,o=n.topicID,n=n.lastMessage,o=this.getLocalTopic(t,o);o&&(o.nextMessageSeq+=1,o.updateLastMessage(n),this.emitOuterEvent(V.TOPIC_UPDATED,{groupID:t,topic:o}))}},{key:"onMessageModified",value:function(e){var t,n=e.to,o=e.time,s=e.sequence,i=e.elements,a=e.cloudCustomData,r=e.messageVersion,c=Be(n),d=this.getLocalTopic(c,n);d&&(t=d.lastMessage,u.d("".concat(this._n,".onMessageModified topicID:").concat(n," lastMessage:"),JSON.stringify(t),"options:",JSON.stringify(e)),t&&(t.payload===null||t.lastTime===o&&t.lastSequence===s&&t.version!==r)&&(t.type=i[0].type,t.payload=i[0].content,t.messageForShow=Kn(t.type,t.payload,this.isIntl()),t.cloudCustomData=a,t.version=r,t.lastSequence=s,t.lastTime=o,this.emitOuterEvent(V.TOPIC_UPDATED,{groupID:c,topic:d})))}},{key:"onMessageRevoked",value:function(e){var t,n,o,s=this;e.length!==0&&(n=t=null,o=!1,e.forEach(function(i){var a=i.to;n=Be(a),(t=s.getLocalTopic(n,a))&&(t.reduceUnreadCount()&&(o=!0),t.isLastMessageRevoked(i)&&(t.setLastMessageRevoked(!0),t.setLastMessageRevoker(i.revoker),o=!0))}),o&&this.emitOuterEvent(V.TOPIC_UPDATED,{groupID:n,topic:t}))}},{key:"isLastMessageRevoked",value:function(t){var o=t.topicID,t=t.sequence,n=Be(o),n=this.getLocalTopic(n,o),o=!1;return o=n?n.isLastMessageRevoked({sequence:t}):o}},{key:"getJoinedCommunityList",value:function(){return this.get(7).syncCommunityWithTopic()}},{key:"createTopicInCommunity",value:function(e){var t=this,n="".concat(this._n,".").concat("createTopicInCommunity"),o=e.topicID;if(!C(o)&&!Ve(o))return v({code:M.ILLEGAL_TOPIC_ID});if(e.topicName&&this._filterProfanity("topicName",e)===!1)return v({code:M.PROFANITY_FOUND});if(e.introduction&&this._filterProfanity("introduction",e)===!1)return v({code:M.PROFANITY_FOUND});if(e.notification&&this._filterProfanity("notification",e)===!1)return v({code:M.PROFANITY_FOUND});var s=new S("createTopicInCommunity");return this.req({proto:g.CREATE_TOPIC,data:l({},e)}).then(function(i){return i=i.data.topicID,s.setMessage("topicID:".concat(i)).end(),u.l("".concat(n," ok. topicID:").concat(i)),t._updateTopicMap([l(l({},e),{},{topicID:i})]),q({topicID:i})}).catch(function(i){return s.setError(i).end(),u.e("".concat(n," failed. error:"),i),v(i)})}},{key:"deleteTopicFromCommunity",value:function(s){var t=this,n="".concat(this._n,".").concat("deleteTopicFromCommunity"),o=s.groupID,s=s.topicIDList,s=s===void 0?[]:s,i=new S("deleteTopicFromCommunity");return i.setMessage("groupID:".concat(o," topicIDList:").concat(s)),this.req({proto:g.DEL_TOPIC,data:{groupID:o,topicIDList:s}}).then(function(d){var d=d.data.resultList,r=[],c=[],d=((d===void 0?[]:d).forEach(function(f){var h=f.topicID,m=f.errorCode,f=f.errorInfo;m===0?r.push({topicID:h}):c.push({topicID:h,code:m,message:f})}),"success count:".concat(r.length,", fail count:").concat(c.length));return i.setMoreMessage(d).end(),u.l("".concat(n," ok. ").concat(d)),r.forEach(function(p){t._deleteLocalTopic(o,p.topicID)}),q({successTopicList:r,failureTopicList:c})}).catch(function(a){return i.setError(a).end(),u.e("".concat(n," failed. error:"),a),v(a)})}},{key:"updateTopicProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("updateTopicProfile");if(u.l("".concat(n," options:"),e),e.topicName&&this._filterProfanity("topicName",e)===!1)return v({code:M.PROFANITY_FOUND});if(e.introduction&&this._filterProfanity("introduction",e)===!1)return v({code:M.PROFANITY_FOUND});if(e.notification&&this._filterProfanity("notification",e)===!1)return v({code:M.PROFANITY_FOUND});var o=new S("updateTopicProfile");return o.setMessage("groupID:".concat(e.groupID," topicID:").concat(e.topicID)),C(e.muteAllMembers)||(e.muteAllMembers=e.muteAllMembers===!0?"On":"Off"),this.req({proto:g.UPDATE_TOPIC_PROFILE,data:l({},e)}).then(function(){return o.end(),u.l("".concat(n," ok")),t._updateTopicMap([e]),q({topic:t.getLocalTopic(e.groupID,e.topicID)})}).catch(function(s){return o.setError(s).end(),u.e("".concat(n," failed. error:"),s),v(s)})}},{key:"getTopicList",value:function(s){var t=this,n="".concat(this._n,".").concat("getTopicList"),o=s.groupID,s=s.topicIDList,s=s===void 0?[]:s,i=s.length===0,a=new S("getTopicList");if(a.setMessage("groupID:".concat(o)),this._getTopicTimeMap.has(o)){var c=this._getTopicTimeMap.get(o),r=c.isGetAll,c=c.time;if((r||!r&&!i)&&Date.now()-c<1e3*this.TOPIC_CACHE_TIME&&(r=this._getLocalTopicList(o,s),i||r.length===s.length))return a.setMoreMessage("from cache, topic count:".concat(r.length)).end(),u.l("".concat(n," groupID:").concat(o," from cache, topic count:").concat(r.length)),Q({successTopicList:r,failureTopicList:[]})}return this.req({proto:g.GET_TOPIC_LIST,data:{groupID:o,topicIDList:s}}).then(function(f){var f=f.data.topicInfoList,p=[],h=[],m=[],f=((f===void 0?[]:f).forEach(function(Y){var k=Y.topic,N=Y.selfInfo,x=Y.errorCode,Y=Y.errorInfo,ie=k.topicID;x===0?(p.push(l(l({},k),{},{selfInfo:N})),h.push(ie)):m.push({topicID:ie,code:x,message:Y})}),t._updateTopicMap(p),t._handleTopicAtInfo(p),"success count:".concat(h.length,", fail count:").concat(m.length)),f=(a.setMoreMessage(f).end(),u.l("".concat(n," groupID:").concat(o," from remote, ").concat(f)),[]);return G(h)||(t._getTopicTimeMap.set(o,{time:Date.now(),isGetAll:i}),f=t._getLocalTopicList(o,h)),q({successTopicList:f,failureTopicList:m})}).catch(function(d){return a.setError(d).end(),u.e("".concat(n," failed. error:"),d),v(d)})}},{key:"hasLocalTopic",value:function(e,t){return!!this._topicMap.has(e)&&this._topicMap.get(e).has(t)}},{key:"getLocalTopic",value:function(e,t){var n=null;return n=this._topicMap.has(e)?this._topicMap.get(e).get(t):n}},{key:"_getLocalTopicList",value:function(n){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[],n=this._topicMap.get(n),o=[];return n&&(o=b(n.values())),t.length===0?o:o.filter(function(s){return t.includes(s.topicID)})}},{key:"_deleteLocalTopic",value:function(e,t){this._topicMap.has(e)&&this._topicMap.get(e).has(t)&&(this._topicMap.get(e).delete(t),u.l("".concat(this._n,"._deleteLocalTopic groupID:").concat(e," topicID:").concat(t)))}},{key:"_updateTopicMap",value:function(e){var t=this,n=[];e.forEach(function(r){var s=r.groupID,i=r.topicID,a=null,r=(t._topicMap.has(s)||t._topicMap.set(s,new Map),t._topicMap.get(s).has(i)?(a=t._topicMap.get(s).get(i)).updateTopic(r):(t._getTopicLastMessage(r),a=new Zc(r,t.isIntl()),t._topicMap.get(s).set(i,a)),t._computeUnreadCount(a));a.updateUnreadCount(r),n.push({conversationID:"".concat(_.CONV_GROUP).concat(i),type:_.CONV_TOPIC,unreadCount:r})}),0<n.length&&this.get(11).updateTopicConversation(n)}},{key:"resetGetTopicTime",value:function(e){var t=this;C(e)?b(this._getTopicTimeMap.keys()).forEach(function(n){t._getTopicTimeMap.set(n,0)}):this._getTopicTimeMap.set(e,0)}},{key:"getTopicListOnReconnected",value:function(){var e=this,t=b(this._topicMap.keys()),n=[],o=this.get(11);t.forEach(function(s){var i=[],a=e._getLocalTopicList(s);o.deleteTopicRoamingMessageInfo(s),a.forEach(function(r){var c=r.lastMessage.lastTime,c=c===void 0?0:c;Date.now()-1e3*c<1e3*e.TOPIC_LAST_ACTIVE_TIME&&i.push(r.topicID)}),0<i.length&&n.push({groupID:s,topicIDList:i})}),u.l("".concat(this._n,".getTopicListOnReconnected. active community count:").concat(n.length)),this._relayGetTopicList(n)}},{key:"_relayGetTopicList",value:function(e){var t,n,o,s=this;e.length!==0&&(n=5<(t=e.shift()).topicIDList.length?"topicIDList.length:".concat(t.topicIDList.length):"topicIDList:".concat(t.topicIDList),(o=new S("relayGetTopicList")).setMessage(n),u.l("".concat(this._n,"._relayGetTopicList. ").concat(n)),this.getTopicList(t).then(function(){o.end(),s._relayGetTopicList(e)}).catch(function(i){o.setError(i).end(),s._relayGetTopicList(e)}))}},{key:"_handleTopicAtInfo",value:function(e){var t=this;e.length!==0&&e.forEach(function(i){var o=i.groupID,s=i.topicID,i=i.groupAtInfoList,a=[];C(i)||(i.forEach(function(r){a.push(l(l({},r),{},{groupID:o,topicID:s}))}),t.get(11).onNewGroupAtTips({dataList:a}))})}},{key:"_getTopicLastMessage",value:function(e){var t;C(e.lastMsg)||(t={time:e.lastMsg.time,sequence:e.lastMsg.sequence,from:e.lastMsg.from,payload:e.lastMsg.elements[0]?e.lastMsg.elements[0].content:null,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:"",nick:e.lastMsg.nick,avatar:e.lastMsg.avatar,version:e.lastMsg.messageVersion,cloudCustomData:e.lastMsg.cloudCustomData,isRevoked:e.lastMsg.isPlaceMessage===2,revoker:G(e.lastMsg.revokerInfo)?null:e.lastMsg.revokerInfo.revoker},e.lastMessage=t)}},{key:"deleteTopicListInCommunity",value:function(e){var t=this,n=this._getLocalTopicList(e),o=this.get(11);n.forEach(function(s){s=s.topicID,t._deleteLocalTopic(e,s),t._getTopicTimeMap.delete(e),o.deleteLocalConversation("".concat(_.CONV_GROUP).concat(s))})}},{key:"_computeUnreadCount",value:function(e){var t,s=e.selfInfo,n=s.excludedUnreadSequenceList,o=s.readedSequence,s=e.nextMessageSeq-e.selfInfo.readedSequence-1;return F(n)&&(t=0,n.forEach(function(i){o<=i&&i<=e.nextMessageSeq-1&&(t+=1)}),1<=t&&(s-=t)),s<0?0:s}},{key:"_filterProfanity",value:function(e,t){var o=this.get(29);if(!o)return!0;var o=o.filterText(t[e],Rt),n=o.isAllowedToSend,o=o.modifiedText;return n===!0&&(t[e]=o,!0)}},{key:"updateLastMessage",value:function(s,t){var n,o=Be(s),s=this.getLocalTopic(o,s);s&&(n=t.sequence+1,s.updateNextMessageSeq(n),s.updateLastMessage(t),this.emitOuterEvent(V.TOPIC_UPDATED,{groupID:o,topic:s}))}},{key:"getMessageExtensions",value:function(e,t){u.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t));var n=Be(e.to);return this.req({proto:g.GET_GRP_MSG_EXT,data:{groupID:n,topicID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMessageExtensions",value:function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,o=(u.l("".concat(this._n,".modifyMessageExtensions operateType:").concat(n)),Be(e.to));return this.req({proto:g.MODIFY_GRP_MSG_EXT,data:{groupID:o,topicID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._topicMap.clear(),this._getTopicTimeMap.clear(),this.TOPIC_CACHE_TIME=300,this.TOPIC_LAST_ACTIVE_TIME=3600}}]),to),tu=(R(vi,[{key:"setExpirationTime",value:function(e){this.expirationTime=e}},{key:"getUserProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getUserProfile"),o=e.userIDList;e.fromAccount=this._userM.getMyAccount(),100<o.length&&(u.w("".concat(n," ").concat(ln(100))),o.length=100);for(var s,i=[],a=[],r=0,c=o.length;r<c;r++)s=o[r],this._userM.isMyFriend(s)&&this._contains(s)?a.push(this._getProfileFromMap(s)):i.push(s);if(i.length===0)return Q(a);e.toAccount=i;var d=e.bFromGetMyProfile||!1,p=[],h=(e.toAccount.forEach(function(m){p.push({toAccount:m,standardSequence:0,customSequence:0})}),e.userItem=p,new S("getUserProfile"));return h.setMessage(5<o.length?"userIDList.length:".concat(o.length):"userIDList:".concat(o)),this._userM.req({proto:g.GET_USER_PROFILE,data:e}).then(function(m){return h.end(),u.i("".concat(n," ok")),m=t._handleResponse(m).concat(a),q(d?m[0]:m)}).catch(function(m){return h.setError(m).end(),u.e("".concat(n," failed. error:"),m),v(m)})}},{key:"getMyProfile",value:function(){var e,t=this._userM.getMyAccount(),n="".concat(this._n,".getMyProfile");return u.l("".concat(n," myAccount:").concat(t)),this._fill(),this._contains(t)?(e=this._getProfileFromMap(t),u.d("".concat(n," from cache, myProfile:").concat(JSON.stringify(e))),Q(e)):this.getUserProfile({fromAccount:t,userIDList:[t],bFromGetMyProfile:!0})}},{key:"_handleResponse",value:function(e){var t=e.data.userProfileItem;if(!F(t))return[];for(var n=[],e=Date.now(),o=0,s=t.length;o<s;o++){var a=t[o],i=a.to,a=a.profileItem;i!=="@TLS#NOT_FOUND"&&i!==""&&(i=this._update(i,this._getLatestProfileFromResponse(i,a)).latestProfile,n.push(i))}return u.l("".concat(this._n,"._handleResponse cost:").concat(Ke(e))),n}},{key:"_getLatestProfileFromResponse",value:function(e,t){var n={userID:e,profileCustomField:[]};if(!G(t))for(var o=0,s=t.length;o<s;o++)if(-1<t[o].tag.indexOf("Tag_Profile_Custom"))n.profileCustomField.push({key:t[o].tag,value:t[o].value});else switch(t[o].tag){case E.NICK:n.nick=t[o].value;break;case E.GENDER:n.gender=t[o].value;break;case E.BIRTHDAY:n.birthday=t[o].value;break;case E.LOCATION:n.location=t[o].value;break;case E.SELFSIGNATURE:n.selfSignature=t[o].value;break;case E.ALLOWTYPE:n.allowType=t[o].value;break;case E.LANGUAGE:n.language=t[o].value;break;case E.AVATAR:n.avatar=t[o].value;break;case E.MESSAGESETTINGS:n.messageSettings=t[o].value;break;case E.ADMINFORBIDTYPE:n.adminForbidType=t[o].value;break;case E.LEVEL:n.level=t[o].value;break;case E.ROLE:n.role=t[o].value;break;default:u.w("".concat(this._n,"._getLatestProfileFromResponse unknown tag:"),t[o].tag,t[o].value)}return n}},{key:"updateMyProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("updateMyProfile");if(e.nick&&this._userM.filterProfanity("nick",e)===!1)return v({code:M.PROFANITY_FOUND});if(e.selfSignature&&this._userM.filterProfanity("selfSignature",e)===!1)return v({code:M.PROFANITY_FOUND});var o=new S("updateMyProfile"),s=(o.setMessage(JSON.stringify(e)),new Qn().validate(e));if(!s.valid)return o.setCode(M.UPDATE_PROFILE_INVALID_PARAM).setMoreMessage("info:".concat(s.tips)).end(),u.e("".concat(n," info:").concat(s.tips)),v({code:M.UPDATE_PROFILE_INVALID_PARAM});var i,a=[];for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(i==="profileCustomField"?e.profileCustomField.forEach(function(c){a.push({tag:c.key,value:c.value})}):a.push({tag:E[i.toUpperCase()],value:e[i]}));if(a.length===0)return s=new Te({code:M.UPDATE_PROFILE_NO_KEY}),o.setError(s).end(),u.e("".concat(n," failed. error:"),s),v(s);var r=this._userM.getMyAccount();return this._userM.req({proto:g.UPDATE_MY_PROFILE,data:{fromAccount:r,profileItem:a}}).then(function(c){o.end(),u.i("".concat(n," ok"));var p=t._update(r,e),d=p.isProfileUpdated,p=p.latestProfile;return d===!0&&t._userM.emitOuterEvent(V.PROFILE_UPDATED,[p]),Q(p)}).catch(function(c){return o.setError(c).end(),u.e("".concat(n," failed. error:"),c),v(c)})}},{key:"onProfileModified",value:function(e){var t=e.dataList;if(!G(t)){var n=t.length;u.d("".concat(this._n,".onProfileModified count:").concat(n," dataList:"),e.dataList);for(var o=[],s=0;s<n;s++){var a=t[s].userID,a=this._update(a,this._getLatestProfileFromResponse(a,t[s].profileList)),i=a.isProfileUpdated,a=a.latestProfile;i===!0&&o.push(a)}0<o.length&&(this._userM.emitInnerEvent(Re.PROFILE_UPDATED,o),this._userM.emitOuterEvent(V.PROFILE_UPDATED,o))}}},{key:"_fill",value:function(){if(this.accountProfileMap.size===0){for(var e=this._getCachedProfiles(),t=Date.now(),n=0,o=e.length;n<o;n++)t-e[n].lastUpdatedTime<this.expirationTime&&this.accountProfileMap.set(e[n].userID,e[n]);u.l("".concat(this._n,"._fill from cache, size:").concat(this.accountProfileMap.size))}}},{key:"_update",value:function(e,t){var n,o=!1,s=Date.now();return this._contains(e)?(n=this._getProfileFromMap(e),t.profileCustomField&&Bn(n.profileCustomField,t.profileCustomField)===!0&&(n.lastUpdatedTime=s,o=!0),0<bt(n,t,["profileCustomField"])&&(n.lastUpdatedTime=s,o=!0)):(n=new Qn(t),!this._userM.isMyFriend(e)&&e!==this._userM.getMyAccount()||(n.lastUpdatedTime=s,o=!0,this.accountProfileMap.set(e,n))),this._flush(e===this._userM.getMyAccount()),o===!0&&u.l("".concat(this._n,"._update account:").concat(e," isProfileUpdated:").concat(o)),{isProfileUpdated:o,latestProfile:n}}},{key:"_flush",value:function(e){var t=b(this.accountProfileMap.values()),n=this._userM.getStorageModule();u.d("".concat(this._n,"._flush length:").concat(t.length," flushAtOnce:").concat(e)),n.setItem(this.TAG,t,e)}},{key:"_contains",value:function(e){return this.accountProfileMap.has(e)}},{key:"_getProfileFromMap",value:function(e){return this.accountProfileMap.get(e)}},{key:"_getCachedProfiles",value:function(){var e=this._userM.getStorageModule().getItem(this.TAG);return G(e)?[]:e}},{key:"onConversationsProfileUpdated",value:function(e){for(var t,n,o,s=[],i=0,a=e.length;i<a;i++)n=(t=e[i]).userID,this._userM.isMyFriend(n)&&(this._contains(n)?(o=this._getProfileFromMap(n),0<bt(o,t)&&s.push(n)):s.push(t.userID));s.length!==0&&(u.i("".concat(this._n,".onConversationsProfileUpdated toAccountList:").concat(s)),this.getUserProfile({userIDList:s}))}},{key:"getNickAndAvatarByUserID",value:function(e){return this._contains(e)?{nick:(e=this._getProfileFromMap(e)).nick,avatar:e.avatar}:{nick:"",avatar:""}}},{key:"getUserNickAndAvatar",value:function(s){var t=this,n=b(new Set(s)),o=(u.l("".concat(this._n,".getUserNickAndAvatar userIDList.length:").concat(s.length," uniqueUserIDList.length:").concat(n.length)),[]);if(s.length===0)return Promise.resolve(o);var s=this._createUserIDListGroup(n),i=[];return s.forEach(function(a){i.push(t.getUserProfile({userIDList:a}))}),Promise.all(i).then(function(a){return a.forEach(function(r){r=r.data.map(function(c){return{userID:c.userID,nick:c.nick,avatar:c.avatar}}),o.push.apply(o,b(r))}),o})}},{key:"_createUserIDListGroup",value:function(e){for(var t=[],n=0;n<e.length;)t.push(e.slice(n,n+=100));return t}},{key:"reset",value:function(){this._flush(!0),this.accountProfileMap.clear()}}]),vi),vr=R(function e(t){D(this,e)}),nu=(R(mi,[{key:"getLocalBlacklist",value:function(){return b(this._blacklistMap.keys())}},{key:"getBlacklist",value:function(){var e=this,t="".concat(this._n,".getBlacklist"),n={fromAccount:this._userM.getMyAccount(),maxLimited:this.maxLimited,startIndex:0,lastSequence:this.currentSequence},o=new S("getBlacklist");return this._userM.req({proto:g.GET_BL,data:n}).then(function(a){var a=a.data,i=a.blackListItem,a=a.currentSequence,r=G(i)?0:i.length;o.setMessage("count:".concat(r)).end(),u.i("".concat(t," ok")),e.currentSequence=a,e._handleResponse(i,!0),e._userM.emitOuterEvent(V.BLACKLIST_UPDATED,b(e._blacklistMap.keys()))}).catch(function(s){return o.setError(s).end(),u.e("".concat(t," failed. error:"),s),v(s)})}},{key:"addBlacklist",value:function(e){var t,n,o=this,s=new S("addToBlacklist"),i="".concat(this._n,".addBlacklist"),a=this._userM.getMyAccount();return e.userIDList.length===1&&e.userIDList[0]===a?(n=this._userM.getErrorMessage(t=M.CANNOT_ADD_SELF_TO_BLACKLIST),s.setCode(t).setMessage(n).end(),n=new Te({code:t}),u.e("".concat(i," failed. error:"),n),v(n)):(e.userIDList.includes(a)&&(e.userIDList=e.userIDList.filter(function(r){return r!==a})),e.fromAccount=this._userM.getMyAccount(),e.toAccount=e.userIDList,this._userM.req({proto:g.ADD_TO_BL,data:e}).then(function(r){return s.setMessage(5<e.userIDList.length?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),u.i("".concat(i," ok")),o._handleResponse(r.resultItem,!0),q(b(o._blacklistMap.keys()))}).catch(function(r){return s.setError(r).end(),u.e("".concat(i," failed. error:"),r),v(r)}))}},{key:"_handleResponse",value:function(e,t){if(!G(e))for(var n,o,s,i=0,a=e.length;i<a;i++)o=e[i].to,s=e[i].resultCode,!C(s)&&s!==0||(t?((n=this._blacklistMap.has(o)?this._blacklistMap.get(o):new vr).userID=o,G(e[i].addBlackTimeStamp)||(n.timeStamp=e[i].addBlackTimeStamp),this._blacklistMap.set(o,n)):this._blacklistMap.has(o)&&(n=this._blacklistMap.get(o),this._blacklistMap.delete(o)));u.l("".concat(this._n,"._handleResponse total:").concat(this._blacklistMap.size," bAdd:").concat(t))}},{key:"deleteBlacklist",value:function(e){var t=this,n="".concat(this._n,".deleteBlacklist"),o=new S("removeFromBlacklist");return e.fromAccount=this._userM.getMyAccount(),e.toAccount=e.userIDList,this._userM.req({proto:g.RM_FROM_BL,data:e}).then(function(s){return o.setMessage(5<e.userIDList.length?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),u.i("".concat(n," ok")),t._handleResponse(s.data.resultItem,!1),q(b(t._blacklistMap.keys()))}).catch(function(s){return o.setError(s).end(),u.e("".concat(n," failed. error:"),s),v(s)})}},{key:"onAccountDeleted",value:function(e){for(var t=0,n=e.length;t<n;t++){var o=e[t];this._blacklistMap.has(o)&&this._blacklistMap.delete(o)}var s=e.length;0<s&&(u.l("".concat(this._n,".onAccountDeleted count:").concat(s," ").concat(s<30?"userIDList:".concat(e):"")),this._userM.emitOuterEvent(V.BLACKLIST_UPDATED,b(this._blacklistMap.keys())))}},{key:"onAccountAdded",value:function(e){for(var t,n=[],o=0,s=e.length;o<s;o++)t=e[o],this._blacklistMap.has(t)||(this._blacklistMap.set(t,new vr({userID:t})),n.push(t));0<n.length&&(u.l("".concat(this._n,".onAccountAdded count:").concat(n.length," userIDList:"),n),this._userM.emitOuterEvent(V.BLACKLIST_UPDATED,b(this._blacklistMap.keys())))}},{key:"reset",value:function(){this._blacklistMap.clear(),this.startIndex=0,this.maxLimited=100,this.currentSequence=0}}]),mi),ou=(R(fi,[{key:"_onCloudConfigUpdated",value:function(){var e=this._userM.getCloudConfig("status_query_count"),t=this._userM.getCloudConfig("status_sub_count"),n=this._userM.getCloudConfig("status_unsub_count");u.l("".concat(this._n,"._onCloudConfigUpdated statusQueryCount:").concat(e," statusSubscribeCount:").concat(t)+" statusUnsubscribeCount:".concat(n)),C(e)||(this.MAX_QUERY_USER_COUNT=parseInt(e,10)),C(e)||(this.MAX_SUBSCRIBE_USER_COUNT=parseInt(t,10)),C(e)||(this.MAX_UNSUBSCRIBE_USER_COUNT=parseInt(n,10))}},{key:"onUserStatusUpdated",value:function(o){var o=o.dataList,t=this._userM.getMyUserID(),n=this._userM.get(12),o=o.map(function(r){var i=r.to,a=r.statusType,r=r.customStatus,r=rs(r);return i===t&&n.setCustomStatus(r),{userID:i,statusType:a,customStatus:r}});u.l("".concat(this._n,".onUserStatusUpdated list:").concat(JSON.stringify(o))),this._userM.emitOuterEvent(V.USER_STATUS_UPDATED,o)}},{key:"setSelfStatus",value:function(e){var t=this,n="".concat(this._n,".setSelfStatus");if(this._userM.filterProfanity("customStatus",e)===!1)return v({code:M.PROFANITY_FOUND});var o=new S("setSelfStatus"),s=e.customStatus;return this._userM.req({proto:g.SET_SELF_STATUS,data:{customStatus:s}}).then(function(i){return o.setMessage("customStatus:".concat(s)).end(),u.l("".concat(n," ok. customStatus:").concat(s)),t._userM.get(12).setCustomStatus(s),q({userID:t._userM.getMyUserID(),statusType:1,customStatus:s})}).catch(function(i){return o.setError(i).end(),u.e("".concat(n," failed. error:"),i),v(i)})}},{key:"getUserStatus",value:function(o){var t="".concat(this._n,".").concat("getUserStatus"),o=o.userIDList,n=o===void 0?[]:o,o=this._userM.getMyUserID(),s=b(n),i=void 0,a=s.indexOf(o);if(-1<a&&(s.splice(a,1),i={userID:o,statusType:1,customStatus:this._userM.get(12).getCustomStatus()}),s.length===0)return Q({successUserList:[i],failureUserList:[]});if(!this._userM.canIUse(de.USER_STATUS))return this._userM.cannotUseCommercialAbility("getUserStatus");s.length>this.MAX_QUERY_USER_COUNT&&(u.w("".concat(t," ").concat(ln(this.MAX_QUERY_USER_COUNT))),s=n.slice(0,this.MAX_QUERY_USER_COUNT));var r=new S("getUserStatus");return this._userM.req({proto:g.GET_USER_STATUS,data:{userIDList:s}}).then(function(p){var p=p.data,d=p.successUserList,d=d===void 0?[]:d,p=p.failureUserList,p=p===void 0?[]:p,d=d.map(function(k){var f=k.userID,I=k.statusType,k=k.customStatus;return{userID:f,statusType:I,customStatus:rs(k)}}),p=p.map(function(N){var f=N.userID,I=N.invalidUserID,k=N.errorCode,N=N.errorInfo;return{userID:G(I)?f:I,code:k,message:N}}),h=(C(i)||d.unshift(i),"userID count:".concat(n.length,", success count:").concat(d.length,", fail count:").concat(p.length));return r.setMessage("".concat(h)).end(),u.l("".concat(t," ok. ").concat(h,".")),q({successUserList:d,failureUserList:p})}).catch(function(c){return r.setMessage("userID count:".concat(n.length)).setError(c).end(),u.e("".concat(t," failed. error:"),c),v(c)})}},{key:"subscribeUserStatus",value:function(o){var t="subscribeUserStatus";if(!this._userM.canIUse(de.USER_STATUS))return this._userM.cannotUseCommercialAbility(t);var n="".concat(this._n,".").concat(t),o=o.userIDList,o=o===void 0?[]:o,s=b(o),i=(s.length>this.MAX_SUBSCRIBE_USER_COUNT&&(u.w("".concat(n," ").concat(ln(this.MAX_SUBSCRIBE_USER_COUNT))),s=o.slice(0,this.MAX_SUBSCRIBE_USER_COUNT)),new S(t)),a="userID count:".concat(o.length);return u.l("".concat(n," ").concat(a)),this._userM.req({proto:g.SUB_USER_STATUS,data:{userIDList:s}}).then(function(r){return r=r.data.failureUserList,r=(r===void 0?[]:r).map(function(m){var d=m.userID,p=m.invalidUserID,h=m.errorCode,m=m.errorInfo;return{userID:G(p)?d:p,code:h,message:m}}),i.setMessage("".concat(a," fail count:").concat(r.length)).end(),u.l("".concat(n," ok. fail count:").concat(r.length,".")),q({failureUserList:r})}).catch(function(r){return i.setMessage(a).setError(r).end(),u.e("".concat(n," failed. error:"),r),v(r)})}},{key:"unsubscribeUserStatus",value:function(n){var a="unsubscribeUserStatus";if(!this._userM.canIUse(de.USER_STATUS))return this._userM.cannotUseCommercialAbility(a);var t="".concat(this._n,".").concat(a),n=(n||{}).userIDList,n=n===void 0?[]:n,o=b(n),s=(n.length>this.MAX_UNSUBSCRIBE_USER_COUNT&&(u.w("".concat(t," ").concat(ln(this.MAX_UNSUBSCRIBE_USER_COUNT))),o=n.slice(0,this.MAX_UNSUBSCRIBE_USER_COUNT)),new S(a)),i="userID count:".concat(n.length),a=(u.l("".concat(t," ").concat(i)),{userIDList:o});return o.length===0&&(a.userIDList=void 0,a.unsubscribeAll=1),this._userM.req({proto:g.UNSUB_USER_STATUS,data:a}).then(function(r){return r=r.data.failureUserList,r=(r===void 0?[]:r).map(function(m){var d=m.userID,p=m.invalidUserID,h=m.errorCode,m=m.errorInfo;return{userID:G(p)?d:p,code:h,message:m}}),s.setMessage("".concat(i," fail count:").concat(r.length)).end(),u.l("".concat(t," ok. fail count:").concat(r.length,".")),q({failureUserList:r})}).catch(function(r){return s.setMessage("".concat(i)).setError(r).end(),u.e("".concat(t," failed. error:"),r),v(r)})}},{key:"reset",value:function(){this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100}}]),fi),su=(z(eo,Oe),pr=X(eo),R(eo,[{key:"onContextUpdated",value:function(e){this._profileHandler.getMyProfile(),this._blacklistHandler.getBlacklist()}},{key:"mockOnNickAvatarModified",value:function(e,t){u.l("".concat(this._n,"._mockOnNickAvatarModified nick:").concat(e," avatar:").concat(t)),this.onProfileModified({dataList:[{pushType:1,userID:this.getMyUserID(),profileList:[{tag:E.NICK,value:e},{tag:E.AVATAR,value:t}]}]})}},{key:"onProfileModified",value:function(e){this._profileHandler.onProfileModified(e)}},{key:"onRelationChainModified",value:function(o){var t,n,o=o.dataList;G(o)||(t=[],o.forEach(function(s){s.blackListDelAccount&&t.push.apply(t,b(s.blackListDelAccount))}),0<t.length&&this._blacklistHandler.onAccountDeleted(t),n=[],o.forEach(function(s){s.blackListAddAccount&&n.push.apply(n,b(s.blackListAddAccount))}),0<n.length&&this._blacklistHandler.onAccountAdded(n))}},{key:"onConversationsProfileUpdated",value:function(e){this._profileHandler.onConversationsProfileUpdated(e)}},{key:"getMyAccount",value:function(){return this.getMyUserID()}},{key:"getMyNick",value:function(){return this._profileHandler.getNickAndAvatarByUserID(this.getMyUserID()).nick}},{key:"getMyProfile",value:function(){return this._profileHandler.getMyProfile()}},{key:"getStorageModule",value:function(){return this.get(13)}},{key:"filterProfanity",value:function(e,t){var o=this.get(29);if(!o)return!0;var o=o.filterText(t[e],"user_profile"),n=o.isAllowedToSend,o=o.modifiedText;return n===!0&&(t[e]=o,!0)}},{key:"isMyFriend",value:function(e){var t=this.get(8);return!!t&&t.isMyFriend(e)}},{key:"getUserProfile",value:function(e){return this._profileHandler.getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._profileHandler.updateMyProfile(e)}},{key:"getNickAndAvatarByUserID",value:function(e){return this._profileHandler.getNickAndAvatarByUserID(e)}},{key:"getUserNickAndAvatar",value:function(e){return this._profileHandler.getUserNickAndAvatar(e)}},{key:"getLocalBlacklist",value:function(){var e=this._blacklistHandler.getLocalBlacklist();return Q(e)}},{key:"addBlacklist",value:function(e){return this._blacklistHandler.addBlacklist(e)}},{key:"deleteBlacklist",value:function(e){return this._blacklistHandler.deleteBlacklist(e)}},{key:"onUserStatusUpdated",value:function(e){this._userStatusHandler.onUserStatusUpdated(e)}},{key:"setSelfStatus",value:function(e){return this._userStatusHandler.setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._userStatusHandler.getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._userStatusHandler.subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._userStatusHandler.unsubscribeUserStatus(e)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._profileHandler.reset(),this._blacklistHandler.reset(),this._userStatusHandler.reset()}}]),eo),iu=(R(hi,[{key:"isLoggedIn",value:function(){return this._isLoggedIn}},{key:"isOversea",value:function(){return this._oversea}},{key:"isPrivateNetWork",value:function(){return this._proxyServer}},{key:"isDevMode",value:function(){return this._isDevMode}},{key:"isTestEnv",value:function(){return this._isTestEnv}},{key:"isPartialUpdatedConvs",value:function(){return this._isPartialUpdatedConvs}},{key:"isSingaporeSite",value:function(){return 2e7<=this._SDKAppID&&this._SDKAppID<3e7||172e7<=this._SDKAppID&&this._SDKAppID<173e7}},{key:"isKoreaSite",value:function(){return 3e7<=this._SDKAppID&&this._SDKAppID<4e7||173e7<=this._SDKAppID&&this._SDKAppID<174e7}},{key:"isGermanySite",value:function(){return 4e7<=this._SDKAppID&&this._SDKAppID<5e7||174e7<=this._SDKAppID&&this._SDKAppID<175e7}},{key:"isIndiaSite",value:function(){return 5e7<=this._SDKAppID&&this._SDKAppID<6e7||175e7<=this._SDKAppID&&this._SDKAppID<176e7}},{key:"isJapanSite",value:function(){return 6e7<=this._SDKAppID&&this._SDKAppID<7e7||176e7<=this._SDKAppID&&this._SDKAppID<177e7}},{key:"isUSASite",value:function(){return 7e7<=this._SDKAppID&&this._SDKAppID<8e7||177e7<=this._SDKAppID&&this._SDKAppID<178e7}},{key:"isIndonesiaSite",value:function(){return 8e7<=this._SDKAppID&&this._SDKAppID<9e7||178e7<=this._SDKAppID&&this._SDKAppID<179e7}},{key:"isIntl",value:function(){return(e=this._SDKAppID)===0||2e7<=e&&e<9e7||172e7<=e&&e<179e7;var e}},{key:"isUnlimitedAVChatRoom",value:function(){return this._unlimitedAVChatRoom}},{key:"isUsingChatCore",value:function(){return this._isUsingChatCore}},{key:"setUsingChatCore",value:function(e){this._isUsingChatCore=e}},{key:"getUIPlatform",value:function(){return this._uiPlatform}},{key:"setUIPlatform",value:function(e){this._uiPlatform=e}},{key:"setUserID",value:function(e){this._userID=e}},{key:"getUserID",value:function(){return this._userID}},{key:"setUserSig",value:function(e){this._userSig=e}},{key:"getUserSig",value:function(){return this._userSig}},{key:"getSDKAppID",value:function(){return this._SDKAppID}},{key:"setTinyID",value:function(e){this._tinyID=e,this._isLoggedIn=!0}},{key:"getTinyID",value:function(){return this._tinyID}},{key:"setCustomStatus",value:function(e){this._customStatus=e}},{key:"getCustomStatus",value:function(){return this._customStatus}},{key:"getScene",value:function(){return xn?window.tencent_cloud_im_csig_flutter_for_web_25F_cy:this._isTUIKit()?"tuikit":this._scene}},{key:"getInstanceID",value:function(){return this._instanceID}},{key:"getStatusInstanceID",value:function(){return this._statusInstanceID}},{key:"setStatusInstanceID",value:function(e){this._statusInstanceID=e}},{key:"getVersion",value:function(){return this._version}},{key:"getA2Key",value:function(){return this._a2Key}},{key:"setA2Key",value:function(e){this._a2Key=e}},{key:"getContentType",value:function(){return this._contentType}},{key:"getProxyServer",value:function(){return this._proxyServer}},{key:"getFileUploadProxy",value:function(){return this._fileUploadProxy}},{key:"getFileDownloadProxy",value:function(){return this._fileDownloadProxy}},{key:"setApplicationID",value:function(e){this._applicationID=e}},{key:"getApplicationID",value:function(){return this._applicationID}},{key:"_isTUIKit",value:function(){var e=!1,t=!1,n=!1,o=!1,r=[];ge&&(r=Object.keys(ce));for(var s=0,i=(r=qe?Object.keys(vn?uni:window):r).length;s<i;s++)if(r[s].toLowerCase().includes("uikit")){e=!0;break}var a,r=null,c=(ge&&!Xe(ce.createGamePortal)&&Xe(getApp)&&!C(getApp())&&(a=getApp().globalData,Ce(a)&&a.isTUIKit===!0&&(t=!0)),this._m.get(13).getStorageSync("TIM_".concat(this._SDKAppID,"_isTUIKit"))===!0&&(n=!0),null);if(_t&&!Dt&&typeof uni>"u"&&__wxConfig&&(c=__wxConfig.pages),ot&&typeof uni>"u"&&__qqConfig&&(c=__qqConfig.pages),F(c)&&0<c.length){for(var d=0,p=c.length;d<p;d++)if(c[d].toLowerCase().includes("tui")){o=!0;break}c=null}return e||t||n||o}},{key:"reset",value:function(){this._isLoggedIn=!1,this._userSig="",this._a2Key="",this._tinyID="",this._customStatus="",this._statusInstanceID=0}}]),hi),au={"k-vue2-pc":1,"k-vue2-h5":2,"k-vue2-h5-uni":3,"k-vue2-app-uni":4,"k-vue2-mp-uni":5,"k-vue2-pc-uni":6,"k-vue3-pc":7,"k-vue3-h5":8,"k-vue3-h5-uni":9,"k-vue3-app-uni":10,"k-vue3-mp-uni":11,"k-vue3-pc-uni":12},ru=(z(Zn,Oe),dr=X(Zn),R(Zn,[{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this._helloInterval==0&&this._hello()}},{key:"getPushModule",value:function(){var e=void 0,t=this.get(36),n=this.get(28);return t.canIUseTIMPush()?e=t:n.canIUseOfflinePush()&&(e=n),e}},{key:"login",value:function(o){if(this.isLoggedIn())return t=this.getMyUserID(),(t=this.getErrorMessage("RepeatLogin",t))&&u.w(t),Q({actionStatus:"OK",errorCode:0,errorInfo:t,repeatLogin:!0});if(Date.now()-this._lastLoginTs<=15e3)return this.outputWarning("LoggingIn",o.userID),v({code:M.REPEAT_LOGIN});u.l("".concat(this._n,".login userID:").concat(o.userID));var t=this._checkLoginInfo(o);if(t.code!==0)return v(t);var t=this.get(12),n=o.userID,o=o.userSig;return t.setUserID(n),t.setUserSig(o),this.get(20).updateProtocolConfig(),this._login()}},{key:"_login",value:function(){var e=this,t=this.get(12),n=t.getScene(),o=0,s=n,i=(n&&n.startsWith("k-")&&(s=au[n],n="tuikit"),new S("login")),r=(i.setMessage("".concat(s)).setMoreMessage("identifier:".concat(this.getMyUserID())),n==="tuikit"),a=0,r=(vn?a=r?s===3||s===4||s===5||s===6?31:s===9||s===10||s===11||s===12?32:4:3:ge?a=xo?36:n==="tuikit"?12:11:qe&&(a=xn?n==="flutter_web_uikit"?21:20:this._isReactUIKit()?rn?25:24:r?s===1||s===2?29:s===7||s===8?30:rn?17:14:rn?16:13),i.setUIPlatform(a),t.setUIPlatform(a),this.getPushModule()),c=(r&&(this._isWebUniapp=r.getUniAppPlatform(),s=this._getStatusInstanceID(),t.setStatusInstanceID(s),this.get(20).updateProtocolConfig(),o=r.getDeviceBrand()),"".concat(this._n,"._login"));return this._lastLoginTs=Date.now(),this.req({proto:g.LOGIN,data:{deviceBrand:o,isWebUniapp:this._isWebUniapp}}).then(function(d){e._lastLoginTs=0;var Le=Date.now(),p=null,x=d.data,h=x.a2Key,m=x.tinyID,f=x.helloInterval,I=x.instanceID,k=x.timeStamp,N=x.customStatus,N=N===void 0?"":N,x=x.purchaseBits,Y=1e3*k,ie=Le-i.getStartTs(),ie=Y+parseInt(ie/2)-Le,Le=i.getStartTs()+ie;if(i.start(Le),Le=Y,un=ie,(Y=new Date).setTime(Le),u.i("baseTime from server:".concat(Y," offset:").concat(un)),!m)throw p=new Te({code:M.NO_TINYID}),i.setError(p).end(),p;if(!h)throw p=new Te({code:M.NO_A2KEY}),i.setError(p).end(),p;return Le=rs(N),Y="scene:".concat(n," helloInterval:").concat(f," instanceID:").concat(I," timeStamp:").concat(k," offset:").concat(ie," customStatus:").concat(Le," "),u.l("".concat(c," ok. ").concat(Y)),p="",N="",_t&&Xe(ce.getAccountInfoSync)&&(k=ce.getAccountInfoSync().miniProgram)&&(p=k.appId,N=k.envVersion),i.setMoreMessage("".concat(Y," href:").concat(qe?window.location.href:""," mpAppId:").concat(p," envVersion:").concat(N)).end(),t.setA2Key(h),t.setTinyID(m),t.setStatusInstanceID(I),t.setCustomStatus(Le),x&&e.get(27).onPushedConfig({errorCode:0,expiredTime:0,purchaseBits:x}),e.get(20).updateProtocolConfig(),e.emitInnerEvent(Re.A2KEY_AND_TINYID_UPDATED),e._helloInterval=f,e.triggerReady(),ie=e.getPushModule(),ie&&(uni.setStorageSync("timUniAppInstanceID",I),ie.init()),e._fetchCloudControlConfig(),e.get(29).init(),d}).catch(function(d){return i.setError(d).end(!0),e._m.setNotReadyReason(M.LOGIN_FAILED),u.e("".concat(c," failed. error:"),d),e._lastLoginTs=0,e._m.onLoginFailed(),v(d)})}},{key:"logout",value:function(){var e=this,t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0;if(!this.isLoggedIn())return v({code:M.USER_NOT_LOGGED_IN});new S("logout").setMessage("identifier:".concat(this.getMyUserID())).end(!0);var n="".concat(this._n,".logout");return u.i("".concat(n," type:").concat(t)),t===0&&this._m.setNotReadyReason(M.LOGGED_OUT),this.req({proto:g.LOGOUT,data:{type:t}}).then(function(){return e.resetReady(),Q({})}).catch(function(o){return u.e("".concat(n," error:"),o),e.resetReady(),Q({})})}},{key:"getLoginUser",value:function(){return this.isLoggedIn()?this.getMyUserID():""}},{key:"_fetchCloudControlConfig",value:function(){this.get(23).fetchConfig()}},{key:"_getStatusInstanceID",value:function(){return uni.getStorageSync("timUniAppInstanceID")||0}},{key:"_hello",value:function(){var e=this;this._lastWsHelloTs=Date.now(),this.req({proto:g.HELLO,data:{isWebUniapp:this._isWebUniapp}}).catch(function(t){u.w("".concat(e._n,"._hello error:"),t)})}},{key:"getLastWsHelloTs",value:function(){return this._lastWsHelloTs}},{key:"_checkLoginInfo",value:function(e){var t=0;return G(this.get(12).getSDKAppID())?t=M.NO_SDKAPPID:G(e.userID)?t=M.NO_IDENTIFIER:G(e.userSig)&&(t=M.NO_USERSIG),{code:t}}},{key:"_isReactUIKit",value:function(){return qe&&window.tencent_cloud_im_csig_react_uikit_23F_xa!==void 0}},{key:"onMultipleAccountKickedOut",value:function(e){var t=this;new S("kickedOut").setMessage("type:".concat(_.KICKED_OUT_MULT_ACCOUNT," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),u.w("".concat(this._n,".onMultipleAccountKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then(function(){t.emitOuterEvent(V.KICKED_OUT,{type:_.KICKED_OUT_MULT_ACCOUNT}),t._m.setNotReadyReason(M.KICKED_OUT_MULT_ACCOUNT),t._m.reset()})}},{key:"onMultipleDeviceKickedOut",value:function(e){var t=this;new S("kickedOut").setMessage("type:".concat(_.KICKED_OUT_MULT_DEVICE," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),u.w("".concat(this._n,".onMultipleDeviceKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then(function(){t.emitOuterEvent(V.KICKED_OUT,{type:_.KICKED_OUT_MULT_DEVICE}),t._m.setNotReadyReason(M.KICKED_OUT_MULT_DEVICE),t._m.reset()})}},{key:"onUserSigExpired",value:function(){new S("kickedOut").setMessage(_.KICKED_OUT_USERSIG_EXPIRED).end(!0),u.w("".concat(this._n,".onUserSigExpired userID:").concat(this.getMyUserID())),this.get(12).getStatusInstanceID()!==0&&(this.emitOuterEvent(V.KICKED_OUT,{type:_.KICKED_OUT_USERSIG_EXPIRED}),this._m.setNotReadyReason(M.KICKED_OUT_USERSIG_EXPIRED),this._m.reset())}},{key:"onRestApiKickedOut",value:function(e){new S("kickedOut").setMessage("type:".concat(_.KICKED_OUT_REST_API," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),u.w("".concat(this._n,".onRestApiKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.get(12).getStatusInstanceID()!==0&&(this.emitOuterEvent(V.KICKED_OUT,{type:_.KICKED_OUT_REST_API}),this._m.setNotReadyReason(M.KICKED_OUT_REST_API),this._m.reset(),this.get(21).onRestApiKickedOut())}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this.resetReady(),this._helloInterval=120,this._lastLoginTs=0,this._lastWsHelloTs=0,this._isWebUniapp=0}}]),Zn);function Zn(e){return D(this,Zn),(e=dr.call(this,e))._n="SignModule",e._helloInterval=120,e._lastLoginTs=0,e._lastWsHelloTs=0,e._isWebUniapp=0,_i.mixin(K(e)),e}function hi(e,t){D(this,hi),this._m=e,this._isLoggedIn=!1,this._SDKAppID=t.SDKAppID,this._userID=t.userID||"",this._userSig=t.userSig||"",this._version="3.3.5",this._a2Key="",this._tinyID="",this._customStatus="",this._contentType="json",this._unlimitedAVChatRoom=t.unlimitedAVChatRoom,this._scene=t.scene||"",this._oversea=t.oversea,this._instanceID=t.instanceID,this._statusInstanceID=0,this._isDevMode=t.devMode,this._isTestEnv=t.testEnv,this._proxyServer=t.proxyServer,this._fileUploadProxy=t.fileUploadProxy,this._fileDownloadProxy=t.fileDownloadProxy,this._applicationID=0,this._isPartialUpdatedConvs=t.partialUpdatedConversations,this._isUsingChatCore=!1,this._uiPlatform=0}function eo(e){return D(this,eo),(e=pr.call(this,e))._n="UserModule",e._profileHandler=new tu(K(e)),e._blacklistHandler=new nu(K(e)),e._userStatusHandler=new ou(K(e)),e.getInnerEmitterInstance().on(Re.A2KEY_AND_TINYID_UPDATED,e.onContextUpdated,K(e)),e}function fi(e){D(this,fi),this._userM=e,this._n="UserStatusHandler",this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100,this._userM.getInnerEmitterInstance().on(Re.CLOUD_CONFIG_UPDATED,this._onCloudConfigUpdated,this)}function mi(e){D(this,mi),this._userM=e,this._n="BlacklistHandler",this._blacklistMap=new Map,this.startIndex=0,this.maxLimited=100,this.currentSequence=0}function vi(e){D(this,vi),this._userM=e,this._n="ProfileHandler",this.TAG="profile",this.accountProfileMap=new Map,this.expirationTime=864e5}function to(e){return D(this,to),(e=_r.call(this,e))._n="TopicModule",e._topicMap=new Map,e._getTopicTimeMap=new Map,e.TOPIC_CACHE_TIME=300,e.TOPIC_LAST_ACTIVE_TIME=3600,e.getInnerEmitterInstance().on(Re.CLOUD_CONFIG_UPDATED,e._onCloudConfigUpdated,K(e)),e}function Ii(e,t){D(this,Ii),this.topicID="",this.topicName="",this.avatar="",this.introduction="",this.notification="",this.unreadCount=0,this.muteAllMembers=!1,this.customData="",this.groupAtInfoList=[],this.nextMessageSeq=0,this.lastMessage=lr(e.lastMessage,t),this.selfInfo={muteTime:0,readedSequence:0,messageRemindType:"",excludedUnreadSequenceList:void 0},this._initTopic(e)}function no(e){return D(this,no),(e=gr.call(this,e))._n="GroupModule",e._commonGroupHandler=new Bc(K(e)),e._groupAttributesHandler=new Hc(K(e)),e._groupCountersHandler=new Kc(K(e)),e._AVChatRoomHandler=new Yc(K(e)),e._groupTipsHandler=new Vc(K(e)),e._groupSystemNoticeHandler=new zc(K(e)),e._groupMemberHandler=new Jc(K(e)),e.groupMap=new Map,e._unjoinedAVChatRoomList=new Map,e._receiptDetailCompleteMap=new Map,e._onlineMemberCountMap=new Map,e._timeoutIDs=[],e.getInnerEmitterInstance().on(Re.CLOUD_CONFIG_UPDATED,e._onCloudConfigUpdated,K(e)),e}function Mi(e){D(this,Mi),this._grpM=e,this._n="GroupSystemNoticeHandler",this.pendencyMap=new Map}function yi(e){D(this,yi),this._grpM=e,this._n="GroupMemberHandler",this.groupMemberListMap=new Map,this.DEFAULT_MEMBER_INFO_FILTER=["Role","JoinTime","NameCard","ShutUpUntil","OnlineStatus"],this._grpM.getInnerEmitterInstance().on(Re.PROFILE_UPDATED,this._onProfileUpdated,this)}function Ai(e){D(this,Ai),this.userID="",this.avatar="",this.nick="",this.role="",this.joinTime="",this.lastSendMsgTime="",this.nameCard="",this.muteUntil=0,this.memberCustomField=[],this.isOnline=!1,this.updateMember(e)}function Ci(e){D(this,Ci),this._grpM=e,this._n="AVChatRoomHandler",this._joinedGroupMap=new Map,this._pollingRequestInfoMap=new Map,this._pollingInstanceMap=new Map,this.sequencesLinkedList=new gi(200),this.messageIDLinkedList=new gi(100),this._reportMessageStackedCount=0,this._onlineMemberCountMap=new Map,this.DEFAULT_EXPIRE_TIME=60,this.DEFAULT_POLLING_INTERVAL=300,this.MAX_POLLING_INTERVAL=2e3,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0,this._startBroadcastSeq=1,this._broadcastMessageIDMap=new Map,this.DEFAULT_POLLING_SIMPLIFIED_MSG=0}function Ti(i){D(this,Ti);var t=i.manager,n=i.groupID,o=i.onInit,s=i.onSuccess,i=i.onFail;this._n="Polling",this._manager=t,this._grpM=t._grpM,this._onInit=o,this._onSuccess=s,this._onFail=i,this._groupID=n,this._timeoutID=-1,this._isRunning=!1,this._proto=g.AV_POLLING}function Di(e){D(this,Di),this._grpM=e,this._n="GroupCountersHandler",this._groupCountersMap=new Map,this.EXPIRE_TIME=3e4,this._grpM.getInnerEmitterInstance().on(Re.CLOUD_CONFIG_UPDATED,this._onCloudConfigUpdated,this)}function Si(e){D(this,Si),this._grpM=e,this._n="GroupAttributesHandler",this._groupAttributesMap=new Map,this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4,this._grpM.getInnerEmitterInstance().on(Re.CLOUD_CONFIG_UPDATED,this._onCloudConfigUpdated,this)}function Li(e){D(this,Li),this._grpM=e,this._n="CommonGroupHandler",this.tempConversationList=null,this._cachedGroupMessageMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this.PAGING_GRP_COUNT_LIMIT=200,this._pagingStatus=zt,this._pagingGetCostList=[],e.getInnerEmitterInstance().on(Re.A2KEY_AND_TINYID_UPDATED,this.syncGroupList,this)}function Ei(e){D(this,Ei),this._grpM=e,this._n="GroupTipsHandler",this._cachedGroupTipsMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4}function oo(e){return D(this,oo),(e=hr.call(this,e))._n="ConversationModule",_i.mixin(K(e)),e._messageListHandler=new Gc,e._messageRemindHandler=new Fc(K(e)),e._convGroupHandler=new qc(K(e)),e.singlyLinkedList=new gi(100),e._pagingStatus=zt,e._pagingTimeStamp=0,e._pagingStartIndex=0,e._pagingPinnedTimeStamp=0,e._pagingPinnedStartIndex=0,e._pagingConvIDMap=new Map,e._convIDFromUnreadDBMap=new Map,e._conversationMap=new Map,e._tmpGroupList=[],e._tmpGroupAtTipsList=[],e._peerReadTimeMap=new Map,e._completedMap=new Map,e._roamingMessageKeyAndTimeMap=new Map,e._roamingMessageSequenceMap=new Map,e._remoteGroupReadSequenceMap=new Map,e._convTotalUnreadCount=0,e._pagingGetCostList=[],e._convMapForDiff=new Map,e._partialUpdatedConvMap=new Map,e._initListeners(),e}function ki(e){D(this,ki),this._convM=e,this._n="ConvGroupHandler",this._convGroupMap=new Map,this._startIndex=0,this._pagingStatus=zt}function Ri(e){D(this,Ri),this._convM=e,this._n="MessageRemindHandler"}function Ni(e,t){var n=2<arguments.length&&arguments[2]!==void 0&&arguments[2];D(this,Ni),this.conversationID=e.conversationID||"",this.unreadCount=e.unreadCount||0,this.type=e.type||"",this.lastMessage=ur(e.lastMessage,t,n),e.lastMsgTime&&(this.lastMessage.lastTime=e.lastMsgTime),this._isInfoCompleted=!1,this.peerReadTime=e.peerReadTime||0,this.groupAtInfoList=[],this.remark="",this.isPinned=e.isPinned||!1,this.messageRemindType=e.messageRemindType,this.markList=e.markList||[],this.customData=e.customData||"",this.conversationGroupList=e.conversationGroupList||[],this.draftText=e.draftText||"",this._initProfile(e),this.subType=this.groupProfile?this.groupProfile.type:""}function Oi(e){D(this,Oi),this.groupID="",this.name="",this.avatar="",this.type="",this.introduction="",this.notification="",this.ownerID="",this.createTime="",this.infoSequence="",this.lastInfoTime="",this.selfInfo={messageRemindType:"",joinTime:"",nameCard:"",role:"",userID:"",memberCustomField:void 0,readedSequence:0,excludedUnreadSequenceList:void 0},this.lastMessage={lastTime:"",lastSequence:"",fromAccount:"",messageForShow:""},this.nextMessageSeq="",this.memberNum="",this.memberCount="",this.maxMemberNum="",this.maxMemberCount="",this.joinOption="",this.inviteOption="",this.groupCustomField=[],this.muteAllMembers=!1,this.isSupportTopic=!1,this._lastRevokedTime=0,this._initGroup(e)}function Gi(e){D(this,Gi),this.MAX_LENGTH=e,this.pTail=null,this.pNodeToDel=null,this.map=new Map}function Pi(e){var t=this;D(this,Pi),G(e)||(this.userID=e.userID||"",this.nick=e.nick||"",this.gender=e.gender||"",this.birthday=e.birthday||0,this.location=e.location||"",this.selfSignature=e.selfSignature||"",this.allowType=e.allowType||_.ALLOW_TYPE_ALLOW_ANY,this.language=e.language||0,this.avatar=e.avatar||"",this.messageSettings=e.messageSettings||0,this.adminForbidType=e.adminForbidType||_.FORBID_TYPE_NONE,this.level=e.level||0,this.role=e.role||0,this.lastUpdatedTime=0,this.profileCustomField=[],G(e.profileCustomField)||e.profileCustomField.forEach(function(n){t.profileCustomField.push({key:n.key,value:n.value})}))}function us(){return null}function Ir(e){var t=e.get(12);return{SDKType:10,SDKAppID:t.getSDKAppID(),SDKVersion:t.getVersion(),tinyID:Number(t.getTinyID()),userID:t.getUserID(),platform:e.getPlatform(),instanceID:t.getInstanceID(),traceID:kt()}}R(qi,[{key:"_errorTolerantHandle",value:function(){ge||!C(window)&&this._canIUseCookies()||(this.getItem=us,this.setItem=us,this.removeItem=us,this.clear=us)}},{key:"onCheckTimer",value:function(e){e%20==0&&this._storageQueue.size!==0&&this._doFlush()}},{key:"_doFlush",value:function(){try{var e,t=Ee(this._storageQueue);try{for(t.s();!(e=t.n()).done;){var n=$(e.value,2),o=n[0],s=n[1];this._setStorageSync(this._getKey(o),s)}}catch(i){t.e(i)}finally{t.f()}this._storageQueue.clear()}catch(i){u.w("".concat(this._n,"._doFlush error:"),i)}}},{key:"_getPrefix",value:function(){var e=this._m.get(12);return"TIM_".concat(e.getSDKAppID(),"_").concat(e.getUserID(),"_")}},{key:"_getKey",value:function(e){return"".concat(this._getPrefix()).concat(e)}},{key:"getItem",value:function(e){var t=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1];try{var n=t?this._getKey(e):e;return this.getStorageSync(n)}catch(o){return u.w("".concat(this._n,".getItem error:"),o),{}}}},{key:"setItem",value:function(e,t){var n;2<arguments.length&&arguments[2]!==void 0&&arguments[2]?(n=!(3<arguments.length&&arguments[3]!==void 0)||arguments[3]?this._getKey(e):e,this._setStorageSync(n,t)):this._storageQueue.set(e,t)}},{key:"clear",value:function(){try{ge?ce.clearStorageSync():this._canIUseCookies()&&localStorage.clear()}catch(e){u.w("".concat(this._n,".clear error:"),e)}}},{key:"removeItem",value:function(e){var t=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1];try{var n=t?this._getKey(e):e;this._removeStorageSync(n)}catch(o){u.w("".concat(this._n,".removeItem error:"),o)}}},{key:"getSize",value:function(e){var t=this,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"b";try{var o={size:0,limitSize:5242880,unit:n};if(Object.defineProperty(o,"leftSize",{enumerable:!0,get:function(){return o.limitSize-o.size}}),ge&&(o.limitSize=1024*ce.getStorageInfoSync().limitSize),e)o.size=JSON.stringify(this.getItem(e)).length+this._getKey(e).length;else if(ge)ce.getStorageInfoSync().keys.forEach(function(i){o.size+=JSON.stringify(t.getStorageSync(i)).length+t._getKey(i).length});else if(this._canIUseCookies())for(var s in localStorage)localStorage.hasOwnProperty(s)&&(o.size+=localStorage.getItem(s).length+s.length);return this._convertUnit(o)}catch(i){u.w("".concat(this._n," error:"),i)}}},{key:"_convertUnit",value:function(e){var t,n={},o=e.unit;for(t in n.unit=o,e)typeof e[t]=="number"&&(o.toLowerCase()==="kb"?n[t]=Math.round(e[t]/1024):o.toLowerCase()==="mb"?n[t]=Math.round(e[t]/1024/1024):n[t]=e[t]);return n}},{key:"_setStorageSync",value:function(e,t){ge?gt?my.setStorageSync({key:e,data:t}):ce.setStorageSync(e,t):this._canIUseCookies()&&localStorage.setItem(e,JSON.stringify(t))}},{key:"getStorageSync",value:function(e){return ge?gt?my.getStorageSync({key:e}).data:ce.getStorageSync(e):this._canIUseCookies()?JSON.parse(localStorage.getItem(e)):{}}},{key:"_removeStorageSync",value:function(e){ge?gt?my.removeStorageSync({key:e}):ce.removeStorageSync(e):this._canIUseCookies()&&localStorage.removeItem(e)}},{key:"_canIUseCookies",value:function(){return navigator&&navigator.cookieEnabled&&localStorage}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._doFlush()}}]);var Mr,cu=qi,uu=(R(Fi,[{key:"pushIn",value:function(e){u.d("".concat(this._n,".pushIn"),this._report.length,e),this._report.push(e)}},{key:"backfill",value:function(e){var t;F(e)&&e.length!==0&&(u.d("".concat(this._n,".backfill"),this._report.length,e.length),(t=this._report).unshift.apply(t,b(e)))}},{key:"getLogsNumInMemory",value:function(){return this._report.length}},{key:"isEmpty",value:function(){return this._report.length===0}},{key:"_reset",value:function(){this._report.length=0,this._report=[]}},{key:"getLogsInMemory",value:function(){var e=this._report.slice();return this._reset(),e}}]),Fi),lu=(z(so,Oe),Mr=X(so),R(so,[{key:"reportAtOnce",value:function(){this._report()}},{key:"_onLoginSuccess",value:function(){var e=this,t=this.get(13),n=t.getItem(this.TAG,!1);!G(n)&&Xe(n.forEach)&&(u.l("".concat(this._n,"._onLoginSuccess. logs count:").concat(n.length)),n.forEach(function(o){e._reportBody.pushIn(o)}),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("evt_rpt_threshold"),t=this.getCloudConfig("evt_rpt_waiting"),n=this.getCloudConfig("evt_rpt_level"),o=this.getCloudConfig("evt_rpt_sdkappid_bl"),s=this.getCloudConfig("evt_rpt_tinyid_wl");C(e)||(this.MIN_THRESHOLD=Number(e)),C(t)||(this.WAITING_TIME=Number(t)),C(n)||(this.REPORT_LEVEL=n.split(",").map(function(i){return Number(i)})),C(o)||(this.REPORT_SDKAPPID_BLACKLIST=o.split(",").map(function(i){return Number(i)})),C(s)||(this.REPORT_TINYID_WHITELIST=s.split(","))}},{key:"pushIn",value:function(e){e instanceof S&&(e.updateTimeStamp(),this._reportBody.pushIn(e),this._reportBody.getLogsNumInMemory()>=this.MIN_THRESHOLD&&this._report())}},{key:"onCheckTimer",value:function(){Date.now()<this._lastReportTime+this.WAITING_TIME||this._reportBody.isEmpty()||this._report()}},{key:"_filterLogs",value:function(e){var t=this,o=this.get(12),n=o.getSDKAppID(),o=o.getTinyID();return Wa(this.REPORT_SDKAPPID_BLACKLIST,n)&&!Ya(this.REPORT_TINYID_WHITELIST,o)?[]:e.filter(function(s){return t.REPORT_LEVEL.includes(s.level)})}},{key:"_report",value:function(){var e,t,n=this;this._reportBody.isEmpty()||(e=this._reportBody.getLogsInMemory(),(t=this._filterLogs(e)).length!==0?(t={header:Ir(this),event:t},this.req({proto:g.SSO_STAT,data:l({},t)}).then(function(){n._lastReportTime=Date.now()}).catch(function(o){u.w("".concat(n._n,"._report failed. error:"),o),n._lastReportTime=Date.now(),n._reportBody.backfill(e),n._reportBody.getLogsNumInMemory()>n.MAX_THRESHOLD&&n._flushAtOnce()})):this._lastReportTime=Date.now())}},{key:"_flushAtOnce",value:function(){var e=this.get(13),t=e.getItem(this.TAG,!1),n=this._reportBody.getLogsInMemory(),o="".concat(this._n,"._flushAtOnce");G(t)?(u.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1)):((n=n.concat(t)).length>this.MAX_THRESHOLD&&(n=n.slice(0,this.MAX_THRESHOLD)),u.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1))}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._lastReportTime=0,this._report(),this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[]}}]),so),Ui="none",bi="online",du=(R(wi,[{key:"start",value:function(){var e=this,t="".concat(this._n,".start");ge?(ce.getNetworkType({success:function(n){e._networkType=n.networkType||n.subtype||"",n.networkType===Ui?u.w("".concat(t," no network, please check!")):u.i("".concat(t," networkType:").concat(n.networkType))}}),this._mpNetworkStatusCallback=this._onNetworkStatusChange.bind(this),ce.onNetworkStatusChange(this._mpNetworkStatusCallback)):(this._networkType=bi,this._webOnlineCallback=this._onWebOnline.bind(this),this._webOfflineCallback=this._onWebOffline.bind(this),window&&(window.addEventListener("online",this._webOnlineCallback),window.addEventListener("offline",this._webOfflineCallback)))}},{key:"_onWebOnline",value:function(){this._onNetworkStatusChange({isConnected:!0,networkType:bi})}},{key:"_onWebOffline",value:function(){this._onNetworkStatusChange({isConnected:!1,networkType:Ui})}},{key:"_onNetworkStatusChange",value:function(n){var t=n.isConnected,n=n.networkType,o="".concat(this._n,"._onNetworkStatusChange"),s=!1,i="previous:".concat(this._networkType," current:").concat(n);t?(u.i("".concat(o," ").concat(i)),this._networkType!==n&&(s=!0,this._networkType=n,this._m.get(21).reConnect(!0))):this._networkType!==n&&(s=!0,this._networkType=n,u.w("".concat(o," no network, please check!")),this._m.get(21).offline()),s&&new S("networkChange").setMessage("isConnected:".concat(t," ").concat(i)).end()}},{key:"isOnline",value:function(){return this._networkType!==Ui}},{key:"getNetworkType",value:function(){return this._networkType}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),ge?this._mpNetworkStatusCallback!==null&&(ce.offNetworkStatusChange&&(ze||Dt?ce.offNetworkStatusChange(this._mpNetworkStatusCallback):ce.offNetworkStatusChange()),this._mpNetworkStatusCallback=null):window&&(this._webOnlineCallback!==null&&(window.removeEventListener("online",this._webOnlineCallback),this._webOnlineCallback=null),this._onWebOffline!==null&&(window.removeEventListener("offline",this._webOfflineCallback),this._webOfflineCallback=null))}}]),wi);function wi(e){D(this,wi),this._m=e,this._networkType=bi,this._n="NetMonitorModule",this.MAX_WAIT_TIME=3e3,this._mpNetworkStatusCallback=null,this._webOnlineCallback=null,this._webOfflineCallback=null}function so(e){D(this,so),(e=Mr.call(this,e))._n="EventStatModule",e.TAG="im-ssolog-event",e._reportBody=new uu,e.MIN_THRESHOLD=20,e.MAX_THRESHOLD=100,e.WAITING_TIME=6e4,e.REPORT_LEVEL=[4,5,6],e.REPORT_SDKAPPID_BLACKLIST=[],e.REPORT_TINYID_WHITELIST=[],e._lastReportTime=Date.now();var t=e.getInnerEmitterInstance();return t.on(Re.A2KEY_AND_TINYID_UPDATED,e._onLoginSuccess,K(e)),t.on(Re.CLOUD_CONFIG_UPDATED,e._onCloudConfigUpdated,K(e)),e}function Fi(e){D(this,Fi),this._n="SSOLogBody",this._report=[]}function qi(e){D(this,qi),this._m=e,this._n="StorageModule",this._storageQueue=new Map,this._errorTolerantHandle()}U=he={exports:{}},Ar=Object.prototype.hasOwnProperty,ht="~",Object.create&&(ao.prototype=Object.create(null),new ao().__proto__||(ht=!1)),It.prototype.eventNames=function(){var e,t,n=[];if(this._eventsCount===0)return n;for(t in e=this._events)Ar.call(e,t)&&n.push(ht?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},It.prototype.listeners=function(t){var t=ht?ht+t:t,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,s=n.length,i=new Array(s);o<s;o++)i[o]=n[o].fn;return i},It.prototype.listenerCount=function(e){return e=ht?ht+e:e,e=this._events[e],e?e.fn?1:e.length:0},It.prototype.emit=function(e,t,n,o,s,i){var a=ht?ht+e:e;if(!this._events[a])return!1;var r,c=this._events[a],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,o),!0;case 5:return c.fn.call(c.context,t,n,o,s),!0;case 6:return c.fn.call(c.context,t,n,o,s,i),!0}for(m=1,r=new Array(d-1);m<d;m++)r[m-1]=arguments[m];c.fn.apply(c.context,r)}else for(var p,h=c.length,m=0;m<h;m++)switch(c[m].once&&this.removeListener(e,c[m].fn,void 0,!0),d){case 1:c[m].fn.call(c[m].context);break;case 2:c[m].fn.call(c[m].context,t);break;case 3:c[m].fn.call(c[m].context,t,n);break;case 4:c[m].fn.call(c[m].context,t,n,o);break;default:if(!r)for(p=1,r=new Array(d-1);p<d;p++)r[p-1]=arguments[p];c[m].fn.apply(c[m].context,r)}return!0},It.prototype.on=function(e,t,n){return Cr(this,e,t,n,!1)},It.prototype.once=function(e,t,n){return Cr(this,e,t,n,!0)},It.prototype.removeListener=function(e,t,n,o){if(e=ht?ht+e:e,!this._events[e])return this;if(!t)return ls(this,e),this;var s=this._events[e];if(s.fn)s.fn!==t||o&&!s.once||n&&s.context!==n||ls(this,e);else{for(var i=0,a=[],r=s.length;i<r;i++)(s[i].fn!==t||o&&!s[i].once||n&&s[i].context!==n)&&a.push(s[i]);a.length?this._events[e]=a.length===1?a[0]:a:ls(this,e)}return this},It.prototype.removeAllListeners=function(e){return e?(e=ht?ht+e:e,this._events[e]&&ls(this,e)):(this._events=new ao,this._eventsCount=0),this},It.prototype.off=It.prototype.removeListener,It.prototype.addListener=It.prototype.on,It.prefixed=ht,U.exports=It.EventEmitter=It;var yr,Ar,ht,xi=he.exports,pu=["requestSnapshotUrl"],_u=(z(io,Oe),yr=X(io),R(io,[{key:"_init",value:function(){var e=this.get(18);this.TIMUploadPlugin=e.getPlugin("tim-upload-plugin"),this.TIMUploadPlugin?this._initUploaderMethod():(this.COSSDK=e.getPlugin(e=ge?"cos-wx-sdk":"cos-js-sdk"),this.COSSDK?(this._getAuthorizationKey(),this.outputWarning("CosReplacement",e)):this.outputWarning("PluginUndetected"))}},{key:"_onCloudConfigUpdated",value:function(){var e="".concat(this._n,"._onCloudConfigUpdated"),t=this.getCloudConfig("upload_size_limit"),n=this.getCloudConfig("simple_cos");if(u.l("".concat(e," uploadSizeLimit:").concat(t," simpleCos:").concat(n)),!C(t))try{var o=JSON.parse(t);this.UPLOAD_SIZE_LIMIT={A:o.a?1048576*parseInt(o.a):this.UPLOAD_SIZE_LIMIT.A,F:o.f?1048576*parseInt(o.f):this.UPLOAD_SIZE_LIMIT.F,I:o.i?1048576*parseInt(o.i):this.UPLOAD_SIZE_LIMIT.I,V:o.v?1048576*parseInt(o.v):this.UPLOAD_SIZE_LIMIT.V}}catch{}C(n)||(this.isSimpleCos=n==="1")}},{key:"_getAuthorizationKey",value:function(){var e=this,t="".concat(this._n,".").concat("_getAuthorizationKey"),n=new S("_getAuthorizationKey"),o=Math.ceil(Date.now()/1e3);this.req({proto:g.COS_SIGN,data:{duration:this.expiredTimeLimit}}).then(function(i){var i=i.data,a=(u.l("".concat(t," ok. data:"),i),i.expiredTime-o);n.setMessage("requestId:".concat(i.requestId," requestTime:").concat(o," expiredTime:").concat(i.expiredTime," diff:").concat(a,"s")).end(),!ge&&i.region&&(e.region=i.region),e.appid=i.appid,e.bucketName=i.bucketName,e.ciUrl=i.ciUrl,e.directory=i.directory,e.downloadUrl=i.downloadUrl,e.uploadUrl=i.uploadUrl,e.cosOptions={secretId:i.secretId,secretKey:i.secretKey,sessionToken:i.sessionToken,expiredTime:i.expiredTime},u.l("".concat(t," ok. region:").concat(e.region," bucketName:").concat(e.bucketName)),e._initUploaderMethod()}).catch(function(s){n.setError(s).end(),u.w("".concat(t," failed. error:"),s)})}},{key:"_getCosPreSigUrl",value:function(e){var t=this,n="".concat(this._n,".").concat("_getCosPreSigUrl"),o=Math.ceil(Date.now()/1e3),s=new S("_getCosPreSigUrl"),i={uploadMethod:e.uploadMethod,platform:this.getPlatform(),SDKAppID:this.getSDKAppID(),userID:e.userID,conversationType:e.conversationType,uploadConfig:[{fileID:1,fileType:e.fileType,fileName:e.fileName}]},a=g.SIMPLE_COS_PRE_SIG;return this.isSimpleCos||(i={fileType:e.fileType,fileName:e.fileName,uploadMethod:e.uploadMethod,duration:e.duration},a=g.COS_PRE_SIG),this.req({proto:a,data:i}).then(function(p){t.tryCount=0;var c,d,p=p.data||{},h=(u.l("".concat(n," ok. isSimpleCos:").concat(t.isSimpleCos," data:"),p),"");return h=t.isSimpleCos?(c=(d=p.preSig[0]).uploadUrl,d=d.fileKey,"uploadIP:".concat(p.uploadIP," uploadUrl:").concat(c," fileKey:").concat(d," cost:").concat(Ke(o))):"requestId:".concat(p.requestId," expiredTime:").concat(p.expiredTime," diff:").concat(p.expiredTime-o,"s"),s.setMessage(h).end(),p}).catch(function(r){return r.code===-1&&(r.code=M.COS_GET_SIG_FAIL),s.setError(r).end(),u.w("".concat(n," failed. error:"),r),t.tryCount<1?(t.tryCount++,t._getCosPreSigUrl(e)):(t.tryCount=0,v({code:M.COS_GET_SIG_FAIL}))})}},{key:"_initUploaderMethod",value:function(){var e=this;if(this.TIMUploadPlugin)return this.timUploadPlugin=new this.TIMUploadPlugin,void(this._cosUploadMethod=function(t,n){e.timUploadPlugin.uploadFile(t,n)});this.appid&&(this.cos=ge?new this.COSSDK({ForcePathStyle:!0,getAuthorization:this._getAuthorization.bind(this)}):new this.COSSDK({getAuthorization:this._getAuthorization.bind(this)}),this._cosUploadMethod=ge?function(t,n){e.cos.postObject(t,n)}:function(t,n){e.cos.uploadFiles(t,n)})}},{key:"onCheckTimer",value:function(e){this.COSSDK&&(this.TIMUploadPlugin||this.isLoggedIn()&&e%60==0&&Math.ceil(Date.now()/1e3)>=this.cosOptions.expiredTime-120&&this._getAuthorizationKey())}},{key:"_getAuthorization",value:function(e,t){t({TmpSecretId:this.cosOptions.secretId,TmpSecretKey:this.cosOptions.secretKey,XCosSecurityToken:this.cosOptions.sessionToken,ExpiredTime:this.cosOptions.expiredTime})}},{key:"upload",value:function(e){if(e._relayFlag===!0)return Promise.resolve();var t=this.get(26);switch(e.type){case _.MSG_IMAGE:return t.addTotalCount(vt),this._uploadImage(e);case _.MSG_FILE:return t.addTotalCount(vt),this._uploadFile(e);case _.MSG_AUDIO:return t.addTotalCount(vt),this._uploadAudio(e);case _.MSG_VIDEO:return t.addTotalCount(vt),this._uploadVideo(e);default:return Promise.resolve()}}},{key:"_uploadImage",value:function(e){var t=this,n=this.get(2),o=e.getElements()[0],s=n.getMessageOption(e.clientSequence);return this.doUploadImage({file:s.payload.file,to:s.to,message:e,onProgress:function(i){if(o.updatePercent(i),Xe(s.onProgress))try{s.onProgress(i)}catch{return v({code:M.MSG_ONPROGRESS_FUNCTION_ERROR})}}}).then(function(Y){var a=Y.location,r=Y.fileType,c=Y.fileSize,d=Y.width,p=Y.height,h=Y.smallImageUrl,m=Y.smallImageWidth,f=Y.smallImageHeight,I=Y.largeImageUrl,k=Y.largeImageWidth,N=Y.largeImageHeight,x=Y.imageInfoArray,Y=t.isPrivateNetWork()?a:Xo(a);o.updateImageFormat(r);var ie,Le,Ze={size:c,url:Y,width:d,height:p};if(x&&0<x.length)for(var et=0;et<x.length;et++){var rt=x[et];rt.type===1?ie=rt:rt.type===2?Le=rt:Ze=l(l({},Ze),rt)}else Le=h&&I?(ie={url:h,width:m,height:f},{url:I,width:k,height:N}):(ie=Os({originUrl:Y,originWidth:d,originHeight:p,min:198}),Os({originUrl:Y,originWidth:d,originHeight:p,min:720}));return o.updateImageInfoArray([l({},Ze),l({},Le),l({},ie)]),e})}},{key:"_uploadFile",value:function(e){var t=this,n=this.get(2),o=e.getElements()[0],s=n.getMessageOption(e.clientSequence);return this.doUploadFile({file:s.payload.file,to:s.to,message:e,onProgress:function(i){if(o.updatePercent(i),Xe(s.onProgress))try{s.onProgress(i)}catch{return v({code:M.MSG_ONPROGRESS_FUNCTION_ERROR})}}}).then(function(i){return i=i.location,i=t.isPrivateNetWork()?i:Xo(i),o.updateFileUrl(i),e})}},{key:"_uploadAudio",value:function(e){var t=this,n=this.get(2),o=e.getElements()[0],s=n.getMessageOption(e.clientSequence);return this.doUploadAudio({file:s.payload.file,to:s.to,message:e,onProgress:function(i){if(o.updatePercent(i),Xe(s.onProgress))try{s.onProgress(i)}catch{return v({code:M.MSG_ONPROGRESS_FUNCTION_ERROR})}}}).then(function(i){return i=i.location,i=t.isPrivateNetWork()?i:Xo(i),o.updateAudioUrl(i),e})}},{key:"_uploadVideo",value:function(e){var t=this,n=this.get(2),o=e.getElements()[0],s=n.getMessageOption(e.clientSequence);return this.doUploadVideo({file:s.payload.file,to:s.to,message:e,onProgress:function(i){if(o.updatePercent(i),Xe(s.onProgress))try{s.onProgress(i)}catch{return v({code:M.MSG_ONPROGRESS_FUNCTION_ERROR})}}}).then(function(a){var r=a.location,a=a.snapshotInfo,r=t.isPrivateNetWork()?r:Xo(r);return o.updateVideoUrl(r),G(a)||o.updateSnapshotInfo(a),e})}},{key:"_checkSizeError",value:function(e){var t="";return e==="A"?t="audio":e==="I"?t="image":e==="V"?t="video":e==="F"&&(t="file"),v({code:M["MSG_".concat(e,"_SIZE_LIMIT")],message:this.getErrorMessage("UploadSizeLimit",t,"".concat(this.UPLOAD_SIZE_LIMIT[e]/1048576,"MB"))})}},{key:"doUploadImage",value:function(e){var t=this;if(!e.file||this._isEmptyFileList(e.file.files))return v({code:M.MSG_I_SELECT_F_FIRST});var n=this._checkImageType(e.file);if(n!==!0||(n=this._checkImageSize(e.file),n!==!0))return n;var o=null;return this._setUploadFileType(1),this.uploadByCOS(e).then(function(s){if(o=s,t.isPrivateNetWork())return i=t.getFileDownloadProxy(),Hn(mt(s.location,i));if(F(o.imageInfoArray)){var i=o.imageInfoArray.find(function(a){return a.type===3});if(i)return i}return Hn("https://".concat(s.location))}).then(function(s){return o.width=s.width,o.height=s.height,Promise.resolve(o)})}},{key:"_checkImageType",value:function(e){var t="",t=ge?e.url.slice(e.url.lastIndexOf(".")+1):e.files[0].name.slice(e.files[0].name.lastIndexOf(".")+1);return 0<=Pc.indexOf(t.toLowerCase())||v({code:M.MSG_I_TYPES_LIMIT})}},{key:"_checkImageSize",value:function(e){return(e=(ge?e:e.files[0]).size)===0?v({code:M.MSG_F_IS_EMPTY}):e<this.UPLOAD_SIZE_LIMIT.I||this._checkSizeError("I")}},{key:"doUploadFile",value:function(e){return!e.file||this._isEmptyFileList(e.file.files)?v({code:M.MSG_F_SELECT_F_FIRST}):e.file.files[0].size>this.UPLOAD_SIZE_LIMIT.F?this._checkSizeError("F"):e.file.files[0].size===0?v({code:M.MSG_F_IS_EMPTY}):(this._setUploadFileType(255),this.uploadByCOS(e))}},{key:"doUploadVideo",value:function(e){return e.file.videoFile.size>this.UPLOAD_SIZE_LIMIT.V?this._checkSizeError("V"):e.file.videoFile.size===0?v({code:M.MSG_F_IS_EMPTY}):Uc.indexOf(e.file.videoFile.type)===-1?v({code:M.MSG_V_TYPES_LIMIT}):(this._setUploadFileType(2),ge?this.handleVideoUpload(l(l({},e),{},{file:e.file.videoFile})):qe?this.handleVideoUpload(e):void 0)}},{key:"handleVideoUpload",value:function(e){var t=this;return new Promise(function(n,o){t.uploadByCOS(e).then(function(s){n(s)}).catch(function(){t.uploadByCOS(e).then(function(s){n(s)}).catch(function(){o(new Te({code:M.MSG_V_UPLOAD_FAIL}))})})})}},{key:"doUploadAudio",value:function(e){return e.file?e.file.size>this.UPLOAD_SIZE_LIMIT.A?this._checkSizeError("A"):e.file.size===0?v({code:M.MSG_F_IS_EMPTY}):(this._setUploadFileType(3),this.uploadByCOS(e)):v({code:M.MSG_A_UPLOAD_FAIL})}},{key:"uploadByCOS",value:function(e){var t=this;if(!Xe(this._cosUploadMethod))return this.outputWarning("PluginUndetected"),v({code:M.COS_UNDETECTED});if(this.timUploadPlugin)return this._uploadWithPreSigUrl(e);var n=new S("upload"),o="".concat(this._n,".uploadByCOS"),s=Date.now(),i=this._getFile(e);return new Promise(function(a,r){var c=ge?t._createCosOptionsWXMiniApp(e):t._createCosOptionsWeb(e),d=t;t._cosUploadMethod(c,function(p,h){var m=Object.create(null);if(h){if(p||F(h.files)&&h.files[0].error)return f=new Te({code:M.MSG_F_UPLOAD_FAIL}),n.setError(f).end(),u.l("".concat(o," failed. error:"),h.files[0].error),h.files[0].error.statusCode===403&&(u.w("".concat(o," failed. cos AccessKeyId was invalid, regain auth key!")),t._getAuthorizationKey()),void r(f);m.fileName=i.name,m.fileSize=i.size,m.fileType=i.type.slice(i.type.indexOf("/")+1).toLowerCase(),m.location=(ge?h:h.files[0].data).Location;var f=Date.now()-s,h=d._formatFileSize(i.size),I=d._formatSpeed(1e3*i.size/f),h="size:".concat(h," time:").concat(f,"ms speed:").concat(I),I=(u.l("".concat(o," success. name:").concat(i.name," ").concat(h)),a(m),t.get(26));return I.addCost(vt,f),I.addFileSize(vt,i.size),void n.setMessage(h).end()}m=new Te({code:M.MSG_F_UPLOAD_FAIL}),n.setError(m).end(),u.w("".concat(o," failed. error:"),p),p.statusCode===403&&(u.w("".concat(o," failed. cos AccessKeyId was invalid, regain auth key!")),t._getAuthorizationKey()),r(m)})})}},{key:"_uploadWithPreSigUrl",value:function(e){var t=this,n="".concat(this._n,"._uploadWithPreSigUrl"),o=this._getFile(e);return this._createCosOptionsPreSigUrl(e).then(function(s){return new Promise(function(i,a){var r=new S("upload"),c=s.requestSnapshotUrl,d=c===void 0?void 0:c,p=Z(s,pu),h=Date.now();t._cosUploadMethod(p,function(m,f){var I,k,N;return m||f.statusCode===403?(r.setError(new Te(m)).end(),k={HttpStatusCode:9999,CostTime:Ke(h,!1),error:m,url:s.url},f.data&&f.data.uploadIP&&(k.uploadIP=f.data.uploadIP),t._uploadSSOLog(k),u.l("".concat(n," failed, error:"),m),void a(new Te({code:M.MSG_F_UPLOAD_FAIL}))):(I=Object.create(null),k=f.data.location||"",t.isPrivateNetWork()||k.indexOf("https://")!==0&&k.indexOf("http://")!==0||(k=k.split("//")[1]),I.fileName=o.name,I.fileSize=o.size,I.fileType=o.type.slice(o.type.indexOf("/")+1).toLowerCase(),I.location=k,m=Ke(h,!1),k=t._formatFileSize(o.size),N=t._formatSpeed(1e3*o.size/m),k="size:".concat(k," time:").concat(m,"ms speed:").concat(N," res:").concat(JSON.stringify(f.data)),u.l("".concat(n," ok. name:").concat(o.name," ").concat(k)),r.setMessage(k).end(),N={HttpStatusCode:f.statusCode,FileSize:o.size,CostTime:m,url:s.url},f.data&&f.data.uploadIP&&(N.uploadIP=f.data.uploadIP),t._uploadSSOLog(N),(k=t.get(26)).addCost(vt,m),k.addFileSize(vt,o.size),N=[],p.thumbUrl&&p.largeUrl&&N.push.apply(N,[t._getSmallImageInfoByUrl(p.thumbUrl,I),t._getLargeImageInfoByUrl(p.largeUrl,I)]),t.uploadFileType===1&&t.isSimpleCos&&!t.isPrivateNetWork()&&(N.push(t._getImageInfoArray(p.downloadUrl,I)),f.data.uploadIP&&N.push(t._getDownloadIP(p.downloadUrl.split("//")[1].split("/")[0],I))),d&&N.push(t._getSnapshotInfoByUrl(d,I)),0<N.length?Promise.all(N).then(function(){i(I)}):void i(I))})})})}},{key:"_getDownloadIP",value:function(e,t){var n="".concat(this._n,"._getDownloadIP"),o=Date.now();return this.req({proto:g.GET_IP,data:{domainName:e}}).then(function(s){var i;s.data&&s.data.ip&&(u.l("".concat(n," ok. downloadIP:").concat(s.data.ip," cost:").concat(Ke(o))),(i=t.location.split("/"))[0]=s.data.ip,t.location=i.join("/"))}).catch(function(s){})}},{key:"_getImageInfoArray",value:function(e,t){var n=this,o="".concat(this._n,"._getImageInfoArray"),s=Date.now();return this.req({proto:g.GET_IMAGE_INFO,data:{imageUrl:e}}).then(function(i){return i=i.data||{},u.l("".concat(o," ok. data: ").concat(JSON.stringify(i)," cost:").concat(Ke(s))),t.imageInfoArray=i.imageInfoArray,i}).catch(function(i){t.imageInfoArray=void 0,n._uploadSSOLog({HttpStatusCode:1e4,CostTime:Ke(s,!1),url:e})})}},{key:"_uploadSSOLog",value:function(e){var t,n;this.isSimpleCos&&((t=new S).setEventType(18),e.error&&t.setError(new Te(e.error)),n="HttpStatusCode:".concat(e.HttpStatusCode,"|CosRequestId:").concat(e.CosRequestId||"","|")+"FileAlreadyExist:".concat(e.FileAlreadyExist||0,"|FileSize:").concat(e.FileSize||0,"|CostTime:").concat(e.CostTime),e.uploadIP&&(n+="|FinalIP:".concat(e.uploadIP)),t.setMessage("OK").setMoreMessage(e.url).setExtension(n).end())}},{key:"_getRawOrUploadProxyUrl",value:function(e){var t=this.get(12).getFileUploadProxy(),n=e;return n=t?e.replace(/^https:\/\/[^/]+/,t):n}},{key:"_getFile",value:function(e){return F(e.file.files)||Ua(e.file.files)?e.file.files[0]:e.file}},{key:"_formatFileSize",value:function(e){return e<1024?e+"B":e<1048576?Math.floor(e/1024)+"KB":Math.floor(e/1048576)+"MB"}},{key:"_formatSpeed",value:function(e){return e<=1048576?wt(e/1024,1)+"KB/s":wt(e/1048576,1)+"MB/s"}},{key:"_createCosOptionsWeb",value:function(e){var t=this._getFile(e),n=t.name,n=n.slice(n.lastIndexOf(".")),n=this._genFileName("".concat(St(999999)).concat(n));return{files:[{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(n),Body:t}],SliceSize:1048576,onProgress:function(o){if(typeof e.onProgress=="function")try{e.onProgress(o.percent)}catch(s){u.w("onProgress callback error:",s)}},onFileFinish:function(o,s,i){}}}},{key:"_createCosOptionsWXMiniApp",value:function(e){var n=this._getFile(e),t=this._genFileName(n.name),n=n.url;return{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(t),FilePath:n,onProgress:function(o){if(u.l(JSON.stringify(o)),typeof e.onProgress=="function")try{e.onProgress(o.percent)}catch(s){u.w("onProgress callback error:",s)}}}}},{key:"_createCosOptionsPreSigUrl",value:function(e){var t,n=this,o="",s="",a=0,i=this._getFile(e),a=ge?(o=e.message.type===_.MSG_FILE?(t=(t=i.name).slice(t.lastIndexOf(".")),this._genFileName("".concat(St(999999)).concat(t))):this._genFileName(i.name),s=i.url,1):(t=(t=i.name).slice(t.lastIndexOf(".")),o=this._genFileName("".concat(St(999999)).concat(t)),s=i,0);return this._getCosPreSigUrl({fileType:this.uploadFileType,fileName:o,uploadMethod:a,duration:this.duration,userID:e.message.from,conversationType:dt(e.message.conversationID)?1:2}).then(function(I){var f=n.isSimpleCos?I.preSig[0]:I,c=f.uploadUrl,d=f.downloadUrl,p=f.requestSnapshotUrl,p=p===void 0?void 0:p,h=f.thumbUrl,m=f.largeUrl,f=f.fileKey,I=I.uploadIP,I=I===void 0?"":I;return{url:n._getRawOrUploadProxyUrl(c),fileType:n.uploadFileType,fileName:o,resources:s,downloadUrl:d,requestSnapshotUrl:p,thumbUrl:h,largeUrl:m,fileKey:f,uploadIP:!n.isPrivateNetWork()&&I,onProgress:function(k){if(typeof e.onProgress=="function")try{e.onProgress(k.percent)}catch(N){u.w("onProgress callback error:",N),u.e(N)}}}})}},{key:"_genFileName",value:function(e){return"".concat(Va(),"-").concat(e)}},{key:"_setUploadFileType",value:function(e){this.uploadFileType=e}},{key:"_getSnapshotInfoByUrl",value:function(e,t){var n=this,o="_getSnapshotInfoByUrl",s=new S(o);return this.req({proto:g.VIDEO_COVER,data:{platform:this.getPlatform(),coverName:this._genFileName(St(99999)),requestSnapshotUrl:e}}).then(function(c){var a=(c.data||{}).snapshotUrl;if(u.l("".concat(n._n,".").concat(o," ok. snapshotUrl:").concat(a)),s.setMessage("snapshotUrl:".concat(a)).end(),G(a))return{};var r,c=a;return n.isPrivateNetWork()&&(r=n.getFileDownloadProxy(),c=mt(a,r)),Hn(c).then(function(d){t.snapshotInfo={snapshotUrl:a,snapshotWidth:d.width,snapshotHeight:d.height}})}).catch(function(i){return u.w("".concat(n._n,".").concat(o," failed. error:"),i),s.setCode(i.errorCode).setMessage(i.errorInfo).end(),{}})}},{key:"_getSmallImageInfoByUrl",value:function(e,t){var n,o=e;return this.isPrivateNetWork()&&(n=this.getFileDownloadProxy(),o=mt(e,n)),Hn(o).then(function(s){t.smallImageUrl=e,t.smallImageWidth=s.width,t.smallImageHeight=s.height})}},{key:"_getLargeImageInfoByUrl",value:function(e,t){var n,o=e;return this.isPrivateNetWork()&&(n=this.getFileDownloadProxy(),o=mt(e,n)),Hn(o).then(function(s){t.largeImageUrl=e,t.largeImageWidth=s.width,t.largeImageHeight=s.height})}},{key:"_isEmptyFileList",value:function(e){return!(!Ua(e)||e.length!==0)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset"))}}]),io),gu=["downloadKey","pbDownloadKey","messageList"],hu=(R(Vi,[{key:"uploadMergerMessage",value:function(o,t){var n="".concat(this._n,".").concat("uploadMergerMessage"),o=(u.d("".concat(n," message:"),o,"messageBytes:".concat(t)),o.payload.messageList),s=o.length,i=new S("uploadMergerMessage");return this._msgM.req({proto:g.UPLOAD_MERGER_MSG,data:{messageList:o}}).then(function(r){u.d("".concat(n," ok. response:"),r.data);var r=r.data,c=r.pbDownloadKey,r=r.downloadKey,c={pbDownloadKey:c,downloadKey:r,messageNumber:s};return i.setMessage("".concat(s,"-").concat(t,"-").concat(r)).end(),c}).catch(function(a){throw u.w("".concat(n," failed. error:"),a),i.setError(a).end(),a})}},{key:"downloadMergerMessage",value:function(e){var t="".concat(this._n,".").concat("downloadMergerMessage"),n=(u.d("".concat(t," message:"),e),e.payload.downloadKey),o=this._msgM.getFileDownloadProxy(),s=new S("downloadMergerMessage");return s.setMessage("downloadKey:".concat(n)),this._msgM.req({proto:g.DOWNLOAD_MERGER_MSG,data:{downloadKey:n}}).then(function(i){var a,r;return u.d("".concat(t," ok. response:"),i.data),Xe(e.clearElement)?((a=e.payload).downloadKey,a.pbDownloadKey,a.messageList,a=Z(a,gu),e.clearElement(),e.setElement({type:e.type,content:l({messageList:i.data.messageList},a)},o)):(r=[],i.data.messageList.forEach(function(c){G(c)||(c=new rr(c,o),r.push(c))}),e.payload.messageList=r,e.payload.downloadKey="",e.payload.pbDownloadKey=""),s.end(),e}).catch(function(i){throw u.w("".concat(t," failed. key:").concat(n," error:"),i),s.setError(i).end(),i})}},{key:"createMergerMessagePack",value:function(e,t,n){return e.conversationType===_.CONV_C2C?this._createC2CMergerMessagePack(e,t,n):this._createGroupMergerMessagePack(e,t,n)}},{key:"_createC2CMergerMessagePack",value:function(e,t,c){var o=null,s=(t&&(t.offlinePushInfo&&(o=t.offlinePushInfo),t.onlineUserOnly===!0&&(o?o.disablePush=!0:o={disablePush:!0})),[]),i=(Ce(t)&&Ce(t.messageControlInfo)&&(i=(r=t.messageControlInfo).excludedFromUnreadCount,a=r.excludedFromLastMessage,r=r.excludedFromContentModeration,i===!0&&s.push("NoUnread"),a===!0&&s.push("NoLastMsg"),r===!0&&s.push("NoMsgCheck")),""),a=(te(e.cloudCustomData)&&0<e.cloudCustomData.length&&(i=e.cloudCustomData),c.pbDownloadKey),r=c.downloadKey,c=c.messageNumber,h=e.payload,d=h.title,p=h.abstractList,h=h.compatibleText,m=this._msgM.get(6),m=m&&m.isOnlineMessage(e,t)?0:void 0;return{proto:g.SEND_C2C_MSG,tjgID:this._msgM.generateTjgID(e),data:{fromAccount:this._msgM.getMyUserID(),toAccount:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:a,downloadKey:r,title:d,abstractList:p,compatibleText:h,messageNumber:c}}],cloudCustomData:i,clientTime:e.clientTime,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:m,offlinePushInfo:as(o),messageControlInfo:m!==0?s:void 0,isSupportExtension:e.isSupportExtension===!0?1:0,isRelayMessage:e._relayFlag===!0?1:0}}}},{key:"_createGroupMergerMessagePack",value:function(e,f,c){var o=null,s=(f&&f.offlinePushInfo&&(o=f.offlinePushInfo),[]),i=(Ce(f)&&Ce(f.messageControlInfo)&&(i=(r=f.messageControlInfo).excludedFromUnreadCount,a=r.excludedFromLastMessage,r=r.excludedFromContentModeration,i===!0&&s.push("NoUnread"),a===!0&&s.push("NoLastMsg"),r===!0&&s.push("NoMsgCheck")),""),a=(te(e.cloudCustomData)&&0<e.cloudCustomData.length&&(i=e.cloudCustomData),c.pbDownloadKey),r=c.downloadKey,c=c.messageNumber,h=e.payload,d=h.title,p=h.abstractList,h=h.compatibleText,m=this._msgM.get(7),f=m&&m.isOnlineMessage(e,f)?1:0;return{proto:g.SEND_GRP_MSG,tjgID:this._msgM.generateTjgID(e),data:{fromAccount:this._msgM.getMyUserID(),groupID:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:a,downloadKey:r,title:d,abstractList:p,compatibleText:h,messageNumber:c}}],random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:void 0,cloudCustomData:i,onlineOnlyFlag:f,offlinePushInfo:as(o),clientTime:e.clientTime,needReadReceipt:e.needReadReceipt!==!0||m.isMessageFromOrToAVChatroom(e.to)?0:1,messageControlInfo:f==0?s:void 0,isSupportExtension:e.isSupportExtension===!0?1:0,isRelayMessage:e._relayFlag===!0?1:0}}}}]),Vi),fu={ERR_SVR_COMM_SENSITIVE_TEXT:80001,ERR_SVR_COMM_BODY_SIZE_LIMIT:80002,OPEN_SERVICE_OVERLOAD_ERROR:60022,ERR_SVR_MSG_PKG_PARSE_FAILED:20001,ERR_SVR_MSG_INTERNAL_AUTH_FAILED:20002,ERR_SVR_MSG_INVALID_ID:20003,ERR_SVR_MSG_PUSH_DENY:20006,ERR_SVR_MSG_IN_PEER_BLACKLIST:20007,ERR_SVR_MSG_BOTH_NOT_FRIEND:20009,ERR_SVR_MSG_NOT_PEER_FRIEND:20010,ERR_SVR_MSG_NOT_SELF_FRIEND:20011,ERR_SVR_MSG_SHUTUP_DENY:20012,ERR_SVR_GROUP_INVALID_PARAMETERS:10004,ERR_SVR_GROUP_PERMISSION_DENY:10007,ERR_SVR_GROUP_NOT_FOUND:10010,ERR_SVR_GROUP_INVALID_GROUPID:10015,ERR_SVR_GROUP_REJECT_FROM_THIRDPARTY:10016,ERR_SVR_GROUP_SHUTUP_DENY:10017,MSG_SEND_FAIL:2100,OVER_FREQUENCY_LIMIT:2996},mu=[M.MSG_ONPROGRESS_FUNCTION_ERROR,M.MSG_I_SELECT_F_FIRST,M.MSG_I_TYPES_LIMIT,M.MSG_F_IS_EMPTY,M.MSG_I_SIZE_LIMIT,M.MSG_F_SELECT_F_FIRST,M.MSG_F_SIZE_LIMIT,M.MSG_V_SIZE_LIMIT,M.MSG_V_TYPES_LIMIT,M.MSG_A_UPLOAD_FAIL,M.MSG_A_SIZE_LIMIT,M.COS_UNDETECTED];function Vi(e){D(this,Vi),this._n="MergerMessageHandler",this._msgM=e}function io(e){D(this,io),(e=yr.call(this,e))._n="UploadModule",e.TIMUploadPlugin=null,e.timUploadPlugin=null,e.COSSDK=null,e._cosUploadMethod=null,e.expiredTimeLimit=600,e.appid=0,e.bucketName="",e.ciUrl="",e.directory="",e.downloadUrl="",e.uploadUrl="",e.region="ap-shanghai",e.cos=null,e.cosOptions={secretId:"",secretKey:"",sessionToken:"",expiredTime:0},e.uploadFileType="",e.duration=900,e.tryCount=0,e.UPLOAD_SIZE_LIMIT={A:20971520,F:104857600,I:20971520,V:104857600},e.isSimpleCos=!1;var t=e.getInnerEmitterInstance();return t.on(Re.A2KEY_AND_TINYID_UPDATED,e._init,K(e)),t.on(Re.CLOUD_CONFIG_UPDATED,e._onCloudConfigUpdated,K(e)),e}function ao(){}function vu(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function Cr(e,t,n,o,s){if(typeof n!="function")throw new TypeError("The listener must be a function");return n=new vu(n,o||e,s),o=ht?ht+t:t,e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],n]:e._events[o].push(n):(e._events[o]=n,e._eventsCount++),e}function ls(e,t){--e._eventsCount==0?e._events=new ao:delete e._events[t]}function It(){this._events=new ao,this._eventsCount=0}function Tr(e){var t=!1;return Object.values(fu).includes(e)&&(t=!0),t=120001<=e&&e<=13e4||10100<=e&&e<=10200?!0:t}var Dr,Sr,Lr,Er,kr,Rr,Iu=["conversationID","timePosition","timePeriod"],Mu=(z(_o,Oe),Rr=X(_o),R(_o,[{key:"createTextMessage",value:function(n){var o=this.getMyUserID(),t=(n.currentUser=o,n.senderTinyID=this.getMyTinyID(),new We(n)),n=te(n.payload)?n.payload:n.payload.text,n=new Hs({text:n}),o=this._getNickAndAvatarByUserID(o);return t.setElement(n),t.setNickAndAvatar(o),t.setNameCard(this._getNameCardByGroupID(t)),t}},{key:"createImageMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),new We(e));if(ge){var s=e.payload.file;if(Bt(s))return void this.outputWarning("FileUnsupportedInMP","createImageMessage");var o=s.tempFiles[0].path||s.tempFiles[0].tempFilePath,s={url:o,name:o.slice(o.lastIndexOf("/")+1),size:s.tempFiles&&s.tempFiles[0].size||1,type:o.slice(o.lastIndexOf(".")+1).toLowerCase()};e.payload.file=s}else qe&&(Bt(e.payload.file)?(o=e.payload.file,e.payload.file={files:[o]}):Ce(e.payload.file)&&typeof uni<"u"&&(s=e.payload.file.tempFiles[0],e.payload.file={files:[s]}));return o=new Ks({imageFormat:Ut.UNKNOWN,uuid:this._generateUUID(e.payload.file),file:e.payload.file}),s=this._getNickAndAvatarByUserID(t),n.setElement(o),n.setNickAndAvatar(s),n.setNameCard(this._getNameCardByGroupID(n)),this._messageOptionsMap.set(n.clientSequence,e),n}},{key:"createAudioMessage",value:function(e){var n=e.payload.file,o=(ge&&(o={url:n.tempFilePath,name:n.tempFilePath.slice(n.tempFilePath.lastIndexOf("/")+1),size:n.fileSize,second:parseInt(n.duration)/1e3,type:n.tempFilePath.slice(n.tempFilePath.lastIndexOf(".")+1).toLowerCase()},e.payload.file=o),this.getMyUserID()),t=(e.currentUser=o,e.senderTinyID=this.getMyTinyID(),new We(e)),n=new Ys({second:Math.floor(n.duration/1e3),size:n.fileSize||n.size,url:n.tempFilePath,uuid:this._generateUUID(e.payload.file)}),o=this._getNickAndAvatarByUserID(o);return t.setElement(n),t.setNickAndAvatar(o),t.setNameCard(this._getNameCardByGroupID(t)),this._messageOptionsMap.set(t.clientSequence,e),t}},{key:"createVideoMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),e.payload.file.thumbUrl="",e.payload.file.thumbSize=0,{});if(ge){if(gt)return void this.outputWarning("VideoUnsupportedInAlipay");if(Bt(e.payload.file))return void this.outputWarning("FileUnsupportedInMP","createVideoMessage");var o=e.payload.file;F(o.tempFiles)&&(o=o.tempFiles[0]),n.url=o.tempFilePath,n.name=o.tempFilePath.slice(o.tempFilePath.lastIndexOf("/")+1),n.size=o.size||1,n.second=o.duration||0,n.type=o.tempFilePath.slice(o.tempFilePath.lastIndexOf(".")+1).toLowerCase()}else qe&&(Bt(e.payload.file)?(o=e.payload.file,e.payload.file.files=[o]):Ce(e.payload.file)&&typeof uni<"u"&&(o=e.payload.file.tempFile,e.payload.file.files=[o]),o=e.payload.file,n.url=window.URL.createObjectURL(o.files[0]),n.name=o.files[0].name,n.size=o.files[0].size||1,n.second=o.files[0].duration||0,n.type=o.files[0].type.split("/")[1]);return e.payload.file.videoFile=n,o=new We(e),n=new zs({videoFormat:n.type,videoSecond:wt(n.second,0),videoSize:n.size,remoteVideoUrl:"",videoUrl:n.url,videoUUID:this._generateUUID(e.payload.file.videoFile),thumbUUID:this._generateUUID(e.payload.file.videoFile),thumbWidth:e.payload.file.width||200,thumbHeight:e.payload.file.height||200,thumbUrl:e.payload.file.thumbUrl,thumbSize:e.payload.file.thumbSize,thumbFormat:e.payload.file.thumbUrl.slice(e.payload.file.thumbUrl.lastIndexOf(".")+1).toLowerCase()}),t=this._getNickAndAvatarByUserID(t),o.setElement(n),o.setNickAndAvatar(t),o.setNameCard(this._getNameCardByGroupID(o)),this._messageOptionsMap.set(o.clientSequence,e),o}},{key:"createCustomMessage",value:function(n){var o=this.getMyUserID(),t=(n.currentUser=o,n.senderTinyID=this.getMyTinyID(),new We(n)),n=new Js({data:n.payload.data,description:n.payload.description,extension:n.payload.extension}),o=this._getNickAndAvatarByUserID(o);return t.setElement(n),t.setNickAndAvatar(o),t.setNameCard(this._getNameCardByGroupID(t)),t}},{key:"createFaceMessage",value:function(n){var o=this.getMyUserID(),t=(n.currentUser=o,n.senderTinyID=this.getMyTinyID(),new We(n)),n=new Ws(n.payload),o=this._getNickAndAvatarByUserID(o);return t.setElement(n),t.setNickAndAvatar(o),t.setNameCard(this._getNameCardByGroupID(t)),t}},{key:"createMergerMessage",value:function(o){var t=this.getMyUserID(),t=(o.currentUser=t,o.senderTinyID=this.getMyTinyID(),this._getNickAndAvatarByUserID(t)),n=new We(o),o=new ss(o.payload);return n.setElement(o),n.setNickAndAvatar(t),n.setNameCard(this._getNameCardByGroupID(n)),n.setRelayFlag(!0),n}},{key:"createForwardMessage",value:function(e){var t=e.to,n=e.conversationType,o=e.priority,s=e.payload,i=e.needReadReceipt,a=e.receiverList;if(!F(s._elements))return v({code:M.MSG_FORWARD_INVALID_ELEMENTS});var r=this.getMyUserID(),c=this._getNickAndAvatarByUserID(r);return s.type===_.MSG_GRP_TIP?v({code:M.MSG_FORWARD_TYPE_INVALID}):(n={to:t,conversationType:n,conversationID:"".concat(n).concat(t),priority:o,isPlaceMessage:0,status:os,currentUser:r,senderTinyID:this.getMyTinyID(),cloudCustomData:e.cloudCustomData||s.cloudCustomData||"",needReadReceipt:i,receiverList:a,isSupportExtension:e.isSupportExtension||!1},t=new We(n),t.setElement(s._elements[0]),t.setNickAndAvatar(c),t.setNameCard(this._getNameCardByGroupID(s)),t.setRelayFlag(!0),t)}},{key:"downloadMergerMessage",value:function(e){return this._mergerMessageHandler.downloadMergerMessage(e)}},{key:"createFileMessage",value:function(e){if(ge){if(!_t&&!ot&&!ze)return;var n=ce.getSystemInfoSync().SDKVersion;if(_t&&Ha(n,"2.5.0")<0)return void this.outputWarning("WXChooseMessageFile");if(ot&&Ha(n,"1.18.0")<0)return void this.outputWarning("QQChooseMessageFile")}qe||ze?Bt(e.payload.file)?(n=e.payload.file,e.payload.file={files:[n]}):Ce(e.payload.file)&&typeof uni<"u"&&(t=(n=e.payload.file).tempFiles,n=n.files,o=null,F(t)?o=t[0]:F(n)&&(o=n[0]),e.payload.file={files:[o]}):(_t||ot)&&(n=l(l({},(t=e.payload.file.tempFiles)[0]),{},{url:t[0].path}),e.payload.file={files:[n]});var o=this.getMyUserID(),t=(e.currentUser=o,e.senderTinyID=this.getMyTinyID(),new We(e)),n=new js({uuid:this._generateUUID(e.payload.file),file:e.payload.file}),o=this._getNickAndAvatarByUserID(o);return t.setElement(n),t.setNickAndAvatar(o),t.setNameCard(this._getNameCardByGroupID(t)),this._messageOptionsMap.set(t.clientSequence,e),t}},{key:"createLocationMessage",value:function(n){var o=this.getMyUserID(),t=(n.currentUser=o,n.senderTinyID=this.getMyTinyID(),new We(n)),n=new Xs(n.payload),o=this._getNickAndAvatarByUserID(o);return t.setElement(n),t.setNickAndAvatar(o),t.setNameCard(this._getNameCardByGroupID(t)),t}},{key:"_onCannotFindModule",value:function(){return v({code:M.CANNOT_FIND_MODULE})}},{key:"sendMessageInstance",value:function(e,t){var n=this;if(this.get(29).filterMessage(e,t)===!1)return e.hasRiskContent=!0,this._onSendMessageFailed(e,new Te({code:M.PROFANITY_FOUND}));var o=null;if(e.conversationType===_.CONV_C2C)o=this.get(6);else{if(e.conversationType!==_.CONV_GROUP)return v({code:M.MSG_INVALID_CONV_TYPE});o=this.get(7)}if(!o)return v({code:M.CANNOT_FIND_MODULE});var s,i="".concat(this._n,".sendMessageInstance"),a=this.get(11),r=o.isOnlineMessage(e,t);return this.get(17).upload(e).then(function(){return n._getSendMessageSpecifiedKey(e)===_n&&n.get(26).addSuccessCount(vt),n._guardForGroup(e).then(function(){if(!e.isSendable())return v({code:M.MSG_F_URL_IS_EMPTY});n._addSendMessageTotalCount(e),s=Date.now();var c=function(d){var p="utf-8";qe&&document&&(p=document.charset.toLowerCase());var h,m=0,f=d.length;if(p==="utf-8"||p==="utf8")for(var I=0;I<f;I++)(h=d.codePointAt(I))<=127?m+=1:h<=2047?m+=2:h<=65535?m+=3:(m+=4,I++);else if(p==="utf-16"||p==="utf16")for(var k=0;k<f;k++)(h=d.codePointAt(k))<=65535?m+=2:(m+=4,k++);else m=d.replace(/[^\x00-\xff]/g,"aa").length;return m}(JSON.stringify(e));return e.type===_.MSG_MERGER&&11264<c?n._mergerMessageHandler.uploadMergerMessage(e,c).then(function(d){return d=n._mergerMessageHandler.createMergerMessagePack(e,t,d),n.req(d)}):(a.setMessageRandom(e),o.sendMessage(e,t))}).then(function(m){var d,m=m.data,p=m.time,h=m.sequence,f=m.readReceiptCode,m=m.messageDropReason,f=(fe(f)&&f!==0&&(new S("sendMessageWithReceipt").setMessage("from:".concat(e.from," to:").concat(e.to," sequence:").concat(h," readReceiptCode:").concat(f)).end(),u.w("".concat(i," readReceiptCode:").concat(f," message:").concat(n.getErrorMessage(f)))),m&&(f=new S("messageDropReason"),m="from:".concat(e.from," to:").concat(e.to," sequence:").concat(h," messageDropReason:").concat(m),f.setMessage(m).end(),u.w("".concat(i," ").concat(m))),n._addSendMessageSuccessCount(e,s),n._messageOptionsMap.delete(e.clientSequence),e.isResend===!0&&(d=a.findMessage(e.ID))&&(u.l("".concat(i," resend ok. ID:").concat(d.ID)),a.deleteLocalMessage(d)),e.status=Et,e.time=p,!1);return e.conversationType===_.CONV_GROUP?e.sequence=h:e.conversationType!==_.CONV_C2C||(m=a.getLatestMessageSentByMe(e.conversationID))&&(d=m.nick,p=m.avatar,d===e.nick&&p===e.avatar||(f=!0)),f&&a.modifyMessageSentByMe({conversationID:e.conversationID,latestNick:e.nick,latestAvatar:e.avatar}),r===!0?e._onlineOnlyFlag=!0:(a.appendToMessageList(e),h=e,Ce(t)&&Ce(t.messageControlInfo)&&(t.messageControlInfo.excludedFromLastMessage===!0&&(e._isExcludedFromLastMessage=!0,h=""),t.messageControlInfo.excludedFromUnreadCount===!0&&(e._isExcludedFromUnreadCount=!0)),m=e.conversationType,Ve(e.to)&&(m=_.CONV_TOPIC,n.get(10).onMessageSent({groupID:Be(e.to),topicID:e.to,lastMessage:h})),a.onMessageSent({conversationOptionsList:[{conversationID:e.conversationID,unreadCount:0,type:m,subType:e.conversationSubType,lastMessage:h}]})),e._relayFlag||e.type!=="TIMImageElem"||Ka(e.payload.imageInfoArray),q({message:e})})}).catch(function(c){return n._onSendMessageFailed(e,c,r)})}},{key:"_guardForGroup",value:function(e){if(e.conversationType!==_.CONV_GROUP)return Promise.resolve();var t=this.get(7);if(!t)return this._onCannotFindModule();if(lt({groupID:e.to})){var n=t.getLocalGroupProfile(e.to);if(n&&n.isSupportTopic)return v({code:M.MSG_SEND_GRP_WITH_TOPIC_FAIL})}return t.guardForAVChatRoom(e)}},{key:"_onSendMessageFailed",value:function(e,t){var s=2<arguments.length&&arguments[2]!==void 0&&arguments[2],n="".concat(this._n,"._onSendMessageFailed"),o=(e.status=xs,t.code!==80001&&t.code!==80004||(e.hasRiskContent=!0),this.get(11)),i=(o.deleteMessageRandom(e),10100<=t.code&&t.code<=10200||120001<=t.code&&t.code<=13e4),s=(s||i||o.appendToMessageList(e)===!0&&u.l("".concat(n," message stored, ID:").concat(e.ID)),this._addSendMessageFailCountOnUser(e,t),new S("sendMessage")),i="tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to);return qe&&("connection"in navigator&&(o=navigator.connection,i+=" downlink:".concat(o.downlink," effectiveType:").concat(o.effectiveType," rtt:").concat(o.rtt)),"memory"in window.performance&&(o=window.performance.memory,i+=" usedJSHeapSize:".concat(o.usedJSHeapSize," totalJSHeapSize:").concat(o.totalJSHeapSize," jsHeapSizeLimit:").concat(o.jsHeapSizeLimit))),s.setMessage(i).setError(t).end(),u.e("".concat(n," error:"),t),v(new Te({code:t&&t.code?t.code:M.MSG_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if([_.MSG_IMAGE,_.MSG_AUDIO,_.MSG_VIDEO,_.MSG_FILE].includes(e.type))return _n;if(e.conversationType===_.CONV_C2C)return Sn;if(e.conversationType===_.CONV_GROUP){var t=this.get(7);if(t&&(t=t.getLocalGroupProfile(e.to),t))return e=t.type,st(e)?En:Ln}}},{key:"_addSendMessageTotalCount",value:function(e){e=this._getSendMessageSpecifiedKey(e),e&&this.get(26).addTotalCount(e)}},{key:"_addSendMessageSuccessCount",value:function(o,t){var n,o=this._getSendMessageSpecifiedKey(o);o&&((n=this.get(26)).addSuccessCount(o),n.addCost(o,Ke(t,!1)))}},{key:"_addSendMessageFailCountOnUser",value:function(i,o){var n,o=o.code,o=o===void 0?-1:o,s=this.get(26),i=this._getSendMessageSpecifiedKey(i);i===_n&&(n=!1,n=mu.includes(o)?!0:n)?s.addFailedCountOfUserSide(vt):Tr(o)&&i&&s.addFailedCountOfUserSide(i)}},{key:"resendMessage",value:function(e,t){return e.isResend=!0,e.status=os,this.sendMessageInstance(e,t)}},{key:"revokeMessage",value:function(e){var t=this,n=null;if(e.conversationType===_.CONV_C2C?n=this.get(6):e.conversationType===_.CONV_GROUP&&(n=this.get(7)),!n)return this._onCannotFindModule();var o=new S("revokeMessage"),s=(o.setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to)),"".concat(this._n,".").concat("revokeMessage"));return n.revokeMessage(e).then(function(a){var a=a.data.recallRetList;return G(a)||a[0].retCode===0?(u.i("".concat(s," ok. ID:").concat(e.ID)),e.isRevoked=!0,o.end(),t.get(11).onMessageRevoked([e]),q({message:e})):(a=new Te({code:a[0].retCode,data:{message:e}}),o.setCode(a.code).setMoreMessage(a.message).end(),v(a))}).catch(function(i){o.setError(i).end();var a=new Te({code:i&&i.code?i.code:M.MSG_REVOKE_FAIL,message:i&&i.message?i.message:void 0,data:{message:e}});return u.w("".concat(s," failed. error:"),i),v(a)})}},{key:"deleteMessage",value:function(e){var t=this,n=null,o=e[0],s=o.conversationID,i="",a=[],r=[];if(o.conversationType===_.CONV_C2C)n=this.get(6),i=s.replace(_.CONV_C2C,""),e.forEach(function(p){p&&p.status===Et&&p.conversationID===s&&(p._onlineOnlyFlag||a.push("".concat(p.sequence,"_").concat(p.random,"_").concat(p.time)),r.push(p))});else if(o.conversationType===_.CONV_GROUP)n=this.get(7),i=s.replace(_.CONV_GROUP,""),e.forEach(function(p){p&&p.status===Et&&p.conversationID===s&&(p._onlineOnlyFlag||a.push("".concat(p.sequence)),r.push(p))});else if(o.conversationType===_.CONV_SYSTEM)return v({code:M.CANNOT_DELETE_GRP_SYSTEM_NOTICE});if(!n)return this._onCannotFindModule();if(a.length===0)return this._onMessageDeleted(r);30<a.length&&(a=a.slice(0,30),r=r.slice(0,30));var c=new S("deleteMessage"),d=(c.setMessage("to:".concat(i," count:").concat(a.length)),"".concat(this._n,".").concat("deleteMessage"));return n.deleteMessage({to:i,keyList:a}).then(function(p){return c.end(),u.i("".concat(d," ok")),t._onMessageDeleted(r)}).catch(function(p){return c.setError(p).end(),u.w("".concat(d," failed. error:"),p),p=new Te({code:p&&p.code?p.code:M.MSG_DELETE_FAIL,message:p&&p.message?p.message:void 0}),v(p)})}},{key:"_onMessageDeleted",value:function(e){return this.get(11).onMessageDeleted(e),Q({messageList:e})}},{key:"translateText",value:function(s){var t="".concat(this._n,".").concat("translateText"),n=s.sourceTextList,o=s.sourceLanguage,s=s.targetLanguage,i=new S("translateText");return i.setMessage("sourceLanguage:".concat(o," targetLanguage:").concat(s)),this.req({proto:g.TRANSLATE_TEXT,data:{sourceTextList:n,source:o||"auto",target:s,from:this.getMyTinyID(),SDKAppID:this.getSDKAppID()}}).then(function(d){var d=d.data,r=d.error,c=d.requestID,d=d.translatedTextList;if(r.code===0)return i.end(),u.i("".concat(t," ok. requestID:").concat(c)),q({translatedTextList:d});throw l(l({},r),{},{requestID:c})}).catch(function(a){return i.setCode(a.code).setMoreMessage(a.requestID).end(),u.w("".concat(t," failed. error:"),a),v({code:M.TRANSLATE_TEXT_FAIL})})}},{key:"convertVoiceToText",value:function(s){var n=s.message,s=s.language,t=n.payload.url,n=(n.from===this.getMyUserID()&&n.flow==="out"&&(t=n.payload.remoteAudioUrl),/\.(wav|pcm|ogg-opus|speex|silk|mp3|m4a|aac|amr)/);if(!n.test(t))return v({code:M.UNSUPPORTED_VOICE_FORMAT});var n=n.exec(t)[1]||"mp3",o="16k_zh-PY",s=(s?s==="zh (cmn-Hans-CN)"?o="16k_zh":s==="en-US"?o="16k_en":s==="yue-Hant-HK"?o="16k_yue":s==="ja-JP"&&(o="16k_ja"):o="16k_zh-PY","serviceType:".concat(o," url:").concat(t)),i="".concat(this._n,".").concat("convertVoiceToText"),a=(u.i("".concat(i," ").concat(s)),new S("convertVoiceToText"));return a.setMessage(s),this.req({proto:g.VOICE_TO_TEXT,data:{url:t,language:o,SDKAppID:this.getSDKAppID(),format:n}}).then(function(p){var p=p.data,c=p.error,d=p.requestID,p=p.result;if(c.code===0)return a.end(),u.i("".concat(i," ok. requestID:").concat(d)),q({result:p});throw l(l({},c),{},{requestID:d})}).catch(function(r){return a.setCode(r.code).setMoreMessage(r.requestID||"").end(),u.w("".concat(i," failed. error:"),r),v({code:M.VOICE_TO_TEXT_FAIL})})}},{key:"modifyRemoteMessage",value:function(e){var t=this,n=null,o=e.conversationType,s=e.to,i=this.get(7);if(!i)return this._onCannotFindModule();if(i.isMessageFromOrToAVChatroom(s))return v({code:M.MSG_MODIFY_DISABLED_IN_AVCHATROOM,data:{message:e}});if(this.get(29).filterMessage(e)===!1)return e.hasRiskContent=!0,v({code:M.PROFANITY_FOUND,data:{message:e}});o===_.CONV_C2C?n=this.get(6):o===_.CONV_GROUP&&(n=this.get(7));var a=new S("modifyMessage"),r=(a.setMessage("to:".concat(s)),"".concat(this._n,".modifyRemoteMessage"));return n.modifyRemoteMessage(e).then(function(c){return a.end(),u.i("".concat(r," ok")),c=t._onModifyRemoteMessageResp(e,c.data),q({message:c})}).catch(function(c){var d;return a.setCode(c.code).setMoreMessage(c.message).end(),u.w("".concat(r," failed. error:"),c),c.code===20027?(d=t._onModifyRemoteMessageResp(e,c.data),v({code:M.MSG_MODIFY_CONFLICT,data:{message:d}})):v({code:c.code,message:c.message,data:{message:e}})})}},{key:"_generateSearchdata",value:function(s){var t=s.conversationID,n=s.timePosition,o=s.timePeriod,s=Z(s,Iu);return C(t)||(dt(t)&&(s.account=t.replace(_.CONV_C2C,"")),at(t)&&(s.groupID=t.replace(_.CONV_GROUP,""))),fe(o)&&0<o&&(fe(n)&&0<n?s.startTime=n-o:s.startTime=Mn()-o),s.startTime&&s.startTime<0&&(s.startTime=void 0),fe(n)&&0<n&&(s.endTime=n),s}},{key:"searchCloudMessages",value:function(e){var t=this,n="searchCloudMessages",o="".concat(this._n,".").concat(n);if(!e)return v({code:M.OPTIONS_IS_EMPTY,message:this.getErrorMessage(M.OPTIONS_IS_EMPTY,n)});var s=e.keywordList,i=e.keywordListMatchType,a=e.conversationID,r=e.cursor,c=F(e.senderUserIDList)&&0<e.senderUserIDList.length,d=F(e.messageTypeList)&&0<e.messageTypeList.length;if(!s&&!c&&!d)throw u.e("[".concat(n,'] Missing required params: "keywordList".')),new Error("Params validate failed.");var p=Date.now(),h=new S(n),m="keywordList:".concat(s," keywordListMatchType:").concat(i," ")+"conversationID:".concat(a," cursor:").concat(r);return u.l("".concat(o," ").concat(m)),this.req({proto:g.MSG_CLOUD_SEARCH,data:this._generateSearchdata(e)}).then(function(k){var N=k.data,I=N.code,N=N.message;if(I!==0)return N=t.getErrorMessage(I===60020?"SearchCloudMessagesUnavailable":I)||N,I=new Te({code:I,message:N}),h.setMessage(m).setError(I).end(),v(I);t.get(27).isSearchCloudMessagesEnabled();var N=k.data,I=N.cursor,k=N.totalCount,N=N.searchResult,x="totalCount:".concat(k," cost:").concat(Ke(p)),x=(u.l("".concat(o," ok. cursor:").concat(I," ").concat(x)),h.setMessage("".concat(m," ").concat(x)).end(),t._handleSearchResults(N,!e.conversationID));return q({searchResultList:x,cursor:I,totalCount:k})}).catch(function(f){return h.setMessage(m).setError(f).end(),v(f)})}},{key:"_handleSearchResults",value:function(e,t){var n=this.get(11);return F(e)&&e.length!==0?e.map(function(a){var s=a.groupID,r=a.userID,i=a.messageCount,a=a.messageList,r=s?"".concat(_.CONV_GROUP).concat(s):"".concat(_.CONV_C2C).concat(r),c={conversationID:r,messageCount:i,messageList:[]};return t&&1<i||a&&0<a.length&&(i=n.onRoamingMessage(a,r,!1),s&&i.reverse(),c.messageList=i),c}):[]}},{key:"_onModifyRemoteMessageResp",value:function(r,p){u.d("".concat(this._n,"._onModifyRemoteMessageResp options:"),p);var n=r.conversationType,o=r.from,s=r.to,i=r.random,a=r.sequence,r=r.time,c=p.elements,d=p.messageVersion,p=p.cloudCustomData,p=p===void 0?"":p;return this.get(11).onMessageModified({conversationType:n,from:o,to:s,time:r,random:i,sequence:a,elements:c,cloudCustomData:p,messageVersion:d})}},{key:"_generateUUID",value:function(n){var t=this.get(12),t="".concat(t.getSDKAppID(),"-").concat(t.getUserID(),"-").concat(wa()),n=n.name||n.value||n.url||n.tempFilePath,n=n&&n.slice(n.lastIndexOf(".")+1);return t=n?"".concat(t,".").concat(n):t}},{key:"getMessageOption",value:function(e){return this._messageOptionsMap.get(e)}},{key:"_getNickAndAvatarByUserID",value:function(e){return this.get(4).getNickAndAvatarByUserID(e)}},{key:"_getNameCardByGroupID",value:function(e){if(e.conversationType===_.CONV_GROUP){var t=this.get(7);if(t)return t.getMyNameCardByGroupID(e.to)}return""}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._messageOptionsMap.clear()}}]),_o),yu=(z(po,Oe),kr=X(po),R(po,[{key:"onMessageExtensionNotify",value:function(i){var t=this,i=i.dataList,r=i.messageInfo,n=i.operateType,o=i.operateResultList,s=i.tinyID,i=i.globalSequence,a=r.clientTime,r=r.random,c="".concat(s,"-").concat(a,"-").concat(r),d=[],p=[],h=(u.l("".concat(this._n,".onMessageExtensionNotify messageID:").concat(c," operateType:").concat(n," globalSequence:").concat(i)),this._updateGlobalSequence(c,i),!1),m=!1;o.forEach(function(f){var I=f.extensions,I=I===void 0?[]:I,k=f.clearSequence;n===1?(h=!0,I.forEach(function(N){d.push({key:N.key,value:N.value})}),t._updateLocalExtension(c,I)):n===2?(m=!0,I.forEach(function(N){p.push(N.key)}),t._updateLocalExtension(c,I)):n===3&&(m=!0,t._hasLocalExtension(c)&&t._getLocalExtension(c).forEach(function(N,x){N.seq<=k&&!G(N.value)&&p.push(x)}),t._clearLocalExtension(c,k))}),h&&this.emitOuterEvent(V.MESSAGE_EXTENSIONS_UPDATED,{messageID:c,extensions:d}),m&&this.emitOuterEvent(V.MESSAGE_EXTENSIONS_DELETED,{messageID:c,keyList:p})}},{key:"setMessageExtensions",value:function(e,d){var n="setMessageExtensions";if(!this.canIUse(de.MSG_EXT))return this.cannotUseCommercialAbility(n);var o="".concat(this._n,".").concat(n),s=e.ID,i=e.conversationID,a=e.sequence,r=e.time,c=b(d),d=(20<d.length&&(c=d.slice(0,20),u.w("".concat(o,". the length of extensions cannot exceed 20."))),"conversationID:".concat(i," messageID:").concat(s," sequence:").concat(a," time:").concat(r," count:").concat(c.length)),p=new S(n);return p.setMessage(d),u.l("".concat(o," ").concat(d)),this._modifyMessageExtensions(e,c).then(function(f){var m=f.resultList,I=f.successCount,f=f.failureCount,I="success count:".concat(I," fail count:").concat(f);return p.setMoreMessage(I).end(),u.l("".concat(o," ok. ").concat(I)),q({extensions:m})}).catch(function(h){return p.setError(h).end(),u.e("".concat(o," failed. error:"),h),v(h)})}},{key:"getMessageExtensions",value:function(e){var t=this,n="getMessageExtensions";if(!this.canIUse(de.MSG_EXT))return this.cannotUseCommercialAbility(n);var o="".concat(this._n,".").concat(n),s=e.ID,r=e.conversationID,i=e.sequence,a=e.time,r="conversationID:".concat(r," messageID:").concat(s," sequence:").concat(i," time:").concat(a),c=new S(n),d=(c.setMessage(r),u.l("".concat(o," ").concat(r)),void 0);return this.getMessageExtensionsMap.has(s)&&(d=this._getGlobalSequence(s)),this._getMessageExtensions(e,d).then(function(p){return c.end(),u.l("".concat(o," ok. total count:").concat(p.length)),C(d)&&0<p.length&&t.getMessageExtensionsMap.set(s,1),q({extensions:p})}).catch(function(p){return c.setError(p).end(),u.e("".concat(o," failed. error:"),p),v(p)})}},{key:"deleteMessageExtensions",value:function(e,a){var n="deleteMessageExtensions";if(!this.canIUse(de.MSG_EXT))return this.cannotUseCommercialAbility(n);var o="".concat(this._n,".").concat(n),s=[],i=3,a=(G(a)||(i=2,a.forEach(function(h){s.push({key:h,value:"",seq:0})})),e.ID),d=e.conversationID,r=e.sequence,c=e.time,d="conversationID:".concat(d," messageID:").concat(a," sequence:").concat(r," time:").concat(c," operateType:").concat(i),p=new S(n);return p.setMessage(d),u.l("".concat(o," ").concat(d)),this._modifyMessageExtensions(e,s,i).then(function(I){var m=I.resultList,f=I.successCount,I=I.failureCount,k="";return i===2&&(k="success count:".concat(f," fail count:").concat(I)),p.setMoreMessage("".concat(k)).end(),u.l("".concat(o," ok. ").concat(k)),q({extensions:m})}).catch(function(h){return p.setError(h).end(),u.e("".concat(o," failed. error:"),h),v(h)})}},{key:"_modifyMessageExtensions",value:function(e,t){var n=this,o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,s=Ve(e.to)?_.CONV_TOPIC:e.conversationType,i=void 0,a=(o!==3&&(i=this._getRequestExtensions(e,t)),null);switch(s){case _.CONV_C2C:a=this.get(6);break;case _.CONV_GROUP:a=this.get(7);break;case _.CONV_TOPIC:a=this.get(10);break;default:return v({code:M.CANNOT_FIND_MODULE})}return a.modifyMessageExtensions(e,i,o).then(function(d){var d=d.data,c=d.extensions,d=d.seq,p=[],h=0,m=0,f=[];return(c=G(c)?[]:c).forEach(function(Y){var k=Y.errorCode,Y=Y.extension,N=Y.key,x=Y.value,Y=Y.seq;p.push({code:k,key:N,value:x}),k===0?h++:m++,f.push({key:N,value:x,seq:Y})}),n._updateGlobalSequence(e.ID,d),0<f.length&&(n._updateLocalExtension(e.ID,f),f=null),{resultList:p,successCount:h,failureCount:m}}).catch(function(r){return v(r)})}},{key:"_getRequestExtensions",value:function(e,t){var n,o=[];return this._hasLocalExtension(e.ID)?(n=this._getLocalExtension(e.ID),t.forEach(function(a){var i=a.key,a=a.value,r=0;n.has(i)&&(r=n.get(i).seq),o.push({key:i,value:a,seq:r})})):t.forEach(function(a){var i=a.key,a=a.value;o.push({key:i,value:a,seq:0})}),o}},{key:"_getMessageExtensions",value:function(e,t){var n=this,o="".concat(this._n,"._getMessageExtensions"),s=e.ID,i=e.to,a=null;switch(Ve(i)?_.CONV_TOPIC:e.conversationType){case _.CONV_C2C:a=this.get(6);break;case _.CONV_GROUP:a=this.get(7);break;case _.CONV_TOPIC:a=this.get(10);break;default:return v({code:M.CANNOT_FIND_MODULE})}return a.getMessageExtensions(e,t).then(function(p){var p=p.data,h=p.extensions,c=p.completeFlag,d=p.globalSequence,p=p.clearSequence,h=G(h)?[]:h;return u.l("".concat(o," ok. completeFlag:").concat(c," globalSequence:").concat(d," clearSequence:").concat(p," count:").concat(h.length)),n._updateLocalExtension(s,h),n._clearLocalExtension(s,p),n._updateGlobalSequence(s,d),c!==1?(p=h.slice(-1)[0].seq+1,n._getMessageExtensions(e,p)):n._getLocalExtensions(s)}).catch(function(r){return v(r)})}},{key:"_hasLocalExtension",value:function(e){return this.messageExtensionMap.has(e)}},{key:"_getLocalExtension",value:function(e){return this.messageExtensionMap.get(e)}},{key:"_updateLocalExtension",value:function(e,t){this._hasLocalExtension(e)||this.messageExtensionMap.set(e,new Map);var n=this._getLocalExtension(e);t.forEach(function(a){var s=a.key,i=a.value,a=a.seq;n.set(s,{value:i===void 0?"":i,seq:a})})}},{key:"_clearLocalExtension",value:function(e,t){var n;t<=0||!this._hasLocalExtension(e)||(n=this._getLocalExtension(e)).forEach(function(o,s){o.seq<=t&&n.delete(s)})}},{key:"_getLocalExtensions",value:function(e){var t=[];return this._hasLocalExtension(e)&&this._getLocalExtension(e).forEach(function(n,o){n=n.value,G(n)||t.push({key:o,value:n})}),t}},{key:"_getGlobalSequence",value:function(e){return this.globalSeqMap.get(e)}},{key:"_updateGlobalSequence",value:function(e,t){this.globalSeqMap.set(e,t)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this.messageExtensionMap.clear(),this.globalSeqMap.clear(),this.getMessageExtensionsMap.clear()}}]),po),Au=(z(lo,Oe),Er=X(lo),R(lo,[{key:"onMessageReactionNotifyList",value:function(n){var t=this,n=(n||{}).dataList;(n===void 0?[]:n).forEach(function(s){var a=s.C2CMessageInfo,r=s.groupMessageInfo,r=r===void 0?{}:r,s=s.reactionList,s=s===void 0?[]:s,a=l(l({},a===void 0?{}:a),r),r=a.tinyID,i=a.clientTime,a=a.random,r="".concat(r,"-").concat(i,"-").concat(a),c=[];s.forEach(function(d){C(d.userIDList)&&(d.userIDList=[],d.count=0),c.push.apply(c,b(d.userIDList))}),u.l("".concat(t._n,".onMessageReactionNotifyList messageID:").concat(r," reactionList:").concat(s.length)),t._handleReactionSummary([{messageID:r,reactionList:s}],c).then(function(d){t.emitOuterEvent(V.MESSAGE_REACTIONS_UPDATED,l({},d[0]))})})}},{key:"onMessageReactionNotify",value:function(n){var n=n.dataList||{},o=n.C2CMessageInfo,s=n.groupMessageInfo,s=s===void 0?{}:s,t=n.reactionID,n=n.operateType,o=l(l({},o===void 0?{}:o),s),s=o.tinyID,i=o.clientTime,o=o.random,s="".concat(s,"-").concat(i,"-").concat(o),i=(u.l("".concat(this._n,".onMessageReactionNotify messageID:").concat(s," reactionID:").concat(t," operateType:").concat(n)),n===1?this._addReactedByMyselfMap(s,t):this._removeReactedByMyselfMap(s,t),"".concat(s,"-").concat(t));this._reactionInfoMap.has(i)&&((o=this._reactionInfoMap.get(i)).reactedByMyself=n===1,this.emitOuterEvent(V.MESSAGE_REACTIONS_UPDATED,{messageID:s,reactionList:[o]}))}},{key:"addMessageReaction",value:function(e,t){var n=this,o="addMessageReaction";if(!this.canIUse(de.MSG_REACTION))return this.cannotUseCommercialAbility(o);var s="".concat(this._n,".").concat(o),r=e.ID,i=e.conversationID,i="conversationID:".concat(i," messageID:").concat(r," reactionID:").concat(t),a=new S(o),r=(a.setMessage(i),u.l("".concat(s," ").concat(i)),this._createReactionOperationPack(e,t,1));return this._addReactedByMyselfMap(e.ID,t),this.req(r).then(function(){return a.end(),u.l("".concat(s," ok.")),q()}).catch(function(c){return n._removeReactedByMyselfMap(e.ID,t),a.setError(c).end(),u.e("".concat(s," failed. error:"),c),v(c)})}},{key:"removeMessageReaction",value:function(e,t){var n="removeMessageReaction";if(!this.canIUse(de.MSG_REACTION))return this.cannotUseCommercialAbility(n);var o="".concat(this._n,".").concat(n),a=e.ID,s=e.conversationID,s="conversationID:".concat(s," messageID:").concat(a," reactionID:").concat(t),i=new S(n),a=(i.setMessage(s),u.l("".concat(o," ").concat(s)),this._createReactionOperationPack(e,t,2));return this._removeReactedByMyselfMap(e.ID,t),this.req(a).then(function(){return i.end(),u.l("".concat(o," ok.")),q()}).catch(function(r){return i.setError(r).end(),u.e("".concat(o," failed. error:"),r),v(r)})}},{key:"getMessageReactions",value:function(e){var t=this,n="getMessageReactions";if(!this.canIUse(de.MSG_REACTION))return this.cannotUseCommercialAbility(n);var o="".concat(this._n,".").concat(n),s=e.messageList,c=e.maxUserCountPerReaction,i=s[0].conversationID,i="conversationID:".concat(i," maxUserCountPerReaction:").concat(c," messageList:").concat(s.length),a=new S(n),r=(a.setMessage(i),u.l("".concat(o," ").concat(i)),new Map),c=this._createReactionSummaryPack(l(l({},e),{},{messageIDMap:r}));return this.req(c).then(function(p){var p=p.data.resultList,h=[],m=[];return(p===void 0?[]:p).forEach(function(k){var I=k.messageKey,I=I===void 0?void 0:I,N=k.messageSequence,N=N===void 0?void 0:N,k=k.reactionList,k=k===void 0?[]:k,N=C(I)?r.get(N):r.get(I);h.push({messageID:N,reactionList:k}),k.forEach(function(x){m.push.apply(m,b(x.userIDList))})}),t._handleReactionSummary(h,m)}).then(function(d){return a.end(),u.l("".concat(o," ok.")),r.clear(),q({resultList:d})}).catch(function(d){return a.setError(d).end(),u.e("".concat(o," failed. error:"),d),v(d)})}},{key:"getAllUserListOfMessageReaction",value:function(e){var t=this,n="getAllUserListOfMessageReaction";if(!this.canIUse(de.MSG_REACTION))return this.cannotUseCommercialAbility(n);var o="".concat(this._n,".").concat(n),r=e.message,s=e.reactionID,i=e.nextSeq,a=e.count,p=r.ID,r=r.conversationID,r="conversationID:".concat(r," messageID:").concat(p," reactionID:").concat(s," nextSeq:").concat(i," count:").concat(a),c=new S(n),d=(c.setMessage(r),u.l("".concat(o," ").concat(r)),{userList:[],nextSeq:0,isCompleted:!1}),p=this._createReactionUserListPack(e);return this.req(p).then(function(f){var f=f.data,m=f.userIDList,m=m===void 0?[]:m,f=f.nextSeq,f=f===void 0?0:f;return d.nextSeq=f,d.isCompleted=f===0,t.get(4).getUserNickAndAvatar(m)}).then(function(h){return d.userList=h,c.end(),u.l("".concat(o," ok.")),q(d)}).catch(function(h){return c.setError(h).end(),u.e("".concat(o," failed. error:"),h),v(h)})}},{key:"_createReactionOperationPack",value:function(e,a,n){var o,s,i=void 0,a={reactionID:a,userIDList:[this.getMyUserID()]};return e.conversationType===_.CONV_C2C&&(o=this.get(6),i=n===1?g.ADD_C2C_MSG_REACTION:g.RM_C2C_MSG_REACTION,a.from=e.from,a.to=e.to,a.messageKey=o.getMessageKey(e)),e.conversationType===_.CONV_GROUP&&(o=void 0,s=e.to,Ve(e.to)&&(s=Be(o=e.to)),i=n===1?g.ADD_GRP_MSG_REACTION:g.RM_GRP_MSG_REACTION,a.groupID=s,a.topicID=o,a.messageSequence=e.sequence),{proto:i,data:a}}},{key:"_createReactionSummaryPack",value:function(r){var t,n,o,s=r.messageList,i=r.maxUserCountPerReaction,i=i===void 0?10:i,a=r.messageIDMap,r=s[0],c=void 0,d=void 0;return r.conversationType===_.CONV_C2C&&(t=this.get(6),n=s.map(function(p){var h=t.getMessageKey(p);return a.set(h,p.ID),h}),c=g.GET_C2C_MSG_REACTIONS,d={from:r.from,to:r.to,messageKeyList:n,count:i}),r.conversationType===_.CONV_GROUP&&(n=void 0,o=r.to,Ve(r.to)&&(o=Be(n=r.to)),r=s.map(function(p){return a.set(p.sequence,p.ID),p.sequence}),c=g.GET_GRP_MSG_REACTIONS,d={groupID:o,topicID:n,messageSequenceList:r,count:i}),{proto:c,data:d}}},{key:"_createReactionUserListPack",value:function(o){var t=o.message,i=o.reactionID,n=o.nextSeq,o=o.count,o=o===void 0?100:o,s=void 0,i={reactionID:i,nextSeq:n===void 0?0:n,count:100<o?100:o};return t.conversationType===_.CONV_C2C&&(n=this.get(6),s=g.GET_C2C_MSG_REACTION_USER_LIST,i.from=t.from,i.to=t.to,i.messageKey=n.getMessageKey(t)),t.conversationType===_.CONV_GROUP&&(o=void 0,n=t.to,Ve(t.to)&&(n=Be(o=t.to)),s=g.GET_GRP_MSG_REACTION_USER_LIST,i.groupID=n,i.topicID=o,i.messageSequence=t.sequence),{proto:s,data:i}}},{key:"_handleReactionSummary",value:function(e,t){var n=this;return this.get(4).getUserNickAndAvatar(t).then(function(o){var s=[];return e.forEach(function(i){var a=[];i.reactionList.forEach(function(p){var c=p.reactionID,d=p.count,m=p.userIDList,p=p.reactedByMyself,p=p===void 0?void 0:p,h=[],m=(m.forEach(function(f){o.forEach(function(I){f===I.userID&&h.push(I)})}),{reactionID:c,totalUserCount:d,partialUserList:h,reactedByMyself:n._computeReactedByMyself({reactedByMyself:p,messageID:i.messageID,reactionID:c})});a.push(m),C(p)&&!n._reactedByMyselfMap.has(i.messageID)&&(d="".concat(i.messageID,"-").concat(c),n._reactionInfoMap.set(d,m))}),s.push({messageID:i.messageID,reactionList:a})}),s})}},{key:"_addReactedByMyselfMap",value:function(e,t){this._reactedByMyselfMap.has(e)||this._reactedByMyselfMap.set(e,[]),e=this._reactedByMyselfMap.get(e),e.indexOf(t)===-1&&e.push(t)}},{key:"_removeReactedByMyselfMap",value:function(e,t){!this._reactedByMyselfMap.has(e)||-1<(t=(e=this._reactedByMyselfMap.get(e)).indexOf(t))&&e.splice(t,1)}},{key:"_computeReactedByMyself",value:function(o){var t=o.reactedByMyself,n=o.messageID,o=o.reactionID;return C(t)?!!this._reactedByMyselfMap.has(n)&&this._reactedByMyselfMap.get(n).includes(o):t===1}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._reactedByMyselfMap.clear(),this._reactionInfoMap.clear()}}]),lo),Cu=(z(uo,Oe),Lr=X(uo),R(uo,[{key:"sendMessage",value:function(e){var t=this,n=this._constructMessageInstance(e);if(n===null)return v({code:M.MSG_SEND_FAIL});this._addSendMessageTotalCount(n);var o=Date.now();return this.get(11).setMessageRandom(n),this._sendComboMessage(n,e).then(function(a){var a=a.data,r=a.time,i=a.sequence,a=a.readReceiptCode,a=(fe(a)&&a!==0&&(new S("sendMessageWithReceipt").setMessage("from:".concat(n.from," to:").concat(n.to," sequence:").concat(i," readReceiptCode:").concat(a)).end(),u.w("".concat(t._n,".sendMessage readReceiptCode:").concat(a," message:").concat(t.getErrorMessage(a)))),t._addSendMessageSuccessCount(n,o),t.get(11)),r=(n.status=Et,n.time=r,n.conversationType===_.CONV_GROUP&&(n.sequence=i),a.appendToMessageList(n),n);return n._isExcludedFromLastMessage===!0&&(r=""),a.onMessageSent({conversationOptionsList:[{conversationID:n.conversationID,unreadCount:0,type:n.conversationType,subType:n.conversationSubType,lastMessage:r}]}),q({message:n})}).catch(function(s){return t._onSendMessageFailed(n,s)})}},{key:"_sendComboMessage",value:function(e,t){var n=this._m.get(20),o="";return e.conversationType===_.CONV_C2C&&(o="".concat(L.NAME.OPEN_IM,".").concat(g.SEND_C2C_MSG)),e.conversationType===_.CONV_GROUP&&(o="".concat(L.NAME.GROUP,".").concat(g.SEND_GRP_MSG)),n.sendComboMessage({servcmd:o,data:t})}},{key:"_constructMessageInstance",value:function(e){var t="".concat(this._n,"._constructMessageInstance"),n=null;try{var o,s=this.getMyUserID(),i={};i.senderTinyID=this.getMyTinyID(),i.currentUser=s,i.from=e.From_Account||s,e.GroupId?(i.conversationID="".concat(_.CONV_GROUP).concat(e.GroupId),i.conversationType=_.CONV_GROUP,i.to=e.GroupId):e.To_Account&&(i.conversationID="".concat(_.CONV_C2C).concat(e.To_Account),i.conversationType=_.CONV_C2C,i.to=e.To_Account),i.time=e.MsgTimeStamp||0,i.random=e.Random||e.MsgRandom||0,i.priority=e.MsgPriority,te(e.CloudCustomData)&&0<e.CloudCustomData.length&&(i.cloudCustomData=e.CloudCustomData),F(e.SendMsgControl)&&(i.messageControlInfo={},e.SendMsgControl.includes("NoUnread")&&(i.messageControlInfo.excludedFromUnreadCount=1),e.SendMsgControl.includes("NoLastMsg")&&(i.messageControlInfo.excludedFromLastMessage=1)),i.conversationType===_.CONV_GROUP&&F(e.To_Account)&&0<e.To_Account.length&&(o=e.To_Account,50<e.To_Account.length&&(o=e.To_Account.slice(0,50),u.w("".concat(t," To_Account must be less than or equal to 50."))),i.receiverList=b(o),e.To_Account=b(o)),e.IsNeedReadReceipt!==1&&e.NeedReadReceipt!==1||(i.needReadReceipt=!0),e.SupportMessageExtension===1&&(i.isSupportExtension=!0),(n=new We(i)).status=os,e.MsgClientTime=n.clientTime,n.conversationType===_.CONV_C2C&&(e.MsgSeq=n.sequence);for(var a,r=e.MsgBody.length,c=0;c<r;c++)(a=e.MsgBody[c]).MsgType==="TIMTextElem"?n.setTextElement(a.MsgContent.Text):a.MsgType==="TIMCustomElem"?n.setCustomElement({data:a.MsgContent.Data||"",description:a.MsgContent.Desc||"",extension:a.MsgContent.Ext||""}):a.MsgType==="TIMFaceElem"&&n.setFaceElement({index:a.MsgContent.Index,data:a.MsgContent.Data});var d=n.getElements();n.payload=d[0].content,n.type=d[0].type}catch(p){n=null,u.e("".concat(t," failed. error:"),p)}return n}},{key:"_onSendMessageFailed",value:function(e,t){return e.status=xs,this.get(11).deleteMessageRandom(e),this._addSendMessageFailCountOnUser(e,t),new S("sendMessage").setMessage("tjg_id:".concat(this.generateTjgID(e)," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to)).setError(t).end(),u.e("".concat(this._n,"._onSendMessageFailed error:"),t),v(new Te({code:t&&t.code?t.code:M.MSG_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if(e.conversationType===_.CONV_C2C)return Sn;if(e.conversationType===_.CONV_GROUP){var e=this.get(7).getLocalGroupProfile(e.to);if(e)return e=e.type,st(e)?En:Ln}}},{key:"_addSendMessageTotalCount",value:function(e){e=this._getSendMessageSpecifiedKey(e),e&&this.get(26).addTotalCount(e)}},{key:"_addSendMessageSuccessCount",value:function(o,t){var n,o=this._getSendMessageSpecifiedKey(o);o&&((n=this.get(26)).addSuccessCount(o),n.addCost(o,Ke(t,!1)))}},{key:"_addSendMessageFailCountOnUser",value:function(s,n){var n=n.code,n=n===void 0?-1:n,o=this.get(26),s=this._getSendMessageSpecifiedKey(s);Tr(n)&&s&&o.addFailedCountOfUserSide(s)}}]),uo),Tu=(z(co,Oe),Sr=X(co),R(co,[{key:"registerPlugin",value:function(e){var t=this;Object.keys(e).forEach(function(n){t.plugins[n]=e[n]}),new S("registerPlugin").setMessage("".concat(Object.keys(e))).end()}},{key:"getPlugin",value:function(e){return this.plugins[e]}},{key:"reset",value:function(){}}]),co),Du=(z(ro,Oe),Dr=X(ro),R(ro,[{key:"_onLoginSuccess",value:function(e){this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"_startSync",value:function(s){var t=this,n=s.cookie,o=s.syncFlag,s=s.isOnlineSync,i="".concat(this._n,"._startSync");u.l("".concat(i," cookie:").concat(n," syncFlag:").concat(o," isOnlineSync:").concat(s)),this.req({proto:g.SYNC_UNREAD_MSG,data:{cookie:n,syncFlag:o,isOnlineSync:s}}).then(function(a){var c=a.data,r=c.cookie,c=c.syncFlag;G(t._cookie=r)||(c===0||c===1?(t._dispatchUnreadMessage(l(l({},a.data),{},{isSyncingEnded:!1})),t._startSync({cookie:r,syncFlag:c,isOnlineSync:0})):c===2&&t._dispatchUnreadMessage(l(l({},a.data),{},{isSyncingEnded:!0})))}).catch(function(a){u.e("".concat(i," failed. error:"),a)})}},{key:"_dispatchUnreadMessage",value:function(e){e.eventArray&&this.get(20).onMessage({head:{},body:{eventArray:e.eventArray,isInstantMessage:this._onlineSyncFlag,isSyncingEnded:e.isSyncingEnded}}),this.get(6).onNewC2CMessage({dataList:e.messageList,isInstantMessage:!!e.isSyncingEnded&&this._onlineSyncFlag,C2CRemainingUnreadList:e.C2CRemainingUnreadList,C2CPairUnreadList:e.C2CPairUnreadList,isSyncingEnded:e.isSyncingEnded})}},{key:"startOnlineSync",value:function(){u.l("".concat(this._n,".startOnlineSync")),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:1})}},{key:"startSyncOnReconnected",value:function(){u.l("".concat(this._n,".startSyncOnReconnected.")),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._onlineSyncFlag=!1,this._cookie=""}}]),ro),ds={request:{toAccount:"To_Account",fromAccount:"From_Account",to:"To_Account",from:"From_Account",groupID:"GroupId",groupAtUserID:"GroupAt_Account",extension:"Ext",data:"Data",description:"Desc",elements:"MsgBody",sizeType:"Type",downloadFlag:"Download_Flag",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",videoUrl:"",imageUrl:"URL",fileUrl:"Url",uuid:"UUID",priority:"MsgPriority",receiverUserID:"To_Account",receiverGroupID:"GroupId",messageSender:"SenderId",messageReceiver:"ReceiverId",nick:"From_AccountNick",avatar:"From_AccountHeadurl",messageNumber:"MsgNum",pbDownloadKey:"PbMsgKey",downloadKey:"JsonMsgKey",applicationType:"PendencyType",userIDList:"To_Account",groupNameList:"GroupName",userID:"To_Account",groupAttributeList:"GroupAttr",mainSequence:"AttrMainSeq",avChatRoomKey:"BytesKey",attributeControl:"AttrControl",sequence:"seq",messageControlInfo:"SendMsgControl",updateSequence:"UpdateSeq",clientTime:"MsgClientTime",sequenceList:"MsgSeqList",topicID:"TopicId",customData:"CustomString",isSupportTopic:"SupportTopic",isWebUniapp:"is_web_uniapp",isSupportExtension:"SupportMessageExtension",messageSequence:"MsgSeq",messageKey:"MsgKey",startSequence:"startSeq",simplifiedMessage:"DownsizeFlag",isRelayMessage:"IsRelayMsg",reactionID:"Reaction",messageSequenceList:"MsgSeqList",messageKeyList:"MsgKeyList",cmConfigID:"CustomModerationConfigID"},response:{MsgPriority:"priority",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",Download_Flag:"downloadFlag",GroupId:"groupID",Member_Account:"userID",MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",MsgSeq:"sequence",MsgRandom:"random",MsgTime:"time",MsgTimeStamp:"time",MsgContent:"content",MsgBody:"elements",From_AccountNick:"nick",From_AccountHeadurl:"avatar",GroupWithdrawInfoArray:"revokedInfos",GroupReadInfoArray:"groupMessageReadNotice",LastReadMsgSeq:"lastMessageSeq",WithdrawC2cMsgNotify:"c2cMessageRevokedNotify",C2cWithdrawInfoArray:"revokedInfos",C2cReadedReceipt:"c2cMessageReadReceipt",ReadC2cMsgNotify:"c2cMessageReadNotice",LastReadTime:"peerReadTime",MsgRand:"random",MsgType:"type",MsgShow:"messageShow",NextMsgSeq:"nextMessageSeq",FaceUrl:"avatar",ProfileDataMod:"profileModify",Profile_Account:"userID",ValueBytes:"value",ValueNum:"value",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgFrom_AccountExtraInfo:"messageFromAccountExtraInformation",Operator_Account:"operatorID",OpType:"operationType",ReportType:"operationType",UserId:"userID",User_Account:"userID",List_Account:"userIDList",MsgOperatorMemberExtraInfo:"operatorInfo",MsgMemberExtraInfo:"memberInfoList",ImageUrl:"avatar",NickName:"nick",MsgGroupNewInfo:"newGroupProfile",MsgAppDefinedData:"groupCustomField",Owner_Account:"ownerID",GroupFaceUrl:"avatar",GroupIntroduction:"introduction",GroupNotification:"notification",GroupApplyJoinOption:"joinOption",MsgKey:"messageKey",GroupInfo:"groupProfile",ShutupTime:"muteTime",Desc:"description",Ext:"extension",GroupAt_Account:"groupAtUserID",MsgNum:"messageNumber",PbMsgKey:"pbDownloadKey",JsonMsgKey:"downloadKey",MsgModifiedFlag:"isModified",PendencyItem:"applicationItem",PendencyType:"applicationType",AddTime:"time",AddSource:"source",AddWording:"wording",ProfileImImage:"avatar",PendencyAdd:"friendApplicationAdded",FrienPencydDel_Account:"friendApplicationDeletedUserIDList",Peer_Account:"userID",GroupAttr:"groupAttributeList",GroupAttrAry:"groupAttributeList",AttrMainSeq:"mainSequence",seq:"sequence",GroupAttrOption:"groupAttributeOption",BytesChangedKeys:"changedKeyList",GroupAttrInfo:"groupAttributeList",GroupAttrSeq:"mainSequence",PushChangedAttrValFlag:"isWithChangedAttributeInfo",SubKeySeq:"sequence",Val:"value",MsgGroupFromCardName:"senderNameCard",MsgGroupFromNickName:"senderNick",C2cNick:"peerNick",C2cImage:"peerAvatar",SendMsgControl:"messageControlInfo",NoLastMsg:"excludedFromLastMessage",NoUnread:"excludedFromUnreadCount",UpdateSeq:"updateSequence",MuteNotifications:"muteFlag",MsgClientTime:"clientTime",TinyId:"tinyID",GroupMsgReceiptList:"readReceiptList",ReadNum:"readCount",UnreadNum:"unreadCount",TopicId:"topicID",MillionGroupFlag:"communityType",SupportTopic:"isSupportTopic",MsgTopicNewInfo:"newTopicInfo",ShutupAll:"muteAllMembers",CustomString:"customData",TopicFaceUrl:"avatar",TopicIntroduction:"introduction",TopicNotification:"notification",TopicIdArray:"topicIDList",MsgVersion:"messageVersion",C2cMsgModNotifys:"c2cMessageModified",GroupMsgModNotifys:"groupMessageModified",ApplyJoinOption:"joinOption",MsgFlag:"messageRemindType",AtInfoList:"groupAtInfoList",AtFlagList:"groupAtType",AtMsgSeq:"sequence",BanDuration:"duration",BanDescription:"reason",NotVisible:"invisible",BytesTag:"tag",BytesValue:"value",RptBytesValue:"value",LatestSeq:"globalSequence",ClearSeq:"clearSequence",SupportMessageExtension:"isSupportExtension",ExtensionList:"extensions",GroupCounter:"counterList",Revoker_Account:"revoker",MsgExtensionNotify:"messageExtensionNotify",ExtensionC2cMsgInfo:"messageInfo",ExtensionGroupMsgInfo:"messageInfo",MsgOptType:"operateType",SetKVInfo:"operateResultList",DeleteKVInfo:"operateResultList",ClearKVInfo:"operateResultList",MsgKeyValue:"extensions",ClearMsgSeq:"clearSequence",MsgLastSeq:"globalSequence",InviteJoinOption:"inviteOption",MemberList_Account:"inviteeList",MsgMemberExtraInfoList:"inviteeInfoList",E:"event",GInf:"groupProfile",MCT:"clientTime",MR:"random",MP:"priority",MTS:"time",GId:"groupID",MS:"sequence",CCD:"cloudCustomData",F_Account:"from",F_Hd:"avatar",F_NN:"nick",GN:"groupName",GT:"groupType",IsSys:"isSystemMessage",OpInf:"operatorInfo",Img:"avatar",NN:"nick",OnlineInf:"onlineMemberInfo",ET:"expireTime",Num:"onlineMemberNum",Opt:"operationType",O_Account:"operatorID",RT:"operationType",UDF:"userDefinedField",L_Account:"userIDList",IsPlaceMsg:"isPlaceMessage",MsgCheckResult:"checkResult",Results:"resultList",Reaction:"reactionID",Reaction_Account:"userIDList",MsgReactionNotifyList:"messageReactionNotifyList",MsgReactionNotify:"messageReactionNotify",MsgReactionSummary:"reactionList",C2CMsgInfo:"C2CMessageInfo",GroupMsgInfo:"groupMessageInfo",int32_err_code:"errorCode",str_err_msg:"errorMsg",MsgDropReason:"messageDropReason",ReactedByMe:"reactedByMyself",Level:"messageRemindType"},ignoreKeyWord:["C2C","ID","USP"]};function ro(e){return D(this,ro),(e=Dr.call(this,e))._n="SyncUnreadMessageModule",e._cookie="",e._onlineSyncFlag=!1,e.getInnerEmitterInstance().on(Re.A2KEY_AND_TINYID_UPDATED,e._onLoginSuccess,K(e)),e}function co(e){return D(this,co),(e=Sr.call(this,e))._n="PluginModule",e.plugins={},e}function uo(e){return D(this,uo),(e=Lr.call(this,e))._n="ComboMessageModule",e}function lo(e){return D(this,lo),(e=Er.call(this,e))._n="MessageReactionModule",e._reactedByMyselfMap=new Map,e._reactionInfoMap=new Map,e}function po(e){return D(this,po),(e=kr.call(this,e))._n="MessageExtensionModule",e.messageExtensionMap=new Map,e.globalSeqMap=new Map,e.getMessageExtensionsMap=new Map,e}function _o(e){return D(this,_o),(e=Rr.call(this,e))._n="MessageModule",e._messageOptionsMap=new Map,e._mergerMessageHandler=new hu(K(e)),e}function Bi(e,t){if(typeof e!="string"&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");return t=Object.assign({pascalCase:!1},t),(e=Array.isArray(e)?e.map(function(n){return n.trim()}).filter(function(n){return n.length}).join("-"):e.trim()).length===0?"":e.length===1?t.pascalCase?e.toUpperCase():e.toLowerCase():(e=e=(e=e!==e.toLowerCase()?Su(e):e).replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,function(n,o){return o.toUpperCase()}).replace(/\d+(\w|$)/g,function(n){return n.toUpperCase()}),t.pascalCase?e.charAt(0).toUpperCase()+e.slice(1):e)}var Su=function(e){for(var t=!1,n=!1,o=!1,s=0;s<e.length;s++){var i=e[s];t&&/[a-zA-Z]/.test(i)&&i.toUpperCase()===i?(e=e.slice(0,s)+"-"+e.slice(s),o=n,n=!(t=!1),s++):n&&o&&/[a-zA-Z]/.test(i)&&i.toLowerCase()===i?(e=e.slice(0,s-1)+"-"+e.slice(s-1),o=n,t=!(n=!1)):(t=i.toLowerCase()===i&&i.toUpperCase()!==i,o=n,n=i.toUpperCase()===i&&i.toLowerCase()!==i)}return e};function Lu(e,t){var n=0;return function o(s,i){return 100<++n?(n--,s):F(s)?(a=s.map(function(p){return Ht(p)?o(p,i):p}),n--,a):Ht(s)?(r=s,c=function(p,h){if(!ba(h))return!1;if(h!==Bi(h))for(var m=0;m<ds.ignoreKeyWord.length&&!h.includes(ds.ignoreKeyWord[m]);m++);var f;return C(i[h])?(f=h)==="OPPOChannelID"?f:f[0].toUpperCase()+Bi(f).slice(1):i[h]},d=Object.create(null),Object.keys(r).forEach(function(p){var h=c(r[p],p);h&&(d[h]=r[p])}),a=xa(a=d,function(p,h){return F(p)||Ht(p)?o(p,i):p}),n--,a):void 0;var a,r,c,d}(e,t)}for(var Nr,Hi=String.fromCharCode,Eu=function(e){var t=0|e.charCodeAt(0);if(55296<=t)if(t<56320)if(e=0|e.charCodeAt(1),56320<=e&&e<=57343){if(65535<(t=(t<<10)+e-56613888|0))return Hi(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}else t=65533;else t<=57343&&(t=65533);return t<=2047?Hi(192|t>>>6,128|63&t):Hi(224|t>>>12,128|t>>>6&63,128|63&t)},Ki=function(e){for(var t=e===void 0?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,Eu),n=0|t.length,o=new Uint8Array(n),s=0;s<n;s=s+1|0)o[s]=0|t.charCodeAt(s);return o},ku=(R(Xi,[{key:"getID",value:function(){return this._id}},{key:"_onOpen",value:function(e){this._handler.onOpen({id:this._id,res:JSON.stringify(e)})}},{key:"_onClose",value:function(e){this._handler.onClose({id:this._id,e})}},{key:"_onMessage",value:function(e){e=this._canIUseBinaryFrame?this._isAppCompressedData(e.data)?this._handler.inflate(e.data):function(t){for(var n=new Uint8Array(t),o="",s=0,i=n.length;s<i;){var a=n[s],r=0,c=0;if(a<=127?(r=0,c=255&a):a<=223?(r=1,c=31&a):a<=239?(r=2,c=15&a):a<=244&&(r=3,c=7&a),0<i-s-r)for(var d=0;d<r;)c=c<<6|63&(a=n[s+d+1]),d+=1;else c=65533,r=i-s;o+=String.fromCodePoint(c),s+=r+1}return o}(e.data):e.data,this._handler.onMessage({data:e})}},{key:"_isAppCompressedData",value:function(e){return e=new Uint8Array(e),e[0]===67&&e[1]===79&&e[2]===77&&e[3]===80}},{key:"_onError",value:function(e){this._handler.onError({id:this._id,e})}},{key:"setIsWorkerEnabled",value:function(e){this._isWorkerEnabled=!0}},{key:"close",value:function(e){if(this._workerSocket&&(this._workerSocket.postMessage({cmd:"stop",code:e}),this._workerSocket.terminate(),this._workerSocket=null),gt)return ce.offSocketClose(),ce.offSocketMessage(),ce.offSocketOpen(),ce.offSocketError(),void ce.closeSocket();this._socket&&(ge?(this._socket.onClose(function(){}),this._socket.onOpen(function(){}),this._socket.onMessage(function(){}),this._socket.onError(function(){})):qe&&(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null),Zt?this._socket.close({code:e}):this._socket.close(e),this._socket=null)}},{key:"send",value:function(e){this._workerSocket?this._workerSocket.postMessage({cmd:"sendMessage",data:this._canIUseBinaryFrame?Ki(e.data).buffer:e.data}):gt?ce.sendSocketMessage({data:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}}):this._socket&&(ge?this._socket.send({data:this._canIUseBinaryFrame?Ki(e.data).buffer:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}}):qe&&this._socket.send(this._canIUseBinaryFrame?Ki(e.data):e.data))}}]),Xi),Ru=["keyMap"],Nu=["keyMap"],go="connected",Or="connecting",Rn="disconnected",Ou=(R(zi,[{key:"_setWebsocketHost",value:function(){var e=this._chM.get(12);this._currentSite=nt,this._chM.isOversea()&&(this._currentSite="OVERSEA"),e.isSingaporeSite()?this._currentSite="SINGAPORE":e.isKoreaSite()?this._currentSite="KOREA":e.isGermanySite()?this._currentSite="GERMANY":e.isIndiaSite()?this._currentSite="IND":e.isJapanSite()?this._currentSite="JPN":e.isUSASite()?this._currentSite="USA":e.isIndonesiaSite()&&(this._currentSite="INDONESIA"),L.HOST.setCurrent(this._currentSite)}},{key:"_initConnection",value:function(){C(L.HOST.CURRENT.BACKUP)||this._url===""?this._url=L.HOST.CURRENT.DEFAULT:this._url===L.HOST.CURRENT.DEFAULT?this._url=L.HOST.CURRENT.BACKUP:this._url===L.HOST.CURRENT.BACKUP?this._url=this._canIUseAnyCast()?L.HOST.CURRENT.ANYCAST:L.HOST.CURRENT.DEFAULT:this._url===L.HOST.CURRENT.ANYCAST&&(L.HOST.CURRENT.ANYCAST="",this._url=L.HOST.CURRENT.DEFAULT);var e=this._chM.get(12),t=e.getProxyServer();G(t)||(this._url=t),e.isTestEnv()&&(this._url=Ne.TEST[this._currentSite].DEFAULT),this._connect(),this._nextPingTs=0}},{key:"_canIUseAnyCast",value:function(){return qe&&L.HOST.CURRENT.ANYCAST}},{key:"onCheckTimer",value:function(e){e%1==0&&(this._checkPromiseMap(),this._checkNativeAppWS())}},{key:"_checkPromiseMap",value:function(){var e=this;this._promiseMap.size!==0&&this._promiseMap.forEach(function(s,n){var o=s.reject,s=s.timestamp,i=15e3;n.indexOf(g.LOGIN)!==-1?i=9e4:n.indexOf(g.PING)!==-1&&(i=3e3),Date.now()-s>=i&&(u.l("".concat(e._n,"._checkPromiseMap request timeout, delete requestID:").concat(n)),e._promiseMap.delete(n),o(new Te({code:M.NETWORK_TIMEOUT})),e._chM.onRequestTimeout())})}},{key:"_checkNativeAppWS",value:function(){ze&&!this.isConnected()&&this._reConnect()}},{key:"onOpen",value:function(e){var t,n;this._readyState!==Rn&&(this._onOpenTs=Date.now(),n=e.id,e=e.res,this._socketID=n,t=Ke(this._startTs,!1),n="socketID:".concat(n," res:").concat(e),u.l("".concat(this._n,"._onOpen cost:").concat(t," ms. ").concat(n)),new S("wsOnOpen").setMessage(t).setCostTime(t).setMoreMessage(n).end(),this._readyState=go,this._reConnectCount=0,this._resend(),this._reConnectFlag===!0&&(this._chM.onReconnected(),this._reConnectFlag=!1),this._chM.onOpen())}},{key:"onClose",value:function(o){var t=new S("wsOnClose"),n=o.id,o=o.e,s="sourceSocketID:".concat(n," currentSocketID:").concat(this._socketID," code:").concat(o.code," reason:").concat(o.reason),i=0;this._onOpenTs!==0&&(i=Date.now()-this._onOpenTs),t.setMessage(i).setCostTime(i).setMoreMessage(s).setCode(o.code).end(!0),u.l("".concat(this._n,"._onClose ").concat(s," onlineTime:").concat(i)),n===this._socketID&&(this._readyState=Rn,i<1e3?this._chM.onReconnectFailed():this._chM.onClose())}},{key:"onError",value:function(n){var t=n.id,n=n.e,o="sourceSocketID:".concat(t," currentSocketID:").concat(this._socketID);new S("wsOnError").setMessage(n.errMsg||Fa(n)).setMoreMessage(o).setLevel("error").end(!0),u.w("".concat(this._n,"._onError"),n,o),t===this._socketID&&(this._readyState=Rn,this._chM.onError())}},{key:"onMessage",value:function(e){var t;try{t=JSON.parse(e.data)}catch{new S("jsonParseError").setMessage(e.data).end()}if(t&&t.head){var n,o,s,e=this._getRequestIDFromHead(t.head),i=t.body;if(this._chM.get(30).isTRTCCommand(e)||(s=Gs(t.head),i=function r(c,d){return F(c)?c.map(function(f){return Ht(f)?r(f,d):f}):Ht(c)?(p=c,h=function(f,I){return C(d[I])?Bi(I):d[I]},m={},Object.keys(p).forEach(function(f){m[h(p[f],f)]=p[f]}),xa(m,function(f){return F(f)||Ht(f)?r(f,d):f})):void 0;var p,h,m}(t.body,this._getResponseKeyMap(s))),u.d("".concat(this._n,".onMessage ret:").concat(JSON.stringify(i)," requestID:").concat(e," has:").concat(this._promiseMap.has(e))),this._setNextPingTs(),this._promiseMap.has(e))return n=(s=this._promiseMap.get(e)).resolve,o=s.reject,s=s.timestamp,this._promiseMap.delete(e),this._calcRTT(s),void(i.errorCode&&i.errorCode!==0?(this._chM.onErrorCodeNotZero(i),o(new Te({code:i.errorCode,message:i.errorInfo||"",data:e.includes(g.MODIFY_C2C_MSG)||e.includes(g.MODIFY_GRP_MSG)?{elements:i.elements,messageVersion:i.messageVersion,cloudCustomData:i.cloudCustomData}:void 0}))):n(q(i)));this._chM.onMessage({head:t.head,body:i})}}},{key:"_calcRTT",value:function(e){e=Date.now()-e,this._chM.get(26).addRTT(e)}},{key:"_connect",value:function(){this._startTs=Date.now(),this._onOpenTs=0,this._socket=new ku(this),this._socketID=this._socket.getID(),this._readyState=Or,u.l("".concat(this._n,"._connect isWorkerEnabled:").concat(this.getIsWorkerEnabled()," socketID:").concat(this._socketID," url:").concat(this.getURL())),new S("wsConnect").setMessage("socketID:".concat(this._socketID," url:").concat(this.getURL())).end()}},{key:"getURL",value:function(){this._chM.isDevMode()&&(this._canIUseBinaryFrame=!1);var e=Ba(),t=((gt||_t&&e==="windows"||ze)&&(this._canIUseBinaryFrame=!1),-1),o=(e==="ios"?t=Ls||-1:e==="android"&&(t=In||-1),this._chM.get(12)),n=this._chM.getPlatform(),s=o.getSDKAppID(),o=o.getInstanceID(),s="sdkappid=".concat(s,"&instanceid=").concat(o,"&random=").concat(this._getRandom(),"&platform=").concat(n,"&host=").concat(e)+"&version=".concat(t,"&sdkversion=").concat("3.3.5");return xo&&(s+="&isminigame=1"),this._chM.canIUseInflate()&&(s+="&compress=gzip"),(this._canIUseBinaryFrame?"".concat(this._url,"/binfo?"):"".concat(this._url,"/info?")).concat(s)}},{key:"_closeConnection",value:function(e){u.l("".concat(this._n,"._closeConnection socketID:").concat(this._socketID)),this._socket&&(this._socket.close(e),this._socketID=-1,this._socket=null,this._readyState=Rn)}},{key:"_resend",value:function(){var e=this;if(u.l("".concat(this._n,"._resend reConnectFlag:").concat(this._reConnectFlag),"promiseMap.size:".concat(this._promiseMap.size," simpleRequestMap.size:").concat(this._simpleRequestMap.size)),0<this._promiseMap.size&&this._promiseMap.forEach(function(p,r){var c=p.uplinkData,d=p.resolve,p=p.reject;r.indexOf(g.AV_POLLING)!==-1?e._promiseMap.delete(r):(e._promiseMap.set(r,{resolve:d,reject:p,timestamp:Date.now(),uplinkData:c}),e._execute(r,c))}),0<this._simpleRequestMap.size){var t,n=Ee(this._simpleRequestMap);try{for(n.s();!(t=n.n()).done;){var o=$(t.value,2),s=o[0],i=o[1];this._execute(s,i)}}catch(a){n.e(a)}finally{n.f()}this._simpleRequestMap.clear()}}},{key:"send",value:function(e){var t=this,n=(e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.keyMap,Z(e,Ru)),o=this._getRequestIDFromHead(e.head),s=JSON.stringify(n);return new Promise(function(i,a){t._promiseMap.set(o,{resolve:i,reject:a,timestamp:Date.now(),uplinkData:s}),u.d("".concat(t._n,".send uplinkData:").concat(JSON.stringify(n)," requestID:").concat(o," readyState:").concat(t._readyState)),t._readyState!==go?t._reConnect():(t._execute(o,s),t._chM.get(26).addRequestCount())})}},{key:"simplySend",value:function(t){t.head.seq=this._getSequence(),t.head.reqtime=Math.floor(Date.now()/1e3),t.keyMap;var n=Z(t,Nu),t=this._getRequestIDFromHead(t.head),n=JSON.stringify(n);this._readyState!==go?(this._simpleRequestMap.size<this.MAX_SIZE?this._simpleRequestMap.set(t,n):u.l("".concat(this._n,".simplySend. simpleRequestMap is full, drop request!")),this._reConnect()):this._execute(t,n)}},{key:"_execute",value:function(e,t){this._socket.send({data:t,fail:ge?this._onSendFail.bind(this):void 0,requestID:e})}},{key:"_onSendFail",value:function(e){u.l("".concat(this._n,"._onSendFail requestID:").concat(e)),this._chM.onSendFail()}},{key:"_getSequence",value:function(){var e;if(this._startSequence<2415919103)return e=this._startSequence,this._startSequence+=1,this._startSequence===2415919103&&(this._startSequence=St()),e}},{key:"_getRequestIDFromHead",value:function(e){return e.servcmd+e.seq}},{key:"_getResponseKeyMap",value:function(e){return e=this._chM.getKeyMap(e),l(l({},ds.response),e.response)}},{key:"_reConnect",value:function(){this._readyState!==go&&this._readyState!==Or&&this.forcedReconnect()}},{key:"forcedReconnect",value:function(){var e="".concat(this._n,".forcedReconnect");u.l("".concat(e," count:").concat(this._reConnectCount," readyState:").concat(this._readyState)),this._reConnectFlag=!0,this._resetRandom(),this._reConnectCount<this.MAX_RECONNECT_COUNT?(this._reConnectCount+=1,this._closeConnection(4001),this._initConnection()):(this._reConnectCount=0,this._chM.get(15).isOnline()?(u.w("".concat(e," disconnected from wsserver but network is ok, continue...")),this._closeConnection(4001),this._initConnection()):this._chM.onReconnectFailed())}},{key:"getReconnectFlag",value:function(){return this._reConnectFlag}},{key:"_setNextPingTs",value:function(){this._nextPingTs=ze?Date.now()+5e3:Date.now()+1e4}},{key:"getNextPingTs",value:function(){return this._nextPingTs}},{key:"isConnected",value:function(){return this._readyState===go}},{key:"canIUseBinaryFrame",value:function(){return this._canIUseBinaryFrame}},{key:"inflate",value:function(e){if(this._chM.canIUseInflate())return this._chM.get(37).inflate(e)}},{key:"setIsWorkerEnabled",value:function(e){u.l("".concat(this._n,".setIsWorkerEnabled flag:").concat(e)),this._isWorkerEnabled=e}},{key:"getIsWorkerEnabled",value:function(){return this._isWorkerEnabled&&Gt}},{key:"_getRandom",value:function(){return this._random===0&&(this._random=Math.random()),this._random}},{key:"_resetRandom",value:function(){this._random=0}},{key:"close",value:function(){u.l("".concat(this._n,".close")),this._closeConnection(4e3),this._promiseMap.clear(),this._startSequence=St(),this._readyState=Rn,this._simpleRequestMap.clear(),this._reConnectFlag=!1,this._reConnectCount=0,this._onOpenTs=0,this._url="",this._random=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0}}]),zi),Wi=function(e,t,n){return new Promise(function(o,s){var i,a,r="application/x-www-form-urlencoded;charset=UTF-8";ge?ce.request({url:t,data:n,method:e,timeout:3e3,header:{"content-type":r},success:function(c){c&&c.data&&c.data.NetCheckInfo&&u.l("".concat("getconninfo ok in"," miniapp. ret:"),c.data),o()},fail:function(){s(new Te({code:M.NETWORK_ERROR}))}}):(i=new XMLHttpRequest,a=setTimeout(function(){i.abort(),s(new Te({code:M.NETWORK_TIMEOUT}))},3e3),i.onreadystatechange=function(){i.readyState===4&&(clearTimeout(a),i.status===200||i.status===304?(i.responseText&&-1<i.responseText.indexOf("NetCheckInfo")&&u.l("".concat("getconninfo ok in"," web. ret:"),JSON.parse(i.responseText)),o()):s(new Te({code:M.NETWORK_ERROR})))},i.open(e,t,!0),i.setRequestHeader("Content-type",r),n?i.send(n):i.send())})},Gu=(z(ho,Oe),Nr=X(ho),R(ho,[{key:"onCheckTimer",value:function(e){this._socketHandler&&(this.isLoggedIn()?(0<this._timerForNotLoggedIn&&(clearInterval(this._timerForNotLoggedIn),this._timerForNotLoggedIn=-1),this._socketHandler.onCheckTimer(e)):this._socketHandler.onCheckTimer(1),this._checkNextPing())}},{key:"onErrorCodeNotZero",value:function(e){this.get(20).onErrorCodeNotZero(e)}},{key:"onMessage",value:function(e){this.get(20).onMessage(e)}},{key:"send",value:function(e){return this._socketHandler?this._previousState!==_.NET_STATE_CONNECTED&&e.head.servcmd.includes(g.SSO_STAT)?(this.reConnect(),this.isPrivateNetWork()?Promise.resolve():this._sendLogViaHTTP(e)):this._socketHandler.send(e):Promise.reject()}},{key:"_sendLogViaHTTP",value:function(n){var t=L.HOST.CURRENT.STAT,t="".concat(t,"/v4/imopenstat/tim_web_report_v2?sdkappid=").concat(n.head.sdkappid,"&reqtime=").concat(Date.now()),n=JSON.stringify(n.body);return Wi("POST",t,n)}},{key:"simplySend",value:function(e){return this._socketHandler?this._socketHandler.simplySend(e):Promise.reject()}},{key:"onOpen",value:function(){this._ping()}},{key:"onClose",value:function(){this._socketHandler&&this._socketHandler.getReconnectFlag()&&this._emitNetStateChangeEvent(_.NET_STATE_DISCONNECTED),this.reConnect()}},{key:"onError",value:function(){ge&&!ze&&this.outputWarning("DomainNameInMP"),this._emitNetStateChangeEvent(_.NET_STATE_DISCONNECTED)}},{key:"getKeyMap",value:function(e){return this.get(20).getKeyMap(e)}},{key:"_onAppHide",value:function(){this._isAppShowing=!1}},{key:"_onAppShow",value:function(){this._isAppShowing=!0}},{key:"onRequestTimeout",value:function(){3e4<=Date.now()-this._lastDiagnoseTS&&this.diagnose()}},{key:"onSendFail",value:function(){this._emitNetStateChangeEvent(_.NET_STATE_DISCONNECTED)}},{key:"onReconnected",value:function(){u.l("".concat(this._n,".onReconnected cost:").concat(Ke(this._disconnectedTS,!0,!0))),this._m.restartTimer(),this.get(20).onReconnected(Ke(this._disconnectedTS,!1,!1)),this._disconnectedTS=0,this._emitNetStateChangeEvent(_.NET_STATE_CONNECTED)}},{key:"onReconnectFailed",value:function(){u.l("".concat(this._n,".onReconnectFailed")),this._emitNetStateChangeEvent(_.NET_STATE_DISCONNECTED)}},{key:"setIsWorkerEnabled",value:function(e){this._socketHandler&&this._socketHandler.setIsWorkerEnabled(!1)}},{key:"offline",value:function(){this._emitNetStateChangeEvent(_.NET_STATE_DISCONNECTED)}},{key:"reConnect",value:function(){var e=0<arguments.length&&arguments[0]!==void 0&&arguments[0],t=!1,n=(this._socketHandler&&(t=this._socketHandler.getReconnectFlag()),"forcedFlag:".concat(e," fatalErrorFlag:").concat(this._fatalErrorFlag," previousState:").concat(this._previousState," reconnectFlag:").concat(t));if(u.l("".concat(this._n,".reConnect ").concat(n)),!this._fatalErrorFlag&&this._socketHandler){if(e===!0)this._socketHandler.forcedReconnect();else{if(this._previousState===_.NET_STATE_CONNECTING&&t)return;this._socketHandler.forcedReconnect()}this._emitNetStateChangeEvent(_.NET_STATE_CONNECTING)}}},{key:"_emitNetStateChangeEvent",value:function(e){this._previousState!==e&&(u.l("".concat(this._n,"._emitNetStateChangeEvent from ").concat(this._previousState," to ").concat(e)),e===_.NET_STATE_DISCONNECTED&&this._disconnectedTS===0&&(this._disconnectedTS=Date.now(),this.diagnose()),this._previousState=e,this.emitOuterEvent(V.NET_STATE_CHANGE,{state:e}))}},{key:"_ping",value:function(){var e,t=this;this._probing!==!0&&(this._probing=!0,e=this.get(20).getProtocolData({proto:g.PING}),this.send(e).then(function(){t._probing=!1}).catch(function(n){t._probing=!1;var o=t.get(15).isOnline();if(u.w("".concat(t._n,"._ping failed. bOnline:").concat(o," error:"),n),n&&n.code===60002)return new S("error").setMessage("code:".concat(n.code," message:").concat(n.message)).end(),t._fatalErrorFlag=!0,void t._emitNetStateChangeEvent(_.NET_STATE_DISCONNECTED);o?t.reConnect():t._emitNetStateChangeEvent(_.NET_STATE_DISCONNECTED)}))}},{key:"_checkNextPing",value:function(){this._socketHandler&&this._socketHandler.isConnected()&&Date.now()>=this._socketHandler.getNextPingTs()&&this._ping()}},{key:"dealloc",value:function(){this._socketHandler&&(this._socketHandler.close(),this._socketHandler=null),-1<this._timerForNotLoggedIn&&clearInterval(this._timerForNotLoggedIn)}},{key:"onRestApiKickedOut",value:function(){this._socketHandler&&(this._socketHandler.close(),this.reConnect(!0))}},{key:"canIUseInflate",value:function(){return this._m.canIUseInflate()}},{key:"diagnose",value:function(){this.isPrivateNetWork()||(this._lastDiagnoseTS=Date.now(),this._diagnoseBySSO(),this._diagnoseByCDN())}},{key:"_diagnoseBySSO",value:function(){var e=this,t=this._socketHandler.getURL(),n=t.split("/")[2];n.startsWith("ws")&&(t=t.slice(t.indexOf("info?")+5),n="https://".concat(n,"/v3/netcheck/getconninfo?").concat(t,"&reqtime=").concat(Date.now()),Wi("GET",n).catch(function(o){u.w("".concat(e._n,"._diagnoseBySSO failed. error:"),o)}))}},{key:"_diagnoseByCDN",value:function(){var e=this,t=this._socketHandler.getURL(),t=t.slice(t.indexOf("info?")+5),t="https://boce-cdn.my-imcloud.com/v3/netcheck/getconninfo?".concat(t,"&reqtime=").concat(Date.now());Wi("GET",t).catch(function(n){u.w("".concat(e._n,"._diagnoseByCDN failed. error:"),n)})}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._previousState=_.NET_STATE_CONNECTED,this._probing=!1,this._fatalErrorFlag=!1,this._timerForNotLoggedIn=setInterval(this.onCheckTimer.bind(this),1e3),this._disconnectedTS=0,this._lastDiagnoseTS=0}}]),ho),Pu=["a2","tinyid"],Uu=["a2","tinyid"],bu=(R(Ji,[{key:"_fillConfigMap",value:function(){this._configMap.clear();var e=this._sessionM.genCommonHead(),t=this._sessionM.genCosSpecifiedHead(),n=this._sessionM.genSSOReportHead();this._configMap.set(g.LOGIN,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_OPEN_STATUS,".").concat(g.LOGIN)}),body:{state:"Online",isWebUniapp:0,deviceBrand:0},keyMap:{request:{deviceBrand:"InstType"},response:{InstId:"instanceID",HelloInterval:"helloInterval"}}}),this._configMap.set(g.LOGOUT,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_OPEN_STATUS,".").concat(g.LOGOUT)}),body:{type:0},keyMap:{request:{type:"wslogout_type"}}}),this._configMap.set(g.HELLO,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_OPEN_STATUS,".").concat(g.HELLO)}),body:{isWebUniapp:0},keyMap:{response:{NewInstInfo:"newInstanceInfo"}}}),this._configMap.set(g.KICK_OTHER,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.STAT_SERVICE,".").concat(g.KICK_OTHER)}),body:{}}),this._configMap.set(g.COS_SIGN,{head:l(l({},t),{},{servcmd:"".concat(L.NAME.IM_COS_SIGN,".").concat(g.COS_SIGN)}),body:{cmd:"open_im_cos_svc",subCmd:"get_cos_token",duration:300,version:2},keyMap:{request:{userSig:"usersig",subCmd:"sub_cmd",cmd:"cmd",duration:"duration",version:"version"},response:{expired_time:"expiredTime",bucket_name:"bucketName",session_token:"sessionToken",tmp_secret_id:"secretId",tmp_secret_key:"secretKey"}}}),this._configMap.set(g.COS_PRE_SIG,{head:l(l({},t),{},{servcmd:"".concat(L.NAME.CUSTOM_UPLOAD,".").concat(g.COS_PRE_SIG)}),body:{fileType:void 0,fileName:void 0,uploadMethod:0,duration:900},keyMap:{request:{userSig:"usersig",fileType:"file_type",fileName:"file_name",uploadMethod:"upload_method"},response:{expired_time:"expiredTime",request_id:"requestId",head_url:"headUrl",upload_url:"uploadUrl",download_url:"downloadUrl",ci_url:"ciUrl",snapshot_url:"requestSnapshotUrl"}}}),this._configMap.set(g.SIMPLE_COS_PRE_SIG,{head:l(l({},t),{},{servcmd:"".concat(L.NAME.CUSTOM_UPLOAD,".").concat(g.SIMPLE_COS_PRE_SIG)}),body:{uploadMethod:0,platform:2,SDKAppID:0,userID:"",conversationType:1,uploadConfig:[{fileID:1,fileType:1,fileName:""}]},keyMap:{request:{platform:"uint32_platform",SDKAppID:"uint32_sdkappid",userID:"str_user_id",uploadMethod:"uint32_upload_method",conversationType:"uint32_scene",uploadConfig:"rpt_upload_object",fileID:"uint32_file_id",fileType:"uint32_file_type",fileName:"str_file_name"},response:{str_final_ip:"uploadIP",rpt_pre_sig:"preSig",uint32_file_id:"fileID",uint32_exist_flag:"existFlag",str_download_url:"downloadUrl",str_upload_url:"uploadUrl",str_snapshot_url:"requestSnapshotUrl",str_file_key:"fileKey"}}}),this._configMap.set(g.GET_IMAGE_INFO,{head:l(l({},t),{},{servcmd:"".concat(L.NAME.CUSTOM_UPLOAD,".").concat(g.GET_IMAGE_INFO)}),body:{imageUrl:""},keyMap:{request:{imageUrl:"str_image_url"},response:{rpt_msg_image_info:"imageInfoArray",uint32_image_type:"type",str_url:"url",uint32_width:"width",uint32_height:"height",str_image_format:"imageFormat"}}}),this._configMap.set(g.GET_IP,{head:l(l({},t),{},{servcmd:"".concat(L.NAME.CUSTOM_UPLOAD,".").concat(g.GET_IP)}),body:{domainName:""},keyMap:{request:{domainName:"str_domain"},response:{str_final_ip:"ip"}}}),this._configMap.set(g.VIDEO_COVER,{head:l(l({},t),{},{servcmd:"".concat(L.NAME.CUSTOM_UPLOAD,".").concat(g.VIDEO_COVER)}),body:{version:1,platform:void 0,coverName:void 0,requestSnapshotUrl:void 0},keyMap:{request:{version:"version",platform:"platform",coverName:"cover_name",requestSnapshotUrl:"snapshot_url"},response:{error_code:"errorCode",error_msg:"errorInfo",download_url:"snapshotUrl"}}}),this._configMap.set(g.FETCH_COMMERCIAL_CONFIG,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_CONFIG_MANAGER,".").concat(g.FETCH_COMMERCIAL_CONFIG)}),body:{SDKAppID:0},keyMap:{request:{SDKAppID:"uint32_sdkappid"},response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}),this._configMap.set(g.PUSHED_COMMERCIAL_CONFIG,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_CONFIG_MANAGER,".").concat(g.PUSHED_COMMERCIAL_CONFIG)}),body:{},keyMap:{response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}),this._configMap.set(g.FETCH_CLOUD_CTRL_CONFIG,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_CONFIG_MANAGER,".").concat(g.FETCH_CLOUD_CTRL_CONFIG)}),body:{SDKAppID:0,version:0},keyMap:{request:{SDKAppID:"uint32_sdkappid",version:"uint64_version"},response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}),this._configMap.set(g.PUSHED_CLOUD_CTRL_CONFIG,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_CONFIG_MANAGER,".").concat(g.PUSHED_CLOUD_CTRL_CONFIG)}),body:{},keyMap:{response:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}),this._configMap.set(g.OVERLOAD_NOTIFY,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OVERLOAD_PUSH,".").concat(g.OVERLOAD_NOTIFY)}),body:{},keyMap:{response:{OverLoadServCmd:"overloadCommand",DelaySecs:"waitingTime"}}}),this._configMap.set(g.SYNC_UNREAD_MSG,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM,".").concat(g.SYNC_UNREAD_MSG)}),body:{cookie:"",syncFlag:0,needAbstract:1,isOnlineSync:0,needSignaling:1},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",from:"From_Account",to:"To_Account",time:"MsgTimeStamp",sequence:"MsgSeq",random:"MsgRandom",elements:"MsgBody"},response:{MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",ClientSeq:"clientSequence",MsgSeq:"sequence",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgRandom:"random",MsgTimeStamp:"time",MsgContent:"content",ToGroupId:"to",MsgKey:"messageKey",GroupTips:"groupTips",MsgBody:"elements",MsgType:"type",C2CRemainingUnreadCount:"C2CRemainingUnreadList",C2CPairUnreadCount:"C2CPairUnreadList"}}}),this._configMap.set(g.GET_PROFANITY_LIST,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_MSG_AUDIT_MGR,".").concat(g.GET_PROFANITY_LIST)}),body:{version:0,deviceID:"",startIndex:void 0},keyMap:{request:{version:"uint64_version",deviceID:"str_device_id",startIndex:"uint64_start_index"},response:{msg_cmd_error_code:"errorInfo",str_err_msg:"errorMessage",uint32_code:"errorCode",msg_scene_ctl_config:"filterConfig",uint64_c2c_custom_msg_flag:"c2c_custom_message",uint64_c2c_text_msg_flag:"c2c_text_message",uint64_group_custom_msg_flag:"group_custom_message",uint64_group_text_msg_flag:"group_text_message",uint64_group_info_flag:"group_profile",uint64_group_member_info_flag:"group_member_profile",uint64_relation_chain_flag:"sns",uint64_user_info_flag:"user_profile",rpt_msg_dirty_word:"lexicon",str_dirty_word:"profanity",str_replaced_content:"replacement",uint64_filter_type:"filterType",uint64_id:"id",uint64_word_type:"profanityType",uint64_complete_flag:"completeFlag",uint64_next_start_index:"nextStartIndex",uint64_version:"version",uint64_expired_time:"expiredTime"}}}),this._configMap.set(g.SEND_C2C_MSG,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM,".").concat(g.SEND_C2C_MSG)}),body:{fromAccount:"",toAccount:"",msgSeq:0,msgRandom:0,msgBody:[],cloudCustomData:void 0,nick:"",avatar:"",msgLifeTime:void 0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{sound:"",badgeMode:0,isVoipPush:void 0},androidInfo:{sound:"",XiaoMiChannelID:"",OPPOChannelID:"",GoogleChannelID:"",VIVOClassification:1,VIVOCategory:"",HuaWeiCategory:""}},messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,isSupportExtension:0,isRelayMessage:0,cmConfigID:void 0},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",count:"MaxCnt",lastMessageTime:"LastMsgTime",messageKey:"MsgKey",peerAccount:"Peer_Account",data:"Data",description:"Desc",extension:"Ext",type:"MsgType",content:"MsgContent",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",nick:"From_AccountNick",avatar:"From_AccountHeadurl",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"IsNeedReadReceipt",GoogleChannelID:"GoogleChannelID",XiaoMiChannelID:"XiaoMiChannelID"}}}),this._configMap.set(g.SEND_GRP_MSG,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.SEND_GRP_MSG)}),body:{fromAccount:"",groupID:"",random:0,clientSequence:0,priority:"",msgBody:[],cloudCustomData:void 0,onlineOnlyFlag:0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{sound:"",badgeMode:0,isVoipPush:void 0},androidInfo:{sound:"",XiaoMiChannelID:"",OPPOChannelID:"",GoogleChannelID:"",VIVOClassification:1,VIVOCategory:"",HuaWeiCategory:""}},groupAtInfo:[],messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,topicID:void 0,receiverList:void 0,isSupportExtension:0,isRelayMessage:0,cmConfigID:void 0},keyMap:{request:{to:"GroupId",extension:"Ext",data:"Data",description:"Desc",random:"Random",sequence:"ReqMsgSeq",count:"ReqMsgNumber",type:"MsgType",priority:"MsgPriority",content:"MsgContent",elements:"MsgBody",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",clientSequence:"ClientSeq",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"NeedReadReceipt",receiverList:"To_Account",GoogleChannelID:"GoogleChannelID",XiaoMiChannelID:"XiaoMiChannelID"},response:{MsgTime:"time",MsgSeq:"sequence"}}}),this._configMap.set(g.REVOKE_C2C_MSG,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM,".").concat(g.REVOKE_C2C_MSG)}),body:{msgInfo:{fromAccount:"",toAccount:"",msgTimeStamp:0,msgSeq:0,msgRandom:0}},keyMap:{request:{msgInfo:"MsgInfo",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom"}}}),this._configMap.set(g.REVOKE_GRP_MSG,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.REVOKE_GRP_MSG)}),body:{groupID:"",msgSeqList:void 0,topicID:""},keyMap:{request:{msgSeqList:"MsgSeqList",msgSeq:"MsgSeq"}}}),this._configMap.set(g.GET_C2C_ROAMING_MSG,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM,".").concat(g.GET_C2C_ROAMING_MSG)}),body:{peerAccount:"",count:15,lastMessageTime:0,messageKey:"",withRecalledMessage:1,direction:0},keyMap:{request:{messageKey:"MsgKey",peerAccount:"Peer_Account",count:"MaxCnt",lastMessageTime:"LastMsgTime",withRecalledMessage:"WithRecalledMsg",direction:"GetDirection"},response:{LastMsgTime:"lastMessageTime",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer"}}}),this._configMap.set(g.MODIFY_C2C_MSG,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM,".").concat(g.MODIFY_C2C_MSG)}),body:{from:"",to:"",sequence:0,random:0,time:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{request:{sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}),this._configMap.set(g.GET_GRP_ROAMING_MSG,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.GET_GRP_ROAMING_MSG)}),body:{withRecalledMsg:1,groupID:"",count:15,sequence:"",topicID:void 0},keyMap:{request:{sequence:"ReqMsgSeq",count:"ReqMsgNumber",withRecalledMessage:"WithRecalledMsg"},response:{Random:"random",MsgTime:"time",MsgSeq:"sequence",ReqMsgSeq:"sequence",RspMsgList:"messageList",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgPriority:"priority",MsgBody:"elements",MsgType:"type",MsgContent:"content",IsFinished:"complete",Download_Flag:"downloadFlag",ClientSeq:"clientSequence",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList",NextReqMsgSeq:"nextSequence"}}}),this._configMap.set(g.SET_C2C_MSG_READ,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM,".").concat(g.SET_C2C_MSG_READ)}),body:{C2CMsgReaded:void 0},keyMap:{request:{lastMessageTime:"LastedMsgTime"}}}),this._configMap.set(g.SET_C2C_PEER_MUTE_NOTIFICATIONS,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM,".").concat(g.SET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{userIDList:void 0,muteFlag:0},keyMap:{request:{userIDList:"Peer_Account",muteFlag:"Mute_Notifications"}}}),this._configMap.set(g.GET_C2C_PEER_MUTE_NOTIFICATIONS,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM,".").concat(g.GET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{toAccount:void 0,userIDList:void 0},keyMap:{request:{userIDList:"Peer_Account"},response:{MuteNotificationsList:"muteFlagList"}}}),this._configMap.set(g.SET_GRP_MSG_READ,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.SET_GRP_MSG_READ)}),body:{groupID:void 0,messageReadSeq:void 0,topicID:void 0},keyMap:{request:{messageReadSeq:"MsgReadedSeq"}}}),this._configMap.set(g.SET_ALL_MSG_READ,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM,".").concat(g.SET_ALL_MSG_READ)}),body:{readAllC2CMessage:0,groupMessageReadInfoList:[]},keyMap:{request:{readAllC2CMessage:"C2CReadAllMsg",groupMessageReadInfoList:"GroupReadInfo",messageSequence:"MsgSeq"},response:{C2CReadAllMsg:"readAllC2CMessage",GroupReadInfoArray:"groupMessageReadInfoList"}}}),this._configMap.set(g.DEL_C2C_MSG,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM,".").concat(g.DEL_C2C_MSG)}),body:{fromAccount:"",to:"",keyList:void 0},keyMap:{request:{keyList:"MsgKeyList"}}}),this._configMap.set(g.DEL_GRP_MSG,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.DEL_GRP_MSG)}),body:{groupID:"",deleter:"",keyList:void 0,topicID:void 0},keyMap:{request:{deleter:"Deleter_Account",keyList:"Seqs"}}}),this._configMap.set(g.TRANSLATE_TEXT,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_OPEN_TRANSLATE,".").concat(g.TRANSLATE_TEXT)}),body:{sourceTextList:void 0,SDKAppID:0,from:0,source:"",target:""},keyMap:{request:{sourceTextList:"SourceText",SDKAppID:"SdkAppId",from:"FromAccount"},response:{TargetText:"translatedTextList",RequestId:"requestID",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}),this._configMap.set(g.VOICE_TO_TEXT,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_OPEN_SPEECH,".").concat(g.VOICE_TO_TEXT)}),body:{url:"",SDKAppID:0,format:"",sourceType:0,language:""},keyMap:{request:{url:"BytesUrl",SDKAppID:"Uint32Sdkappid",format:"BytesVoiceFormat",sourceType:"Uint64SourceType",language:"BytesEngServiceType"},response:{BytesRequestid:"requestID",BytesResult:"result",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}),this._configMap.set(g.MODIFY_GRP_MSG,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM,".").concat(g.MODIFY_GRP_MSG)}),body:{groupID:"",topicID:void 0,sequence:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{request:{sequence:"MsgSeq",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}),this._configMap.set(g.GET_READ_RECEIPT,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.GET_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{request:{sequence:"MsgSeq"}}}),this._configMap.set(g.SEND_C2C_READ_RECEIPT,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM,".").concat(g.SEND_C2C_READ_RECEIPT)}),body:{peerAccount:"",messageInfoList:void 0},keyMap:{request:{peerAccount:"Peer_Account",messageInfoList:"C2CMsgInfo",fromAccount:"From_Account",toAccount:"To_Account",sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",clientTime:"MsgClientTime"}}}),this._configMap.set(g.SEND_READ_RECEIPT,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.SEND_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{request:{sequenceList:"MsgSeqList",sequence:"MsgSeq"}}}),this._configMap.set(g.GET_READ_RECEIPT_DETAIL,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.GET_READ_RECEIPT_DETAIL)}),body:{groupID:"",sequence:void 0,flag:0,cursor:0,count:0},keyMap:{request:{sequence:"MsgSeq",count:"Num"},response:{ReadList:"readUserIDList",Read_Account:"userID",UnreadList:"unreadUserIDList",Unread_Account:"userID",IsFinish:"isCompleted"}}}),this._configMap.set(g.MODIFY_C2C_MSG_EXT,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM_MSG_EXT,".").concat(g.MODIFY_C2C_MSG_EXT)}),body:{from:void 0,to:void 0,messageKey:void 0,operateType:void 0,extensionList:void 0}}),this._configMap.set(g.GET_C2C_MSG_EXT,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM_MSG_EXT,".").concat(g.GET_C2C_MSG_EXT)}),body:{from:void 0,to:void 0,messageKey:void 0,startSequence:void 0}}),this._configMap.set(g.MODIFY_GRP_MSG_EXT,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM_MSG_EXT,".").concat(g.MODIFY_GRP_MSG_EXT)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,operateType:void 0,extensionList:void 0}}),this._configMap.set(g.GET_GRP_MSG_EXT,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM_MSG_EXT,".").concat(g.GET_GRP_MSG_EXT)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,startSequence:void 0}}),this._configMap.set(g.MSG_CLOUD_SEARCH,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.MSG_SEARCH,".").concat(g.MSG_CLOUD_SEARCH)}),body:{keywordList:void 0,keywordListMatchType:"or",account:void 0,groupID:void 0,count:100,cursor:void 0,messageTypeList:void 0,senderUserIDList:void 0,startTime:void 0,endTime:void 0},keyMap:{request:{keywordListMatchType:"MatchType",account:"PeerAccount",groupID:"GroupID",messageTypeList:"MsgTypeList",senderUserIDList:"SendUserIDList"},response:{GroupID:"groupID",UserID:"userID",Count:"messageCount",LastMsgTime:"lastMessageTime",ConversationMsgs:"searchResult",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer",MsgSeq:"sequence",ReqMsgSeq:"sequence",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgContent:"content",ClientSeq:"clientSequence",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList",ErrorCode:"code",ErrorInfo:"message"}}}),this._configMap.set(g.ADD_C2C_MSG_REACTION,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM_MSG_EXT,".").concat(g.ADD_C2C_MSG_REACTION)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,userIDList:void 0},keyMap:{request:{userIDList:"Add_Account"}}}),this._configMap.set(g.RM_C2C_MSG_REACTION,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM_MSG_EXT,".").concat(g.RM_C2C_MSG_REACTION)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,userIDList:void 0},keyMap:{request:{userIDList:"Del_Account"}}}),this._configMap.set(g.GET_C2C_MSG_REACTIONS,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM_MSG_EXT,".").concat(g.GET_C2C_MSG_REACTIONS)}),body:{from:void 0,to:void 0,messageKeyList:void 0,count:void 0}}),this._configMap.set(g.GET_C2C_MSG_REACTION_USER_LIST,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM_MSG_EXT,".").concat(g.GET_C2C_MSG_REACTION_USER_LIST)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,count:void 0}}),this._configMap.set(g.ADD_GRP_MSG_REACTION,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM_MSG_EXT,".").concat(g.ADD_GRP_MSG_REACTION)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,userIDList:void 0},keyMap:{request:{userIDList:"Add_Account"}}}),this._configMap.set(g.RM_GRP_MSG_REACTION,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM_MSG_EXT,".").concat(g.RM_GRP_MSG_REACTION)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,userIDList:void 0},keyMap:{request:{userIDList:"Del_Account"}}}),this._configMap.set(g.GET_GRP_MSG_REACTIONS,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM_MSG_EXT,".").concat(g.GET_GRP_MSG_REACTIONS)}),body:{groupID:void 0,topicID:void 0,messageSequenceList:void 0,count:void 0},keyMap:{response:{MsgSeq:"messageSequence"}}}),this._configMap.set(g.GET_GRP_MSG_REACTION_USER_LIST,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM_MSG_EXT,".").concat(g.GET_GRP_MSG_REACTION_USER_LIST)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,nextSeq:void 0,count:void 0}}),this._configMap.set(g.GET_C2C_PEER_READ_TIME,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM,".").concat(g.GET_C2C_PEER_READ_TIME)}),body:{userIDList:void 0},keyMap:{request:{userIDList:"To_Account"},response:{ReadTime:"peerReadTimeList"}}}),this._configMap.set(g.PAGING_GET_CONV_LIST,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.RECENT_CONTACT,".").concat(g.PAGING_GET_CONV_LIST)}),body:{fromAccount:void 0,timeStamp:void 0,startIndex:void 0,pinnedTimeStamp:void 0,pinnedStartIndex:void 0,orderType:void 0,messageAssistFlag:15,assistFlag:31},keyMap:{request:{messageAssistFlag:"MsgAssistFlags",assistFlag:"AssistFlags",pinnedTimeStamp:"TopTimeStamp",pinnedStartIndex:"TopStartIndex"},response:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime",LastMsgFlags:"lastMessageFlag",TopFlags:"isPinned",TopTimeStamp:"pinnedTimeStamp",TopStartIndex:"pinnedStartIndex",GroupId:"convGroupID",C2cRemark:"friendRemark",MsgRecvOption:"messageRemindType",GroupIgnoredUnreadSeqCount:"noUnreadCount",GroupNextMsgSeq:"nextMessageSeq"}}}),this._configMap.set(g.DEL_CONV,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.RECENT_CONTACT,".").concat(g.DEL_CONV)}),body:{fromAccount:"",conversationList:void 0,clearHistoryMessage:void 0},keyMap:{request:{toGroupID:"ToGroupid",clearHistoryMessage:"ClearRamble",conversationList:"ContactItem"},response:{ResultItem:"resultList",ToGroupid:"groupID",ResultCode:"code",ResultInfo:"info"}}}),this._configMap.set(g.CLEAR_HISTORY_MSG,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.RECENT_CONTACT,".").concat(g.CLEAR_HISTORY_MSG)}),body:{fromAccount:"",toAccount:void 0,type:1,toGroupID:void 0},keyMap:{request:{toGroupID:"ToGroupid"}}}),this._configMap.set(g.PIN_CONV,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.RECENT_CONTACT,".").concat(g.PIN_CONV)}),body:{fromAccount:"",operationType:1,itemList:void 0},keyMap:{request:{itemList:"RecentContactItem"}}}),this._configMap.set(g.DEL_GROUP_AT_TIPS,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM,".").concat(g.DEL_GROUP_AT_TIPS)}),body:{messageListToDelete:void 0},keyMap:{request:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}),this._configMap.set(g.SET_CONV_CUSTOM_DATA,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.RECENT_CONTACT,".").concat(g.MARK_CONV)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},response:{ToGroupId:"groupID",OptType:"operationType"}}}),this._configMap.set(g.MARK_CONV,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.RECENT_CONTACT,".").concat(g.MARK_CONV)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},response:{ToGroupId:"groupID",OptType:"operationType"}}}),this._configMap.set(g.CREATE_CONV_GRP,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.RECENT_CONTACT,".").concat(g.CREATE_CONV_GRP)}),body:{fromAccount:"",itemList:void 0},keyMap:{request:{itemList:"GroupContactItem",groupID:"ToGroupId"},response:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType"}}}),this._configMap.set(g.DEL_CONV_GRP,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.RECENT_CONTACT,".").concat(g.DEL_CONV_GRP)}),body:{fromAccount:"",groupName:void 0},keyMap:{request:{},response:{GroupId:"convGroupID"}}}),this._configMap.set(g.RENAME_CONV_GRP,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.RECENT_CONTACT,".").concat(g.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{request:{oldName:"OldGroupName",newName:"NewGroupName",groupID:"ToGroupId",operationType:"ContactOptType",groupName:"OldGroupName",updateItem:"ContactUpdateItem"},response:{ContactOptType:"operationType",ToGroupId:"groupID",GroupId:"convGroupID"}}}),this._configMap.set(g.ADD_CONV_TO_GRP,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.RECENT_CONTACT,".").concat(g.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:{groupName:void 0,updateGroupType:void 0,updateItem:void 0}},keyMap:{request:{},response:{}}}),this._configMap.set(g.DEL_CONV_FROM_GRP,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.RECENT_CONTACT,".").concat(g.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{request:{},response:{}}}),this._configMap.set(g.GET_CONV_GRP_LIST,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.RECENT_CONTACT,".").concat(g.GET_CONV_GRP_LIST)}),body:{fromAccount:"",startIndex:void 0},keyMap:{request:{},response:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType",CustomMark:"customData",ContactGroupId:"convGroupIDList"}}}),this._configMap.set(g.SEARCH_CONV_GRP_MARK,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.RECENT_CONTACT,".").concat(g.SEARCH_CONV_GRP_MARK)}),body:{fromAccount:"",contactItem:void 0},keyMap:{request:{groupID:"ToGroupId"},response:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType",CustomMark:"customData",ContactGroupId:"convGroupIDList",ContactResultItem:"contactItem"}}}),this._configMap.set(g.GET_USER_PROFILE,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.PROFILE,".").concat(g.GET_USER_PROFILE)}),body:{fromAccount:"",userItem:[]},keyMap:{request:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}),this._configMap.set(g.UPDATE_MY_PROFILE,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.PROFILE,".").concat(g.UPDATE_MY_PROFILE)}),body:{fromAccount:"",profileItem:[{tag:E.NICK,value:""},{tag:E.GENDER,value:""},{tag:E.ALLOWTYPE,value:""},{tag:E.AVATAR,value:""}]},keyMap:{request:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}),this._configMap.set(g.GET_BL,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FD,".").concat(g.GET_BL)}),body:{fromAccount:"",startIndex:0,maxLimited:30,lastSequence:0},keyMap:{response:{CurruentSequence:"currentSequence"}}}),this._configMap.set(g.ADD_TO_BL,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FD,".").concat(g.ADD_TO_BL)}),body:{fromAccount:"",toAccount:[]}}),this._configMap.set(g.RM_FROM_BL,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FD,".").concat(g.RM_FROM_BL)}),body:{fromAccount:"",toAccount:[]}}),this._configMap.set(g.SET_SELF_STATUS,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_OPEN_STATUS,".").concat(g.SET_SELF_STATUS)}),body:{customStatus:""},keyMap:{}}),this._configMap.set(g.GET_USER_STATUS,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_OPEN_STATUS,".").concat(g.GET_USER_STATUS)}),body:{userIDList:void 0},keyMap:{response:{UserStatusList:"successUserList",ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID",Status:"statusType"}}}),this._configMap.set(g.SUB_USER_STATUS,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_OPEN_STATUS,".").concat(g.SUB_USER_STATUS)}),body:{userIDList:void 0},keyMap:{response:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}),this._configMap.set(g.UNSUB_USER_STATUS,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_OPEN_STATUS,".").concat(g.UNSUB_USER_STATUS)}),body:{userIDList:void 0,unsubscribeAll:void 0},keyMap:{response:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}),this._configMap.set(g.GET_FD_LIST,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FD,".").concat(g.GET_FD_LIST)}),body:{fromAccount:"",startIndex:0,standardSequence:0,customSequence:0},keyMap:{response:{FriendNum:"friendCount",UserDataItem:"resultList",ValueItem:"tagValueList"}}}),this._configMap.set(g.ADD_FD,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FD,".").concat(g.ADD_FD)}),body:{fromAccount:"",addFriendItem:[],type:""},keyMap:{request:{source:"AddSource",wording:"AddWording",type:"AddType"},response:{ResultItem:"resultList"}}}),this._configMap.set(g.UPDATE_FD,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FD,".").concat(g.UPDATE_FD)}),body:{fromAccount:"",updateItem:void 0},keyMap:{request:{snsItem:"SnsItem"},response:{ResultItem:"resultList"}}}),this._configMap.set(g.DEL_FD,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FD,".").concat(g.DEL_FD)}),body:{fromAccount:"",userIDList:[],type:""},keyMap:{request:{type:"DeleteType"},response:{ResultItem:"resultList"}}}),this._configMap.set(g.GET_FD_PROFILE,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FD,".").concat(g.GET_FD_PROFILE)}),body:{fromAccount:"",userIDList:void 0},keyMap:{response:{InfoItem:"resultList",SnsProfileItem:"tagValueList"}}}),this._configMap.set(g.CHECK_FD,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FD,".").concat(g.CHECK_FD)}),body:{fromAccount:"",userIDList:[],type:""},keyMap:{request:{type:"CheckType"},response:{InfoItem:"resultList"}}}),this._configMap.set(g.GET_FD_APPLICATION_LIST,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FD,".").concat(g.GET_FD_APPLICATION_LIST)}),body:{fromAccount:"",applicationType:"",startTime:0,maxLimited:0,lastSequence:0},keyMap:{response:{PendencyItem:"resultList",AddSource:"source",AddTime:"time",AddWording:"wording",Image:"avatar",UnreadPendencyCount:"unreadCount",To_Account:"userID",PendencyType:"type"}}}),this._configMap.set(g.RESPOND_FD_APPLICATION,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FD,".").concat(g.RESPOND_FD_APPLICATION)}),body:{fromAccount:"",responseFriendItem:[]},keyMap:{request:{tag:"TagName",action:"ResponseAction"},response:{ResultItem:"resultList"}}}),this._configMap.set(g.DEL_FD_APPLICATION,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FD,".").concat(g.DEL_FD_APPLICATION)}),body:{fromAccount:"",type:"",userIDList:void 0},keyMap:{request:{type:"PendencyType",userIDList:"To_Account"},response:{ResultItem:"resultList"}}}),this._configMap.set(g.REPORT_FD_APPLICATION,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FD,".").concat(g.REPORT_FD_APPLICATION)}),body:{fromAccount:"",latestTimeStamp:""},keyMap:{request:{latestTimeStamp:"LatestPendencyTimeStamp"}}}),this._configMap.set(g.CREATE_FD_GRP,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FD,".").concat(g.CREATE_FD_GRP)}),body:{fromAccount:"",groupName:void 0,userIDList:void 0},keyMap:{request:{groupName:"GroupName",userIDList:"To_Account"},response:{ResultItem:"resultList"}}}),this._configMap.set(g.DEL_FD_GRP,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FD,".").concat(g.DEL_FD_GRP)}),body:{fromAccount:"",nameList:void 0},keyMap:{request:{nameList:"GroupName"}}}),this._configMap.set(g.GET_FD_GRP_LIST,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FD,".").concat(g.GET_FD_GRP_LIST)}),body:{fromAccount:"",lastSequence:0,needFriend:"Need_Friend_Type_Yes"},keyMap:{response:{ResultItem:"resultList",GroupName:"name",FriendNumber:"friendCount",To_Account:"userIDList"}}}),this._configMap.set(g.UPDATE_FD_GRP,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FD,".").concat(g.UPDATE_FD_GRP)}),body:{fromAccount:"",oldName:"",newName:void 0,updateGroupItem:void 0},keyMap:{request:{oldName:"GroupOldName",newName:"GroupNewName"},response:{UpdateType:"type",ResultItem:"resultList"}}}),this._configMap.set(g.GET_GRP_LIST,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.GET_GRP_LIST)}),body:{memberAccount:"",limit:void 0,offset:void 0,groupType:void 0,responseFilter:{groupBaseInfoFilter:void 0,selfInfoFilter:void 0},isSupportTopic:0},keyMap:{request:{memberAccount:"Member_Account"},response:{GroupIdList:"groups",NoUnreadSeqList:"excludedUnreadSequenceList",MsgSeq:"readedSequence",LastRecallTime:"_lastRevokedTime"}}}),this._configMap.set(g.GET_GRP_PROFILE,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.GET_GRP_PROFILE)}),body:{groupIDList:void 0,responseFilter:{groupBaseInfoFilter:void 0,groupCustomFieldFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0}},keyMap:{request:{groupIDList:"GroupIdList",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",groupCustomFieldFilter:"AppDefinedDataFilter_Group",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{GroupIdList:"groups",AppDefinedData:"groupCustomField",AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_Group:"groupCustomFieldFilter",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",InfoSeq:"infoSequence",MemberList:"members",GroupInfo:"groups",ShutUpUntil:"muteUntil",ShutUpAllMember:"muteAllMembers"}}}),this._configMap.set(g.CREATE_GRP,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.CREATE_GRP)}),body:{type:void 0,name:void 0,groupID:void 0,ownerID:void 0,introduction:void 0,notification:void 0,maxMemberNum:void 0,joinOption:void 0,memberList:void 0,groupCustomField:void 0,memberCustomField:void 0,webPushFlag:1,avatar:"",isSupportTopic:void 0,inviteOption:void 0},keyMap:{request:{ownerID:"Owner_Account",userID:"Member_Account",avatar:"FaceUrl",maxMemberNum:"MaxMemberCount",joinOption:"ApplyJoinOption",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",inviteOption:"InviteJoinOption"},response:{HugeGroupFlag:"avChatRoomFlag",OverJoinedGroupLimit_Account:"overLimitUserIDList"}}}),this._configMap.set(g.DISMISS_GRP,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.DISMISS_GRP)}),body:{groupID:void 0}}),this._configMap.set(g.UPDATE_GRP_PROFILE,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.UPDATE_GRP_PROFILE)}),body:{groupID:void 0,name:void 0,introduction:void 0,notification:void 0,avatar:void 0,joinOption:void 0,groupCustomField:void 0,muteAllMembers:void 0,inviteOption:void 0},keyMap:{request:{groupCustomField:"AppDefinedData",muteAllMembers:"ShutUpAllMember",joinOption:"ApplyJoinOption",avatar:"FaceUrl",inviteOption:"InviteJoinOption"},response:{AppDefinedData:"groupCustomField",ShutUpAllMember:"muteAllMembers"}}}),this._configMap.set(g.APPLY_JOIN_GRP,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.APPLY_JOIN_GRP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1,historyMessageFlag:void 0},keyMap:{request:{applyMessage:"ApplyMsg",historyMessageFlag:"HugeGroupHistoryMsgFlag"},response:{HugeGroupFlag:"avChatRoomFlag",AVChatRoomKey:"avChatRoomKey",RspMsgList:"messageList",ToGroupId:"to"}}}),this._configMap.set(g.APPLY_JOIN_GRP_NOAUTH,(e.a2,e.tinyid,{head:l(l({},Z(e,Pu)),{},{servcmd:"".concat(L.NAME.BIG_GRP_NO_AUTH,".").concat(g.APPLY_JOIN_GRP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1},keyMap:{request:{applyMessage:"ApplyMsg"},response:{HugeGroupFlag:"avChatRoomFlag"}}})),this._configMap.set(g.QUIT_GRP,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.QUIT_GRP)}),body:{groupID:void 0}}),this._configMap.set(g.SEARCH_GRP,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.SEARCH_GRP)}),body:{groupIDList:void 0,responseFilter:{groupBasePublicInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption","InviteJoinOption"]}},keyMap:{response:{}}}),this._configMap.set(g.CHANGE_GRP_OWNER,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.CHANGE_GRP_OWNER)}),body:{groupID:void 0,newOwnerID:void 0},keyMap:{request:{newOwnerID:"NewOwner_Account"}}}),this._configMap.set(g.HANDLE_GRP_APPLICATION,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.HANDLE_GRP_APPLICATION)}),body:{groupID:void 0,applicant:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{request:{applicant:"Applicant_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}),this._configMap.set(g.HANDLE_INVITE_JOIN_GRP,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.HANDLE_INVITE_JOIN_GRP)}),body:{groupID:void 0,applicant:void 0,invitee:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,userDefinedField:void 0},keyMap:{request:{applicant:"Applicant_Account",invitee:"Invited_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg"}}}),this._configMap.set(g.HANDLE_GRP_INVITATION,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.HANDLE_GRP_INVITATION)}),body:{groupID:void 0,inviter:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{request:{inviter:"Inviter_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}),this._configMap.set(g.GET_GRP_PENDENCY,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.GET_GRP_PENDENCY)}),body:{startTime:void 0,limit:void 0,handleAccount:void 0},keyMap:{request:{handleAccount:"Handle_Account"},response:{To_Account:"userID",ApplyInviteMsg:"note"}}}),this._configMap.set(g.DEL_GRP_SYSTEM_NOTICE,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM,".").concat(g.DEL_GRP_SYSTEM_NOTICE)}),body:{messageListToDelete:void 0},keyMap:{request:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}),this._configMap.set(g.AV_POLLING,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.BIG_GRP_POLLING,".").concat(g.AV_POLLING)}),body:{USP:1,startSeq:1,startBroadcastSeq:void 0,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{request:{USP:"USP"},response:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}}),this._configMap.set(g.AV_NOAUTH_POLLING,(e.a2,e.tinyid,{head:l(l({},Z(e,Uu)),{},{servcmd:"".concat(L.NAME.BIG_GRP_POLLING_NO_AUTH,".").concat(g.AV_POLLING)}),body:{USP:1,startSeq:1,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{request:{USP:"USP"},response:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}})),this._configMap.set(g.GET_ONLINE_MBR_NUM,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.GET_ONLINE_MBR_NUM)}),body:{groupID:void 0},keyMap:{response:{OnlineMemberNum:"memberCount"}}}),this._configMap.set(g.SET_GRP_ATTR,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.SET_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key",value:"value"}}}),this._configMap.set(g.MODIFY_GRP_ATTR,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.MODIFY_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key",value:"value"}}}),this._configMap.set(g.DEL_GRP_ATTR,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.DEL_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{request:{key:"key"}}}),this._configMap.set(g.CLEAR_GRP_ATTR,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.CLEAR_GRP_ATTR)}),body:{groupID:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]}}),this._configMap.set(g.GET_GRP_ATTR,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP_ATTR,".").concat(g.GET_GRP_ATTR)}),body:{groupID:void 0,avChatRoomKey:void 0,groupType:1},keyMap:{request:{avChatRoomKey:"Key",groupType:"GroupType"}}}),this._configMap.set(g.GET_GRP_NOTIFY,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.GET_GRP_NOTIFY)}),body:{notifyReqList:[]},keyMap:{request:{notifyReqList:"NotifyReqList"},response:{NextMsgTime:"nextRevokedTime",NotifyMsgList:"notifyList",NotifyRspList:"notifyRspList"}}}),this._configMap.set(g.UPDATE_GRP_COUNTER,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.UPDATE_GRP_COUNTER)}),body:{groupID:void 0,counterList:void 0,avChatRoomKey:void 0,mode:void 0},keyMap:{request:{counterList:"GroupCounter"}}}),this._configMap.set(g.GET_GRP_COUNTER,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.GET_GRP_COUNTER)}),body:{groupID:void 0,keyList:[],avChatRoomKey:void 0},keyMap:{request:{keyList:"GroupCounterKeys"}}}),this._configMap.set(g.CREATE_TOPIC,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP_COMMUNITY,".").concat(g.CREATE_TOPIC)}),body:{groupID:void 0,topicName:void 0,avatar:void 0,customData:void 0,topicID:void 0,notification:void 0,introduction:void 0},keyMap:{request:{avatar:"FaceUrl"}}}),this._configMap.set(g.DEL_TOPIC,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP_COMMUNITY,".").concat(g.DEL_TOPIC)}),body:{groupID:void 0,topicIDList:void 0},keyMap:{request:{topicIDList:"TopicIdList"},response:{DestroyResultItem:"resultList"}}}),this._configMap.set(g.UPDATE_TOPIC_PROFILE,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP_COMMUNITY,".").concat(g.UPDATE_TOPIC_PROFILE)}),body:{groupID:void 0,topicID:void 0,avatar:void 0,customData:void 0,notification:void 0,introduction:void 0,muteAllMembers:void 0,topicName:void 0},keyMap:{request:{avatar:"FaceUrl",muteAllMembers:"ShutUpAllMember"}}}),this._configMap.set(g.GET_TOPIC_LIST,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP_COMMUNITY,".").concat(g.GET_TOPIC_LIST)}),body:{groupID:void 0,topicIDList:void 0,MemberInfoFilter:["NoUnreadSeqList"]},keyMap:{request:{topicIDList:"TopicIdList"},response:{TopicAndSelfInfo:"topicInfoList",TopicInfo:"topic",GroupID:"groupID",ShutUpTime:"muteTime",ShutUpAllFlag:"muteAllMembers",LastMsgTime:"lastMessageTime",MsgSeq:"readedSequence",LastMsgSeq:"sequence",NoUnreadSeqList:"excludedUnreadSequenceList"}}}),this._configMap.set(g.GET_GRP_MBR_LIST,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.GET_GRP_MBR_LIST)}),body:{groupID:void 0,limit:0,offset:void 0,next:void 0,memberRoleFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{request:{memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",MemberList:"members",ShutUpUntil:"muteUntil"}}}),this._configMap.set(g.GET_AV_MBR_LIST,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP_AV,".").concat(g.GET_AV_MBR_LIST)}),body:{groupID:void 0,offset:void 0,filter:void 0},keyMap:{request:{offset:"Timestamp",filter:"Mark"},response:{NextTimestamp:"offset"}}}),this._configMap.set(g.GET_GRP_MBR_PROFILE,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.GET_GRP_MBR_PROFILE)}),body:{groupID:void 0,userIDList:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{request:{userIDList:"Member_List_Account",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},response:{MemberList:"members",ShutUpUntil:"muteUntil",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",AppMemberDefinedData:"memberCustomField"}}}),this._configMap.set(g.ADD_GRP_MBR,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.ADD_GRP_MBR)}),body:{groupID:void 0,silence:void 0,userIDList:void 0},keyMap:{request:{userID:"Member_Account",userIDList:"MemberList"},response:{MemberList:"members"}}}),this._configMap.set(g.DEL_GRP_MBR,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.DEL_GRP_MBR)}),body:{groupID:void 0,userIDList:void 0,reason:void 0},keyMap:{request:{userIDList:"MemberToDel_Account"}}}),this._configMap.set(g.BAN_AV_MBR,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.BAN_AV_MBR)}),body:{groupID:void 0,userIDList:void 0,duration:void 0,reason:""},keyMap:{request:{userIDList:"Members_Account",duration:"Duration",reason:"Description"}}}),this._configMap.set(g.MODIFY_GRP_MBR_INFO,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP,".").concat(g.MODIFY_GRP_MBR_INFO)}),body:{groupID:void 0,topicID:void 0,userID:void 0,messageRemindType:void 0,nameCard:void 0,role:void 0,memberCustomField:void 0,muteTime:void 0},keyMap:{request:{userID:"Member_Account",memberCustomField:"AppMemberDefinedData",muteTime:"ShutUpTime",messageRemindType:"MsgFlag"}}}),this._configMap.set(g.MARK_AV_MBR_INFO,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.GRP_AV,".").concat(g.MARK_AV_MBR_INFO)}),body:{groupID:void 0,operationType:1,memberList:[]},keyMap:{request:{operationType:"CommandType",memberList:"MemberList",markType:"Marks",userID:"Member_Account"},response:{CommandType:"operationType",Marks:"markType",Member_Account:"userID"}}}),this._configMap.set(g.SSO_STAT,{head:l(l({},n),{},{servcmd:"".concat(L.NAME.IM_OPEN_STAT,".").concat(g.SSO_STAT)}),body:{header:{},event:[],quality:[]},keyMap:{request:{SDKType:"sdk_type",SDKVersion:"sdk_version",deviceType:"device_type",platform:"platform",instanceID:"instance_id",traceID:"trace_id",SDKAppID:"sdk_app_id",userID:"user_id",tinyID:"tiny_id",extension:"extension",timestamp:"timestamp",networkType:"network_type",eventType:"event_type",code:"error_code",message:"error_message",moreMessage:"more_message",duplicate:"duplicate",costTime:"cost_time",level:"level",qualityType:"quality_type",reportIndex:"report_index",wholePeriod:"whole_period",totalCount:"total_count",rttCount:"success_count_business",successRateOfRequest:"percent_business",countLessThan1Second:"success_count_business",percentOfCountLessThan1Second:"percent_business",countLessThan3Second:"success_count_platform",percentOfCountLessThan3Second:"percent_platform",successCountOfBusiness:"success_count_business",successRateOfBusiness:"percent_business",successCountOfPlatform:"success_count_platform",successRateOfPlatform:"percent_platform",successCountOfMessageReceived:"success_count_business",successRateOfMessageReceived:"percent_business",avgRTT:"average_value",avgDelay:"average_value",avgValue:"average_value",uiPlatform:"ui_platform"}}}),this._configMap.set(g.PING,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.HEARTBEAT,".").concat(g.PING)}),body:{}}),this._configMap.set(g.MSG_PUSH,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_OPEN_PUSH,".").concat(g.MSG_PUSH)}),body:{},keyMap:{response:{C2cMsgArray:"C2CMessageArray",GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",C2cNotifyMsgArray:"C2CNotifyMessageArray",C2cMsgInfo:"C2CReadReceiptArray",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyAdd_Account:"userID",ProfileImNick:"nick",PendencyType:"applicationType",C2CReadAllMsg:"readAllC2CMessage",IsNeedReadReceipt:"needReadReceipt",Status:"statusType",CurrFollowType:"followType",Follow_Account:"userID"}}}),this._configMap.set(g.MULTI_MSG_PUSH,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_OPEN_PUSH,".").concat(g.MULTI_MSG_PUSH)}),body:{},keyMap:{response:{GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyType:"applicationType"}}}),this._configMap.set(g.MSG_PUSH_ACK,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OPEN_IM,".").concat(g.MSG_PUSH_ACK)}),body:{sessionData:void 0},keyMap:{request:{sessionData:"SessionData"}}}),this._configMap.set(g.STATUS_FORCE_OFFLINE,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_OPEN_STATUS,".").concat(g.STATUS_FORCE_OFFLINE)}),body:{},keyMap:{response:{C2cNotifyMsgArray:"C2CNotifyMessageArray",NoticeSeq:"noticeSequence",KickoutMsgNotify:"kickoutMsgNotify",NewInstInfo:"newInstanceInfo"}}}),this._configMap.set(g.DOWNLOAD_MERGER_MSG,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_LONG_MSG,".").concat(g.DOWNLOAD_MERGER_MSG)}),body:{downloadKey:""},keyMap:{response:{Data:"data",Desc:"description",Ext:"extension",Download_Flag:"downloadFlag",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID"}}}),this._configMap.set(g.UPLOAD_MERGER_MSG,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_LONG_MSG,".").concat(g.UPLOAD_MERGER_MSG)}),body:{messageList:[]},keyMap:{request:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",type:"MsgType",content:"MsgContent",data:"Data",description:"Desc",extension:"Ext",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody"}}}),this._configMap.set(g.FOLLOW,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FOLLOW,".").concat(g.FOLLOW)}),body:{fromAccount:"",userIDList:[]},keyMap:{request:{userIDList:"FollowItem"},response:{ResultItem:"resultList",To_Account:"userID"}}}),this._configMap.set(g.UNFOLLOW,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FOLLOW,".").concat(g.UNFOLLOW)}),body:{fromAccount:"",userIDList:[]},keyMap:{request:{userIDList:"To_Account"},response:{ResultItem:"resultList",To_Account:"userID"}}}),this._configMap.set(g.GET_FOLLOW_INFO,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FOLLOW,".").concat(g.GET_FOLLOW_INFO)}),body:{fromAccount:"",userIDList:[]},keyMap:{request:{userIDList:"To_Account"},response:{FollowInfo:"followInfoList",To_Account:"userID",FollowerCount:"followersCount",FollowingCount:"followingCount",MutualFollowingCount:"mutualFollowersCount"}}}),this._configMap.set(g.GET_FOLLOW,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FOLLOW,".").concat(g.GET_FOLLOW)}),body:{fromAccount:"",type:1,nextCursor:"",count:500},keyMap:{request:{type:"FollowType",nextCursor:"StartCursor",count:"WantNum"},response:{FollowItem:"resultList",To_Account:"userID",ProfileItem:"profileList"}}}),this._configMap.set(g.CHECK_FOLLOW_TYPE,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.FOLLOW,".").concat(g.CHECK_FOLLOW_TYPE)}),body:{fromAccount:"",userIDList:[]},keyMap:{request:{userIDList:"To_Account"},response:{ResultItem:"resultList",To_Account:"userID"}}}),this._configMap.set(g.SET_TOKEN,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_OPEN_STATUS,".").concat(g.SET_TOKEN)}),body:{tokenID:"",pushMsg:0,sdkAppID:0,businessID:"",deviceBrand:"",deviceToken:"",isTpns:0,isWebUniapp:0,notificationStatus:0,deviceModel:"",systemVersion:"",pushVersion:""},keyMap:{request:{tokenID:"TokenID",pushMsg:"PushMsg",sdkAppID:"EnterVersion",businessID:"BusiID",deviceBrand:"InstType",deviceToken:"VarToken",isTpns:"IsTpns",notificationStatus:"NotificationStatus",deviceModel:"DeviceModel",systemVersion:"SystemVersion",pushVersion:"PushPluginVersion"}}}),this._configMap.set(g.STAT_FOREGROUND,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_OPEN_STATUS,".").concat(g.STAT_FOREGROUND)}),body:{isWebUniapp:0}}),this._configMap.set(g.STAT_BACKGROUND,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_OPEN_STATUS,".").concat(g.STAT_BACKGROUND)}),body:{C2CUnread:0,GroupUnread:0,isWebUniapp:0},keyMap:{request:{c2cUnreadCount:"C2cUnread",groupUnreadCount:"GrpUnread"}}}),this._configMap.set(g.PUSH_REPORT,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.OFFLINE_PUSH_REPORT,".").concat(g.PUSH_REPORT)}),body:{eventList:[]},keyMap:{request:{eventList:"UinappPushEvents",type:"EventType",time:"EventTime",pushId:"ClickExt"}}}),this._configMap.set(g.SET_ALL_RECEIVE_MSG_OPT,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_MSG_LOGIC,".").concat(g.SET_ALL_RECEIVE_MSG_OPT)}),body:{startTime:0,endTime:0,isRepeated:0,messageRemindType:0},keyMap:{request:{messageRemindType:"Level"}}}),this._configMap.set(g.GET_ALL_RECEIVE_MSG_OPT,{head:l(l({},e),{},{servcmd:"".concat(L.NAME.IM_MSG_LOGIC,".").concat(g.GET_ALL_RECEIVE_MSG_OPT)}),body:{toAccount:void 0}})}},{key:"has",value:function(e){return this._configMap.has(e)}},{key:"get",value:function(e){return this._configMap.get(e)}},{key:"update",value:function(){this._fillConfigMap()}},{key:"getKeyMap",value:function(e){return this.has(e)?this.get(e).keyMap||{}:(u.w("".concat(this._n,".getKeyMap unknown proto:").concat(e)),{})}},{key:"getProtocolData",value:function(n){var o=n.proto,t=n.data,n=this.get(o),o=null;if(t){var s,i=this._simpleDeepCopy(n),i=this._updateService(t,i),a=i.body,r=Object.create(null);for(s in a)if(Object.prototype.hasOwnProperty.call(a,s)){if(r[s]=a[s],t[s]===void 0)continue;r[s]=t[s]}i.body=r,o=this._getUplinkData(i)}else o=this._getUplinkData(n);return o}},{key:"_getUplinkData",value:function(t){var t=this._dataCleaner(t),n=Gs(t.head),n=Lu(t.body,this._getRequestKeyMap(n));return t.body=n,t}},{key:"_updateService",value:function(e,t){var n,o,s=Gs(t.head);return this._isFromGroupRequest(t)&&(n=e.type,o=e.groupID,e=(e=e.groupIDList)===void 0?[]:e,C(o=o===void 0?void 0:o)&&(o=e[0]||""),lt({type:n,groupID:o})&&(t.head.servcmd="".concat(L.NAME.GRP_COMMUNITY,".").concat(s))),t}},{key:"_isFromGroupRequest",value:function(e){return e.head.servcmd.includes(L.NAME.GRP)||e.head.servcmd.includes(L.NAME.GRP_ATTR)}},{key:"_getRequestKeyMap",value:function(e){return e=this.getKeyMap(e),l(l({},ds.request),e.request)}},{key:"_dataCleaner",value:function(e){var t,n=Array.isArray(e)?[]:Object.create(null);for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&ba(t)&&e[t]!==null&&e[t]!==void 0&&(O(e[t])!=="object"?n[t]=e[t]:n[t]=this._dataCleaner.bind(this)(e[t]));return n}},{key:"_simpleDeepCopy",value:function(e){for(var t,n=Object.keys(e),o={},s=0,i=n.length;s<i;s++)t=n[s],F(e[t])?o[t]=Array.from(e[t]):Ht(e[t])?o[t]=this._simpleDeepCopy(e[t]):o[t]=e[t];return o}}]),Ji),wu=[g.MSG_PUSH_ACK],Fu=(R(ji,[{key:"_c2cMessageArrayHandler",value:function(e){var t=this._sessionM.get(6);t&&(e.dataList.forEach(function(n){var o;n.isSyncMessage===1&&(o=n.from,n.from=n.to,n.to=o)}),e.needSync===1&&this._sessionM.get(19).startOnlineSync(),t.onNewC2CMessage({dataList:e.dataList,isInstantMessage:!0}))}},{key:"_c2cMessageModifiedHandler",value:function(e){var t=this._sessionM.get(6);t&&t.onC2CMessageModified(e)}},{key:"_groupMessageArrayHandler",value:function(e){var t=this._sessionM.get(7);t&&t.onNewGroupMessage({event:e.event,dataList:e.dataList,isInstantMessage:!0})}},{key:"_groupMessageModifiedHandler",value:function(e){var t=this._sessionM.get(7);t&&t.onGroupMessageModified(e)}},{key:"_groupTipsHandler",value:function(e){var t=this._sessionM.get(7);if(t){var n=e.event,o=e.dataList,s=e.isInstantMessage,i=s===void 0||s,a=e.isSyncingEnded;switch(n){case 4:case 6:t.onNewGroupTips({event:n,dataList:o});break;case 5:for(var r=0;r<o.length;r++)if(F(o[r].elements.revokedInfos))t.onGroupMessageRevoked({dataList:o});else if(F(o[r].elements.groupMessageReadNotice))t.onGroupMessageReadNotice({dataList:o});else{if(!F(o[r].elements.readReceiptList)){t.onNewGroupSystemNotice({dataList:o,isInstantMessage:i,isSyncingEnded:a});break}t.onReadReceiptList({dataList:o})}break;case 12:this._sessionM.get(11).onNewGroupAtTips({dataList:o});break;default:u.l("".concat(this._n,"._groupTipsHandler unknown event:").concat(n," dataList:"),o)}}}},{key:"_C2CNotifyMessageArrayHandler",value:function(e){var t,n=this,o=e.dataList;F(o)&&(t=this._sessionM.get(6),o.forEach(function(s){var i,a;Ce(s)&&(s.hasOwnProperty("kickoutMsgNotify")?(i=(a=s.kickoutMsgNotify).kickType,a=(a=a.newInstanceInfo)===void 0?{}:a,i===1?n._sessionM.onMultipleAccountKickedOut(a):i===2?n._sessionM.onMultipleDeviceKickedOut(a):i===3&&n._sessionM.onRestApiKickedOut(a)):s.hasOwnProperty("c2cMessageRevokedNotify")?t&&t.onC2CMessageRevoked({dataList:o}):s.hasOwnProperty("c2cMessageReadReceipt")?t&&t.onC2CMessageReadReceipt({dataList:o}):s.hasOwnProperty("c2cMessageReadNotice")?t&&t.onC2CMessageReadNotice({dataList:o}):s.hasOwnProperty("muteNotificationsSync")&&n._sessionM.get(11).onC2CMessageRemindTypeSynced({dataList:o}))}))}},{key:"_C2CReadReceiptArrayHandler",value:function(e){this._sessionM.get(6).onReadReceiptList(e)}},{key:"_profileHandler",value:function(e){this._sessionM.get(4).onProfileModified({dataList:e.dataList});var t=this._sessionM.get(8);t&&t.onFriendProfileModified({dataList:e.dataList})}},{key:"_relationChainHandler",value:function(e){this._sessionM.get(4).onRelationChainModified({dataList:e.dataList});var t=this._sessionM.get(8);t&&t.onRelationChainModified({dataList:e.dataList})}},{key:"_recentContactHandler",value:function(n){var t,n=n.dataList;!F(n)||(t=this._sessionM.get(11))&&n.forEach(function(o){var s,i,a=o.pushType;a===1?(s=o.recentContactDeleteItem,t.onConversationDeleted(s.recentContactList)):a===2?(s=o.recentContactTopItem,t.onConversationPinned(s.recentContactList)):a===3?(s=o.recentContactTopItem,t.onConversationUnpinned(s.recentContactList)):a===4?(s=o.recentContactMarkContact,t.onConversationMarkUpdated(s.recentContactMarkContactItem)):a===5?(s=o.recentContactCreateContactGroup,t.onConversationGroupCreated(s.msgContactGroupContactItem)):a===6?(s=o.recentContactDelContactGroup,t.onConversationGroupDeleted(s.msgGroupItem)):a===7&&(a=(s=o.recentContactUpdateContactGroup).updateType,o=s.msgUpdateGroup,s=s.msgUpdateContact,a===1?(i=o.updateGroupType)===1?t.onConversationGroupNameUpdated(o):i===2&&t.onConversationInGroupUpdated(o):a===2&&t.onConversationAddedToOrDeletedFromGroup(s))})}},{key:"_allMessageReadHandler",value:function(t){var t=t.dataList,n=this._sessionM.get(11);n&&n.onPushedAllMessageRead(t)}},{key:"_userStatusListHandler",value:function(e){this._sessionM.get(4).onUserStatusUpdated(e)}},{key:"_messageExtensionNotifyHandler",value:function(e){this._sessionM.get(3).onMessageExtensionNotify(e)}},{key:"_messageReactionNotifyListHandler",value:function(e){this._sessionM.get(34).onMessageReactionNotifyList(e)}},{key:"_messageReactionNotifyHandler",value:function(e){this._sessionM.get(34).onMessageReactionNotify(e)}},{key:"_followInfoHandler",value:function(e){this._sessionM.get(35).onFollowInfoNotify(e)}},{key:"onMessage",value:function(e){var t=this,n=e.body;if(this._filterMessageFromIMOpenPush(e)){var o,s=n.eventArray,i=n.isInstantMessage,a=n.isSyncingEnded,r=n.needSync;if(F(s))for(var c,d,p,h=0,m=s.length;h<m;h++)(p=(c=s[h]).event)!==100?p!==24?(o=Object.keys(c).find(function(f){return t._keys.indexOf(f)!==-1}))?(d=p===14?{readAllC2CMessage:c[o],groupMessageReadInfoList:c.groupMessageReadNotice||[]}:p===16?{userID:c.userID,readReceiptList:c[o]}:c[o],this._eventHandlerMap.get(o)({event:p,dataList:d,isInstantMessage:i,isSyncingEnded:a,needSync:r})):u.l("".concat(this._n,".onMessage unknown eventItem:").concat(c)):this._onAllReceiveMessageOptNotify(c):this._onRoomCustomData(c.content)}}},{key:"_onRoomCustomData",value:function(e){this._sessionM.get(30).onRoomCustomDataReceived(e),u.l("".concat(this._n,"._onRoomCustomData data:").concat(e))}},{key:"_onAllReceiveMessageOptNotify",value:function(e){this._sessionM.get(11).onAllReceiveMessageOptNotify(e)}},{key:"_filterMessageFromIMOpenPush",value:function(t){var n=t.head,t=t.body,n=n.servcmd,o=!1;return!(o=C(n)?o:n.includes(L.NAME.IM_CONFIG_MANAGER)||n.includes(L.NAME.OVERLOAD_PUSH)||n.includes(L.NAME.STAT_SERVICE))||(n.includes(g.PUSHED_CLOUD_CTRL_CONFIG)?this._sessionM.get(23).onPushedCloudControlConfig(t):n.includes(g.PUSHED_COMMERCIAL_CONFIG)?this._sessionM.get(27).onPushedConfig(t):n.includes(g.OVERLOAD_NOTIFY)?this._sessionM.onPushedServerOverload(t):n.includes(g.KICK_OTHER)&&(o=Date.now(),this._sessionM.reLoginOnKickOther(),t=new S("kickOther"),o=o-(n=this._sessionM.get(1).getLastWsHelloTs()),t.setMessage("last wshello time:".concat(n," diff:").concat(o,"ms")).end()),!1)}}]),ji),Gr=[{cmd:g.GET_GRP_PROFILE,interval:1,count:8},{cmd:g.UPDATE_GRP_PROFILE,interval:1,count:8},{cmd:g.GET_AVCHATROOM_MBR_LIST,interval:3,count:1},{cmd:g.GET_GRP_PENDENCY,interval:1,count:15},{cmd:g.GET_TOPIC_LIST,interval:1,count:10},{cmd:g.SET_GRP_ATTR,interval:5,count:10},{cmd:g.MODIFY_GRP_ATTR,interval:5,count:10},{cmd:g.DEL_GRP_ATTR,interval:5,count:10},{cmd:g.CLEAR_GRP_ATTR,interval:5,count:10},{cmd:g.GET_GRP_ATTR,interval:5,count:20},{cmd:g.UPDATE_GRP_COUNTER,interval:5,count:20},{cmd:g.GET_GRP_COUNTER,interval:5,count:20},{cmd:g.SET_ALL_MSG_READ,interval:1,count:1},{cmd:g.GET_USER_STATUS,interval:5,count:20},{cmd:g.SUB_USER_STATUS,interval:5,count:20},{cmd:g.UNSUB_USER_STATUS,interval:5,count:20},{cmd:g.MSG_CLOUD_SEARCH,interval:1,count:2},{cmd:g.CHECK_FOLLOW_TYPE,interval:5,count:20}],Yi=new Map,Pr=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],ps=0,qu=Pr.length;ps<qu;ps++)Yi.set(ps,Pr[ps]);function ji(e){D(this,ji),this._sessionM=e,this._n="DownlinkHandler",this._eventHandlerMap=new Map,this._eventHandlerMap.set("C2CMessageArray",this._c2cMessageArrayHandler.bind(this)),this._eventHandlerMap.set("groupMessageArray",this._groupMessageArrayHandler.bind(this)),this._eventHandlerMap.set("groupTips",this._groupTipsHandler.bind(this)),this._eventHandlerMap.set("C2CNotifyMessageArray",this._C2CNotifyMessageArrayHandler.bind(this)),this._eventHandlerMap.set("C2CReadReceiptArray",this._C2CReadReceiptArrayHandler.bind(this)),this._eventHandlerMap.set("profileModify",this._profileHandler.bind(this)),this._eventHandlerMap.set("friendListMod",this._relationChainHandler.bind(this)),this._eventHandlerMap.set("recentContactMod",this._recentContactHandler.bind(this)),this._eventHandlerMap.set("readAllC2CMessage",this._allMessageReadHandler.bind(this)),this._eventHandlerMap.set("c2cMessageModified",this._c2cMessageModifiedHandler.bind(this)),this._eventHandlerMap.set("groupMessageModified",this._groupMessageModifiedHandler.bind(this)),this._eventHandlerMap.set("userStatusList",this._userStatusListHandler.bind(this)),this._eventHandlerMap.set("messageExtensionNotify",this._messageExtensionNotifyHandler.bind(this)),this._eventHandlerMap.set("messageReactionNotifyList",this._messageReactionNotifyListHandler.bind(this)),this._eventHandlerMap.set("messageReactionNotify",this._messageReactionNotifyHandler.bind(this)),this._eventHandlerMap.set("follow",this._followInfoHandler.bind(this)),this._keys=b(this._eventHandlerMap.keys())}function Ji(e){D(this,Ji),this._n="ProtocolHandler",this._sessionM=e,this._configMap=new Map,this._fillConfigMap()}function ho(e){var t,n;return D(this,ho),(e=Nr.call(this,e))._n="ChannelModule",e._socketHandler=new Ou(K(e)),e._probing=!1,e._isAppShowing=!0,e._previousState=_.NET_STATE_CONNECTED,ge&&typeof ce.onAppShow=="function"&&typeof ce.onAppHide=="function"&&(t=e._onAppHide.bind(K(e)),n=e._onAppShow.bind(K(e)),typeof ce.offAppHide=="function"&&ce.offAppHide(t),typeof ce.offAppShow=="function"&&ce.offAppShow(n),ce.onAppHide(t),ce.onAppShow(n)),e._timerForNotLoggedIn=-1,e._timerForNotLoggedIn=setInterval(e.onCheckTimer.bind(K(e)),1e3),e._fatalErrorFlag=!1,e._disconnectedTS=0,e._lastDiagnoseTS=0,e}function zi(e){D(this,zi),this._chM=e,this._n="SocketHandler",this._promiseMap=new Map,this._readyState=Rn,this._simpleRequestMap=new Map,this.MAX_SIZE=100,this._startSequence=St(),this._startTs=0,this._reConnectFlag=!1,this._nextPingTs=0,this._reConnectCount=0,this.MAX_RECONNECT_COUNT=3,this._socketID=-1,this._random=0,this._socket=null,this._url="",this._onOpenTs=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0,this._currentSite=nt,this._setWebsocketHost(),this._initConnection()}function Xi(e){D(this,Xi);var t,n,o=(this._handler=e).getURL();this._socket=null,this._workerSocket=null,this._id=St(),this._handler.getIsWorkerEnabled()?(t=URL.createObjectURL(new Blob([';let _socket = null;onmessage = function(event) {  if (event.data.cmd === "start") {    const url = event.data.url;    _socket = new WebSocket(url);    _socket.binaryType = "arraybuffer";    _socket.onopen = function() {      postMessage({ callback: "onOpen", extensions: _socket.extensions });    };    _socket.onclose = function(e) {      postMessage({ callback: "onOpen", e: { code: e.code, reason: e.reason } });    };    _socket.onmessage = function(e) {      postMessage({ callback: "onMessage", data: e.data });    };    _socket.onerror = function(e) {      postMessage({ callback: "onError", e: { isTrusted: "true" } });    };  } else if (event.data.cmd === "sendMessage") {    if (_socket !== null) {      _socket.send(event.data.data);    }  } else if (event.data.cmd === "stop") {    if (_socket !== null) {      _socket.close(event.data.code);      _socket = null;    }  }};'],{type:"application/javascript; charset=utf-8"})),this._workerSocket=new Worker(t),(n=this)._workerSocket.onmessage=function(s){var r=s.data,i=r.callback,a=r.e,r=r.extensions;i==="onOpen"?n._onOpen(r):i==="onClose"?n._onClose(a):i==="onError"?n._onError(a):i==="onMessage"&&n._onMessage(s.data)},this._workerSocket.postMessage({cmd:"start",id:this._id,url:o})):ge?gt?(ce.connectSocket({url:o,header:{"content-type":"application/json"}}),ce.onSocketClose(this._onClose.bind(this)),ce.onSocketOpen(this._onOpen.bind(this)),ce.onSocketMessage(this._onMessage.bind(this)),ce.onSocketError(this._onError.bind(this))):(this._socket=ce.connectSocket({url:o,header:{"content-type":"application/json"},complete:function(){}}),this._socket.onClose(this._onClose.bind(this)),this._socket.onOpen(this._onOpen.bind(this)),this._socket.onMessage(this._onMessage.bind(this)),this._socket.onError(this._onError.bind(this))):qe&&(this._socket=new WebSocket(o),this._socket.binaryType="arraybuffer",this._socket.onopen=this._onOpen.bind(this,this._socket.extensions),this._socket.onmessage=this._onMessage.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onerror=this._onError.bind(this)),this._canIUseBinaryFrame=e.canIUseBinaryFrame()}function $i(e){for(var t,n,o=e,s="",i=0,a=(o=e.length%8!=0?"0".repeat(8-e.length%8)+e:o).length;i<a;i+=8)t=parseInt(o.slice(i,i+4),2),n=parseInt(o.slice(i+4,i+8),2),s+=Yi.get(t)+Yi.get(n);return s}function xu(e){if(e<0||53<e)return NaN;var t=0|1073741824*Math.random();return 30<e?t+1073741824*(0|Math.random()*(1<<e-30)):t>>>30-e}function Vu(e,t){for(var n=e.toString(16),o=t-n.length,s="0";0<o;o>>>=1,s+=s)1&o&&(n=s+n);return n}z(So,Oe),Wr=X(So),R(So,[{key:"_init",value:function(){this._updateCommandFrequencyLimitMap(Gr)}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("cmd_frequency_limit");C(e)||(e=JSON.parse(e),this._updateCommandFrequencyLimitMap(e))}},{key:"_updateCommandFrequencyLimitMap",value:function(e){var t=this;e.forEach(function(n){t._commandFrequencyLimitMap.set(n.cmd,{interval:n.interval,count:n.count})})}},{key:"updateProtocolConfig",value:function(){this._protocolHandler.update()}},{key:"req",value:function(o){u.d("".concat(this._n,".req options:"),o);var t=o.proto,n=o.tjgID;if(!this._protocolHandler.has(t))return u.w("".concat(this._n,".req unknown proto:").concat(t)),v({code:M.CANNOT_FIND_PROTOCOL});var o=this.getProtocolData(o),s=o.head.servcmd;if(this._isFrequencyOverLimit(s))return v({code:i=M.OVER_FREQUENCY_LIMIT,message:this.getErrorMessage(i,this._getCmd(s))});if(this._isServerOverload(s))return v({code:i=M.OPEN_SERVICE_OVERLOAD_ERROR,message:this.getErrorMessage(i,this._getCmd(s))});G(n)||(o.head.tjgID=n);var i=this.get(21);return wu.includes(t)?i.simplySend(o):i.send(o)}},{key:"getKeyMap",value:function(e){return this._protocolHandler.getKeyMap(e)}},{key:"genCommonHead",value:function(){var e=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:we,websdkversion:ae,a2:e.getA2Key()||void 0,tinyid:e.getTinyID()||void 0,status_instid:e.getStatusInstanceID(),sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getA2Key()?void 0:e.getUserID(),usersig:e.getA2Key()?void 0:e.getUserSig(),sdkability:192371,sdkability_ext:$i(""),cappid:e.getApplicationID(),tjgID:""}}},{key:"genCosSpecifiedHead",value:function(){var e=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:we,websdkversion:ae,sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getUserID(),usersig:e.getUserSig(),status_instid:e.getStatusInstanceID(),sdkability:192371,sdkability_ext:$i(""),cappid:e.getApplicationID()}}},{key:"genSSOReportHead",value:function(){var e=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:we,websdkversion:ae,sdkappid:e.getSDKAppID(),contenttype:"",reqtime:0,identifier:"",usersig:"",status_instid:e.getStatusInstanceID(),sdkability:192371,sdkability_ext:$i(""),cappid:e.getApplicationID()}}},{key:"getProtocolData",value:function(e){return this._protocolHandler.getProtocolData(e)}},{key:"trans",value:function(t){var n=t.servcmd,t=t.data,n={head:l(l({},this.genCommonHead()),{},{servcmd:n}),body:t};return this.get(21).send(n)}},{key:"sendComboMessage",value:function(t){var n=t.servcmd,t=t.data,n={head:l(l({},this.genCommonHead()),{},{servcmd:n}),body:t};return this.get(21).send(n)}},{key:"onErrorCodeNotZero",value:function(e){var t,n=e.errorCode;n===M.HELLO_ANSWER_KICKED_OUT&&(t=e.kickType,e=(e=e.newInstanceInfo)===void 0?{}:e,t===1?this.onMultipleAccountKickedOut(e):t===2?this.onMultipleDeviceKickedOut(e):t===3&&this.onRestApiKickedOut(e)),n!==M.MSG_A2KEY_EXPIRED&&n!==M.ACCOUNT_A2KEY_EXPIRED||(this._onUserSigExpired(),this.get(21).reConnect())}},{key:"onMessage",value:function(e){var n=e.body,t=n.needAck,n=n.sessionData;(t===void 0?0:t)===1&&this._sendACK(n),this._messageDispatcher.onMessage(e)}},{key:"onReconnected",value:function(e){this._incrementalPullContactFlag=e<=300,this._reLoginOnReconnected()}},{key:"reLoginOnKickOther",value:function(){u.l("".concat(this._n,".reLoginOnKickOther")),this._reLogin()}},{key:"_reLoginOnReconnected",value:function(){u.l("".concat(this._n,"._reLoginOnReconnected")),this._reLogin()}},{key:"_reLogin",value:function(){var e,t,n,o=this,s="".concat(this._n,"._reLogin");this.isLoggedIn()&&(e=0,(t=this.get(1).getPushModule())&&(e=t.getUniAppPlatform()),n=new S("reLogin"),this.req({proto:g.LOGIN,data:{isWebUniapp:e}}).then(function(a){var a=a.data,r=a.instanceID,a=a.customStatus,c=o.get(12),d=rs(a),r=(c.setStatusInstanceID(r),"instanceID:".concat(r," customStatus:").concat(d)),r=(n.setMessage(r).end(!0),u.l("".concat(s," ok. ").concat(r)),c.getCustomStatus()!==d&&o.get(4).onUserStatusUpdated({dataList:[{to:o.getMyUserID(),statusType:_.USER_STATUS_ONLINE,customStatus:a}]}),o.get(21).diagnose(),o.get(11).syncConversationList(o._incrementalPullContactFlag).then(function(){u.l("".concat(s,", sync conversation list ok.")),o.get(25).start()}),o.get(7)),c=(r&&r.updateLocalMainSequenceOnReconnected(),o.get(10)),d=(c.resetGetTopicTime(),c.getTopicListOnReconnected(),o.get(35));d&&d.clearCacheOnReconnected()}))}},{key:"onMultipleAccountKickedOut",value:function(e){this.get(1).onMultipleAccountKickedOut(e)}},{key:"onMultipleDeviceKickedOut",value:function(e){this.get(1).onMultipleDeviceKickedOut(e)}},{key:"_onUserSigExpired",value:function(){this.get(1).onUserSigExpired()}},{key:"onRestApiKickedOut",value:function(e){this.get(1).onRestApiKickedOut(e)}},{key:"_sendACK",value:function(e){this.req({proto:g.MSG_PUSH_ACK,data:{sessionData:e}})}},{key:"_isFrequencyOverLimit",value:function(e){if(e=e.split(".")[1],!this._commandFrequencyLimitMap.has(e))return!1;if(!this._commandRequestInfoMap.has(e))return this._commandRequestInfoMap.set(e,{startTime:Date.now(),requestCount:1}),!1;var n=this._commandFrequencyLimitMap.get(e),t=n.count,n=n.interval,s=this._commandRequestInfoMap.get(e),o=s.startTime,s=s.requestCount;return Date.now()-o>1e3*n?(this._commandRequestInfoMap.set(e,{startTime:Date.now(),requestCount:1}),!1):(this._commandRequestInfoMap.set(e,{startTime:o,requestCount:s+=1}),t<s)}},{key:"_isServerOverload",value:function(e){if(!this._serverOverloadInfoMap.has(e))return!1;var n=this._serverOverloadInfoMap.get(e),t=n.overloadTime,n=n.waitingTime;return Date.now()-t<=1e3*n||(this._serverOverloadInfoMap.delete(e),!1)}},{key:"_getCmd",value:function(e){var t="";if(!e.includes("."))return t;var n,o=e.split(".")[1];for(n in g)if(g[n]===o){t=n;break}return t}},{key:"onPushedServerOverload",value:function(n){var t=n.overloadCommand,n=n.waitingTime;this._serverOverloadInfoMap.set(t,{overloadTime:Date.now(),waitingTime:n}),u.w("".concat(this._n,".onPushedServerOverload waitingTime:").concat(n,"s cmd:").concat(this._getCmd(t)))}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._updateCommandFrequencyLimitMap(Gr),this._commandRequestInfoMap.clear(),this._serverOverloadInfoMap.clear(),this._incrementalPullContactFlag=!0}}]);var Ur,br,wr,Fr,qr,xr,Vr,Br,Hr,Kr,Wr,Bu=So,Hu=(z(Do,Oe),Kr=X(Do),R(Do,[{key:"getCloudConfig",value:function(e){return C(e)?this._cloudConfig:this._cloudConfig.has(e)?this._cloudConfig.get(e):void 0}},{key:"getServerConfig",value:function(e){var t={code:0,data:""};return!C(e)&&this._cloudConfig.has(e)&&(t.data=this._cloudConfig.get(e)),Promise.resolve(t)}},{key:"_canFetchConfig",value:function(){return this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime}},{key:"fetchConfig",value:function(){var e,t=this,n=this._canFetchConfig();u.l("".concat(this._n,".fetchConfig canFetchConfig:").concat(n)),n&&(e=new S("fetchCloudControlConfig"),n=this.get(12).getSDKAppID(),this._isFetching=!0,this.req({proto:g.FETCH_CLOUD_CTRL_CONFIG,data:{SDKAppID:n,version:this._version}}).then(function(o){t._isFetching=!1,e.setMessage("version:".concat(t._version," newVersion:").concat(o.data.version," config:").concat(o.data.cloudControlConfig)).end(),u.l("".concat(t._n,".fetchConfig ok")),t._parseCloudControlConfig(o.data)}).catch(function(o){t._isFetching=!1,e.setError(o).end(),u.l("".concat(t._n,".fetchConfig failed. error:"),o),t._setExpiredTimeOnResponseError(12e4)}))}},{key:"onPushedCloudControlConfig",value:function(e){u.l("".concat(this._n,".onPushedCloudControlConfig")),new S("pushedCloudControlConfig").setMessage("newVersion:".concat(e.version," config:").concat(e.cloudControlConfig)).end(),this._parseCloudControlConfig(e)}},{key:"onCheckTimer",value:function(e){this._canFetchConfig()&&this.fetchConfig()}},{key:"_parseCloudControlConfig",value:function(e){var t=this,n="".concat(this._n,"._parseCloudControlConfig"),o=e.errorCode,s=e.errorMessage,i=e.cloudControlConfig,a=e.version,r=e.expiredTime;if(o===0){if(this._version!==a){var c=null;try{c=JSON.parse(i)}catch{this.isPrivateNetWork()||u.e("".concat(n," JSON parse error. cloudControlConfig:"),i)}c&&(this._cloudConfig.clear(),Object.keys(c).forEach(function(d){t._cloudConfig.set(d,c[d])}),this._version=a,this.emitInnerEvent(Re.CLOUD_CONFIG_UPDATED))}this._expiredTime=Date.now()+1e3*r}else C(o)?(u.l("".concat(n," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(u.e("".concat(n," errorCode:").concat(o," errorMessage:").concat(s)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._cloudConfig.clear(),this._expiredTime=0,this._version=0,this._isFetching=!1}}]),Do),Ku=(z(To,Oe),Hr=X(To),R(To,[{key:"start",value:function(){this._recoverGroupChat(),this._recoverC2CChat()}},{key:"_recoverGroupChat",value:function(){var e,t,n,o,s=this,i=this._getLocalConversationList().filter(function(c){return c.type===_.CONV_GROUP&&c.groupProfile.type!==_.GRP_AVCHATROOM}),a=this.get(11),r=[];i.forEach(function(p){var d=p.conversationID,p=p.lastMessage;e=d.replace(_.CONV_GROUP,""),t=a.getLocalLastMessage(d),p&&p.lastSequence!==0&&t?(n=p.lastSequence,t=t.sequence,o=n-t,0<t&&1<=o&&o<300?s._recoverGroupMessage({groupID:e,localLastMessageSequence:t,remoteLastMessageSequence:n}):r.push(e)):r.push(e)}),this._getGroupNotify(r)}},{key:"_recoverC2CChat",value:function(){var e,t,n,o=this,s=this._getLocalConversationList().filter(function(r){return r.type===_.CONV_C2C}),i=this.get(11),a=[Promise.resolve()];s.forEach(function(d){var c=d.conversationID,d=d.lastMessage;e=i.getLocalLastMessage(c),d&&d.lastTime!==0&&e&&(t=d.lastTime,e=e.time,n=t-e,0<e&&1<=n&&n<=600&&a.push(o._recoverC2CMessage({conversationID:c,localLastMessageTime:e,remoteLastMessageTime:t})))}),Promise.all(a).then(function(){u.l("".concat(o._n,"._recoverC2CChat all promise fulfilled, start to sync unread messages")),o.get(19).startSyncOnReconnected()})}},{key:"_getLocalConversationList",value:function(){return this.get(11).getLocalConversationList()}},{key:"_recoverGroupMessage",value:function(e){var t=this,n="".concat(this._n,"._recoverGroupMessage"),o=(u.l("".concat(n," options:"),e),e.groupID),s=e.localLastMessageSequence,i=e.remoteLastMessageSequence;this._getGroupRoamingMessage({groupID:o,sequence:s}).then(function(r){var r=r.data,c=r.complete,d=r.messageList;if(!C(d)){var r=d[0].sequence,p=d.map(function(k){return k.sequence}),p="groupID:".concat(o," pkgLastSequence:").concat(r," remoteLastSequence:").concat(i," complete:").concat(c," sequenceList:").concat(p),h=(u.l("".concat(n," ").concat(p)),r<i&&c!==2&&t._recoverGroupMessage({groupID:o,localLastMessageSequence:r,remoteLastMessageSequence:i}),new S("recoverMessage").setMessage(p).end(),t.get(7));1<d.length&&d.sort(function(k,N){return k.sequence-N.sequence});for(var m=0;m<d.length;m++){var f=d[m];f.from!==_.CONV_SYSTEM?h.onNewGroupMessage({dataList:[f],isInstantMessage:!1,updateUnreadCount:!1}):h.onNewGroupTips({event:f.event,dataList:[f]})}t._getGroupNotify([o])}})}},{key:"_genMultiGroupIDList",value:function(e,t){var n=t&&1<t?t:1,o=e.length,s=[];if(0<o)for(var i=0;i<o;i+=n)s.push(e.slice(i,i+n));return s}},{key:"_getGroupNotify",value:function(e){var t=this._genMultiGroupIDList(e,10);if(0<t.length)for(var n=this.get(7),o=0,s=t.length;o<s;o++)n.getGroupNotify(t[o])}},{key:"_getGroupRoamingMessage",value:function(n){var t=n.groupID,n=n.sequence;return this.req({proto:g.GET_GRP_ROAMING_MSG,data:{groupID:t,count:this.PULL_LIMIT_COUNT,sequence:n+this.PULL_LIMIT_COUNT-1}})}},{key:"_recoverC2CMessage",value:function(e){var t=this,n="".concat(this._n,"._recoverC2CMessage"),o=(u.l("".concat(n," options:"),e),e.conversationID),s=e.localLastMessageTime,i=e.remoteLastMessageTime;return this._getC2CRoamingMessage({conversationID:o,time:s}).then(function(c){var c=c.data,r=c.complete,c=c.messageList;if(!C(c)){var d=c.length,d=(t.get(6).onNewC2CMessage({dataList:c,isInstantMessage:!0}),c[d-1].time),c=c.map(function(m){return m.random}),p=o.replace(_.CONV_C2C,""),p="peerAccount:".concat(p," pkgLastTime:").concat(d," remoteLastTime:").concat(i," complete:").concat(r," randomList:").concat(c);if(u.l("".concat(n," ").concat(p)),new S("recoverMessage").setMessage(p).end(),d<i&&r!==1)return t._recoverC2CMessage({conversationID:o,localLastMessageTime:d,remoteLastMessageTime:i})}})}},{key:"_getC2CRoamingMessage",value:function(n){var t=n.conversationID,n=n.time;return this.req({proto:g.GET_C2C_ROAMING_MSG,data:{peerAccount:t.replace(_.CONV_C2C,""),count:this.PULL_LIMIT_COUNT+1,lastMessageTime:n,direction:1}})}},{key:"reset",value:function(){u.l("".concat(this._n,".reset"))}}]),To),Wu=(R(ma,[{key:"addMessageDelay",value:function(e){e=Mn()-e,0<=e&&this._e2eDelayArray.push(e)}},{key:"_calcAvg",value:function(e,t){if(t===0)return 0;var n=0;return e.forEach(function(o){n+=o}),wt(n/t,1)}},{key:"_calcCountWithLimit",value:function(e){var t=e.e2eDelayArray,n=e.min,o=e.max;return t.filter(function(s){return n<=s&&s<o}).length}},{key:"_calcPercent",value:function(e,t){return e=wt(e/t*100,2),e=100<e?100:e}},{key:"_checkE2EDelayException",value:function(e,t){var n,o,s,i=e.filter(function(a){return t<a});0<i.length&&(n=i.length,o=Math.min.apply(Math,b(i)),s=Math.max.apply(Math,b(i)),i=this._calcAvg(i,n),50<(e=wt(n/e.length*100,2))&&new S("messageE2EDelayException").setMessage("count:".concat(n," min:").concat(o," max:").concat(s," avg:").concat(i," percent:").concat(e)).setLevel("warning").end())}},{key:"getStatResult",value:function(){var e=this._e2eDelayArray.length;if(e===0)return null;var t=b(this._e2eDelayArray),n=this._calcCountWithLimit({e2eDelayArray:t,min:0,max:1}),o=this._calcCountWithLimit({e2eDelayArray:t,min:1,max:3}),s=this._calcPercent(n,e),i=this._calcPercent(o,e),a=this._calcAvg(t,e);return this._checkE2EDelayException(t,3),t.length=0,this.reset(),{totalCount:e,countLessThan1Second:n,percentOfCountLessThan1Second:s,countLessThan3Second:o,percentOfCountLessThan3Second:i,avgDelay:a}}},{key:"reset",value:function(){this._e2eDelayArray.length=0}}]),ma),Yu=(R(fa,[{key:"addRequestCount",value:function(){this._requestCount+=1}},{key:"addRTT",value:function(e){this._rttArray.push(e)}},{key:"_calcTotalCount",value:function(){return this._requestCount}},{key:"_calcRTTCount",value:function(e){return e.length}},{key:"_calcSuccessRateOfRequest",value:function(e,t){return t===0?0:(e=wt(e/t*100,2),e=100<e?100:e)}},{key:"_calcAvg",value:function(e,t){if(t===0)return 0;var n=0;return e.forEach(function(o){n+=o}),parseInt(n/t)}},{key:"_calcMax",value:function(){return Math.max.apply(Math,b(this._rttArray))}},{key:"_calcMin",value:function(){return Math.min.apply(Math,b(this._rttArray))}},{key:"getStatResult",value:function(){var e=this._calcTotalCount(),o=b(this._rttArray);if(e===0)return null;var t=this._calcRTTCount(o),n=this._calcSuccessRateOfRequest(t,e),o=this._calcAvg(o,t);return u.l("".concat(this._n,".getStatResult max:").concat(this._calcMax()," min:").concat(this._calcMin()," avg:").concat(o)),this.reset(),{totalCount:e,rttCount:t,successRateOfRequest:n,avgRTT:o}}},{key:"reset",value:function(){this._requestCount=0,this._rttArray.length=0}}]),fa),ju=(R(ha,[{key:"initMap",value:function(e){var t=this;e.forEach(function(n){t._map.set(n,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})})}},{key:"addTotalCount",value:function(e){return!(C(e)||!this._map.has(e)||(this._map.get(e).totalCount+=1,0))}},{key:"addSuccessCount",value:function(e){return!(C(e)||!this._map.has(e)||(this._map.get(e).successCount+=1,0))}},{key:"addFailedCountOfUserSide",value:function(e){return!(C(e)||!this._map.has(e)||(this._map.get(e).failedCountOfUserSide+=1,0))}},{key:"addCost",value:function(e,t){return!(C(e)||!this._map.has(e)||(this._map.get(e).costArray.push(t),0))}},{key:"addFileSize",value:function(e,t){return!(C(e)||!this._map.has(e)||(this._map.get(e).fileSizeArray.push(t),0))}},{key:"_calcSuccessRateOfBusiness",value:function(e){return C(e)||!this._map.has(e)?-1:(e=this._map.get(e),e=wt(e.successCount/e.totalCount*100,2),e=100<e?100:e)}},{key:"_calcSuccessRateOfPlatform",value:function(n){if(C(n)||!this._map.has(n))return-1;var t=this._map.get(n),n=this._calcSuccessCountOfPlatform(n)/t.totalCount*100;return n=100<(n=wt(n,2))?100:n}},{key:"_calcTotalCount",value:function(e){return C(e)||!this._map.has(e)?-1:this._map.get(e).totalCount}},{key:"_calcSuccessCountOfBusiness",value:function(e){return C(e)||!this._map.has(e)?-1:this._map.get(e).successCount}},{key:"_calcSuccessCountOfPlatform",value:function(e){return C(e)||!this._map.has(e)?-1:(e=this._map.get(e),e.successCount+e.failedCountOfUserSide)}},{key:"_calcAvg",value:function(e){return C(e)||!this._map.has(e)?-1:e===vt?this._calcAvgSpeed(e):this._calcAvgCost(e)}},{key:"_calcAvgCost",value:function(e){var t=this._map.get(e).costArray.length;if(t===0)return 0;var n=0;return this._map.get(e).costArray.forEach(function(o){n+=o}),parseInt(n/t)}},{key:"_calcAvgSpeed",value:function(e){var t=0,n=0;return this._map.get(e).costArray.forEach(function(o){t+=o}),this._map.get(e).fileSizeArray.forEach(function(o){n+=o}),parseInt(1e3*n/t)}},{key:"getStatResult",value:function(e){var t=this._calcTotalCount(e);if(t===0)return null;var n=this._calcSuccessCountOfBusiness(e),o=this._calcSuccessRateOfBusiness(e),s=this._calcSuccessCountOfPlatform(e),i=this._calcSuccessRateOfPlatform(e),a=this._calcAvg(e);return this.reset(e),{totalCount:t,successCountOfBusiness:n,successRateOfBusiness:o,successCountOfPlatform:s,successRateOfPlatform:i,avgValue:a}}},{key:"reset",value:function(e){C(e)?this._map.clear():this._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}}]),ha),Ju=(R(ga,[{key:"initMap",value:function(e){var t=this;e.forEach(function(n){t._lastMap.set(n,new Map),t._currentMap.set(n,new Map)})}},{key:"addMessageSequence",value:function(e){var t=e.key,s=e.message;if(C(t)||!this._lastMap.has(t)||!this._currentMap.has(t))return!1;var n,o,i=s.conversationID,s=s.sequence,i=i.replace(_.CONV_GROUP,"");return this._lastMap.get(t).size!==0&&this._lastMap.get(t).has(i)?(o=(n=this._lastMap.get(t).get(i)).length-1,s>n[0]&&s<n[o]?(n.push(s),n.sort(),this._lastMap.get(t).set(i,n)):this._addCurrentMap(e)):this._addCurrentMap(e),!0}},{key:"_addCurrentMap",value:function(n){var t=n.key,n=n.message,o=n.conversationID,n=n.sequence,o=o.replace(_.CONV_GROUP,"");this._currentMap.get(t).has(o)||this._currentMap.get(t).set(o,[]),this._currentMap.get(t).get(o).push(n)}},{key:"_copyData",value:function(e){if(!C(e)){this._lastMap.set(e,new Map);var t,n=this._lastMap.get(e),o=Ee(this._currentMap.get(e));try{for(o.s();!(t=o.n()).done;){var s=$(t.value,2),i=s[0],a=s[1];n.set(i,a)}}catch(r){o.e(r)}finally{o.f()}n=null,this._currentMap.set(e,new Map)}}},{key:"getStatResult",value:function(e){if(C(this._currentMap.get(e))||C(this._lastMap.get(e)))return null;if(this._lastMap.get(e).size===0)return this._copyData(e),null;var t=0,n=0;if(this._lastMap.get(e).forEach(function(r,i){var r=b(r.values()),a=r.length,r=r[a-1]-r[0]+1;t+=r,n+=a}),t===0)return null;var o=wt(n/t*100,2);return 100<o&&(o=100),this._copyData(e),{totalCount:t,successCountOfMessageReceived:n,successRateOfMessageReceived:o}}},{key:"reset",value:function(){this._currentMap.clear(),this._lastMap.clear()}}]),ga),zu=(z(Co,Oe),Br=X(Co),R(Co,[{key:"_onLoginSuccess",value:function(){var e=this,t=(this._rateMessageSent.initMap(this._messageSentItems),this._rateMessageReceived.initMap(this._messageReceivedItems),this.get(13)),n=t.getItem(this.TAG,!1);!G(n)&&Xe(n.forEach)&&(u.l("".concat(this._n,"._onLoginSuccess. logs count:").concat(n.length)),n.forEach(function(o){e._statInfoArr.push(o)}),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("q_rpt_interval"),t=this.getCloudConfig("q_rpt_sdkappid_bl"),n=this.getCloudConfig("q_rpt_tinyid_wl");C(e)||(this.REPORT_INTERVAL=Number(e)),C(t)||(this.REPORT_SDKAPPID_BLACKLIST=t.split(",").map(function(o){return Number(o)})),C(n)||(this.REPORT_TINYID_WHITELIST=n.split(","))}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this.REPORT_INTERVAL==0&&(this.wholePeriod=!0,this._report())}},{key:"addRequestCount",value:function(){this._avgRTT.addRequestCount()}},{key:"addRTT",value:function(e){this._avgRTT.addRTT(e)}},{key:"addMessageDelay",value:function(e){this._avgE2EDelay.addMessageDelay(e)}},{key:"addTotalCount",value:function(e){this._rateMessageSent.addTotalCount(e)||u.w("".concat(this._n,".addTotalCount invalid key:"),e)}},{key:"addSuccessCount",value:function(e){this._rateMessageSent.addSuccessCount(e)||u.w("".concat(this._n,".addSuccessCount invalid key:"),e)}},{key:"addFailedCountOfUserSide",value:function(e){this._rateMessageSent.addFailedCountOfUserSide(e)||u.w("".concat(this._n,".addFailedCountOfUserSide invalid key:"),e)}},{key:"addCost",value:function(e,t){this._rateMessageSent.addCost(e,t)||u.w("".concat(this._n,".addCost invalid key or cost:"),e,t)}},{key:"addFileSize",value:function(e,t){this._rateMessageSent.addFileSize(e,t)||u.w("".concat(this._n,".addFileSize invalid key or size:"),e,t)}},{key:"addMessageSequence",value:function(e){this._rateMessageReceived.addMessageSequence(e)||u.w("".concat(this._n,".addMessageSequence invalid key:"),e.key)}},{key:"_getQualityItem",value:function(e){var t={},n=sr[this.get(15).getNetworkType()],n=(C(n)&&(n=8),{qualityType:Lc[e],timestamp:kt(),networkType:n,extension:""});switch(e){case Vs:t=this._avgRTT.getStatResult();break;case Bs:t=this._avgE2EDelay.getStatResult();break;case Sn:case Ln:case En:case _n:case vt:t=this._rateMessageSent.getStatResult(e);break;case kn:case Jn:case zn:t=this._rateMessageReceived.getStatResult(e)}return t===null?null:l(l({},n),t)}},{key:"_report",value:function(i){var t=this,n=[],o=null,i=(C(i)?this._qualityItems.forEach(function(a){(o=t._getQualityItem(a))!==null&&(o.reportIndex=t.reportIndex,o.wholePeriod=t.wholePeriod,n.push(o))}):(o=this._getQualityItem(i))!==null&&(o.reportIndex=this.reportIndex,o.wholePeriod=this.wholePeriod,n.push(o)),u.d("".concat(this._n,"._report"),n),0<this._statInfoArr.length&&(n=n.concat(this._statInfoArr),this._statInfoArr=[]),this.get(12)),s=i.getSDKAppID(),i=i.getTinyID();0<(n=Wa(this.REPORT_SDKAPPID_BLACKLIST,s)&&!Ya(this.REPORT_TINYID_WHITELIST,i)?[]:n).length&&this._doReport(n)}},{key:"_doReport",value:function(e){var t=this,n={header:Ir(this),quality:e};this.req({proto:g.SSO_STAT,data:l({},n)}).then(function(){t.reportIndex++,t.wholePeriod=!1}).catch(function(o){u.w("".concat(t._n,"._doReport failed. error:"),o),t._statInfoArr=t._statInfoArr.concat(e),t._flushAtOnce()})}},{key:"_flushAtOnce",value:function(){var e=this.get(13),t=e.getItem(this.TAG,!1),n=this._statInfoArr,o="".concat(this._n,"._flushAtOnce");G(t)?(u.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1)):(10<(n=n.concat(t)).length&&(n=n.slice(0,10)),u.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1)),this._statInfoArr=[]}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._report(),this.reportIndex=0,this.wholePeriod=!1,this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[],this._avgRTT.reset(),this._avgE2EDelay.reset(),this._rateMessageSent.reset(),this._rateMessageReceived.reset()}}]),Co),Yr=R(function e(t){D(this,e),G(t)||(this.userID=t.userID||"",this.nick=t.nick||"",this.avatar=t.avatar||"",this.time=t.time||0,this.source=t.source||"",this.wording=t.wording||"",this.type=t.type||"")}),Xu=(R(_a,[{key:"getLocalFriendApplicationList",value:function(){return{friendApplicationList:b(this._friendApplicationMap.values()),unreadCount:this._unreadCount}}},{key:"_onFriendApplicationListUpdated",value:function(){this._snsM.emitOuterEvent(V.FRIEND_APPLICATION_LIST_UPDATED,{friendApplicationList:b(this._friendApplicationMap.values()),unreadCount:this._unreadCount})}},{key:"onFriendApplicationRead",value:function(){this._unreadCount=0,this._onFriendApplicationListUpdated()}},{key:"onFriendApplicationAdded",value:function(e,t){var n,o,s=this;G(e)||(n="",n=t===this._snsM.getMyUserID()?_.SNS_APPLICATION_SENT_BY_ME:_.SNS_APPLICATION_SENT_TO_ME,o=!1,e.forEach(function(i){var a="".concat(i.userID,"_").concat(n);n!==_.SNS_APPLICATION_SENT_TO_ME||s._friendApplicationMap.has(a)||(s._unreadCount+=1),s._friendApplicationMap.set(a,new Yr(l(l({},i),{},{type:n}))),o=!0}),o&&this._onFriendApplicationListUpdated())}},{key:"onFriendApplicationDeleted",value:function(e){G(e)||(this._startTime=0,this._currentSequence=0,this.getFriendApplicationList())}},{key:"getFriendApplicationList",value:function(){var e=this,t="".concat(this._n,".").concat("getFriendApplicationList"),n=new S("getFriendApplicationList");return this._snsM.req({proto:g.GET_FD_APPLICATION_LIST,data:{applicationType:_.SNS_APPLICATION_TYPE_BOTH,fromAccount:this._snsM.getMyUserID(),maxLimited:this._maxLimited,startTime:this._startTime,lastSequence:this._currentSequence}}).then(function(r){var r=r.data,s=r.resultList,i=r.unreadCount,a=r.startTime,r=r.currentSequence,c=(e._startTime=a,e._currentSequence=r,e._unreadCount=i,F(s)?s.length:0),c="applicationCount:".concat(c," unreadCount:").concat(i," startTime:").concat(a," currentSequence:").concat(r);n.setMessage(c).end(),u.i("".concat(t," ok. ").concat(c)),e._friendApplicationMap.clear(),F(s)&&s.forEach(function(m){var p=m.userID,h=m.type,m=new Yr(m);e._friendApplicationMap.set("".concat(p,"_").concat(h),m)}),e._onFriendApplicationListUpdated()}).catch(function(o){return n.setError(o).end(),u.w("".concat(t," failed. error:"),o),v(o)})}},{key:"deleteFriendApplication",value:function(e){var t="".concat(this._n,".").concat("deleteFriendApplication"),n=e.userID,o=e.type;if(o&&(o===_.SNS_APPLICATION_SENT_BY_ME||o===_.SNS_APPLICATION_SENT_TO_ME)||(o=_.SNS_APPLICATION_SENT_TO_ME),!this._friendApplicationMap.has("".concat(n,"_").concat(o)))return v({code:M.FRIEND_APPLICATION_NOT_EXIST});var s=new S("deleteFriendApplication");return s.setMessage("userID:".concat(n," type:").concat(o)),this._snsM.req({proto:g.DEL_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),userIDList:[n],type:o}}).then(function(a){var a=a.data.resultList,d=a[0],r=d.to,c=d.resultCode,d=d.resultInfo;return s.setMoreMessage("resultList:".concat(JSON.stringify(a))).end(),u.i("".concat(t," ok. userID:").concat(n," type:").concat(o)),c===0?q():v({userID:r,code:c,message:d})}).catch(function(i){return s.setError(i).end(),u.w("".concat(t," failed. error:"),i),v(i)})}},{key:"acceptFriendApplication",value:function(e){var t="".concat(this._n,".").concat("acceptFriendApplication"),n=e.userID,o=e.remark,s=e.tag,i=e.type,a=(i&&(i===_.SNS_APPLICATION_AGREE||i===_.SNS_APPLICATION_AGREE_AND_ADD)||(i=_.SNS_APPLICATION_AGREE_AND_ADD),new S("acceptFriendApplication"));return a.setMessage("userID:".concat(n," type:").concat(i)),this._snsM.req({proto:g.RESPOND_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),responseFriendItem:[{userID:n,remark:o,tag:s,action:i}]}}).then(function(d){a.end();var d=d.data.resultList[0],c=d.resultCode,d=d.resultInfo;if(c!==0)return v({code:c,message:d});u.i("".concat(t," ok. userID:").concat(n," type:").concat(i))}).catch(function(r){return a.setError(r).end(),u.w("".concat(t," failed. error:"),r),v(r)})}},{key:"refuseFriendApplication",value:function(e){var t="".concat(this._n,".").concat("refuseFriendApplication"),n=e.userID,o=new S("refuseFriendApplication");return o.setMessage("userID:".concat(n)),this._snsM.req({proto:g.RESPOND_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),responseFriendItem:[{userID:n,action:"Response_Action_Reject"}]}}).then(function(a){o.end();var a=a.data.resultList[0],i=a.resultCode,a=a.resultInfo;if(i!==0)return v({code:i,message:a});u.i("".concat(t," ok. userID:").concat(n))}).catch(function(s){return o.setError(s).end(),u.w("".concat(t," failed. error:"),s),v(s)})}},{key:"_onFriendApplicationProcessed",value:function(e){var t,n=this;e.length!==0&&(t=!1,e.forEach(function(o){o="".concat(o.to,"_").concat(_.SNS_APPLICATION_SENT_TO_ME),n._friendApplicationMap.has(o)&&(n._friendApplicationMap.delete(o),--n._unreadCount,t=!0)}),this._unreadCount<0&&(this._unreadCount=0),t&&this._onFriendApplicationListUpdated())}},{key:"setFriendApplicationRead",value:function(){var e=this,t="".concat(this._n,".").concat("setFriendApplicationRead"),n=new S("setFriendApplicationRead");return this._snsM.req({proto:g.REPORT_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),latestTimeStamp:wt(kt()/1e3,0)}}).then(function(o){n.end(),u.i("".concat(t," ok")),e._unreadCount=0}).catch(function(o){return n.setError(o).end(),u.w("".concat(t," failed. error:"),o),v(o)})}},{key:"reset",value:function(){this._startIndex=0,this._maxLimited=100,this._currentSequence=0,this._unreadCount=0,this._friendApplicationMap.clear()}}]),_a),Qi=(R(pa,[{key:"validate",value:function(e){var t,n=!0,o="";if(G(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var s=e.profileCustomField.length,i=null,a=0;a<s;a++){if(i=e.profileCustomField[a],!te(i.key)||i.key.indexOf("Tag_Profile_Custom")===-1)return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!te(i.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(t in e)if(Object.prototype.hasOwnProperty.call(e,t)){if(t==="profileCustomField")continue;if(G(e[t])&&!te(e[t])&&!fe(e[t])){o="key:"+t+", invalid value:"+e[t],n=!1;continue}switch(t){case"nick":te(e[t])||(n=!(o="nick must be a string")),500<zo(e[t])&&(o="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(zo(e[t])," bytes"),n=!1);break;case"gender":yn(se,e.gender)||(o="key:gender, invalid value:"+e.gender,n=!1);break;case"birthday":fe(e.birthday)||(n=!(o="birthday must be a number"));break;case"location":te(e.location)||(n=!(o="location must be a string"));break;case"selfSignature":te(e.selfSignature)||(n=!(o="selfSignature must be a string"));break;case"allowType":yn(Ae,e.allowType)||(o="key:allowType, invalid value:"+e.allowType,n=!1);break;case"language":fe(e.language)||(n=!(o="language must be a number"));break;case"avatar":te(e.avatar)||(n=!(o="avatar must be a string"));break;case"messageSettings":e.messageSettings!==0&&e.messageSettings!==1&&(n=!(o="messageSettings must be 0 or 1"));break;case"adminForbidType":yn(me,e.adminForbidType)||(o="key:adminForbidType, invalid value:"+e.adminForbidType,n=!1);break;case"level":fe(e.level)||(n=!(o="level must be a number"));break;case"role":fe(e.role)||(n=!(o="role must be a number"));break;default:o="unknown key:"+t+"  "+e[t],n=!1}}return{valid:n,tips:o}}},{key:"update",value:function(e){var t,n="",o=[];this.friendCustomField.forEach(function(r){o.push(r.key)});for(var s=0,i=e.length;s<i;s++)if(n=e[s].tag,t=e[s].value,-1<n.indexOf("Tag_SNS_Custom"))-1<o.indexOf(n)?this.friendCustomField.forEach(function(r){r.key===n&&(r.value=t)}):this.friendCustomField.push({key:n,value:t});else if(-1<n.indexOf("Tag_Profile_Custom")){var a=!1;this.profile.profileCustomField.forEach(function(r){r.key===n&&(r.value=t,a=!0)}),a||this.profile.profileCustomField.push({key:n,value:t})}else switch(n){case E.NICK:this.profile.nick=t;break;case E.GENDER:this.profile.gender=t;break;case E.BIRTHDAY:this.profile.birthday=t;break;case E.LOCATION:this.profile.location=t;break;case E.SELFSIGNATURE:this.profile.selfSignature=t;break;case E.ALLOWTYPE:this.profile.allowType=t;break;case E.LANGUAGE:this.profile.language=t;break;case E.AVATAR:this.profile.avatar=t;break;case E.MESSAGESETTINGS:this.profile.messageSettings=t;break;case E.ADMINFORBIDTYPE:this.profile.adminForbidType=t;break;case E.LEVEL:this.profile.level=t;break;case E.ROLE:this.profile.role=t;break;case W.REMARK:this.remark=t;break;case W.ADDTIME:this.addTime=t;break;case W.GROUP:this.groupList=JSON.parse(JSON.stringify(t));break;case W.ADDSOURCE:this.source=t;break;case W.ADDWORDING:break;default:u.d("snsProfileItem unkown tag->",e[s].tag)}this.timestamp=Date.now(),o.length=0}},{key:"updateProfile",value:function(e){this.profile=JSON.parse(JSON.stringify(e)),this.timestamp=Date.now()}},{key:"addToGroupList",value:function(e){this.groupList.indexOf(e)===-1&&(this.groupList.push(e),this.count=this.groupList.length)}},{key:"removeFromGroupList",value:function(e){e=this.groupList.indexOf(e),-1<e&&(this.groupList.splice(e,1),this.count=this.groupList.length)}}]),pa),$u=(R(da,[{key:"getLocalFriendList",value:function(){return b(this._friendMap.values())}},{key:"getFriendRemark",value:function(e){return this._friendMap.has(e)?this._friendMap.get(e).remark:""}},{key:"onFriendProfileModified",value:function(o){var t,n=this,o=o.dataList;G(o)||(t=this._snsM.get(11),o.forEach(function(r){var i,a=r.userID,r=r.profileList;n.isMyFriend(a)&&(u.l("".concat(n._n,".onFriendProfileModified. friend account:").concat(a,", profileList:").concat(JSON.stringify(r))),(i=n._friendMap.get(a)).update(r),t.modifyMessageSentByPeer({conversationID:"".concat(_.CONV_C2C).concat(a),latestNick:i.profile.nick,latestAvatar:i.profile.avatar}))}),this._onFriendListUpdated())}},{key:"onFriendAdded",value:function(e){var t=this;e.length!==0&&(u.l("".concat(this._n,".onFriendAdded userIDList:").concat(e)),e.forEach(function(n){t._friendMap.set(n,new Qi(n))}),this.getFriendProfile({userIDList:e}).then(function(n){e.forEach(function(o){var s=t._friendMap.get(o);0<s.groupList.length&&t._snsM.updateWhenFriendAdded({nameList:s.groupList,userID:o})}),t._onFriendListUpdated()}))}},{key:"onFriendDeleted",value:function(e){var t=this;e.length!==0&&(u.l("".concat(this._n,".onFriendDeleted userIDList:").concat(e)),e.forEach(function(n){var o=t._friendMap.get(n);0<o.groupList.length&&t._snsM.updateWhenFriendDeleted({nameList:o.groupList,userID:n}),t._friendMap.delete(n)}),this._onFriendListUpdated())}},{key:"_onFriendListUpdated",value:function(){this._snsM.emitOuterEvent(V.FRIEND_LIST_UPDATED),this._snsM.get(11).checkAndPatchRemark()}},{key:"getFriendProfile",value:function(o){var t=this,n="".concat(this._n,".").concat("getFriendProfile"),o=o.userIDList,s=[],i=[],a=[];if(o.forEach(function(c){var d;t._friendMap.has(c)?(d=t._friendMap.get(c),Date.now()-d.timestamp<t._expirationTime?i.push(d):a.push(c)):s.push({userID:c,code:M.NOT_MY_FRIEND,message:t._snsM.getErrorMessage(M.NOT_MY_FRIEND)})}),a.length===0)return u.i("".concat(n," newUserIDList is empty")),Q({friendList:i,failureUserIDList:s});var r=new S("getFriendProfile");return r.setMessage("userIDList:".concat(a)),u.i("".concat(n," userIDList:").concat(a)),this._snsM.req({proto:g.GET_FD_PROFILE,data:{fromAccount:this._snsM.getMyUserID(),userIDList:a}}).then(function(c){return r.end(),u.i("".concat(n," ok")),c.data.resultList.forEach(function(I){var p,h=I.to,m=I.resultCode,f=I.resultInfo,I=I.tagValueList;C(m)||m===0?(t._friendMap.has(h)?(p=t._friendMap.get(h)).update(I):(p=new Qi(h,I),t._friendMap.set(h,p)),i.push(p)):s.push({userID:h,code:m,message:f})}),q({friendList:i,failureUserIDList:s})}).catch(function(c){return r.setError(c).end(),u.w("".concat(n," failed. error:"),c),v(c)})}},{key:"isMyFriend",value:function(e){return this._friendMap.has(e)}},{key:"pagingGetFriendList",value:function(){var e=this,t="".concat(this._n,".").concat("getFriendList"),n=new S("getFriendList"),o=Date.now();this._snsM.req({proto:g.GET_FD_LIST,data:{fromAccount:this._snsM.getMyUserID(),startIndex:this._startIndex,standardSequence:this._standardSequence,customSequence:this._customSequence}}).then(function(d){var d=d.data,p=d.friendCount,i=d.resultList,a=d.nextStartIndex,r=d.standardSequence,c=d.customSequence,d=d.completeFlag,p=(e._startIndex=a,e._standardSequence=r,e._customSequence=c,"friendCount:".concat(p," nextStartIndex:").concat(a," standardSequence:").concat(r," ")+"customSequence:".concat(c," completeFlag:").concat(d," cost:").concat(Ke(o)));n.setMessage(p).end(),u.i("".concat(t," ok."),p),G(i)||i.forEach(function(f){var m=f.to,f=f.tagValueList;e._friendMap.set(m,new Qi(m,f))}),d===0?e.pagingGetFriendList():(e._snsM.emitOuterEvent(V.FRIEND_LIST_UPDATED),e._pagingGetFriendProfile())}).catch(function(s){return n.setError(s).end(),u.w("".concat(t," failed. error:"),s),v(s)})}},{key:"_pagingGetFriendProfile",value:function(){var e=this,t=b(this._friendMap.keys()),n=this._snsM.get(4),o=t.length,s=o<=100?1:Math.ceil(o/100);u.l("".concat(this._n,"._pagingGetFriendProfile friendCount:").concat(o," pageCount:").concat(s));for(var i=0;i<s;i++)n.getUserProfile({userIDList:t.slice(100*i,100*(i+1))}).then(function(a){a.data.forEach(function(r){var c=e._friendMap.get(r.userID);c&&c.updateProfile(r)}),e._onFriendListUpdated()})}},{key:"addFriend",value:function(c){var t=this,n="".concat(this._n,".").concat("addFriend");if(this._friendMap.has(c.to))return v({code:M.ALREADY_MY_FRIEND});if(c.wording&&this._snsM.filterProfanity("wording",c)===!1)return v({code:M.PROFANITY_FOUND});var o=c.to,s=c.source,i=c.type,a=c.wording,r=c.remark,c=c.groupName,d=i,p=(d&&(d===_.SNS_ADD_TYPE_SINGLE||d===_.SNS_ADD_TYPE_BOTH)||(d=_.SNS_ADD_TYPE_BOTH),new S("addFriend"));return p.setMessage("to:".concat(o," source:").concat(s," type:").concat(d)),this._snsM.req({proto:g.ADD_FD,data:{fromAccount:this._snsM.getMyUserID(),addFriendItem:[{to:o,source:s,wording:a,remark:r,groupName:c}],type:d}}).then(function(I){var I=I.data.resultList,I=(p.setMoreMessage("resultList:".concat(JSON.stringify(I))).end(),I[0]),m=I.to,f=I.resultCode,I=I.resultInfo;return u.i("".concat(n," ok. to:").concat(m," type:").concat(d," code:").concat(f)),C(f)||f===0?q({userID:m,code:0}):f===30539?q({userID:m,code:f,message:t._snsM.getErrorMessage(f)}):v({userID:m,code:f,message:t._snsM.getErrorMessage(f)||I})}).catch(function(h){return p.setError(h).end(),u.w("".concat(n," failed. error:"),h),v(h)})}},{key:"deleteFriend",value:function(o){var t=this,n="".concat(this._n,".").concat("deleteFriend"),r=o.userIDList,o=o.type,s=(1e3<r.length&&(u.w("".concat(n," ").concat(ln(1e3))),r.length=1e3),[]),i=[],a=[];if(r.forEach(function(d){t._friendMap.has(d)?a.push(d):s.push({userID:d,code:M.NOT_MY_FRIEND,message:t._snsM.getErrorMessage(M.NOT_MY_FRIEND)})}),a.length===0)return Q({successUserIDList:i,failureUserIDList:s});var r=o,c=(r&&(r===_.SNS_DELETE_TYPE_SINGLE||r===_.SNS_DELETE_TYPE_BOTH)||(r=_.SNS_DELETE_TYPE_BOTH),new S("deleteFriend"));return c.setMessage("userIDList:".concat(a," type:").concat(r)),this._snsM.req({proto:g.DEL_FD,data:{fromAccount:this._snsM.getMyUserID(),userIDList:a,type:r}}).then(function(d){return c.end(),u.i("".concat(n," ok")),d=d.data.resultList,G(d)||d.forEach(function(f){var h=f.to,m=f.resultCode,f=f.resultInfo;C(m)||m===0?i.push({userID:h}):s.push({userID:h,code:m,message:f})}),q({successUserIDList:i,failureUserIDList:s})}).catch(function(d){return c.setError(d).end(),u.w("".concat(n," error:"),d),v(d)})}},{key:"updateFriend",value:function(e){var t=this,n=e.userID,o=e.remark,s=e.friendCustomField;if(!this._friendMap.has(n))return v({code:M.NOT_MY_FRIEND});var i="".concat(this._n,".").concat("updateFriend"),a=new S("updateFriend"),r=(a.setMessage("userID:".concat(n," remark:").concat(o," friendCustomField:").concat(s)),[]);return C(o)||r.push({tag:W.REMARK,value:o}),F(s)&&0<s.length&&s.forEach(function(c){r.push({tag:c.key,value:c.value})}),this._snsM.req({proto:g.UPDATE_FD,data:{fromAccount:this._snsM.getMyUserID(),updateItem:[{to:n,snsItem:r}]}}).then(function(h){a.end(),u.i("".concat(i," ok"));var h=h.data.resultList[0],d=h.to,p=h.resultCode,h=h.resultInfo;return C(p)||p===0?((d=t._friendMap.get(d))&&(C(o)||(d.remark=o),F(s)&&0<s.length&&Bn(d.friendCustomField,s),t._onFriendListUpdated()),q(d)):v({code:p,message:h})}).catch(function(c){return a.setError(c).end(),u.w("".concat(i," failed. error:"),c),v(c)})}},{key:"checkFriend",value:function(e){var t="".concat(this._n,".").concat("checkFriend"),n=e.userIDList,o=e.type,s=(o&&(o===_.SNS_CHECK_TYPE_SINGLE||o===_.SNS_CHECK_TYPE_BOTH)||(o=_.SNS_CHECK_TYPE_BOTH),new S("checkFriend"));return s.setMessage("userIDList:".concat(n," type:").concat(o)),this._snsM.req({proto:g.CHECK_FD,data:{fromAccount:this._snsM.getMyUserID(),userIDList:n,type:o}}).then(function(c){s.end(),u.i("".concat(t," ok. userIDList:").concat(n," type:").concat(o));var a=[],r=[],c=c.data.resultList;return F(c)&&c.forEach(function(f){var p=f.to,h=f.relation,m=f.resultCode,f=f.resultInfo;C(m)||m===0?a.push({userID:p,code:0,relation:h}):r.push({userID:p,code:m,message:f})}),q({successUserIDList:a,failureUserIDList:r})}).catch(function(i){return s.setError(i).end(),u.w("".concat(t," failed. error:"),i),v(i)})}},{key:"updateWhenAddedToFriendGroup",value:function(o){var t=this,n=o.name,o=o.userIDList;u.l("".concat(this._n,".updateWhenAddedToFriendGroup groupName:").concat(n," userIDList:").concat(o)),n&&!G(o)&&o.forEach(function(s){t._friendMap.has(s)&&t._friendMap.get(s).addToGroupList(n)})}},{key:"updateWhenRemovedFromFriendGroup",value:function(o){var t=this,n=o.name,o=o.userIDList;u.l("".concat(this._n,".updateWhenRemovedFromFriendGroup groupName:").concat(n," userIDList:").concat(o)),n&&!G(o)&&o.forEach(function(s){t._friendMap.has(s)&&t._friendMap.get(s).removeFromGroupList(n)})}},{key:"reset",value:function(){this._friendMap.clear(),this._startIndex=0,this._standardSequence=0,this._customSequence=0}}]),da),jr=(R(la,[{key:"addToUserIDList",value:function(e){this.userIDList.indexOf(e)===-1&&(this.userIDList.push(e),this.count=this.userIDList.length)}},{key:"removeFromUserIDList",value:function(e){e=this.userIDList.indexOf(e),-1<e&&(this.userIDList.splice(e,1),this.count=this.userIDList.length)}}]),la),Qu=(R(ua,[{key:"getLocalFriendGroupList",value:function(){return b(this._friendGroupMap.values())}},{key:"_emitFriendGroupListUpdated",value:function(){var e=b(this._friendGroupMap.values());this._snsM.emitOuterEvent(V.FRIEND_GROUP_LIST_UPDATED,e)}},{key:"getFriendGroupList",value:function(){var e=this,t="".concat(this._n,".").concat("getFriendGroupList"),n=new S("getFriendGroupList");return this._snsM.req({proto:g.GET_FD_GRP_LIST,data:{fromAccount:this._snsM.getMyUserID()}}).then(function(o){n.end(),o=o.data.resultList,G(o)?u.i("".concat(t," ok. friend group count:0")):(u.i("".concat(t," ok. friend group count:").concat(o.length)),e._friendGroupMap.clear(),o.forEach(function(s){var i=new jr(s);e._friendGroupMap.set(s.name,i)}),e._emitFriendGroupListUpdated())}).catch(function(o){return n.setError(o).end(),u.w("".concat(t," error:"),o),v(o)})}},{key:"createFriendGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("createFriendGroup"),o=e.name,s=e.userIDList;if(this._friendGroupMap.has(o))return v({code:M.FRIEND_GRP_EXISTED});var i=new S("createFriendGroup");return i.setMessage("name:".concat(o," userIDList:").concat(s)),this._snsM.req({proto:g.CREATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),groupName:[o],userIDList:F(s)?s:void 0}}).then(function(d){i.end(),u.l("".concat(n," ok. name:").concat(o," userIDList:").concat(s));var d=d.data.resultList,r=[],c=[],d=(d&&d.forEach(function(p){var h=p.to,m=p.resultCode,f=p.resultInfo;C(m)||m===0?r.push(h):(h={userID:p.to,code:m,message:f},c.push(h))}),new jr({name:o,userIDList:r}));return t._friendGroupMap.set(o,d),t._snsM.updateWhenAddedToFriendGroup({name:o,userIDList:r}),t._emitFriendGroupListUpdated(),q({friendGroup:d,failureUserIDList:c})}).catch(function(a){return i.setError(a).end(),u.w("".concat(n," failed. error:"),a),v(a)})}},{key:"deleteFriendGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteFriendGroup"),o=e.name;if(!this._friendGroupMap.has(o))return v({code:M.FRIEND_GRP_NOT_EXIST});var s=new S("deleteFriendGroup");return s.setMessage("name:".concat(o)),this._snsM.req({proto:g.DEL_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),nameList:[o]}}).then(function(i){s.end(),u.l("".concat(n," ok. name:").concat(o));var a=t._friendGroupMap.get(o);return a&&(t._snsM.updateWhenRemovedFromFriendGroup({name:o,userIDList:a.userIDList}),t._friendGroupMap.delete(o),a.userIDList.length=0),t._emitFriendGroupListUpdated(),q(a)}).catch(function(i){return s.setError(i).end(),u.w("".concat(n," failed. error:"),i),v(i)})}},{key:"renameFriendGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("renameFriendGroup"),o=e.oldName,s=e.newName;if(!this._friendGroupMap.has(o))return v({code:M.FRIEND_GRP_NOT_EXIST});var i=new S("renameFriendGroup");return i.setMessage("oldName:".concat(o," newName:").concat(s)),this._snsM.req({proto:g.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:o,newName:s}}).then(function(){var a;return i.end(),u.l("".concat(n," ok. oldName:").concat(o," newName:").concat(s)),t._friendGroupMap.has(o)?((a=t._friendGroupMap.get(o)).name=s,t._friendGroupMap.delete(o),t._friendGroupMap.set(s,a),t._snsM.updateWhenRemovedFromFriendGroup({name:o,userIDList:a.userIDList}),t._snsM.updateWhenAddedToFriendGroup({name:s,userIDList:a.userIDList}),t._emitFriendGroupListUpdated(),q(a)):q()}).catch(function(a){return i.setError(a).end(),u.w("".concat(n," failed. error:"),a),v(a)})}},{key:"addToFriendGroup",value:function(s){var t=this,n="".concat(this._n,".").concat("addToFriendGroup"),o=s.name,s=s.userIDList;if(!this._friendGroupMap.has(o))return this._onFriendGroupNotExist(o);var i=new S("addToFriendGroup");return i.setMessage("name:".concat(o," userIDList:").concat(s)),u.l("".concat(n," name:").concat(o," userIDList:").concat(s)),this._snsM.req({proto:g.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:o,updateGroupItem:s.filter(function(a){return t._snsM.isMyFriend(a)}).map(function(a){return{to:a,updateType:"Update_Type_Add"}})}}).then(function(a){return i.end(),t._onFriendGroupUpdated(o,a)}).catch(function(a){return i.setError(a).end(),u.w("".concat(n," failed. error:"),a),v(a)})}},{key:"removeFromFriendGroup",value:function(s){var t=this,n="".concat(this._n,".").concat("removeFromFriendGroup"),o=s.name,s=s.userIDList;if(!this._friendGroupMap.has(o))return this._onFriendGroupNotExist(o);var i=new S("removeFromFriendGroup");return i.setMessage("name:".concat(o," userIDList:").concat(s)),u.l("".concat(n," name:").concat(o," userIDList:").concat(s)),this._snsM.req({proto:g.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:o,updateGroupItem:s.filter(function(a){return t._snsM.isMyFriend(a)}).map(function(a){return{to:a,updateType:"Update_Type_Delete"}})}}).then(function(a){return i.end(),t._onFriendGroupUpdated(o,a)}).catch(function(a){return i.setError(a).end(),u.w("".concat(n," failed. error:"),a),v(a)})}},{key:"_onFriendGroupUpdated",value:function(e,n){var n=n.data.resultList,o=this._friendGroupMap.get(e),s=[],i=[],a=[];return F(n)&&n.forEach(function(r){var c=r.to,d=r.resultCode,p=r.resultInfo,h=r.type;d===0?h==="Update_Type_Add"?o&&(o.addToUserIDList(c),i.push(c)):h==="Update_Type_Delete"&&o&&(o.removeFromUserIDList(c),a.push(c)):s.push({to:r.to,code:d,message:p})}),u.l("".concat(this._n,"._onFriendGroupUpdated name:").concat(e," userIDList:").concat(o.userIDList)),0<i.length&&this._snsM.updateWhenAddedToFriendGroup({name:e,userIDList:i}),0<a.length&&this._snsM.updateWhenRemovedFromFriendGroup({name:e,userIDList:a}),q({friendGroup:o,failureUserIDList:s})}},{key:"updateWhenFriendAdded",value:function(e){var t=this,n=e.nameList,o=e.userID;u.l("".concat(this._n,".updateWhenFriendAdded userID:").concat(o," nameList:").concat(n)),G(n)||n.forEach(function(s){t._friendGroupMap.has(s)&&t._friendGroupMap.get(s).addToUserIDList(o)})}},{key:"updateWhenFriendDeleted",value:function(e){var t=this,n=e.nameList,o=e.userID;u.l("".concat(this._n,".updateWhenFriendDeleted userID:").concat(o," nameList:").concat(n)),G(n)||n.forEach(function(s){t._friendGroupMap.has(s)&&t._friendGroupMap.get(s).removeFromUserIDList(o)})}},{key:"reset",value:function(){this._friendGroupMap.clear()}}]),ua),Zu=(z(Ao,Oe),Vr=X(Ao),R(Ao,[{key:"onContextUpdated",value:function(e){this._friendHandler.pagingGetFriendList(),this._friendGroupHandler.getFriendGroupList(),this._friendApplicationHandler.getFriendApplicationList()}},{key:"onRelationChainModified",value:function(c){var t,n,o,s,i,a,r=this,c=c.dataList;G(c)||(t=[],n=[],o=[],i=!(s=[]),a="",c.forEach(function(d){var p;d.pushType!==3&&d.pushType!==4||!d.from||(a=d.from),d.friendAddAccount&&(t.push.apply(t,b(d.friendAddAccount)),s.push.apply(s,b(d.friendAddAccount))),d.friendDelAccount&&n.push.apply(n,b(d.friendDelAccount)),d.friendApplicationAdded&&o.push.apply(o,b(d.friendApplicationAdded)),d.friendApplicationDeletedUserIDList&&s.push.apply(s,b(d.friendApplicationDeletedUserIDList)),d.reportTime&&d.pushType===7&&(i=!0),d.friendUpInfo&&(p={dataList:[]},d.friendUpInfo.forEach(function(h){p.dataList.push({userID:h.friendAccount,profileList:b(h.sns)})}),r.onFriendProfileModified(p))}),i&&this._friendApplicationHandler.onFriendApplicationRead(),this._friendApplicationHandler.onFriendApplicationAdded(o,a),this._friendApplicationHandler.onFriendApplicationDeleted(s),this._friendHandler.onFriendAdded(t),this._friendHandler.onFriendDeleted(n))}},{key:"isMyFriend",value:function(e){return this._friendHandler.isMyFriend(e)}},{key:"filterProfanity",value:function(e,t){var o=this.get(29);if(!o)return!0;var o=o.filterText(t[e],"sns"),n=o.isAllowedToSend,o=o.modifiedText;return n===!0&&(t[e]=o,!0)}},{key:"onFriendProfileModified",value:function(e){this._friendHandler.onFriendProfileModified(e)}},{key:"getLocalFriendList",value:function(){var e=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],t=this._friendHandler.getLocalFriendList();return e?Q(t):t}},{key:"getFriendRemark",value:function(e){return this._friendHandler.getFriendRemark(e)}},{key:"getFriendList",value:function(){return this._friendHandler.pagingGetFriendList()}},{key:"addFriend",value:function(e){return this._friendHandler.addFriend(e)}},{key:"deleteFriend",value:function(e){return this._friendHandler.deleteFriend(e)}},{key:"checkFriend",value:function(e){return this._friendHandler.checkFriend(e)}},{key:"getFriendProfile",value:function(e){return this._friendHandler.getFriendProfile(e)}},{key:"updateFriend",value:function(e){return this._friendHandler.updateFriend(e)}},{key:"updateWhenAddedToFriendGroup",value:function(e){this._friendHandler.updateWhenAddedToFriendGroup(e)}},{key:"updateWhenRemovedFromFriendGroup",value:function(e){this._friendHandler.updateWhenRemovedFromFriendGroup(e)}},{key:"getLocalFriendApplicationList",value:function(){var e=this._friendApplicationHandler.getLocalFriendApplicationList();return Q(e)}},{key:"deleteFriendApplication",value:function(e){return this._friendApplicationHandler.deleteFriendApplication(e)}},{key:"refuseFriendApplication",value:function(e){return this._friendApplicationHandler.refuseFriendApplication(e)}},{key:"acceptFriendApplication",value:function(e){return this._friendApplicationHandler.acceptFriendApplication(e)}},{key:"setFriendApplicationRead",value:function(e){return this._friendApplicationHandler.setFriendApplicationRead(e)}},{key:"getLocalFriendGroupList",value:function(){var e=this._friendGroupHandler.getLocalFriendGroupList();return Q(e)}},{key:"createFriendGroup",value:function(e){return this._friendGroupHandler.createFriendGroup(e)}},{key:"deleteFriendGroup",value:function(e){return this._friendGroupHandler.deleteFriendGroup(e)}},{key:"addToFriendGroup",value:function(e){return this._friendGroupHandler.addToFriendGroup(e)}},{key:"removeFromFriendGroup",value:function(e){return this._friendGroupHandler.removeFromFriendGroup(e)}},{key:"renameFriendGroup",value:function(e){return this._friendGroupHandler.renameFriendGroup(e)}},{key:"onAddToFriendGroup",value:function(e){return this._friendGroupHandler.onAddToFriendGroup(e)}},{key:"updateWhenFriendAdded",value:function(e){this._friendGroupHandler.updateWhenFriendAdded(e)}},{key:"updateWhenFriendDeleted",value:function(e){this._friendGroupHandler.updateWhenFriendDeleted(e)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._friendHandler.reset(),this._friendGroupHandler.reset(),this._friendApplicationHandler.reset()}}]),Ao),el=(z(yo,Oe),xr=X(yo),R(yo,[{key:"isWorkerEnabled",value:function(){return this._isWorkerEnabled&&Gt}},{key:"startWorkerTimer",value:function(){u.l("".concat(this._n,".startWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("start")}},{key:"stopWorkerTimer",value:function(){u.l("".concat(this._n,".stopWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("stop")}},{key:"_init",value:function(){var e,t;Gt&&(e=URL.createObjectURL(new Blob(['let interval = -1;onmessage = function(event) {  if (event.data === "start") {    if (interval > 0) {      clearInterval(interval);    }    interval = setInterval(() => {      postMessage("");    }, 1000);    postMessage(interval);  } else if (event.data === "stop") {    clearInterval(interval);    interval = -1;  }};'],{type:"application/javascript; charset=utf-8"})),this._workerTimer=new Worker(e),(t=this)._workerTimer.onmessage=function(n){n.data?(t._timerID=n.data,u.l("".concat(t._n,"._init seed:").concat(t._timerID))):t._m.onCheckTimer()})}},{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("enable_worker");u.l("".concat(this._n,"._onCloudConfigUpdated enableWorker:").concat(e)),C(e)||e==="1"?!this._isWorkerEnabled&&Gt&&(this._isWorkerEnabled=!0,this.startWorkerTimer(),this._m.onWorkerTimerEnabled()):this._isWorkerEnabled&&Gt&&(this._isWorkerEnabled=!1,this.stopWorkerTimer(),this._m.onWorkerTimerDisabled())}},{key:"terminate",value:function(){u.l("".concat(this._n,".terminate")),this._workerTimer&&(this._workerTimer.terminate(),this._workerTimer=null,this._timerID=-1)}},{key:"getTimerID",value:function(){return this._timerID}},{key:"reset",value:function(){u.l("".concat(this._n,".reset"))}}]),yo),tl=(R(ca,[{key:"isValidPurchaseBits",value:function(e){return e&&typeof e=="string"&&1<=e.length&&e.length<=64&&/[01]{1,64}/.test(e)}},{key:"parsePurchaseBits",value:function(e){if(this.isValidPurchaseBits(e)){this._featureMap.clear();for(var t,n=e.length-1,o=0;0<=n;n--,o++)t=(o<32?new ke(0,Math.pow(2,o)):new ke(Math.pow(2,o-32),0)).toString(),e[n]==="1"?this._featureMap.set(t,!0):this._featureMap.set(t,!1)}else u.w("".concat(this._n,".parsePurchaseBits invalid purchasebits:").concat(e))}},{key:"hasPurchasedFeature",value:function(e){return!!this._featureMap.get(e)}},{key:"isFeatureEnabled",value:function(e){for(var t=parseInt(e).toString(2),n=void 0,o=!0,s=t.length-1,i=0;0<=s;s--,i++)if(t.charAt(s)==="1"&&(n=(i<32?new ke(0,Math.pow(2,i)):new ke(Math.pow(2,i-32),0)).toString(),!this._featureMap.get(n))){o=!1;break}return u.l("".concat(this._n,".isFeatureEnabled decimalNumber:").concat(e," key:").concat(n," ret:").concat(o)),Q({enabled:o})}},{key:"isFeatureEnabledForStat",value:function(e){for(var t=parseInt(e).toString(2),n=t.length-1,o=0;0<=n;n--,o++)if(t.charAt(n)==="1"){if(s=(o<32?new ke(0,Math.pow(2,o)):new ke(Math.pow(2,o-32),0)).toString(),!this._featureMap.get(s))break;var s,i="",a=0;s===de.PLUGIN_TRANSLATE?(i="plugin_translate",a=16):s===de.PLUGIN_VOICE_TO_TEXT?(i="plugin_voice_to_text",a=17):s===de.PLUGIN_CS?(i="plugin_cs",a=14):s===de.PLUGIN_PUSH?(i="plugin_push",a=13):s===de.PLUGIN_BOT?(i="plugin_bot",a=15):s===de.MSG_REACTION&&(i="plugin_emoji_reaction",a=18),i!==""&&(s=this._commercialConfigM.get(12).getUIPlatform(),new S(i).setCode(a).setUIPlatform(s).end(),u.l("".concat(this._n,".isFeatureEnabledForStat ").concat(i," code:").concat(a," uiPlatform:").concat(s)))}}},{key:"isSearchCloudMessagesEnabled",value:function(){var e;this._isSCMReported||(e=this._commercialConfigM.get(12).getUIPlatform(),new S("plugin_search").setCode(6).setUIPlatform(e).end(),this._isSCMReported=!0)}},{key:"clear",value:function(){this._featureMap.clear(),this._isSCMReported=!1}}]),ca),nl=(R(ra,[{key:"_canFetch",value:function(){return this.get(12).isLoggedIn()?!this._isFetching&&Date.now()>=this._expiredTime:(this._expiredTime=Date.now()+2e3,!1)}},{key:"onCheckTimer",value:function(e){this._canFetch()&&this.fetchConfig()}},{key:"fetchConfig",value:function(){var e,t,n=this,o=this._canFetch(),s="".concat(this._n,".fetchConfig");u.l("".concat(s," canFetch:").concat(o)),o&&(e=new S("fetchCommercialConfig"),o=this.get(12).getSDKAppID(),t=this.get(20),this._isFetching=!0,t.req({proto:g.FETCH_COMMERCIAL_CONFIG,data:{SDKAppID:o}}).then(function(i){e.setMessage("purchaseBits:".concat(i.data.purchaseBits)).end(),u.l("".concat(s," ok.")),n._parseConfig(i.data),n._isFetching=!1}).catch(function(i){e.setError(i).end(),n._isFetching=!1}))}},{key:"onPushedConfig",value:function(e){var t="".concat(this._n,".onPushedConfig data:").concat(JSON.stringify(e));u.l("".concat(t)),new S("pushedCommercialConfig").setMessage("purchaseBits:".concat(e.purchaseBits)).end(),this._parseConfig(e)}},{key:"_parseConfig",value:function(e){var t="".concat(this._n,"._parseConfig"),n=e.errorCode,o=e.errorMessage,s=e.purchaseBits,i=e.expiredTime;n===0?(this._purchasedFeatureHandler.parsePurchaseBits(s),this._expiredTime=Date.now()+1e3*i):C(n)?(u.l("".concat(t," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(u.e("".concat(t," errorCode:").concat(n," errorMessage:").concat(o)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"canIUse",value:function(e){return this._purchasedFeatureHandler.hasPurchasedFeature(e)}},{key:"isFeatureEnabled",value:function(e){return this._purchasedFeatureHandler.isFeatureEnabled(e)}},{key:"isFeatureEnabledForStat",value:function(e){this._purchasedFeatureHandler.isFeatureEnabledForStat(e)}},{key:"isSearchCloudMessagesEnabled",value:function(){this._purchasedFeatureHandler.isSearchCloudMessagesEnabled()}},{key:"get",value:function(e){return this._m.get(e)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler.clear()}}]),ra),ol=(z(Mo,Oe),qr=X(Mo),R(Mo,[{key:"registerPlugin",value:function(e){var t,n,o,s,i,a,r,c,d,p,h,m,f;ze?(this._offlinePushPlugin=e["tim-offline-push-plugin"],t=(f=e.offlinePushConfig||{}).huaweiBusinessID,n=f.xiaomiBusinessID,o=f.xiaomiAppID,s=f.xiaomiAppKey,i=f.meizuBusinessID,a=f.meizuAppID,r=f.meizuAppKey,c=f.vivoBusinessID,d=f.oppoBusinessID,p=f.oppoAppKey,h=f.oppoAppSecret,m=f.honorBusinessID,f=f.iosBusinessID,this._androidPushConfig.huaweiPushBussinessId=t,this._androidPushConfig.xiaomiPushBussinessId=n,this._androidPushConfig.xiaomiPushAppId=o,this._androidPushConfig.xiaomiPushAppKey=s,this._androidPushConfig.meizuPushBussinessId=i,this._androidPushConfig.meizuPushAppId=a,this._androidPushConfig.meizuPushAppKey=r,this._androidPushConfig.vivoPushBussinessId=c,this._androidPushConfig.oppoPushBussinessId=d,this._androidPushConfig.oppoPushAppKey=p,this._androidPushConfig.oppoPushAppSecret=h,this._androidPushConfig.honorPushBussinessId=m,new S("registerPlugin").setMessage("tim-offline-push-plugin").setMoreMessage("isExist:".concat(!C(this._offlinePushPlugin))).end(!0),u.l("".concat(this._n,".").concat("registerPlugin"," ok. offlinePushConfig:").concat(JSON.stringify(e.offlinePushConfig))),this._iosBusinessID=f,this._setAppShowListener()):this.outputWarning("OfflinePushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._getDeviceToken()}},{key:"_getDeviceToken",value:function(){var e,t=this,n="".concat(this._n,".").concat("_getDeviceToken");Xe(this._offlinePushPlugin.getDeviceToken)?(e="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig),", iosBusinessID:").concat(this._iosBusinessID),u.l("".concat(n," start. ").concat(e)),new S("_getDeviceToken").setMessage("".concat(e)).end(!0),this._offlinePushPlugin.getDeviceToken(this._androidPushConfig,function(o){var s,i,a,r,c=new S("getDeviceTokenRes"),d=o.code,p=o.msg;d===0?(s=(r=o.data).deviceToken,i=r.deviceBrand,a=r.deviceType,r=r.bussinessId,t._deviceToken=s,t._businessID=r||t._iosBusinessID,e="deviceToken:".concat(s,", deviceBrand:").concat(i||a,", businessID:").concat(t._businessID),u.l("".concat(n," ok. ").concat(e)),c.setMessage(e).end(!0),t._setToken()):(c.setMessage("code:".concat(d,", msg:").concat(p)).end(!0),u.e("".concat(n," failed. error:"),o))})):u.e("".concat(n," getDeviceToken is not a function"))}},{key:"canIUseOfflinePush",value:function(){return ze&&!C(this._offlinePushPlugin)}},{key:"_setAppShowListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setAppShowListener");C(this._offlinePushPlugin)?u.e("".concat(t," offlinePushPlugin is undefined")):Xe(this._offlinePushPlugin.setAppShowListener)?(new S("_setAppShowListener").end(!0),u.l("".concat(t," start")),this._offlinePushPlugin.setAppShowListener(function(n){n=(n||{}).appShow,new S("setAppShowListenerRes").setMessage("appShow:".concat(n)).end(!0),u.l("".concat(t," ok. appShow:").concat(n)),e._m.isReady()&&(n===0?(e._getConvUnreadCount(),e._onBackground()):n===1&&e._onForeground())})):u.e("".concat(t," setAppShowListener is not a function"))}},{key:"getDeviceBrand",value:function(){var e;if(!C(this._offlinePushPlugin)&&Xe(this._offlinePushPlugin.getDeviceType))return e=(this._offlinePushPlugin.getDeviceType()||{}).deviceType,u.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(e)),e}},{key:"_setToken",value:function(){var e="".concat(this._n,"._setToken"),t=this.get(12),n=1,o="",s="",r=(G(this._deviceToken)&&(n=0),this.getUniAppPlatform()),i=this.getDeviceBrand(),a=(r===re.IOS||r===re.IPAD||r===re.MAC?s=this._deviceToken:r===re.ANDROID&&(o=this._deviceToken),new S("offlinePushSetToken")),r="deviceToken:".concat(s||o,", businessID:").concat(this._businessID,", ")+"deviceBrand:".concat(i,", isWebUniapp:").concat(this._isWebUniapp,", pushMsg:").concat(n,", platform:").concat(r);return a.setMessage("".concat(r)),u.l("".concat(e," ").concat(r)),this.req({proto:g.SET_TOKEN,data:{tokenID:o,pushMsg:n,sdkAppID:t.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:i,deviceToken:s,isWebUniapp:this._isWebUniapp}}).then(function(c){return a.end(),u.l("".concat(e," ok")),c}).catch(function(c){return a.setError(c).end(),u.e("".concat(e," failed. error:"),c),v(c)})}},{key:"_getConvUnreadCount",value:function(){var e=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.get(11).getLocalConversationList().forEach(function(t){t.type===_.CONV_C2C&&(e._c2cUnreadCount+=t.unreadCount),t.type===_.CONV_GROUP&&(e._groupUnreadCount+=t.unreadCount)})}},{key:"_onBackground",value:function(){var e=this,t="".concat(this._n,".").concat("_onBackground"),n=new S("_onBackground");this.req({proto:g.STAT_BACKGROUND,data:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then(function(o){return n.setMessage("c2cUnreadCount: ".concat(e._c2cUnreadCount,", groupUnreadCount: ").concat(e._groupUnreadCount)).end(),u.l("".concat(t," ok")),o}).catch(function(o){n.setError(o).end(),u.e("".concat(t," failed. error:"),o)})}},{key:"_onForeground",value:function(){var e="".concat(this._n,".").concat("_onForeground"),t=new S("_onForeground");this.req({proto:g.STAT_FOREGROUND,data:{isWebUniapp:this._isWebUniapp}}).then(function(n){return t.end(),u.l("".concat(e," ok")),n}).catch(function(n){t.setError(n).end(),u.e("".concat(e," failed. error:"),n)})}},{key:"getUniAppPlatform",value:function(){var e=uni.getSystemInfoSync().platform,t=this.getDeviceBrand();return e==="ios"?re.IOS:e==="android"?re.ANDROID:t===1002?re.IPAD:t===1001?re.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,u.l("".concat(this._n,".reset"))}}]),Mo),sl=(z(Io,Oe),Fr=X(Io),R(Io,[{key:"registerPlugin",value:function(e){var t,n,o;ze?(t="".concat(this._n,".").concat("registerPlugin"),this._pushPlugin=e["tim-push"],this._getDeviceInfo(),n=(o=e.pushConfig||{}).androidConfig,o=o.iOSConfig,Ht(n)&&(this._androidPushConfig=n[this._deviceInfo.packageName]),n=(o||{}).iOSBusinessID,this._iOSBusinessID=n,o=!C(this._pushPlugin),new S("registerPlugin").setMessage(this._pluginName).setMoreMessage("isExisted:".concat(o)).end(!0),u.l("".concat(t," ok. pushConfig:").concat(JSON.stringify(e.pushConfig))),o?(this._setAppShowListener(),this._setPushEventReportListener()):u.e("".concat(t," ").concat(this._pluginName," is undefined"))):this.outputWarning("TIMPushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._reportEventCacheList(),this._getDeviceToken(),this.get(27).isFeatureEnabledForStat(Math.pow(2,41))}},{key:"_reportEventCacheList",value:function(){var e=this,t="".concat(this._n,".").concat("_reportEventCacheList");Xe(this._pushPlugin.getPushEventCacheList)?(new S("_reportEventCacheList").end(!0),this._pushPlugin.getPushEventCacheList(function(n){var o=n.code,s=n.data.eventList,i=new S("getPushEventCacheListRes");if(i.setCode(o),o!==0)i.setMessage("res:".concat(JSON.stringify(n))).end(!0),u.e("".concat(t," failed. error:").concat(JSON.stringify(n)));else{o=s.length<10?"eventList:".concat(JSON.stringify(s)):"eventList.length:".concat(s.length),u.l("".concat(t," ok. ").concat(o)),i.setMessage(o).end(!0);for(var a=l(l({},n.data),{},{eventList:[]});0<s.length;)a.eventList=s.splice(0,40),e._pushReport(a)}})):u.e("".concat(this._pluginName,".getPushEventCacheList is not a function"))}},{key:"_getDeviceToken",value:function(){var e,t=this,n="".concat(this._n,".").concat("_getDeviceToken");Xe(this._pushPlugin.getDeviceToken)?(e="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig)," iOSBusinessID:").concat(this._iOSBusinessID),u.l("".concat(n," start. ").concat(e)),new S("_getDeviceToken").setMessage("".concat(e)).end(!0),this._pushPlugin.getDeviceToken(this._androidPushConfig,function(o){var s,i,a,r=o.code,c=o.msg,d=new S("getDeviceTokenRes");if(d.setCode(r),r===0)return s=(r=o.data).deviceToken,i=r.deviceBrand,a=r.deviceType,r=r.bussinessId,t._deviceToken=s,t._businessID=r||t._iOSBusinessID,e="deviceToken:".concat(s," deviceBrand:").concat(i||a," businessID:").concat(t._businessID),u.l("".concat(n," ok. ").concat(e)),d.setMessage(e).end(!0),void t._setToken();d.setMessage(c).end(!0),u.e("".concat(n," failed. error:").concat(JSON.stringify(o)))})):u.e("".concat(this._pluginName,".getDeviceToken is not a function"))}},{key:"_getDeviceInfo",value:function(){var e="".concat(this._n,".").concat("_getDeviceInfo");if(Xe(this._pushPlugin.getDeviceInfo)){var t=this._pushPlugin.getDeviceInfo(),n=t.code,o=t.data,s=new S("_getDeviceInfo");if(s.setCode(n),n===0)return this._deviceInfo=l(l({},this._deviceInfo),o),this._deviceInfo.pushVersion||(this._deviceInfo.pushVersion="1.0.1"),n="deviceInfo:".concat(JSON.stringify(this._deviceInfo)),u.l("".concat(e," ok. ").concat(n)),void s.setMessage(n).end(!0);s.setMessage("deviceInfoRes:".concat(JSON.stringify(t))).end(!0),u.e("".concat(e," failed. error:").concat(JSON.stringify(t)))}else u.e("".concat(this._pluginName,".getDeviceInfo is not a function"))}},{key:"canIUseTIMPush",value:function(){return ze&&!C(this._pushPlugin)}},{key:"_setAppShowListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setAppShowListener");Xe(this._pushPlugin.setAppShowListener)?(new S("_setAppShowListener").end(!0),u.l("".concat(t," start")),this._pushPlugin.setAppShowListener(function(n){n=(n||{}).appShow,new S("setAppShowListenerRes").setMessage("appShow:".concat(n)).end(!0),u.l("".concat(t," ok. appShow:").concat(n)),e._m.isReady()&&(n===0?(e._getConvUnreadCount(),e._onBackground()):n===1&&e._onForeground())})):u.e("".concat(this._pluginName,".setAppShowListener is not a function"))}},{key:"_setPushEventReportListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setPushEventReportListener");Xe(this._pushPlugin.setPushEventReportListener)?(new S("_setPushEventReportListener").end(!0),this._pushPlugin.setPushEventReportListener(function(n){var o=n.code,s=n.data,i=s.eventList,a=new S("setPushEventReportListenerRes");if(a.setCode(o),o===0)return o="eventList:".concat(JSON.stringify(i)),u.l("".concat(t," ok. ").concat(o)),a.setMessage(o).end(!0),void(e._m.isReady()&&F(i)&&0<i.length&&e._pushReport(s));a.setMessage("res:".concat(JSON.stringify(n))).end(!0),u.e("".concat(t," failed. error:").concat(JSON.stringify(n)))})):u.e("".concat(this._pluginName,".setPushEventReportListener is not a function"))}},{key:"getDeviceBrand",value:function(){var e;if(!C(this._pushPlugin)&&Xe(this._pushPlugin.getDeviceType))return e=(this._pushPlugin.getDeviceType()||{}).deviceType,u.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(e)),e}},{key:"_setToken",value:function(){var e="".concat(this._n,".").concat("_setToken"),t=this.get(12),n=1,r="",o="",i=(G(this._deviceToken)&&(n=0),this.getUniAppPlatform()),s=this.getDeviceBrand(),i=(i===re.IOS||i===re.IPAD||i===re.MAC?o=this._deviceToken:i===re.ANDROID&&(r=this._deviceToken),l({tokenID:r,pushMsg:n,sdkAppID:t.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:s,deviceToken:o,isWebUniapp:this._isWebUniapp},this._deviceInfo)),a=new S("_setToken"),r="data:".concat(JSON.stringify(i));a.setMessage("".concat(r)),u.l("".concat(e," ").concat(r)),this.req({proto:g.SET_TOKEN,data:i}).then(function(){a.end(),u.w("".concat(e," ok"))}).catch(function(c){a.setError(c).end(),u.e("".concat(e," failed. error:"),c),v(c)})}},{key:"_getConvUnreadCount",value:function(){var e=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.get(11).getLocalConversationList().forEach(function(t){t.type===_.CONV_C2C&&(e._c2cUnreadCount+=t.unreadCount),t.type===_.CONV_GROUP&&(e._groupUnreadCount+=t.unreadCount)})}},{key:"_onBackground",value:function(){var e=this,t="".concat(this._n,".").concat("_onBackground"),n=new S("_onBackground");this.req({proto:g.STAT_BACKGROUND,data:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then(function(){n.setMessage("c2cUnreadCount:".concat(e._c2cUnreadCount," groupUnreadCount:").concat(e._groupUnreadCount)).end(),u.l("".concat(t," ok"))}).catch(function(o){n.setError(o).end(),u.e("".concat(t," failed. error:"),o)})}},{key:"_onForeground",value:function(){var e="".concat(this._n,".").concat("_onForeground"),t=new S("_onForeground");this.req({proto:g.STAT_FOREGROUND,data:{isWebUniapp:this._isWebUniapp}}).then(function(){t.end(),u.l("".concat(e," ok"))}).catch(function(n){t.setError(n).end(),u.e("".concat(e," failed. error:"),n)})}},{key:"_pushReport",value:function(e){var t=this,n="".concat(this._n,".").concat("_pushReport"),o=new S("_pushReport");this.req({proto:g.PUSH_REPORT,data:{eventList:e.eventList}}).then(function(){o.end(),t._notifyReportSuccess(e)}).catch(function(s){o.setError(s).end(),u.e("".concat(n," failed. error:"),s)})}},{key:"_notifyReportSuccess",value:function(e){!C(this._pushPlugin)&&Xe(this._pushPlugin.notifyReportSuccess)&&(this._pushPlugin.notifyReportSuccess(e),u.l("".concat(this._n,"._notifyReportSuccess ok")))}},{key:"getUniAppPlatform",value:function(){var e=uni.getSystemInfoSync().platform,t=this.getDeviceBrand();return e==="ios"?re.IOS:e==="android"?re.ANDROID:t===1002?re.IPAD:t===1001?re.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,u.l("".concat(this._n,".reset"))}}]),Io),il=(z(vo,Oe),wr=X(vo),R(vo,[{key:"init",value:function(){var e=this.get(18).getPlugin("tim-profanity-filter-plugin");e&&(this._plugin=new e({logger:u,isArray:F,isMap:Pa,isDevMode:this.isDevMode()}),this._getLexicon())}},{key:"onCheckTimer",value:function(){this._plugin&&this._canIUseLexicon&&this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime&&this._getLexicon()}},{key:"filterMessage",value:function(e,o){var n=!0;if(!this._plugin||!this._canIUseLexicon||o&&o.messageControlInfo&&o.messageControlInfo.excludedFromContentModeration===!0)return n;var o=e.type,s=e.conversationType;if(o!==_.MSG_TEXT&&o!==_.MSG_CUSTOM)return n;var i,a="".concat(this._n,".filterMessage");if(u.l("".concat(a)),o===_.MSG_TEXT){if(s===_.CONV_C2C?i="c2c_text_message":s===_.CONV_GROUP&&(i="group_text_message"),!this._isConfigOn(i))return n;var c=this._plugin.filter(e.payload.text),r=c.type,c=c.modifiedText;r===1?n=!1:r===2&&(e.payload.text=c)}else if(o===_.MSG_CUSTOM){if(s===_.CONV_C2C?i="c2c_custom_message":s===_.CONV_GROUP&&(i="group_custom_message"),!this._isConfigOn(i))return n;r=this._plugin.filter(e.payload.data),c=this._plugin.filter(e.payload.description),o=this._plugin.filter(e.payload.extension),r.type===1||c.type===1||o.type===1?n=!1:(r.type===2&&(e.payload.data=r.modifiedText),c.type===2&&(e.payload.description=c.modifiedText),o.type===2&&(e.payload.extension=o.modifiedText))}return u.l("".concat(a," done. isAllowedToSend:").concat(n)),n}},{key:"filterText",value:function(e,t){var n="".concat(this._n,".filterText"),o={isAllowedToSend:!0,modifiedText:e};return!this._plugin||!this._canIUseLexicon||!this._isConfigOn(t)?o:(u.l("".concat(n)),t=this._plugin.filter(e),e=t.type,t=t.modifiedText,e===1?o.isAllowedToSend=!1:e===2&&(o.modifiedText=t),u.l("".concat(n," done. ret:"),o),o)}},{key:"_getLexicon",value:function(){var e=this,t=new S("profanityFilter"),n="".concat(this._n,"._getLexicon");this._isFetching=!0,this.req({proto:g.GET_PROFANITY_LIST,data:{startIndex:this._startIndex,version:this._version}}).then(function(h){var h=h.data,s=h.errorInfo,i=h.filterConfig,a=h.lexicon,r=h.strToken,c=h.completeFlag,d=h.nextStartIndex,p=h.version,h=h.expiredTime,m=s.errorCode,f=s.errorMessage;return m!==0?(e._isFetching=!1,u.w("".concat(n," failed. error:"),s),void t.setCode(m).setMessage(f).end()):(e._onFilterConfig(i),e._getToken(r),c===1?(u.l("".concat(n," done. version:").concat(p," expiredTime:").concat(h)),e._version=p,e._canIUseLexicon=!0,e._isFetching=!1,e._expiredTime=Date.now()+1e3*h,void e._plugin.onLexiconCompleted(a)):(e._startIndex=d,e._plugin.onLexiconSliced(a),void e._getLexicon()))}).catch(function(o){t.setError(o).end(),e._isFetching=!1,u.l("".concat(n," failed. error:"),o)})}},{key:"_onFilterConfig",value:function(e){var t=this;G(e)||(this._filterConfigMap.clear(),Object.keys(e).forEach(function(n){t._filterConfigMap.set(n,e[n])}),u.l("".concat(this._n,"._onFilterConfig. keys:").concat(Array.from(this._filterConfigMap.keys())," values:").concat(Array.from(this._filterConfigMap.values()))))}},{key:"_isConfigOn",value:function(e){return this._filterConfigMap.get(e)===1}},{key:"_getToken",value:function(e){if(te(e)){var t=e.length,n="";if(t%2==0)for(var o=0;o<=t-1;o+=2)n=(n+=e[o+1])+e[o];else{for(var s=0;s<t-1;s+=2)n=(n+=e[s+1])+e[s];n+=e[t-1]}this._plugin.onToken(n)}}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._plugin&&(this._plugin.reset(),this._plugin=null),this._filterConfigMap.clear(),this._startIndex=0,this._version=0,this._canIUseLexicon=!1,this._isFetching=!1,this._expiredTime=0}}]),vo),al=(R(aa,[{key:"_onCloudConfigUpdated",value:function(){var e=this,t=this._m.get(23).getCloudConfig("rtc_cmd");C(t)||((t=JSON.parse(t)).forEach(function(n){e._TRTCCommandList.includes(n)||e._TRTCCommandList.push(n)}),this._setTRTCCommandMap())}},{key:"_setTRTCCommandMap",value:function(){for(var e,t=0,n=this._TRTCCommandList.length;t<n;t++)e=this._TRTCCommandList[t].split(".")[0],this._TRTCCommandMap.set(e,1)}},{key:"onRoomCustomDataReceived",value:function(e){this._m.getOuterEmitterInstance().emit(V.ROOM_CUSTOM_DATA_RECEIVED,e)}},{key:"sendTRTCCustomData",value:function(n){var t=n.serviceCommand,n=n.data,o="".concat(L.NAME.TUIROOM_SVR,".*");return C(t)||(o=t),this._isValidServiceCommand(o)?this._trans({servcmd:o,data:n}):v({code:M.INVALID_TRTC_CMD})}},{key:"_trans",value:function(n){u.d("".concat(this._n,"._trans. options:").concat(JSON.stringify(n)));var t=n.servcmd,n=n.data;return this._m.get(20).trans({servcmd:t,data:te(n)?JSON.parse(n):n})}},{key:"_isValidServiceCommand",value:function(e){return e.endsWith(".*")?this._TRTCCommandList.includes(e):(e=e.split(".")[0],this._TRTCCommandMap.has(e))}},{key:"isTRTCCommand",value:function(e){return e=e.split(".")[0],this._TRTCCommandMap.has(e)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset"))}}]),aa),rl=(R(ia,[{key:"_init",value:function(){var e,t=this._getStorageModule().getItem(this.TIM_ERROR_ASSISTANCE,!1);if(t){try{e=JSON.parse(t)}catch(n){this._getStorageModule().removeItem(this.TIM_ERROR_ASSISTANCE,!1),u.w("".concat(this._n,"._init error:"),n)}e&&(this._needToUpdate(e)?this._fetch():this._fillMap(e.message))}else this._fetch()}},{key:"_needToUpdate",value:function(n){var t=n.localSavedTime,n=n.localSavedVersion,t=t&&new Date().getTime()-t>=this.STORAGE_EXPIRES_TIME,n=!n||n!=="3.3.5";return u.l("".concat(this._n,"._needToUpdate isTimeout:").concat(t," isDifferentVersion:").concat(n)),t||n}},{key:"_fetch",value:function(){var e,t,n,o,s,i;this._m.get(12).isPrivateNetWork()||(e="https://web.sdk.qcloud.com/im/download/error-message/v3/0.0.5/tim-error-message.txt",t="application/x-www-form-urlencoded;charset=UTF-8",n="".concat(this._n,"._fetch ok in"),o=this,ge?ce.request({url:e,method:"GET",timeout:3e3,header:{"content-type":t},dataType:"text",success:function(a){o._fillAndSave(a.data),u.l("".concat(n," mini program"))},fail:function(){}}):(s=new XMLHttpRequest,i=setTimeout(function(){s.abort()},3e3),s.onreadystatechange=function(){s.readyState===4&&(clearTimeout(i),s.status!==200&&s.status!==304||(u.l("".concat(n," browser")),o._fillAndSave(s.responseText)))},s.open("GET",e,!0),s.setRequestHeader("Content-type",t),s.send()))}},{key:"_fillAndSave",value:function(e){this._fillMap(e),this._getStorageModule().setItem(this.TIM_ERROR_ASSISTANCE,JSON.stringify({message:e,localSavedTime:new Date().getTime(),localSavedVersion:"3.3.5"}),!0,!1)}},{key:"_getStorageModule",value:function(){return this._m.get(13)}},{key:"_fillMap",value:function(e){this._map.clear();for(var t,n,o=e.split(`;
`),s=o.length,i=new RegExp(/'/g),a=0;a<s;a++)if(n=o[a].indexOf(":"),t=o[a].slice(0,n),n=o[a].slice(n+1,o[a].length),!t.startsWith("//")){if(C(n))continue;this._map.set(t,n.replace(i,""))}}},{key:"get",value:function(n){var o=n.isIntl,s=n.key,t=n.replacement1,n=n.replacement2,o="".concat(s,o?"_en":"_cn"),s=(!this._map.has(o)&&this._map.has(s)&&(o=s),"");return this._map.has(o)&&(s=this._map.get(o),C(t)||(s=s.replace("$replacement1",t)),C(n)||(s=s.replace("$replacement2",n))),s}},{key:"reset",value:function(){u.l("".concat(this._n,".reset"))}}]),ia),cl=(R(sa,[{key:"onNewMessageList",value:function(n){var t=this,n=this._sigM.filterMessageList(n);0<n.length&&n.forEach(function(o){var s=t.getPayloadData(o);s&&t._handleActionType(s,o)})}},{key:"onMessageModified",value:function(n){var t=this,n=this._sigM.filterMessageList(n);0<n.length&&n.forEach(function(o){var s=t.getPayloadData(o);s&&t._onInvitationModified(s,o)})}},{key:"getPayloadData",value:function(n){var t="".concat(this._n,".getPayloadData"),n=n.payload.data;try{return JSON.parse(n)}catch{return u.e("".concat(t," JSON parse error. signalingData:").concat(n)),null}}},{key:"_handleActionType",value:function(e,t){switch(e.actionType){case Me.ACTION_TYPE_INVITE:this._onNewInvitationReceived(e,t);break;case Me.ACTION_TYPE_REJECT_INVITE:this._onInviteeRejected(e);break;case Me.ACTION_TYPE_ACCEPT_INVITE:this._onInviteeAccepted(e);break;case Me.ACTION_TYPE_CANCEL_INVITE:this._onInvitationCancelled(e);break;case Me.ACTION_TYPE_INVITE_TIMEOUT:this._onInvitationTimeout(e)}}},{key:"_createDefaultEmitData",value:function(e){return{inviteID:e.inviteID,inviter:e.inviter,groupID:e.groupID,data:e.data||""}}},{key:"_onNewInvitationReceived",value:function(e,t){var p="".concat(this._n,"._onNewInvitationReceived"),n=e.inviteID,o=e.inviteeList,s=e.groupID,i=e.inviter,a=this._sigM.getMyUserID(),r=o.includes(a),c=e.timeout,d=(Ko().getTime()-1e3*t.time)/1e3,p=(0<c&&0<d&&d<c&&(c-=d),"".concat(p," myselfIncluded:").concat(r," groupID:").concat(s," signalObj:").concat(JSON.stringify(e)));u.l("".concat(p," timeout:").concat(c,"s delta:").concat(d,"s")),(s&&r||!s)&&((p=this._sigM.getInviteInfo(n))&&p===e||(p||this._sigM.setInviteInfo(n,l(l({},e),{},{message:t})),this._sigM.emitEvent(Me.NEW_INVITATION_RECEIVED,l(l({},this._createDefaultEmitData(e)),{},{inviteeList:o})),i!==a&&this._sigM.startTimer(l(l({},e),{},{timeout:c}))))}},{key:"_onInviteeRejected",value:function(e){var t="".concat(this._n,"._onInviteeRejected"),n=e.inviteID,o=e.inviter,s=e.groupID,i=this._sigM.hasInviteInfo(n);u.l("".concat(t," inviteID:").concat(n," hasInviteID:").concat(i," inviter:").concat(o," groupID:").concat(s)),i&&(this._sigM.updateInviteInfo(e),this._sigM.emitEvent(Me.INVITEE_REJECTED,l(l({},this._createDefaultEmitData(e)),{},{invitee:e.inviteeList[0]})))}},{key:"_onInviteeAccepted",value:function(e){var t="".concat(this._n,"._onInviteeAccepted"),n=e.inviteID,o=e.inviter,s=e.groupID,i=this._sigM.hasInviteInfo(n);u.l("".concat(t," inviteID:").concat(n," hasInviteID:").concat(i," inviter:").concat(o," groupID:").concat(s)),i&&(this._sigM.updateInviteInfo(e),this._sigM.emitEvent(Me.INVITEE_ACCEPTED,l(l({},this._createDefaultEmitData(e)),{},{invitee:e.inviteeList[0]})))}},{key:"_onInvitationCancelled",value:function(e){var t="".concat(this._n,"._onInvitationCancelled"),n=e.inviteID,o=e.inviter,s=e.groupID,i=this._sigM.hasInviteInfo(n);u.l("".concat(t," inviteID:").concat(n," hasInviteID:").concat(i," inviter:").concat(o," groupID:").concat(s)),i&&(this._sigM.deleteInviteInfo(n),this._sigM.emitEvent(Me.INVITATION_CANCELLED,this._createDefaultEmitData(e)))}},{key:"_onInvitationTimeout",value:function(e){var t="".concat(this._n,"._onInvitationTimeout"),n=e.inviteID,o=e.inviter,s=e.groupID,i=e.inviteeList,a=this._sigM.hasInviteInfo(n);u.l("".concat(t," inviteID:").concat(n," hasInviteID:").concat(a," inviter:").concat(o," groupID:").concat(s,"  data:").concat(e.data)),a&&(this._sigM.updateInviteInfo(e),this._sigM.emitEvent(Me.INVITATION_TIMEOUT,l(l({},this._createDefaultEmitData(e)),{},{inviteeList:i,isSelfTimeout:!1})))}},{key:"_onInvitationModified",value:function(e,t){var n="".concat(this._n,"._onInvitationModified"),o=e.inviteID,s=e.data;u.l("".concat(n," inviteID:").concat(o," data:").concat(s)),this._sigM.setInviteInfo(o,l(l({},e),{},{message:t})),this._sigM.emitEvent(Me.INVITATION_MODIFIED,{inviteID:o,data:s})}}]),sa),ul=(R(oa,[{key:"generateInviteID",value:function(){var e,t=(t=Vu)((e=xu)(32),8)+"-"+t(e(16),4)+"-"+t(16384|e(12),4)+"-"+t(32768|e(14),4)+"-"+t(e(48),12);return u.l("".concat(this._n,".generateInviteID inviteID:").concat(t)),t}},{key:"createInviteInfo",value:function(n){var t=this.generateInviteID(),n=this.createInviteCustomData(l(l({},n),{},{inviteID:t})),s=n.groupID,o=n.inviteeList,s=s||o[0];return{customData:n,message:this.createSignalingMessage(n,s),inviteID:t}}},{key:"_createDefaultCustomData",value:function(o){var t=o.data,n=o.inviteID,o=o.groupID;return{businessID:1,timeout:0,data:t===void 0?"":t,inviteID:n===void 0?"":n,groupID:o===void 0?"":o}}},{key:"createInviteCustomData",value:function(e){var t=e.userID,n=e.timeout,n=n===void 0?0:n,o=e.groupID,o=o===void 0?"":o,s=this._sigM.getMyUserID(),s=l(l({},this._createDefaultCustomData(e)),{},{actionType:Me.ACTION_TYPE_INVITE,inviter:s,inviteeList:o?e.inviteeList:[t],timeout:n});return u.l("".concat(this._n,".createInviteCustomData customData:").concat(JSON.stringify(s))),s}},{key:"createCancelCustomData",value:function(e){var t,n="".concat(this._n,".createCancelCustomData"),a=e.inviteID,o=this._sigM.getMyUserID(),a=this._sigM.getInviteInfo(a),s=a.inviteeList,i=a.groupID,a=a.inviter;return a===o?t=l(l({},this._createDefaultCustomData(e)),{},{actionType:Me.ACTION_TYPE_CANCEL_INVITE,groupID:i,inviter:o,inviteeList:s}):u.e("".concat(n," unmatched inviter:").concat(a," and my userID:").concat(o)),u.l("".concat(n," customData:").concat(JSON.stringify(t))),t}},{key:"createAcceptCustomData",value:function(e){var t,n="".concat(this._n,".createAcceptCustomData"),o=e.inviteID,s=this._sigM.getMyUserID(),i=this._sigM.getInviteInfo(o),a=i.inviter,r=i.groupID;return i.inviteeList.includes(s)?t=l(l({},this._createDefaultCustomData(e)),{},{actionType:Me.ACTION_TYPE_ACCEPT_INVITE,groupID:r,inviter:a,inviteeList:[s]}):u.e("".concat(n," userID:").concat(s," not in inviteeList. inviteID:").concat(o," groupID:").concat(r)),u.l("".concat(n," customData:").concat(JSON.stringify(t))),t}},{key:"createRejectCustomData",value:function(e){var t,n="".concat(this._n,".createRejectCustomData"),o=e.inviteID,s=this._sigM.getMyUserID(),i=this._sigM.getInviteInfo(o),a=i.inviter,r=i.groupID;return i.inviteeList.includes(s)?t=l(l({},this._createDefaultCustomData(e)),{},{actionType:Me.ACTION_TYPE_REJECT_INVITE,groupID:r,inviter:a,inviteeList:[s]}):u.e("".concat(n," userID:").concat(s," not in inviteeList. inviteID:").concat(o," groupID:").concat(r)),u.l("".concat(n," customData:").concat(JSON.stringify(t))),t}},{key:"createTimeoutCustomData",value:function(a){var t="".concat(this._n,".createTimeoutCustomData"),n=a.inviteeList,o=a.inviter,s=a.isInviter,s=s!==void 0&&s,i=this._sigM.getMyUserID(),a=l(l({},this._createDefaultCustomData(a)),{},{actionType:Me.ACTION_TYPE_INVITE_TIMEOUT,inviter:o,inviteeList:s?n:[i]});return u.l("".concat(t," customData:").concat(JSON.stringify(a))),a}},{key:"createSignalingMessage",value:function(e,s){var n=e.groupID,i=e.inviter,o=this._sigM.get(2),s={to:s||n||i,conversationType:n?_.CONV_GROUP:_.CONV_C2C,priority:_.MSG_PRIORITY_HIGH,payload:{data:JSON.stringify(e)}},i=o.createCustomMessage(s);return u.d("".concat(this._n,".createSignalingMessage. message:").concat(JSON.stringify(i))),i}}]),oa),ll=(R(na,[{key:"getHistorySignaling",value:function(){var e=this,t=this._sigM.get(11).getLocalConversationList();G(t)||(this._getC2CSignalingList(),t=this._getValidConversationList(t),this._getGroupSignalingList(t).then(function(n){e._handleSignalingList(n)}))}},{key:"_getC2CSignalingList",value:function(){var e=this._sigM.get(6).getMessageListFromUnreadDB(),e=this._filterMessageList(e);this._getSignalingRelatedToMeMap(e)}},{key:"_getGroupSignalingList",value:function(n){var t=this,n=this._createPromiseList(n);return G(n)?Promise.resolve(this._sortSignaling(this._signalingRelatedToMeMap)):this._concurrentGetMessageList(n).then(function(o){var s=new Map;return o.forEach(function(i){i=i.signalingList,i=t._getSignalingRelatedToMeMap(i),s=new Map([].concat(b(s),b(i)))}),t._sortSignaling(s)})}},{key:"_handleSignalingList",value:function(e){G(e)||(u.d("".concat(this._n,"._handleSignalingList signalingList:").concat(JSON.stringify(e))),this._sigM.onNewMessageList(e))}},{key:"_filterMessageList",value:function(e){return this._sigM.filterMessageList(e)}},{key:"_getValidConversationList",value:function(e){for(var t=[],n=0;n<e.length;n++){var s=e[n],o=s.type,s=s.unreadCount;o===_.CONV_GROUP&&s&&t.push(e[n])}return t}},{key:"_createPromiseList",value:function(e){for(var t=[],n=0;n<e.length;n++){var s=e[n],o=s.conversationID,i=s.unreadCount,s=s.type===_.CONV_C2C?i:this.COUNT,i=(this._signalingMap.set(o,{needMessageCount:s,signalingList:[]}),this._sigM.get(11).getMessageList({conversationID:o}));t.push(i)}return t}},{key:"_concurrentGetMessageList",value:function(e){var t=this,n=[];return Promise.all(e).then(function(o){for(var s=0;s<o.length;s++){var a=o[s],i=a.code,a=a.data;i===0&&a.messageList.length!==0&&(t._handleMessageList(a.messageList),(i=t._relayGetMessageList(a))&&n.push(i))}return 0<n.length?t._concurrentGetMessageList(n):t._signalingMap})}},{key:"_relayGetMessageList",value:function(n){var s=n.messageList,t=n.nextReqMessageID,n=n.isCompleted;if(s.length===0)return null;var s=s[0],o=s.conversationID,s=s.conversationType,i=this._signalingMap.get(o).needMessageCount;return s===_.CONV_GROUP||i===0||n?null:this._sigM.get(11).getMessageList({conversationID:o,nextReqMessageID:t,count:i})}},{key:"_handleMessageList",value:function(e){var t=e.length,n=e[0].conversationID,s=this._signalingMap.get(n),o=s.needMessageCount,s=s.signalingList;this._signalingMap.set(n,{needMessageCount:0<o-t?o-t:0,signalingList:s.concat(this._filterMessageList(e))})}},{key:"_getSignalingRelatedToMeMap",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this._saveSignalingRelatedToMe(n)}return this._signalingRelatedToMeMap}},{key:"_saveSignalingRelatedToMe",value:function(e){var n=this._sigM.getRemoteSignalingHandler().getPayloadData(e)||{},t=n.actionType,n=n.inviteID,o=n===void 0?"":n;switch(t===void 0?"":t){case Me.ACTION_TYPE_INVITE:this._setHistoryInviteInfo(e);break;case Me.ACTION_TYPE_REJECT_INVITE:case Me.ACTION_TYPE_ACCEPT_INVITE:this.updateHistoryInviteInfo(e);break;case Me.ACTION_TYPE_CANCEL_INVITE:this.deleteHistoryInviteInfo(o);break;case Me.ACTION_TYPE_INVITE_TIMEOUT:this.updateHistoryInviteInfo(e)}}},{key:"_setHistoryInviteInfo",value:function(e){var t=this._sigM.getRemoteSignalingHandler().getPayloadData(e)||{},n=t.inviteID,n=n===void 0?"":n,o=t.inviteeList,o=o===void 0?[]:o,s=t.timeout,s=s===void 0?0:s,i=this._sigM.getMyUserID();o.includes(i)&&(o=Mn()-e.time,0<s&&s<o&&s!==0||this._signalingRelatedToMeMap.set(n,l(l({},t),{},{messageList:[e]})))}},{key:"deleteHistoryInviteInfo",value:function(e){this._signalingRelatedToMeMap.has(e)&&this._signalingRelatedToMeMap.delete(e)}},{key:"updateHistoryInviteInfo",value:function(e){var n=this._sigM.getRemoteSignalingHandler().getPayloadData(e)||{},t=n.inviteID,t=t===void 0?"":t,n=n.inviteeList,o=n===void 0?[]:n;if(this._signalingRelatedToMeMap.has(t)){for(var n=this._signalingRelatedToMeMap.get(t),s=n.inviteeList,n=n.messageList,i=0;i<o.length;i++){var a=o[i];s.includes(a)&&s.splice(s.indexOf(a),1)}s.length===0?this.deleteHistoryInviteInfo(t):n.push(e)}else this.deleteHistoryInviteInfo(t)}},{key:"_sortSignaling",value:function(e){var t=[];return e.forEach(function(n){t=[].concat(b(t),b(n.messageList))}),t.sort(function(n,o){return(n.time||0)-(o.time||0)})}},{key:"reset",value:function(){this._signalingMap.clear(),this._signalingRelatedToMeMap.clear()}}]),na),dl=R(function e(t,n){D(this,e),this.businessID=t.businessID||1,this.inviteID=t.inviteID,this.groupID=t.groupID||"",this.inviter=t.inviter||"",this.inviteeList=t.inviteeList||[],this.data=t.data||"",this.actionType=t.actionType||Me.ACTION_TYPE_INVITE,this.timeout=t.timeout||0}),pl=["message"],_l=["message"],gl=(z(mo,Oe),br=X(mo),R(mo,[{key:"onC2CUnreadHandleCompleted",value:function(){this._isC2CUnreadHandleCompleted=!0,this._isC2CUnreadHandleCompleted&&this._isConvSyncCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"onConvSyncCompleted",value:function(){this._isConvSyncCompleted=!0,this._isC2CUnreadHandleCompleted&&this._isConvSyncCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"onReady",value:function(){u.l("".concat(this._n,".onReady")),this._isSyncCompleted=!0,this._historySignalingHandler.getHistorySignaling()}},{key:"onNewMessageList",value:function(e){return this._remoteSignalingHandler.onNewMessageList(e)}},{key:"onMessageModified",value:function(e){return this._remoteSignalingHandler.onMessageModified(e)}},{key:"hasInviteInfo",value:function(e){return this._inviteInfoMap.has(e)}},{key:"getInviteInfo",value:function(e){return this._inviteInfoMap.get(e)}},{key:"setInviteInfo",value:function(e,o){var n=o.message,o=Z(o,pl);u.l("".concat(this._n,".setInviteInfo inviteID:").concat(e," data:").concat(JSON.stringify(o))),this._inviteInfoMap.set(e,l(l({},o),{},{message:n}))}},{key:"deleteInviteInfo",value:function(e){this.hasInviteInfo(e)&&(u.l("".concat(this._n,".deleteInviteInfo inviteID:").concat(e,".")),this._inviteInfoMap.delete(e))}},{key:"updateInviteInfo",value:function(i){var t="".concat(this._n,".updateInviteInfo"),n=i.inviteID,o=i.inviter,s=i.inviteeList,i=i.groupID;u.l("".concat(t," inviteID:").concat(n," inviter:").concat(o," groupID:").concat(i)),i&&this.hasInviteInfo(n)?(o=s[0],(i=this.getInviteInfo(n).inviteeList).includes(o)&&(i.splice(i.indexOf(o),1),u.l("".concat(t," remove ").concat(o,". localInviteeList.length:").concat(i.length))),i.length===0&&this.deleteInviteInfo(n)):this.deleteInviteInfo(n)}},{key:"getLocalSignalingHandler",value:function(){return this._localSignalingHandler}},{key:"getRemoteSignalingHandler",value:function(){return this._remoteSignalingHandler}},{key:"canIUseSignaling",value:function(){return this._canIUseSignaling}},{key:"emitEvent",value:function(e,t){this._outerEmitter.emit(e,t)}},{key:"addSignalingListener",value:function(e,t,n){this._canIUseSignaling||(this._canIUseSignaling=!0),this._outerEmitter.on(e,t,n)}},{key:"removeSignalingListener",value:function(e,t,n){this._outerEmitter.off(e,t,n),this._outerEmitter.eventNames().length===0&&(this._canIUseSignaling=!1)}},{key:"invite",value:function(e){var t=this,n="".concat(this._n,".").concat("invite"),o=this._localSignalingHandler.createInviteInfo(e),s=o.message,i=o.customData,a=o.inviteID;return u.l("".concat(n," options:").concat(JSON.stringify(e)," inviteID:").concat(a)),this.sendSignaling(s,e).then(function(r){return r&&r.code===0?(t.setInviteInfo(a,l(l({},i),{},{message:s})),t.startTimer(l(l({},i),{},{inviteID:a})),l(l({},r),{},{inviteID:a})):r}).catch(function(r){return v(r)})}},{key:"inviteSync",value:function(e,t,n){var o=this,s="".concat(this._n,".").concat("inviteSync"),i=this._localSignalingHandler.createInviteInfo(e),a=i.message,r=i.customData,c=i.inviteID;return u.l("".concat(s," options:").concat(JSON.stringify(e)," inviteID:").concat(c)),this.sendSignaling(a,e).then(function(d){if(d&&d.code===0)return o.setInviteInfo(c,l(l({},r),{},{message:a})),o.startTimer(l(l({},r),{},{inviteID:c})),t&&t({inviteID:c}),{inviteID:c};n&&n(d.code===0,d.message||"")}).catch(function(d){return n&&n(d.code,d.message),v(d)}),c}},{key:"_handleImResponse",value:function(e,t,n){t&&t.code===0&&(this._isHandling=!1,n?this.deleteInviteInfo(e.inviteID):this.updateInviteInfo(e))}},{key:"cancel",value:function(e){var t=this,o="".concat(this._n,".").concat("cancel");if(u.l("".concat(o," options:").concat(JSON.stringify(e))),!this.hasInviteInfo(e.inviteID)||this._isHandling)return v({code:M.INVALID_CANCEL_MESSAGE});this._isHandling=!0;var n=this._localSignalingHandler.createCancelCustomData(e);if(!n)return this._isHandling=!1,v({code:M.SIGNALING_NO_PERMISSION});var o=n.groupID,s=n.inviteeList,o=o||s[0],s=this._localSignalingHandler.createSignalingMessage(n,o);return this.sendSignaling(s,e).then(function(i){return t._handleImResponse(n,i,!0),i.code===0?l(l({},i),{},{inviteID:e.inviteID}):i}).catch(function(i){return v(i)})}},{key:"accept",value:function(e){var t=this,n="".concat(this._n,".").concat("accept");if(u.l("".concat(n," options:").concat(JSON.stringify(e))),!this.hasInviteInfo(e.inviteID)||this._isHandling)return v({code:M.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var o=this._localSignalingHandler.createAcceptCustomData(e);return o?(n=this._localSignalingHandler.createSignalingMessage(o),this.sendSignaling(n,e).then(function(s){return t._handleImResponse(o,s),s.code===0?l(l({},s),{},{inviteID:e.inviteID}):s}).catch(function(s){return v(s)})):(this._isHandling=!1,v({code:M.SIGNALING_NO_PERMISSION}))}},{key:"reject",value:function(e){var t=this,n="".concat(this._n,".").concat("reject");if(u.l("".concat(n," options:").concat(JSON.stringify(e))),!this.hasInviteInfo(e.inviteID)||this._isHandling)return v({code:M.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var o=this._localSignalingHandler.createRejectCustomData(e);return o?(n=this._localSignalingHandler.createSignalingMessage(o),this.sendSignaling(n,e).then(function(s){return t._handleImResponse(o,s,!0),s.code===0?l(l({},s),{},{inviteID:e.inviteID}):s}).catch(function(s){return v(s)})):(this._isHandling=!1,v({code:M.SIGNALING_NO_PERMISSION}))}},{key:"getSignalingInfo",value:function(r){var t="".concat(this._n,".getSignalingInfo"),n=r.ID,o=r.from,s=r.to,i=this._filterSignalingMessage(r),a=null,r=(i&&(r=this._remoteSignalingHandler.getPayloadData(r),a=new dl(r)),i?"actionType:".concat(a.actionType):"");return u.l("".concat(t," messageID:").concat(n," from:").concat(o," to:").concat(s," ")+"".concat(r," isSignaling:").concat(i)),a}},{key:"modifyInvitation",value:function(s){var t=this,n=s.inviteID,o=s.data;if(!this.hasInviteInfo(s.inviteID)||this._isHandling)return v({code:M.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var s=this.getInviteInfo(n),i=s.message,a=Z(s,_l),r=i.payload.data;return a.data=o,i.payload.data=JSON.stringify(a),this.get(2).modifyRemoteMessage(i).then(function(c){return t.setInviteInfo(n,l(l({},a),{},{message:i})),t._isHandling=!1,c}).catch(function(c){return t._isHandling=!1,i.payload.data=r,v(c)})}},{key:"_genMessageControlInfo",value:function(){var o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},e=o.data,e=e===void 0?"":e,t=o.onlineUserOnly,i=o.inviteID,i=i===void 0?"":i,n=o.offlinePushInfo,o=o.actionType,s={_onlineOnlyFlag:!1},i={onlineUserOnly:(s=i&&this.getInviteInfo(i)?this.getInviteInfo(i).message:s)._onlineOnlyFlag||t||!1,offlinePushInfo:n,messageControlInfo:{excludedFromContentModeration:!0,excludedFromUnreadCount:!1,excludedFromLastMessage:!1}};return o===Me.ACTION_TYPE_INVITE_TIMEOUT?(s=!!e.match(/excludeTimeoutSignalingFromHistoryMessage/),i.messageControlInfo.excludedFromUnreadCount=s,i.messageControlInfo.excludedFromLastMessage=s,i):(t=!!e.match(/excludeFromHistoryMessage/),n=!!e.match(/excludeOriginalSignalingFromHistoryMessage/),i.messageControlInfo.excludedFromUnreadCount=t||n,i.messageControlInfo.excludedFromLastMessage=t||n,i)}},{key:"sendSignaling",value:function(e,t){var n=this;return this.get(2).sendMessageInstance(e,this._genMessageControlInfo(t)).catch(function(o){return n._isHandling=!1,v(o)})}},{key:"filterMessageList",value:function(e){var t=this;return e.filter(function(n){return t._filterSignalingMessage(n)})}},{key:"_filterSignalingMessage",value:function(e){var t,n,o=!1;return e.type&&e.type===_.MSG_CUSTOM&&(t=e.cloudCustomData,e=(e=e.payload.data)===void 0?"":e,t=(t===void 0?"":t).match(/"type":"tsignaling"/),n=e.match(/inviteID/),e=e.match(/actionType/),o=t||n&&e),!!o}},{key:"startTimer",value:function(e){var t,n,o,s=this,i="".concat(this._n,".startTimer"),a=e.timeout,r=e.inviteID,c=e.inviter,d=e.groupID,p=c===this.getMyUserID();u.l("".concat(i," timeout:").concat(a," isInviter:").concat(p," groupID:").concat(d)),a<=0||(t=p?a+5:a,n=1,o=setInterval(function(){var h=s._hasLocalInviteInfo(e,p);n<t&&h?++n:(h&&s._sendTimeoutNotice(r,p),u.l("".concat(i," end.")),clearInterval(o))},1e3))}},{key:"_hasLocalInviteInfo",value:function(o,t){var n=o.inviteID,o=o.groupID;if(!this.hasInviteInfo(n))return!1;var s="".concat(this._n,"._hasLocalInviteInfo"),i=this.getInviteInfo(n).inviteeList;return u.l("".concat(s," inviteID:").concat(n," inviteeList:").concat(i," groupID:").concat(o)),!o||(t?0<i.length:0<i.length&&i.includes(this.getMyUserID()))}},{key:"_getReceiver",value:function(e,s){var n=s.groupID,o=s.inviteeList,s=s.inviter;return e?n||o[0]:n||s}},{key:"_sendTimeoutNotice",value:function(e,t){var n=this,o=this.getInviteInfo(e),s=this._getReceiver(t,o),i=(u.l("".concat(this._n,"._sendTimeoutNotice inviteID:").concat(e," to:").concat(s," isInviter:").concat(t)),this._localSignalingHandler.createTimeoutCustomData(l(l({},o),{},{isInviter:t}))),a=this._localSignalingHandler.createSignalingMessage(i,s);return this.sendSignaling(a,i).then(function(r){var c,d,p;r&&r.code===0&&(r=i.data,c=i.groupID,d=i.inviteeList,p=i.inviter,n.emitEvent(Me.INVITATION_TIMEOUT,{data:r,groupID:c,inviteID:e,inviteeList:d,inviter:p,isSelfTimeout:!0,message:a}),t?n.deleteInviteInfo(e):n.updateInviteInfo(i))})}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._inviteInfoMap.clear(),this._canIUseSignaling=!1,this._isHandling=!1,this._historySignalingHandler.reset(),this._isC2CUnreadHandleCompleted=!1,this._isConvSyncCompleted=!1,this._isSyncCompleted=!1}}]),mo),hl=["followTypeList"],Ct={NONE:0,FOLLOWERS:1,FOLLOWING:2,MUTUAL:3},fl=(z(fo,Oe),Ur=X(fo),R(fo,[{key:"_onCloudConfigUpdated",value:function(){var e=this.getCloudConfig("follow_req_count");C(e)||(e=Number(e),this.DEFAULT_COUNT=e>this.MAX_COUNT?this.MAX_COUNT:e,this._clearFollowList())}},{key:"clearCacheOnReconnected",value:function(){this._clearFollowList(),this._followType.clear()}},{key:"onFollowInfoNotify",value:function(o){var o=o.dataList||{},t=o.followAddList,t=t===void 0?[]:t,n=o.followDeleteList,n=n===void 0?[]:n,o=o.pushType,s=this._initFollowInfo();o===1?this._handleFollowAddList({followAddList:t,followInfo:s}):this._handleFollowDeleteList({followDeleteList:n,followInfo:s}),this._emitEvent(s),u.l("".concat(this._n,".onFollowInfoNotify pushType:").concat(o," followAddList:").concat(t.length," followDeleteList:").concat(n.length))}},{key:"_initFollowInfo",value:function(){var e={};return Object.values(Ct).forEach(function(t){t!==Ct.NONE&&(e[t]={userInfoList:[],isAdd:!1})}),e}},{key:"_handleFollowAddList",value:function(e){var t=this,n=e.followAddList,o=e.followInfo;n.forEach(function(s){var i=s.followTypeList,i=i===void 0?[]:i,a=Z(s,hl);i.forEach(function(r){o[r].userInfoList.push(a),o[r].isAdd=!0}),t._setFollowType(s.userID,s.followType)})}},{key:"_handleFollowDeleteList",value:function(e){var t=this,n=e.followDeleteList,o=e.followInfo;n.forEach(function(s){var i=s.followTypeList,i=i===void 0?[]:i,a=s.userID;i.forEach(function(r){o[r].userInfoList.push(a),o[r].isAdd=!1}),t._setFollowType(s.userID,s.followType)})}},{key:"_emitEvent",value:function(e){var t=this;Object.keys(e).forEach(function(o){var o=Number(o),s=e[o];0<s.userInfoList.length&&(o===Ct.FOLLOWERS&&(t._clearFollowList(Ct.FOLLOWERS),t.emitOuterEvent(V.MY_FOLLOWERS_LIST_UPDATED,s)),o===Ct.FOLLOWING&&(t._clearFollowList(Ct.FOLLOWING),t.emitOuterEvent(V.MY_FOLLOWING_LIST_UPDATED,s)),o===Ct.MUTUAL&&(t._clearFollowList(Ct.MUTUAL),t.emitOuterEvent(V.MUTUAL_FOLLOWERS_LIST_UPDATED,s)))})}},{key:"followUser",value:function(e){if(!this.canIUse(de.FOLLOW))return this.cannotUseCommercialAbility("followUser");var t="".concat(this._n,".").concat("followUser"),n="userIDList:".concat(e.length),o=new S("followUser");return o.setMessage(n),u.l("".concat(t," ").concat(n)),this.req({proto:g.FOLLOW,data:{fromAccount:this.getMyUserID(),userIDList:e.map(function(s){return{userID:s}})}}).then(function(s){return o.end(),u.l("".concat(t," ok.")),q(s.data.resultList)}).catch(function(s){return o.setError(s).end(),u.e("".concat(t," failed. error:"),s),v(s)})}},{key:"unfollowUser",value:function(e){if(!this.canIUse(de.FOLLOW))return this.cannotUseCommercialAbility("unfollowUser");var t="".concat(this._n,".").concat("unfollowUser"),n="userIDList:".concat(e.length),o=new S("unfollowUser");return o.setMessage(n),u.l("".concat(t," ").concat(n)),this.req({proto:g.UNFOLLOW,data:{fromAccount:this.getMyUserID(),userIDList:e}}).then(function(s){return o.end(),u.l("".concat(t," ok.")),q(s.data.resultList)}).catch(function(s){return o.setError(s).end(),u.e("".concat(t," failed. error:"),s),v(s)})}},{key:"getMyFollowersList",value:function(){var e=this,t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",n="getMyFollowersList";if(!this.canIUse(de.FOLLOW))return this.cannotUseCommercialAbility(n);var o=t||this.FIRST_PAGE_INDEX;if(this._myFollowersList.has(o)){var a=this._myFollowersList.get(o),s=a.resultList,i=a.nextCursor,a=a.lastUpdateTime;if(Date.now()-a<this.MAX_CATCH_TIME&&0<s.length)return u.l("".concat(this._n,".").concat(n," nextCursor:").concat(t," from local.")),Q({resultList:s,nextCursor:i})}return this._getFollowList(t,Ct.FOLLOWERS).then(function(r){return e._myFollowersList.set(o,l(l({},r),{},{lastUpdateTime:Date.now()})),u.l("".concat(e._n,".").concat(n," nextCursor:").concat(t," from remote.")),q(r)})}},{key:"getMyFollowingList",value:function(){var e=this,t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",n="getMyFollowingList";if(!this.canIUse(de.FOLLOW))return this.cannotUseCommercialAbility(n);var o=t||this.FIRST_PAGE_INDEX;if(this._myFollowingList.has(o)){var a=this._myFollowingList.get(o),s=a.resultList,i=a.nextCursor,a=a.lastUpdateTime;if(Date.now()-a<this.MAX_CATCH_TIME&&0<s.length)return u.l("".concat(this._n,".").concat(n," nextCursor:").concat(t," from local.")),Q({resultList:s,nextCursor:i})}return this._getFollowList(t,Ct.FOLLOWING).then(function(r){return e._myFollowingList.set(o,l(l({},r),{},{lastUpdateTime:Date.now()})),u.l("".concat(e._n,".").concat(n," nextCursor:").concat(t," from remote.")),q(r)})}},{key:"getMutualFollowersList",value:function(){var e=this,t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",n="getMutualFollowersList";if(!this.canIUse(de.FOLLOW))return this.cannotUseCommercialAbility(n);var o=t||this.FIRST_PAGE_INDEX;if(this._myMutualFollowersList.has(o)){var a=this._myMutualFollowersList.get(o),s=a.resultList,i=a.nextCursor,a=a.lastUpdateTime;if(Date.now()-a<this.MAX_CATCH_TIME&&0<s.length)return u.l("".concat(this._n,".").concat(n," nextCursor:").concat(t," from local.")),Q({resultList:s,nextCursor:i})}return this._getFollowList(t,Ct.MUTUAL).then(function(r){return e._myMutualFollowersList.set(o,l(l({},r),{},{lastUpdateTime:Date.now()})),u.l("".concat(e._n,".").concat(n," nextCursor:").concat(t," from remote.")),q(r)})}},{key:"_getFollowList",value:function(e,t){var n=this,o=new S("_getFollowList");return o.setMessage("nextCursor:".concat(e," type:").concat(t)),this.req({proto:g.GET_FOLLOW,data:{fromAccount:this.getMyUserID(),count:this.DEFAULT_COUNT,nextCursor:e,type:t}}).then(function(a){o.end();var a=a.data,i=a.resultList,i=i===void 0?[]:i,a=a.nextCursor,a=a===void 0?"":a,r=[];return i.forEach(function(h){var d=h.userID,p=h.followTime,h=h.profileList;r.push(l({userID:d,followTime:p},n._handleProfileItem(h===void 0?[]:h)))}),{resultList:r,nextCursor:a}}).catch(function(s){return o.setError(s).end(),u.e("".concat(n._n,"._getFollowList failed. error:"),s),v(s)})}},{key:"_handleProfileItem",value:function(e){var t={};return e.forEach(function(n){switch(n.tag){case E.NICK:t.nick=n.value;break;case E.GENDER:t.gender=n.value;break;case E.BIRTHDAY:t.birthday=n.value;break;case E.LOCATION:t.location=n.value;break;case E.SELFSIGNATURE:t.selfSignature=n.value;break;case E.ALLOWTYPE:t.allowType=n.value;break;case E.LANGUAGE:t.language=n.value;break;case E.AVATAR:t.avatar=n.value;break;case E.MESSAGESETTINGS:t.messageSettings=n.value;break;case E.ADMINFORBIDTYPE:t.adminForbidType=n.value;break;case E.LEVEL:t.level=n.value;break;case E.ROLE:t.role=n.value;break;default:t[n.tag]=n.value}}),t}},{key:"getUserFollowInfo",value:function(s){if(!this.canIUse(de.FOLLOW))return this.cannotUseCommercialAbility("getUserFollowInfo");var t=s,n=!1,o=(C(s)&&(t=[this.getMyUserID()],n=!0),"".concat(this._n,".").concat("getUserFollowInfo")),s="userIDList:".concat(t.length," isGetMyFollowInfo:").concat(n),i=new S("getUserFollowInfo");return i.setMessage(s),u.l("".concat(o," ").concat(s)),this.req({proto:g.GET_FOLLOW_INFO,data:{fromAccount:this.getMyUserID(),userIDList:t}}).then(function(r){i.end(),u.l("".concat(o," ok."));var r=r.data.followInfoList,c=[];return(r===void 0?[]:r).forEach(function(m){var p=m.followersCount,h=m.followingCount,m=m.mutualFollowersCount;c.push({followersCount:p,followingCount:h,mutualFollowersCount:m})}),q(c)}).catch(function(a){return i.setError(a).end(),u.e("".concat(o," failed. error:"),a),v(a)})}},{key:"checkFollowType",value:function(e){var t=this;if(!this.canIUse(de.FOLLOW))return this.cannotUseCommercialAbility("checkFollowType");100<e.length&&(e=e.slice(0,100),u.w("".concat(n," ").concat(ln(100))));var n="".concat(this._n,".").concat("checkFollowType"),o="userIDList length:".concat(e.length," "),s=new S("checkFollowType"),i=(s.setMessage(o),u.l("".concat(n," ").concat(o)),[]),a=[];return e.forEach(function(r){var c;t._followType.has(r)?(c=t._followType.get(r),i.push({userID:r,followType:c})):a.push(r)}),u.l("".concat(n," from local count:").concat(i.length,", from remote count:").concat(a.length,".")),a.length===0?Q(i):this.req({proto:g.CHECK_FOLLOW_TYPE,data:{fromAccount:this.getMyUserID(),userIDList:a}}).then(function(r){return s.end(),u.l("".concat(n," ok.")),r=r.data.resultList,(r===void 0?[]:r).forEach(function(p){var d=p.userID,p=p.followType;t._setFollowType(d,p),i.push({userID:d,followType:p})}),q(i)}).catch(function(r){return s.setError(r).end(),u.e("".concat(n," failed. error:"),r),v(r)})}},{key:"_setFollowType",value:function(e,t){this._followType.set(e,t)}},{key:"_clearFollowList",value:function(e){if(C(e))return this._myFollowersList.clear(),this._myFollowingList.clear(),void this._myMutualFollowersList.clear();e!==Ct.FOLLOWERS?e!==Ct.FOLLOWING?e!==Ct.MUTUAL||this._myMutualFollowersList.clear():this._myFollowingList.clear():this._myFollowersList.clear()}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._clearFollowList(),this._followType.clear()}}]),fo),ml=(R(ta,[{key:"_startTimer",value:function(){var e=this._moduleMap.get(24),t=e.isWorkerEnabled();u.l("".concat(this._n,".startTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.startWorkerTimer():this._startMainThreadTimer()}},{key:"_startMainThreadTimer",value:function(){this._checkTimer<0&&(this._checkTimer=setInterval(this.onCheckTimer.bind(this),1e3)),u.l("".concat(this._n,"._startMainThreadTimer seed:").concat(this._checkTimer))}},{key:"stopTimer",value:function(){var e=this._moduleMap.get(24),t=e.isWorkerEnabled();u.l("".concat(this._n,".stopTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.stopWorkerTimer():this._stopMainThreadTimer()}},{key:"_stopMainThreadTimer",value:function(){u.l("".concat(this._n,"._stopMainThreadTimer")),0<this._checkTimer&&(clearInterval(this._checkTimer),this._checkTimer=-1,this._checkCount=0)}},{key:"_stopMainThreadSocket",value:function(){u.l("".concat(this._n,"._stopMainThreadSocket"));var e=this._moduleMap.get(21);e.setIsWorkerEnabled(!0),e.reConnect()}},{key:"_startMainThreadSocket",value:function(){u.l("".concat(this._n,"._startMainThreadSocket"));var e=this._moduleMap.get(21);e.setIsWorkerEnabled(!1),e.reConnect()}},{key:"onWorkerTimerEnabled",value:function(){u.l("".concat(this._n,".onWorkerTimerEnabled, disable main thread timer and socket")),this._stopMainThreadTimer(),this._stopMainThreadSocket()}},{key:"onWorkerTimerDisabled",value:function(){u.l("".concat(this._n,".onWorkerTimerDisabled, enable main thread timer and socket")),this._startMainThreadTimer(),this._startMainThreadSocket()}},{key:"onCheckTimer",value:function(){this._checkCount+=1;var e,t=Ee(this._moduleMap);try{for(t.s();!(e=t.n()).done;){var n=$(e.value,2)[1];n.onCheckTimer&&n.onCheckTimer(this._checkCount)}}catch(o){t.e(o)}finally{t.f()}}},{key:"_initReadyList",value:function(){var e=this;this._readyList=[this._moduleMap.get(1)],this._readyList.forEach(function(t){t.ready(function(){return e._onModuleReady()})})}},{key:"_onModuleReady",value:function(){var e,t,n=!0;this._readyList.forEach(function(o){o.isReady()||(n=!1)}),n&&!this._isReady&&(this._isReady=!0,this._outerEmitter.emit(V.SDK_READY),e=Date.now()-this._startLoginTs,u.w("SDK is ready. cost ".concat(e," ms")),this._startLoginTs=Date.now(),t=this._ssoLogForReady.getStartTs()+un,this._ssoLogForReady.setMessage(e).start(t).end())}},{key:"login",value:function(){this._startLoginTs===0&&(Wo(),this._startLoginTs=Date.now(),this._startTimer(),this._moduleMap.get(15).start(),this._ssoLogForReady=new S("sdkReady"),this._reason=M.LOGGING_IN)}},{key:"onLoginFailed",value:function(){this._startLoginTs=0}},{key:"getOuterEmitterInstance",value:function(){return this._outerEmitter===null&&(this._outerEmitter=new xi,e=this._outerEmitter,pn=e,this._outerEmitter._emit=this._outerEmitter.emit,this._outerEmitter.emit=function(t,n){var o,s,i=this;this._canIUseSignaling()&&(t===V.MESSAGE_RECEIVED&&this.get(33).onNewMessageList(n),t===V.MESSAGE_MODIFIED&&this.get(33).onMessageModified(n)),t===V.CONVERSATION_LIST_UPDATED||t===V.FRIEND_LIST_UPDATED||t===V.GROUP_LIST_UPDATED||t===V.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?this._eventThrottling!==!1?this._eventThrottleMap.has(t)?(o=Date.now())-(s=this._eventThrottleMap.get(t)).last<=1e3?(s.timeoutID&&clearTimeout(s.timeoutID),s.timeoutID=setTimeout(function(){s.last=Date.now(),i._outerEmitter._emit.apply(i._outerEmitter,[t,{name:t,data:i._getEventData(t)}])},1e3)):(s.last=o,this._outerEmitter._emit.apply(this._outerEmitter,[t,{name:t,data:this._getEventData(t)}])):(this._eventThrottleMap.set(t,{last:Date.now(),timeoutID:-1}),this._outerEmitter._emit.apply(this._outerEmitter,[t,{name:t,data:this._getEventData(t)}])):this._outerEmitter._emit.apply(this._outerEmitter,[t,{name:t,data:this._getEventData(t)}]):this._outerEmitter._emit.apply(this._outerEmitter,[t,{name:t,data:n}])}.bind(this)),this._outerEmitter;var e}},{key:"_canIUseSignaling",value:function(){var e=this.get(33);return!!e&&e.canIUseSignaling()}},{key:"_getEventData",value:function(e){return e===V.CONVERSATION_LIST_UPDATED?this._moduleMap.get(12).isPartialUpdatedConvs()?this._moduleMap.get(11).getPartialUpdatedConvs():this._moduleMap.get(11).getLocalConversationList():e===V.FRIEND_LIST_UPDATED?this._moduleMap.get(8).getLocalFriendList(!1):e===V.GROUP_LIST_UPDATED?this._moduleMap.get(7).getLocalGroupList():e===V.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?this._moduleMap.get(11).getTotalUnreadMessageCount():e===V.CONVERSATION_ID_LIST_UPDATED?this._moduleMap.get(11).getUpdatedConvIDList():void 0}},{key:"getInnerEmitterInstance",value:function(){return this._innerEmitter===null&&(this._innerEmitter=new xi,this._innerEmitter._emit=this._innerEmitter.emit,this._innerEmitter.emit=function(e,t){e=Ce(t)&&t.data?[e,{name:e,data:t.data}]:[e,{name:e,data:t}],this._innerEmitter._emit.apply(this._innerEmitter,e)}.bind(this)),this._innerEmitter}},{key:"hasModule",value:function(e){return this._moduleMap.has(e)}},{key:"get",value:function(e){return this._moduleMap.get(e)}},{key:"canIUseModule",value:function(e){return!this._moduleMap.get(12).isUsingChatCore()||this._optionalModuleMap.has(e)}},{key:"canIUseInflate",value:function(){return!!this._moduleMap.get(37)}},{key:"isReady",value:function(){return this._isReady}},{key:"isIntl",value:function(){return this.get(12).isIntl()}},{key:"getNotReadyReason",value:function(){return this._reason}},{key:"setNotReadyReason",value:function(e){this._reason=e}},{key:"getErrorMessage",value:function(e,t,n){return this._moduleMap.get(32).get({key:e,replacement1:t,replacement2:n,isIntl:this.isIntl()})}},{key:"outputWarning",value:function(e,t,n){e=this.getErrorMessage(e,t,n),e&&u.w(e)}},{key:"onError",value:function(e){var t="code:".concat(e.code," message:").concat(e.message);u.w("Oops! ".concat(t)),new S("error").setMessage(t).setLevel("error").end(),this.getOuterEmitterInstance().emit(V.ERROR,e)}},{key:"restartTimer",value:function(){u.l("".concat(this._n,".restartTimer")),this.stopTimer(),this._startTimer();var e=this.get(7);e&&e.restartPolling()}},{key:"getTimerID",value:function(){var e=this._moduleMap.get(24);return e.isWorkerEnabled()?e.getTimerID():this._checkTimer}},{key:"getPollingTimerID",value:function(e){return this._moduleMap.get(7).getPollingTimerID(e)}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),Wo();var e,t=Ee(this._moduleMap);try{for(t.s();!(e=t.n()).done;){var n=$(e.value,2)[1];n.reset&&n.reset()}}catch(a){t.e(a)}finally{t.f()}this._startLoginTs=0,this._initReadyList(),this._isReady=!1,this.stopTimer(),this._outerEmitter.emit(V.SDK_NOT_READY);var o,s=Ee(this._eventThrottleMap);try{for(s.s();!(o=s.n()).done;){var i=$(o.value,2)[1];i.timeoutID&&clearTimeout(i.timeoutID)}}catch(a){s.e(a)}finally{s.f()}this._eventThrottleMap.clear()}}]),ta),vl=(R(ea,[{key:"defense",value:function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:void 0;if(typeof e!="string"||e.length===0||typeof t!="function")return null;if(this._funcMap.has(e)&&this._funcMap.get(e).has(t))return this._funcMap.get(e).get(t);this._funcMap.has(e)||this._funcMap.set(e,new Map);var o=null;return this._funcMap.get(e).has(t)?o=this._funcMap.get(e).get(t):(o=this._pack(e,t,n),this._funcMap.get(e).set(t,o)),o}},{key:"defenseOnce",value:function(e,t){return typeof t!="function"?null:this._pack(e,t,2<arguments.length&&arguments[2]!==void 0?arguments[2]:void 0)}},{key:"find",value:function(e,t){return typeof e!="string"||e.length===0||typeof t!="function"?null:this._funcMap.has(e)&&this._funcMap.get(e).has(t)?this._funcMap.get(e).get(t):(this._m.outputWarning("ListenerFnNotFound",e),null)}},{key:"delete",value:function(e,t){return typeof t=="function"&&!!this._funcMap.has(e)&&!!this._funcMap.get(e).has(t)&&(this._funcMap.get(e).delete(t),this._funcMap.get(e).size===0&&this._funcMap.delete(e),!0)}},{key:"_pack",value:function(e,t,n){var o=this;return function(){try{t.apply(n,Array.from(arguments))}catch(a){var s=Object.values(V).indexOf(e),i="CallbackError";s!==-1&&(s=Object.keys(V)[s],o._m.outputWarning(i,s,a)),o._reportCount<5&&(new S(i).setMessage("eventName:".concat(e)).setMoreMessage(a.message).end(),o._reportCount+=1)}}}},{key:"destroy",value:function(){this._funcMap.clear()}},{key:"reset",value:function(){u.l("".concat(this._n,".reset")),this._reportCount=0}}]),ea),Il=(R(Zi,[{key:"onError",value:function(e){this._m.onError(e)}},{key:"login",value:function(e){return this._m.login(),this._get(1).login(e)}},{key:"logout",value:function(){var e=this;return this._get(1).logout().then(function(t){return e._safetyCallbackFactory.reset(),e._m.reset(),t})}},{key:"getLoginUser",value:function(){return this._get(1).getLoginUser()}},{key:"isReady",value:function(){return this._m.isReady()}},{key:"isIntl",value:function(){return this._m.isIntl()}},{key:"getNotReadyReason",value:function(){return this._m.getNotReadyReason()}},{key:"getErrorMessage",value:function(e,t,n){return this._m.getErrorMessage(e,t,n)}},{key:"_get",value:function(e){return this._m.get(e)}},{key:"destroy",value:function(){var e=this;return this.logout().finally(function(){e._safetyCallbackFactory.destroy(),e._m.stopTimer(),e._get(24).terminate(),e._get(21).dealloc();var t=e._m.getOuterEmitterInstance(),n=e._get(12);t.emit(V.SDK_DESTROY,{SDKAppID:n.getSDKAppID()})})}},{key:"on",value:function(e,t,n){u.d("on","eventName:".concat(e)),this._m.getOuterEmitterInstance().on(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"once",value:function(e,t,n){u.d("once","eventName:".concat(e)),this._m.getOuterEmitterInstance().once(e,this._safetyCallbackFactory.defenseOnce(e,t,n),n||this)}},{key:"off",value:function(e,t,n,o){u.d("off","eventName:".concat(e));var s=this._safetyCallbackFactory.find(e,t);s!==null&&(this._m.getOuterEmitterInstance().off(e,s,n,o),this._safetyCallbackFactory.delete(e,t))}},{key:"registerPlugin",value:function(e){(C(e["tim-push"])?C(e["tim-offline-push-plugin"])?this._get(18):this._get(28):this._get(36)).registerPlugin(e)}},{key:"setLogLevel",value:function(e){var t;e<=0&&(t=this.getErrorMessage("TIM_ASCII_ART"),(t=this.getErrorMessage("API_REFER"))&&(Ps()&&"%c ".concat("IM SDK API ->"," %c")),t=this.getErrorMessage("DOCS_GUIDE"),t=this.getErrorMessage("IOS_WEBVIEW_WARNING"),cn&&t&&console.warn(t)),u.setLevel(e)}},{key:"createTextMessage",value:function(e){return this._get(2).createTextMessage(e)}},{key:"createTextAtMessage",value:function(e){return this._get(2).createTextMessage(e)}},{key:"createImageMessage",value:function(e){return this._get(2).createImageMessage(e)}},{key:"createAudioMessage",value:function(e){return this._get(2).createAudioMessage(e)}},{key:"createVideoMessage",value:function(e){return this._get(2).createVideoMessage(e)}},{key:"createCustomMessage",value:function(e){return this._get(2).createCustomMessage(e)}},{key:"createFaceMessage",value:function(e){return this._get(2).createFaceMessage(e)}},{key:"createFileMessage",value:function(e){return this._get(2).createFileMessage(e)}},{key:"createLocationMessage",value:function(e){return this._get(2).createLocationMessage(e)}},{key:"createMergerMessage",value:function(e){return this._get(2).createMergerMessage(e)}},{key:"downloadMergerMessage",value:function(e){return e.type!==_.MSG_MERGER?v({code:M.MSG_MERGER_TYPE_INVALID}):G(e.payload.downloadKey)?v({code:M.MSG_MERGER_KEY_INVALID}):this._get(2).downloadMergerMessage(e).catch(function(t){return v({code:M.MSG_MERGER_DOWNLOAD_FAIL})})}},{key:"createForwardMessage",value:function(e){return this._get(2).createForwardMessage(e)}},{key:"sendMessage",value:function(e,t){return e instanceof We?this._get(2).sendMessageInstance(e,t):v({code:M.MSG_INSTANCE_REQUIRED})}},{key:"searchCloudMessages",value:function(e){return this._get(2).searchCloudMessages(e)}},{key:"callExperimentalAPI",value:function(e,t){return e==="sendComboMessage"?this._get(31).sendMessage(t):e==="handleGroupInvitation"?this._get(7).handleGroupInvitation(t):e==="isCommercialAbilityEnabled"?this._get(27).isFeatureEnabled(t):e==="isFeatureEnabledForStat"?this._get(27).isFeatureEnabledForStat(t):e==="isIntl"?this.isIntl():e==="sendTRTCCustomData"||e==="sendRoomCustomData"?this._get(30).sendTRTCCustomData(t):e==="getTimerID"?this._m.getTimerID():e==="getPollingTimerID"?this._m.getPollingTimerID(t):e==="setApplicationID"?(this._get(12).setApplicationID(t),void this._get(20).updateProtocolConfig()):e==="getServerConfig"?this._get(23).getServerConfig(t):e==="canIUseModule"?this._m.canIUseModule(t):e==="startMessageLongPolling"?this._get(7).startMessageLongPolling(t):e==="stopMessageLongPolling"?this._get(7).stopMessageLongPolling(t):v({code:M.INVALID_OPERATION})}},{key:"revokeMessage",value:function(e){return this._get(2).revokeMessage(e)}},{key:"resendMessage",value:function(e,t){return e instanceof We?this._get(2).resendMessage(e,t):v({code:M.MSG_INSTANCE_REQUIRED})}},{key:"deleteMessage",value:function(e){return this._get(2).deleteMessage(e)}},{key:"translateText",value:function(e){return this._get(2).translateText(e)}},{key:"convertVoiceToText",value:function(e){return this._get(2).convertVoiceToText(e)}},{key:"setMessageExtensions",value:function(e,t){return this._get(3).setMessageExtensions(e,t)}},{key:"getMessageExtensions",value:function(e){return this._get(3).getMessageExtensions(e)}},{key:"deleteMessageExtensions",value:function(e,t){return this._get(3).deleteMessageExtensions(e,t)}},{key:"addMessageReaction",value:function(e,t){return this._get(34).addMessageReaction(e,t)}},{key:"removeMessageReaction",value:function(e,t){return this._get(34).removeMessageReaction(e,t)}},{key:"getMessageReactions",value:function(e){return this._get(34).getMessageReactions(e)}},{key:"getAllUserListOfMessageReaction",value:function(e){return this._get(34).getAllUserListOfMessageReaction(e)}},{key:"modifyMessage",value:function(e){return this._get(2).modifyRemoteMessage(e)}},{key:"getMessageList",value:function(e){return this._get(11).getMessageList(e)}},{key:"getMessageListHopping",value:function(e){return this._get(11).getMessageListHopping(e)}},{key:"sendMessageReadReceipt",value:function(e){return this._get(11).sendReadReceipt(e)}},{key:"getMessageReadReceiptList",value:function(e){return this._get(11).getReadReceiptList(e)}},{key:"getGroupMessageReadMemberList",value:function(e){var t=this._get(7);return t?t.getReadReceiptDetail(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"findMessage",value:function(e){return this._get(11).findMessage(e)}},{key:"setMessageRead",value:function(e){return this._get(11).setMessageRead(e)}},{key:"getConversationList",value:function(e){return this._get(11).getConversationList(e)}},{key:"getConversationProfile",value:function(e){return this._get(11).getConversationProfile(e)}},{key:"deleteConversation",value:function(e){return this._get(11).deleteConversation(e)}},{key:"setConversationDraft",value:function(e){return this._get(11).setConversationDraft(e)}},{key:"clearHistoryMessage",value:function(e){return this._get(11).clearHistoryMessage(e)}},{key:"pinConversation",value:function(e){return this._get(11).pinConversation(e)}},{key:"setAllMessageRead",value:function(e){return this._get(11).setAllMessageRead(e)}},{key:"setMessageRemindType",value:function(e){return this._get(11).setMessageRemindType(e)}},{key:"setAllReceiveMessageOpt",value:function(e){return this._get(11).setAllReceiveMessageOpt(e)}},{key:"getAllReceiveMessageOpt",value:function(){return this._get(11).getAllReceiveMessageOpt()}},{key:"getTotalUnreadMessageCount",value:function(){return this._get(11).getTotalUnreadMessageCount()}},{key:"setConversationCustomData",value:function(e){return this._get(11).setConversationCustomData(e)}},{key:"markConversation",value:function(e){return this._get(11).markConversation(e)}},{key:"getConversationGroupList",value:function(){return this._get(11).getConversationGroupList()}},{key:"createConversationGroup",value:function(e){return this._get(11).createConversationGroup(e)}},{key:"deleteConversationGroup",value:function(e){return this._get(11).deleteConversationGroup(e)}},{key:"renameConversationGroup",value:function(e){return this._get(11).renameConversationGroup(e)}},{key:"addConversationsToGroup",value:function(e){return this._get(11).addConversationsToGroup(e)}},{key:"deleteConversationsFromGroup",value:function(e){return this._get(11).deleteConversationsFromGroup(e)}},{key:"getMyProfile",value:function(){return this._get(4).getMyProfile()}},{key:"getUserProfile",value:function(e){return this._get(4).getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._get(4).updateMyProfile(e)}},{key:"getBlacklist",value:function(){return this._get(4).getLocalBlacklist()}},{key:"addToBlacklist",value:function(e){return this._get(4).addBlacklist(e)}},{key:"removeFromBlacklist",value:function(e){return this._get(4).deleteBlacklist(e)}},{key:"setSelfStatus",value:function(e){return this._get(4).setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._get(4).getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._get(4).subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._get(4).unsubscribeUserStatus(e)}},{key:"getFriendList",value:function(){var e=this._get(8);return e?e.getLocalFriendList():v({code:M.CANNOT_FIND_MODULE})}},{key:"addFriend",value:function(e){var t=this._get(8);return t?t.addFriend(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"deleteFriend",value:function(e){var t=this._get(8);return t?t.deleteFriend(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"checkFriend",value:function(e){var t=this._get(8);return t?t.checkFriend(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getFriendProfile",value:function(e){var t=this._get(8);return t?t.getFriendProfile(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"updateFriend",value:function(e){var t=this._get(8);return t?t.updateFriend(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getFriendApplicationList",value:function(){var e=this._get(8);return e?e.getLocalFriendApplicationList():v({code:M.CANNOT_FIND_MODULE})}},{key:"acceptFriendApplication",value:function(e){var t=this._get(8);return t?t.acceptFriendApplication(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"refuseFriendApplication",value:function(e){var t=this._get(8);return t?t.refuseFriendApplication(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"deleteFriendApplication",value:function(e){var t=this._get(8);return t?t.deleteFriendApplication(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"setFriendApplicationRead",value:function(){var e=this._get(8);return e?e.setFriendApplicationRead():v({code:M.CANNOT_FIND_MODULE})}},{key:"getFriendGroupList",value:function(){var e=this._get(8);return e?e.getLocalFriendGroupList():v({code:M.CANNOT_FIND_MODULE})}},{key:"createFriendGroup",value:function(e){var t=this._get(8);return t?t.createFriendGroup(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"deleteFriendGroup",value:function(e){var t=this._get(8);return t?t.deleteFriendGroup(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"addToFriendGroup",value:function(e){var t=this._get(8);return t?t.addToFriendGroup(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"removeFromFriendGroup",value:function(e){var t=this._get(8);return t?t.removeFromFriendGroup(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"renameFriendGroup",value:function(e){var t=this._get(8);return t?t.renameFriendGroup(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"followUser",value:function(e){var t=this._get(35);return t?t.followUser(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"unfollowUser",value:function(e){var t=this._get(35);return t?t.unfollowUser(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getMyFollowersList",value:function(e){var t=this._get(35);return t?t.getMyFollowersList(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getMyFollowingList",value:function(e){var t=this._get(35);return t?t.getMyFollowingList(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getMutualFollowersList",value:function(e){var t=this._get(35);return t?t.getMutualFollowersList(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getUserFollowInfo",value:function(e){var t=this._get(35);return t?t.getUserFollowInfo(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"checkFollowType",value:function(e){var t=this._get(35);return t?t.checkFollowType(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getGroupList",value:function(){var e=this._get(7);return e?e.getGroupList():v({code:M.CANNOT_FIND_MODULE})}},{key:"getGroupProfile",value:function(e){var t=this._get(7);return t?t.getGroupProfile(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"createGroup",value:function(e){var t=this._get(7);return t?t.createGroup(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"dismissGroup",value:function(e){var t=this._get(7);return t?t.dismissGroup(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"updateGroupProfile",value:function(e){var t=this._get(7);return t?t.updateGroupProfile(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"joinGroup",value:function(e){var t=this._get(7);return t?t.joinGroup(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"quitGroup",value:function(e){var t=this._get(7);return t?t.quitGroup(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"searchGroupByID",value:function(e){var t=this._get(7);return t?t.searchGroupByID(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this._get(7);return t?t.getGroupOnlineMemberCount(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"changeGroupOwner",value:function(e){var t=this._get(7);return t?t.changeGroupOwner(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getGroupApplicationList",value:function(){var e=this._get(7);return e?e.getGroupApplicationList():v({code:M.CANNOT_FIND_MODULE})}},{key:"handleGroupApplication",value:function(e){var t=this._get(7);return t?t.handleGroupApplication(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"initGroupAttributes",value:function(e){var t=this._get(7);return t?t.initGroupAttributes(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"setGroupAttributes",value:function(e){var t=this._get(7);return t?t.setGroupAttributes(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"deleteGroupAttributes",value:function(e){var t=this._get(7);return t?t.deleteGroupAttributes(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getGroupAttributes",value:function(e){var t=this._get(7);return t?t.getGroupAttributes(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"setGroupCounters",value:function(e){var t=this._get(7);return t?t.setGroupCounters(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"increaseGroupCounter",value:function(e){var t=this._get(7);return t?t.increaseGroupCounter(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"decreaseGroupCounter",value:function(e){var t=this._get(7);return t?t.decreaseGroupCounter(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getGroupCounters",value:function(e){var t=this._get(7);return t?t.getGroupCounters(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getGroupMemberList",value:function(e){var t=this._get(7);return t?t.getGroupMemberList(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getGroupMemberProfile",value:function(e){var t=this._get(7);return t?t.getGroupMemberProfile(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"addGroupMember",value:function(e){var t=this._get(7);return t?t.addGroupMember(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"deleteGroupMember",value:function(e){var t=this._get(7);return t?t.deleteGroupMember(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"setGroupMemberMuteTime",value:function(e){var t=this._get(7);return t?t.setGroupMemberMuteTime(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"setGroupMemberRole",value:function(e){var t=this._get(7);return t?t.setGroupMemberRole(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"setGroupMemberNameCard",value:function(e){var t=this._get(7);return t?t.setGroupMemberNameCard(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"setGroupMemberCustomField",value:function(e){var t=this._get(7);return t?t.setGroupMemberCustomField(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"markGroupMemberList",value:function(e){var t=this._get(7);return t?t.markGroupMemberList(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getJoinedCommunityList",value:function(){return this._get(10).getJoinedCommunityList()}},{key:"createTopicInCommunity",value:function(e){return this._get(10).createTopicInCommunity(e)}},{key:"deleteTopicFromCommunity",value:function(e){return this._get(10).deleteTopicFromCommunity(e)}},{key:"updateTopicProfile",value:function(e){return this._get(10).updateTopicProfile(e)}},{key:"getTopicList",value:function(e){return this._get(10).getTopicList(e)}},{key:"addSignalingListener",value:function(e,t,n){var o=this._get(33);o&&o.addSignalingListener(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"removeSignalingListener",value:function(e,t,n){var o,s=this._safetyCallbackFactory.find(e,t);s===null||(o=this._get(33))&&(o.removeSignalingListener(e,s,n),this._safetyCallbackFactory.delete(e,t))}},{key:"invite",value:function(e){var t=this._get(33);return t?t.invite(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"inviteSync",value:function(e,t,n){var o=this._get(33);return o?o.inviteSync(e,t,n):""}},{key:"inviteInGroup",value:function(e){var t=this._get(33);return t?t.invite(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"inviteInGroupSync",value:function(e,t,n){var o=this._get(33);return o?o.inviteSync(e,t,n):""}},{key:"cancel",value:function(e){var t=this._get(33);return t?t.cancel(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"accept",value:function(e){var t=this._get(33);return t?t.accept(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"reject",value:function(e){var t=this._get(33);return t?t.reject(e):v({code:M.CANNOT_FIND_MODULE})}},{key:"getSignalingInfo",value:function(e){var t=this._get(33);return t?t.getSignalingInfo(e):null}},{key:"modifyInvitation",value:function(e){var t=this._get(33);return t?t.modifyInvitation(e):v({code:M.CANNOT_FIND_MODULE})}}]),Zi),Ml={login:1,logout:1,getLoginUser:1,destroy:1,on:1,off:1,ready:1,setLogLevel:1,joinGroup:1,quitGroup:1,registerPlugin:1,getGroupOnlineMemberCount:1,isReady:1,addSignalingListener:1,removeSignalingListener:1,callExperimentalAPI:1};function Zi(e){D(this,Zi),e={SDKAppID:e.SDKAppID,unlimitedAVChatRoom:e.unlimitedAVChatRoom||!1,scene:e.scene||"",oversea:e.oversea||!1,instanceID:Va(),devMode:e.devMode||!1,testEnv:e.testEnv||!1,proxyServer:e.proxyServer||void 0,fileUploadProxy:e.fileUploadProxy||void 0,fileDownloadProxy:e.fileDownloadProxy||e.fileUploadProxy||void 0,eventThrottling:e.eventThrottling!==!1,partialUpdatedConversations:e.partialUpdatedConversations===!0,modules:e.modules||void 0},this._m=new ml(e),this._vendorMap=new Map,this._safetyCallbackFactory=new vl(this._m)}function ea(e){D(this,ea),this._funcMap=new Map,this._m=e,this._n="SafetyCallback",this._reportCount=0}function ta(e){var t=this;D(this,ta);var n,o=new S("sdkConstruct"),r=(this._n="ModuleManager",this._isReady=!1,this._reason=M.USER_NOT_LOGGED_IN,this._startLoginTs=0,this._moduleMap=new Map,this._optionalModuleMap=new Map,this._innerEmitter=null,this._outerEmitter=null,this._checkCount=0,this._checkTimer=-1,this._moduleMap.set(12,new iu(this,e)),this._moduleMap.set(15,new du(this)),this._moduleMap.set(27,new nl(this)),this._moduleMap.set(23,new Hu(this)),this._moduleMap.set(24,new el(this)),this._moduleMap.set(26,new zu(this)),this._moduleMap.set(21,new Gu(this)),this._moduleMap.set(20,new Bu(this)),this._moduleMap.set(1,new ru(this)),this._moduleMap.set(2,new Mu(this)),this._moduleMap.set(3,new yu(this)),this._moduleMap.set(34,new Au(this)),this._moduleMap.set(31,new Cu(this)),this._moduleMap.set(4,new su(this)),this._moduleMap.set(6,new Oc(this)),this._moduleMap.set(11,new xc(this)),this._moduleMap.set(7,new $c(this)),this._moduleMap.set(10,new eu(this)),this._moduleMap.set(13,new cu(this)),this._moduleMap.set(32,new rl(this)),this._moduleMap.set(14,new lu(this)),this._moduleMap.set(17,new _u(this)),this._moduleMap.set(18,new Tu(this)),this._moduleMap.set(19,new Du(this)),this._moduleMap.set(25,new Ku(this)),this._moduleMap.set(8,new Zu(this)),this._moduleMap.set(28,new ol(this)),this._moduleMap.set(36,new sl(this)),this._moduleMap.set(29,new il(this)),this._moduleMap.set(30,new al(this)),this._moduleMap.set(33,new gl(this)),this._moduleMap.set(35,new fl(this)),this._eventThrottleMap=new Map,this._eventThrottling=e.eventThrottling,Ce(e.modules)?(Object.keys(e.modules).forEach(function(c){n=e.modules[c],c==="group-module"?t._moduleMap.set(7,new n(t)):c==="relationship-module"?t._moduleMap.set(8,new n(t)):c==="signaling-module"?t._moduleMap.set(33,new n(t)):c==="follow-module"&&t._moduleMap.set(35,new n(t)),t._optionalModuleMap.set(c,1)}),this._moduleMap.get(12).setUsingChatCore(!0)):this._moduleMap.has(7)||this._moduleMap.get(12).setUsingChatCore(!0),e.instanceID),s=e.SDKAppID,i=this._moduleMap.get(12).isIntl(),a=this._moduleMap.get(12).isUsingChatCore(),r="instanceID:".concat(r," SDKAppID:").concat(s," isIntl:").concat(i," isUsingChatCore:").concat(a," host:").concat(Ba()," isIOSWebView:").concat(cn)+" inBrowser:".concat(qe," inMiniApp:").concat(ge)+" canIUseInflate:".concat(this.canIUseInflate())+" workerAvailable:".concat(Gt," UserAgent:").concat(xe);S.bindEventStatModule(this._moduleMap.get(14)),S.bindNetMonitorModule(this._moduleMap.get(15)),o.setMessage("".concat(r," ").concat(function(){var c="";if(ge)try{var d=ce.getSystemInfoSync(),p=d.model,h=d.version,m=d.system,f=d.platform,I=d.SDKVersion,c="model:".concat(p," version:").concat(h," system:").concat(m," platform:").concat(f," SDKVersion:").concat(I)}catch{c=""}return c}())).end(),u.i("SDK ".concat(r)),Te.prototype._getErrorMessage=this.getErrorMessage.bind(this),this._readyList=void 0,this._ssoLogForReady=null,this._initReadyList()}function fo(e){return D(this,fo),(e=Ur.call(this,e))._n="FollowModule",e._myFollowersList=new Map,e._myFollowingList=new Map,e._myMutualFollowersList=new Map,e._followType=new Map,e.MAX_CATCH_TIME=6e5,e.FIRST_PAGE_INDEX=wa(),e.DEFAULT_COUNT=500,e.MAX_COUNT=1e3,e.getInnerEmitterInstance().on(Re.CLOUD_CONFIG_UPDATED,e._onCloudConfigUpdated,K(e)),e}function mo(e){return D(this,mo),(e=br.call(this,e))._n="SignalingModule",e._inviteInfoMap=new Map,e._outerEmitter=new xi,e._outerEmitter._emit=e._outerEmitter.emit,e._outerEmitter.emit=function(){this._outerEmitter._emit.apply(this._outerEmitter,[].concat([arguments.length<=0?void 0:arguments[0],{name:arguments.length<=0?void 0:arguments[0],data:arguments.length<=1?void 0:arguments[1]}]))}.bind(K(e)),e._canIUseSignaling=!1,e._isHandling=!1,e._remoteSignalingHandler=new cl(K(e)),e._localSignalingHandler=new ul(K(e)),e._historySignalingHandler=new ll(K(e)),e._isC2CUnreadHandleCompleted=!1,e._isConvSyncCompleted=!1,e._isSyncCompleted=!1,e.getInnerEmitterInstance().on(Re.C2C_UNREAD_HANDLE_COMPLETED,e.onC2CUnreadHandleCompleted,K(e)),e.getInnerEmitterInstance().on(Re.CONV_SYNC_COMPLETED,e.onConvSyncCompleted,K(e)),e}function na(e){D(this,na),this._n="HistorySignalingHandler",this._sigM=e,this.COUNT=20,this._signalingMap=new Map,this._signalingRelatedToMeMap=new Map}function oa(e){D(this,oa),this._n="LocalSignalingHandler",this._sigM=e}function sa(e){D(this,sa),this._n="RemoteSignalingHandler",this._sigM=e}function ia(e){D(this,ia),this._m=e,this._n="ErrorMessageModule",this.TIM_ERROR_ASSISTANCE="tim_error_assistance",this.STORAGE_EXPIRES_TIME=6048e5,this._map=new Map,this._init()}function aa(e){D(this,aa),this._m=e,this._n="TransCmdModule",this._TRTCCommandList=["tui_room_svr.*","callkit_records_svr.*","room_engine_srv.*","room_engine_http_srv.*","room_engine_mic.*","live_engine_srv.*","live_engine_http_srv.*"],this._TRTCCommandMap=new Map,this._setTRTCCommandMap(),this._m.getInnerEmitterInstance().on(Re.CLOUD_CONFIG_UPDATED,this._onCloudConfigUpdated,this)}function vo(e){return D(this,vo),(e=wr.call(this,e))._n="ProfanityFilterModule",e._plugin=null,e._filterConfigMap=new Map,e._startIndex=0,e._version=0,e._canIUseLexicon=!1,e._isFetching=!1,e._expiredTime=0,e}function Io(e){var t;return D(this,Io),(t=Fr.call(this,e))._m=e,t._n="TIMPushModule",t._pluginName="TIMPush",t._pushPlugin=void 0,t._androidPushConfig={},t._deviceToken="",t._businessID=0,t._iOSBusinessID=0,t._c2cUnreadCount=0,t._groupUnreadCount=0,t._isWebUniapp=0,t._deviceInfo={notificationStatus:0,deviceModel:"",systemVersion:"",pushVersion:"1.0.1",packageName:""},t}function Mo(e){var t;return D(this,Mo),(t=qr.call(this,e))._m=e,t._n="OfflinePushModule",t._offlinePushPlugin=void 0,t._androidPushConfig={huaweiPushBussinessId:"",xiaomiPushBussinessId:"",xiaomiPushAppId:"",xiaomiPushAppKey:"",meizuPushBussinessId:"",meizuPushAppId:"",meizuPushAppKey:"",vivoPushBussinessId:"",fcmPushBussinessId:"",oppoPushBussinessId:"",oppoPushAppKey:"",oppoPushAppSecret:"",honorPushBussinessId:""},t._deviceToken="",t._businessID=0,t._iosBusinessID=0,t._c2cUnreadCount=0,t._groupUnreadCount=0,t._isWebUniapp=0,t}function ra(e){D(this,ra),this._m=e,this._n="CommercialConfigModule",this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler=new tl(this)}function ca(e){D(this,ca),this._commercialConfigM=e,this._n="PurchasedFeatureHandler",this._isSCMReported=!1,this._featureMap=new Map}function yo(e){return D(this,yo),(e=xr.call(this,e))._n="WorkerTimerModule",e._isWorkerEnabled=!0,e._workerTimer=null,e._timerID=-1,e._init(),e.getInnerEmitterInstance().on(Re.CLOUD_CONFIG_UPDATED,e._onCloudConfigUpdated,K(e)),e}function Ao(e){return D(this,Ao),(e=Vr.call(this,e))._n="SnsModule",e._friendHandler=new $u(K(e)),e._friendApplicationHandler=new Xu(K(e)),e._friendGroupHandler=new Qu(K(e)),e.getInnerEmitterInstance().on(Re.A2KEY_AND_TINYID_UPDATED,e.onContextUpdated,K(e)),e}function ua(e){D(this,ua),this._snsM=e,this._n="FriendGroupHandler",this._friendGroupMap=new Map}function la(e){D(this,la),G(e)||(this.name=e.name||"",this.userIDList=e.userIDList||[],this.count=this.userIDList.length||0)}function da(e){D(this,da),this._snsM=e,this._n="FriendHandler",this._friendMap=new Map,this._startIndex=0,this._standardSequence=0,this._customSequence=0,this._expirationTime=18e4}function pa(e,t){D(this,pa),this.userID=e,this.remark="",this.groupList=[],this.source="",this.addTime=0,this.friendCustomField=[],this.timestamp=0;var n={},o=[];if(n.userID=e,!G(t))for(var s,i="",a=0,r=t.length;a<r;a++)if(i=t[a].tag,s=t[a].value,-1<i.indexOf("Tag_SNS_Custom"))this.friendCustomField.push({key:i,value:s});else if(-1<i.indexOf("Tag_Profile_Custom"))o.push({key:i,value:s});else switch(i){case E.NICK:n.nick=s;break;case E.GENDER:n.gender=s;break;case E.BIRTHDAY:n.birthday=s;break;case E.LOCATION:n.location=s;break;case E.SELFSIGNATURE:n.selfSignature=s;break;case E.ALLOWTYPE:n.allowType=s;break;case E.LANGUAGE:n.language=s;break;case E.AVATAR:n.avatar=s;break;case E.MESSAGESETTINGS:n.messageSettings=s;break;case E.ADMINFORBIDTYPE:n.adminForbidType=s;break;case E.LEVEL:n.level=s;break;case E.ROLE:n.role=s;break;case W.REMARK:this.remark=s;break;case W.ADDTIME:this.addTime=s;break;case W.GROUP:this.groupList=JSON.parse(JSON.stringify(s));break;case W.ADDSOURCE:this.source=s;break;case W.ADDWORDING:break;default:u.l("snsProfileItem unknown tag->",t[a].tag)}this.profile=new Qn(l(l({},n),{},{profileCustomField:o}))}function _a(e){D(this,_a),this._snsM=e,this._n="FriendApplicationHandler",this._startTime=0,this._maxLimited=100,this._currentSequence=0,this._friendApplicationMap=new Map,this._unreadCount=0}function Co(e){D(this,Co),(e=Br.call(this,e))._n="QualityStatModule",e.TAG="im-ssolog-quality-stat",e.reportIndex=0,e.wholePeriod=!1,e._qualityItems=[Vs,Bs,Sn,Ln,En,_n,vt,kn,Jn,zn],e._messageSentItems=[Sn,Ln,En,_n,vt],e._messageReceivedItems=[kn,Jn,zn],e.REPORT_INTERVAL=120,e.REPORT_SDKAPPID_BLACKLIST=[],e.REPORT_TINYID_WHITELIST=[],e._statInfoArr=[],e._avgRTT=new Yu,e._avgE2EDelay=new Wu,e._rateMessageSent=new ju,e._rateMessageReceived=new Ju;var t=e.getInnerEmitterInstance();return t.on(Re.A2KEY_AND_TINYID_UPDATED,e._onLoginSuccess,K(e)),t.on(Re.CLOUD_CONFIG_UPDATED,e._onCloudConfigUpdated,K(e)),e}function ga(){D(this,ga),this._lastMap=new Map,this._currentMap=new Map}function ha(){D(this,ha),this._map=new Map}function fa(){D(this,fa),this._n="AvgRTT",this._requestCount=0,this._rttArray=[]}function ma(){D(this,ma),this._n="AvgE2EDelay",this._e2eDelayArray=[]}function To(e){return D(this,To),(e=Hr.call(this,e))._n="RecoverMessageModule",e.PULL_LIMIT_COUNT=15,e}function Do(e){return D(this,Do),(e=Kr.call(this,e))._n="CloudControlModule",e._cloudConfig=new Map,e._expiredTime=0,e._version=0,e._isFetching=!1,e}function So(e){return D(this,So),(e=Wr.call(this,e))._n="SessionModule",e._platform=e.getPlatform(),e._protocolHandler=new bu(K(e)),e._messageDispatcher=new Fu(K(e)),e._commandFrequencyLimitMap=new Map,e._commandRequestInfoMap=new Map,e._serverOverloadInfoMap=new Map,e._incrementalPullContactFlag=!0,e._init(),e.getInnerEmitterInstance().on(Re.CLOUD_CONFIG_UPDATED,e._onCloudConfigUpdated,K(e)),e}var Lo={},Ye={};return Ye.create=function(a){var t="TencentCloudChat.create",n=0,i=a.SDKAppID;if(fe(i))n=i;else if(n=parseInt(i),isNaN(i))return u.e("".concat(t," failed. Failed to parse the SDKAppID, please check the arguments")),null;if(n&&Lo[n])return Lo[n];u.l("".concat(t));var o,s,i=new Il(l(l({},a),{},{SDKAppID:n})),a=(i.on(V.SDK_DESTROY,function(r){Lo[r.data.SDKAppID]=null,delete Lo[r.data.SDKAppID]}),o=i,s=Object.create(null),Object.keys(Sc).forEach(function(r){var c;o[r]&&(c=new Yt,s[r]=function(){var d=Array.from(arguments);return c.use(function(p,h){var m=function(f,I){if(f.isReady()||Ml[I]===1)return!0;var k={code:k=f.getNotReadyReason(),message:"".concat(f.getErrorMessage(k)," | ").concat(I," | ").concat(f.getErrorMessage(M.SDK_IS_NOT_READY))};return f.onError(k),k}(o,r);return m===!0?h():v(m)}).use(function(p,h){if(function(m,f,I){if(f===void 0)return!0;var k=!0;if(Ce(f))Object.keys(f).forEach(function(x){var Y=m.length===1?m[0][x]:void 0;k=!!$a(Y,f[x],I,x)&&k});else if(F(f))for(var N=0;N<f.length;N++)k=!!$a(m[N],f[N],I,f[N].name)&&k;if(k)return k;throw new Error("Params validate failed.")}(p,or[r],r)===!0)return h()}).use(function(p,h){return o[r].apply(o,p)}),c.run(d)})}),s);return Lo[n]=a,or.hookGetAPITips(i.getErrorMessage.bind(i)),u.l("".concat(t," ok")),a},Ye.TYPES=_,Ye.EVENT=V,Ye.TSignaling=Me,Ye.VERSION="3.3.5",u.l("TencentCloudChat.VERSION:".concat(Ye.VERSION)),Ye})})(Mc);const vs=Mc.exports;bn();const je=fn();class dc{constructor(A){Ro(this,"chat");Ro(this,"sdkAppId");Ro(this,"userId");Ro(this,"userSig");const{sdkAppId:T,userId:l,userSig:O}=A;this.sdkAppId=T,this.chat=null,this.userId=l,this.userSig=O,this.initChat()}async initChat(){this.chat=await vs.create({SDKAppID:this.sdkAppId}),this.join()}async join(){this.chat.login({userID:this.userId,userSig:this.userSig}).then(T=>{setTimeout(()=>{this.listenIn(),this.getMessageRead(),setTimeout(()=>{this.getConversationList()},200)},400),T.data,T.data.repeatLogin===!0&&T.data.errorInfo}).catch(function(T){console.warn("login error:",T)})}getConversationList(){this.chat.getConversationList().then(function(T){const l=T.data.conversationList;l.length>=1,l.length>=1?(je.aiList=[],l.forEach(O=>{O.userProfile&&O.userProfile.nick!="PushBot"&&(typeof O.lastMessage.payload.data=="string"&&(O.lastMessage.payload.data=JSON.parse(O.lastMessage.payload.data)),isNaN(O.lastMessage.lastTime)||(O.lastMessage.lastTime=Qr(O.lastMessage.lastTime)),O.lastMessage.content=O.lastMessage.payload.text?O.lastMessage.payload.text:O.lastMessage.payload.data.content,je.aiList.push(O))}),je.aiInfo.ai_uid&&(je.isAI=je.aiList.some(O=>O.userProfile.userID===je.aiInfo.ai_uid))):je.aiInfo.ai_uid&&(je.isAI=!1)}).catch(function(T){console.warn("getConversationList error:",T)})}deleteConversation(A,T){this.chat.deleteConversation(A).then(function(O){O.data,je.aiList.splice(T,1)}).catch(function(O){console.warn("deleteConversation error:",O)})}getMessageRead(){if(!je.aiInfo.ai_uid)return!1;setTimeout(()=>{this.getConversationList()},200),this.chat.setMessageRead({conversationID:"C2C"+je.aiInfo.ai_uid}),this.chat.getMessageList({conversationID:"C2C"+je.aiInfo.ai_uid}).then(T=>{T.data.messageList.forEach(O=>{je.originalData.push(O),this.setList(hs(O))})})}onMessageReceived(A){A.data.forEach(l=>{l.type===vs.TYPES.MSG_CUSTOM&&(je.originalData.push(l),this.getConversationList(),this.setList(l))})}sendToAiText(A){const T=this.chat.createCustomMessage({to:je.aiInfo.ai_uid,conversationType:vs.TYPES.CONV_C2C,payload:{data:JSON.stringify(A),description:String(this.random(1,6)),extension:""}});this.chat.sendMessage(T).then(function(O){}).catch(function(O){console.warn("sendMessage error:",O)})}random(A,T){return Math.floor(Math.random()*(T-A+1)+A)}listenIn(){this.chat.on(vs.EVENT.MESSAGE_RECEIVED,this.onMessageReceived.bind(this))}setList(A){try{je.isSend=0,A._elements.forEach((T,l)=>{if(!T.content.data)return!1;if(T.content.data,typeof T.content.data=="string")try{T.content.data=JSON.parse(T.content.data)}catch(O){console.error("\u89E3\u6790 JSON \u51FA\u9519:",O)}else T.content.data=T.content.data;if(T.content.data.extra==null)return!1;(T.content.data.extra.dataType=="text"||T.content.data.extra.dataType=="audio"||T.content.data.extra.dataType=="image")&&(T.content.data.is_ai_reply=!0,T.to=A.to,Vl(A.time)!=""&&(T.time=Qr(A.time)),je.chatList.push(T),je.chatList)})}catch{}}modifyMessage(A){je.chatList[A];const T=hs(je.chatList[A]),l=JSON.stringify(T.content.data),O=hs(je.originalData[A]);O.payload.data=l,O._elements[0].content.data=l,this.chat.modifyMessage(O).then(w=>{w.data}).catch(function(w){})}deleteMessage(A){const T=hs(je.originalData[A]);this.chat.deleteMessage([T]).then(O=>{this.modifyMessage(A)}).catch(function(O){console.warn("\u5220\u9664\u6D88\u606F\u5931\u8D25deleteMessage error:",O)})}}const yc=y=>(wo("data-v-3fd601c3"),y=y(),Fo(),y),N_={key:0,class:"photoAlbum"},O_={class:"photoDialog"},G_={class:"name"},P_={key:0,class:"cont"},U_={class:"nImageBox"},b_=yc(()=>J("i",null,null,-1)),w_=yc(()=>J("i",null,null,-1)),F_={key:1,class:"cont empty"},q_={key:1,class:"photoAlbum"},x_={key:0,class:"photoDialog_m"},V_={class:"name"},B_={key:0,class:"cont"},H_={key:1,class:"cont empty"},K_=Tt({__name:"photoAlbum",setup(y){const A=Cs(),T=bn(),l=Fe(!1);Ra();const O=bo(),D=O==null?void 0:O.appContext.config.globalProperties.$isMobile,w=O==null?void 0:O.appContext.config.globalProperties.$sensors,R=fn(),H=()=>{R.isPopupPhoto=!1},z=()=>{R.isPopupPhoto=!1},oe=Fe([]),_e=async()=>{const Ie={page:1,page_size:20,ai_uid:R.aiInfo.ai_uid,sort:"Earliest"},j=await Ul(Ie);oe.value=j.data},ve=()=>{var Ie;((Ie=T.userInfo)==null?void 0:Ie.vip_info.vip_type)==0&&(A.push("/becomePro"),R.isPopupPhoto=!1)};return Wt(()=>R.isPopupPhoto,()=>{R.isPopupPhoto&&(_e(),w.track("h5_gallery_view",{photo_num:oe.value.length,from_our_platform:"ponrh.ai",ref_name:"pornh.ai:"+Mt("ref")}))},{immediate:!0}),(Ie,j)=>{const Z=Zr("n-space"),K=Zr("n-image-group");return B(D)?(ee(),ne("div",q_,[B(R).isPopupPhoto?(ee(),ne("div",x_,[J("div",V_,[J("img",{src:Ts,class:"prev",onClick:z}),gn(" "+$e(B(R).aiInfo.ai_name)+"'s Gallery ",1)]),oe.value.length>0?(ee(),ne("div",B_,[Ue(K,{"show-toolbar-tooltip":""},{default:it(()=>[Ue(Z,{class:"picBox"},{default:it(()=>[(ee(!0),ne(yt,null,on(oe.value,(X,$)=>(ee(),hn(B(sn),{width:"100%",src:X.pic_url},null,8,["src"]))),256))]),_:1})]),_:1})])):(ee(),ne("div",H_,"Empty photo album "))])):ct("",!0)])):(ee(),ne("div",N_,[Ue(B(ys),{show:B(R).isPopupPhoto,"onUpdate:show":j[0]||(j[0]=X=>B(R).isPopupPhoto=X),"on-after-leave":H},{default:it(()=>[Ue(B(As),{show:l.value},{default:it(()=>[J("div",O_,[J("div",G_,$e(B(R).aiInfo.ai_name)+"'s Gallery",1),oe.value.length>0?(ee(),ne("div",P_,[Ue(K,{"show-toolbar-tooltip":""},{default:it(()=>[Ue(Z,{class:"picBox"},{default:it(()=>[(ee(!0),ne(yt,null,on(oe.value,(X,$)=>{var b;return ee(),ne("div",U_,[Ue(B(sn),{width:"100%",src:X.pic_url,onClick:ve},null,8,["src"]),((b=B(T).userInfo)==null?void 0:b.vip_info.vip_type)==0?(ee(),ne("div",{key:0,class:"btn",onClick:ve},"Pro ")):ct("",!0)])}),256)),b_,w_]),_:1})]),_:1})])):(ee(),ne("div",F_,"Empty photo album"))])]),_:1},8,["show"])]),_:1},8,["show"])]))}}});const W_=mn(K_,[["__scopeId","data-v-3fd601c3"]]),Y_={class:"light-green",style:{background:"#131313",height:"100%",position:"relative",overflow:"scroll"}},j_={class:"light-green",style:{background:"#18143c",height:"100%",position:"relative"}},J_=Tt({__name:"chatView",setup(y){const A=bn(),T=fn();T.chatList=[],T.isSend=0;const l=Fe(0);T.mainPosition;const O=D=>{T.mainPosition=D,l.value++};return Un(async()=>{A.Token!=""&&(await T.getInitChat(),await T.getInitIm(),T.chatIm=await new dc({sdkAppId:T.sdkAppId,userId:A.userInfo.uid,userSig:T.init.userSig}))}),Wt(()=>A.Token,async()=>{A.Token&&(await T.getInitChat(),await T.getInitIm(),T.chatIm=await new dc({sdkAppId:T.sdkAppId,userId:A.userInfo.uid,userSig:T.init.userSig}))},{immediate:!1}),(D,w)=>(ee(),ne(yt,null,[Ue(B(Nd),{"h-100p":"","overflow-hidden":"","x-gap":"0",cols:24,class:"chatGrid",style:ka({left:"-"+B(T).mainPosition+"%"})},{default:it(()=>[Ue(B(ms),{span:6,style:{background:"#1A1A1A",height:"100%",position:"relative"},class:"chatPeople"},{default:it(()=>[Ue(vp,{onChangePosition:O})]),_:1}),B(A).Token!=""&&(B(T).aiList!=""||!B(T).isAI)&&B(T).aiInfo.ai_uid||Object.keys(B(T).aiInfo).length!==0&&!B(A).Token?(ee(),ne(yt,{key:0},[Ue(B(ms),{span:11,class:"chatDialogue"},{default:it(()=>[J("div",Y_,[Ue(s_,{onChangePosition:O,changeStatus:l.value},null,8,["changeStatus"])])]),_:1}),Ue(B(ms),{span:7,class:"chatDetalis"},{default:it(()=>[J("div",j_,[Ue(C_,{onChangePosition:O})])]),_:1})],64)):(ee(),hn(B(ms),{key:1,span:18},{default:it(()=>[Ue(R_)]),_:1}))]),_:1},8,["style"]),B(T).isLoadAi&&B(T).aiList!=""?(ee(),hn(B(As),{key:0,"position-absolute":"","left-0":"","top-0":"","w-100p":"","h-100p":"","z-6":""})):ct("",!0),Ue(W_)],64))}});const tg=mn(J_,[["__scopeId","data-v-b434f5bd"]]);export{tg as default};
